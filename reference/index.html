
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://micdoh.github.io/XLRON/reference/">
      
      
        <link rel="prev" href="../flags_reference/">
      
      
        <link rel="next" href="../license/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Function reference - XLRON - Accelerated Learning and Resource Allocation for Optical Networks</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="yellow" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#environments" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="XLRON - Accelerated Learning and Resource Allocation for Optical Networks" class="md-header__button md-logo" aria-label="XLRON - Accelerated Learning and Resource Allocation for Optical Networks" data-md-component="logo">
      
  <img src="../images/xlron_nobackground.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            XLRON - Accelerated Learning and Resource Allocation for Optical Networks
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Function reference
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="XLRON - Accelerated Learning and Resource Allocation for Optical Networks" class="md-nav__button md-logo" aria-label="XLRON - Accelerated Learning and Resource Allocation for Optical Networks" data-md-component="logo">
      
  <img src="../images/xlron_nobackground.png" alt="logo">

    </a>
    XLRON - Accelerated Learning and Resource Allocation for Optical Networks
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding_xlron/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Understanding XLRON
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../flags_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command-line options
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Function reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Function reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#xlron.environments" class="md-nav__link">
    <span class="md-ellipsis">
      environments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.EnvParams" class="md-nav__link">
    <span class="md-ellipsis">
      EnvParams
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.EnvState" class="md-nav__link">
    <span class="md-ellipsis">
      EnvState
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv" class="md-nav__link">
    <span class="md-ellipsis">
      RMSAGNModelEnv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RMSAGNModelEnv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv.action_mask" class="md-nav__link">
    <span class="md-ellipsis">
      action_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv.num_actions" class="md-nav__link">
    <span class="md-ellipsis">
      num_actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv.observation_space" class="md-nav__link">
    <span class="md-ellipsis">
      observation_space
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnvParams" class="md-nav__link">
    <span class="md-ellipsis">
      RMSAGNModelEnvParams
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnvState" class="md-nav__link">
    <span class="md-ellipsis">
      RMSAGNModelEnvState
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv" class="md-nav__link">
    <span class="md-ellipsis">
      RSAGNModelEnv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RSAGNModelEnv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv.num_actions" class="md-nav__link">
    <span class="md-ellipsis">
      num_actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv.observation_space" class="md-nav__link">
    <span class="md-ellipsis">
      observation_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnvParams" class="md-nav__link">
    <span class="md-ellipsis">
      RSAGNModelEnvParams
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnvState" class="md-nav__link">
    <span class="md-ellipsis">
      RSAGNModelEnvState
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    About
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    License and Support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Change Log
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#xlron.environments" class="md-nav__link">
    <span class="md-ellipsis">
      environments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.EnvParams" class="md-nav__link">
    <span class="md-ellipsis">
      EnvParams
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.EnvState" class="md-nav__link">
    <span class="md-ellipsis">
      EnvState
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv" class="md-nav__link">
    <span class="md-ellipsis">
      RMSAGNModelEnv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RMSAGNModelEnv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv.action_mask" class="md-nav__link">
    <span class="md-ellipsis">
      action_mask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv.num_actions" class="md-nav__link">
    <span class="md-ellipsis">
      num_actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnv.observation_space" class="md-nav__link">
    <span class="md-ellipsis">
      observation_space
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnvParams" class="md-nav__link">
    <span class="md-ellipsis">
      RMSAGNModelEnvParams
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RMSAGNModelEnvState" class="md-nav__link">
    <span class="md-ellipsis">
      RMSAGNModelEnvState
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv" class="md-nav__link">
    <span class="md-ellipsis">
      RSAGNModelEnv
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RSAGNModelEnv">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv.num_actions" class="md-nav__link">
    <span class="md-ellipsis">
      num_actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv.observation_space" class="md-nav__link">
    <span class="md-ellipsis">
      observation_space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnv.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnvParams" class="md-nav__link">
    <span class="md-ellipsis">
      RSAGNModelEnvParams
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlron.environments.RSAGNModelEnvState" class="md-nav__link">
    <span class="md-ellipsis">
      RSAGNModelEnvState
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="environments">Environments</h1>


<div class="doc doc-object doc-module">



<a id="xlron.environments"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="xlron.environments.EnvParams" class="doc doc-heading">
            <code>EnvParams</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment parameters. Parameters are immutable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of requests in an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>incremental_loading</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Incremental increase in traffic load (non-expiring requests)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_first_blocking</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End episode on first blocking event</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>continuous_operation</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, do not reset the environment at the end of an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two column array defining source-dest node-pair edges of the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slot_size</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral width of frequency slot in GHz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>consider_modulation_format</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, consider modulation format to determine required slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_length_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of link lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots to aggregate into a single action (First-Fit with aggregation)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guardband</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Guard band in slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed_graph</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed (one fibre per link per transmission direction)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters. Parameters are immutable.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_requests (chex.Scalar): Maximum number of requests in an episode</span>
<span class="sd">        incremental_loading (chex.Scalar): Incremental increase in traffic load (non-expiring requests)</span>
<span class="sd">        end_first_blocking (chex.Scalar): End episode on first blocking event</span>
<span class="sd">        continuous_operation (chex.Scalar): If True, do not reset the environment at the end of an episode</span>
<span class="sd">        edges (chex.Array): Two column array defining source-dest node-pair edges of the graph</span>
<span class="sd">        slot_size (chex.Scalar): Spectral width of frequency slot in GHz</span>
<span class="sd">        consider_modulation_format (chex.Scalar): If True, consider modulation format to determine required slots</span>
<span class="sd">        link_length_array (chex.Array): Array of link lengths</span>
<span class="sd">        aggregate_slots (chex.Scalar): Number of slots to aggregate into a single action (First-Fit with aggregation)</span>
<span class="sd">        guardband (chex.Scalar): Guard band in slots</span>
<span class="sd">        directed_graph (bool): Whether graph is directed (one fibre per link per transmission direction)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">incremental_loading</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_first_blocking</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">continuous_operation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">slot_size</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">consider_modulation_format</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_length_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">aggregate_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">guardband</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">directed_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">maximise_throughput</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">reward_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">values_bw</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">truncate_holding_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traffic_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pack_path_bits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">relative_arrival_times</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.EnvState" class="doc doc-heading">
            <code>EnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>current_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current time in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Holding time of current request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_timesteps</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total timesteps in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total requests in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="jraph.GraphsTuple">GraphsTuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Graph tuple representing network state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action mask for link slot action (including if slot actions are aggregated)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_time (chex.Scalar): Current time in environment</span>
<span class="sd">        holding_time (chex.Scalar): Holding time of current request</span>
<span class="sd">        total_timesteps (chex.Scalar): Total timesteps in environment</span>
<span class="sd">        total_requests (chex.Scalar): Total requests in environment</span>
<span class="sd">        graph (jraph.GraphsTuple): Graph tuple representing network state</span>
<span class="sd">        full_link_slot_mask (chex.Array): Action mask for link slot action (including if slot actions are aggregated)</span>
<span class="sd">        accepted_services (chex.Array): Number of accepted services</span>
<span class="sd">        accepted_bitrate (chex.Array): Accepted bitrate</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">current_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">arrival_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_timesteps</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">graph</span><span class="p">:</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span>
    <span class="n">full_link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.RMSAGNModelEnv" class="doc doc-heading">
            <code>RMSAGNModelEnv</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="xlron.environments.RSAEnv">RSAEnv</span></code></p>


        <p>RMSA + GNN model environment.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/gn_model/rmsa_gn_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnv</span><span class="p">(</span><span class="n">RSAEnv</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RMSA + GNN model environment.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span>
            <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span>
            <span class="n">traffic_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">launch_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">laplacian_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the environment state and set as initial state.</span>

<span class="sd">        Args:</span>
<span class="sd">            key: PRNG key</span>
<span class="sd">            params: Environment parameters</span>
<span class="sd">            traffic_matrix (optional): Traffic matrix</span>
<span class="sd">            launch_power_array (optional): Launch power array</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">traffic_matrix</span><span class="o">=</span><span class="n">traffic_matrix</span><span class="p">,</span> <span class="n">list_of_requests</span><span class="o">=</span><span class="n">list_of_requests</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="o">=</span><span class="n">laplacian_matrix</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">RMSAGNModelEnvState</span><span class="p">(</span>
            <span class="n">current_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">arrival_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">holding_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">total_timesteps</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">total_requests</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">link_slot_array</span><span class="o">=</span><span class="n">init_link_slot_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">init_link_slot_departure_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">request_array</span><span class="o">=</span><span class="n">init_rsa_request_array</span><span class="p">(),</span>
            <span class="n">link_slot_mask</span><span class="o">=</span><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">),</span>
            <span class="n">traffic_matrix</span><span class="o">=</span><span class="n">traffic_matrix</span> <span class="k">if</span> <span class="n">traffic_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">init_traffic_matrix</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">),</span>
            <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">accepted_services</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">accepted_bitrate</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
            <span class="n">total_bitrate</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
            <span class="n">list_of_requests</span><span class="o">=</span><span class="n">list_of_requests</span><span class="p">,</span>
            <span class="n">link_snr_array</span><span class="o">=</span><span class="n">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">path_index_array</span><span class="o">=</span><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">path_index_array_prev</span><span class="o">=</span><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">channel_power_array</span><span class="o">=</span><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">init_modulation_format_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">channel_centre_bw_array_prev</span><span class="o">=</span><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">channel_power_array_prev</span><span class="o">=</span><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">modulation_format_index_array_prev</span><span class="o">=</span><span class="n">init_modulation_format_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">launch_power_array</span><span class="o">=</span><span class="n">launch_power_array</span><span class="p">,</span>
            <span class="n">mod_format_mask</span><span class="o">=</span><span class="n">init_mod_format_mask</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">init_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="p">))</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">action_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">RSAEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RSAEnvState</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns mask of valid actions.</span>

<span class="sd">        Args:</span>
<span class="sd">            state: Environment state</span>
<span class="sd">            params: Environment parameters</span>

<span class="sd">        Returns:</span>
<span class="sd">            state: Environment state with action mask</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">mask_slots_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">RMSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RMSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_paths_obs_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_actions</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of actions possible in environment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">observation_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Observation space of the environment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span>
            <span class="mi">3</span> <span class="o">+</span>  <span class="c1"># Request array</span>
            <span class="mi">1</span> <span class="o">+</span>  <span class="c1"># Holding time</span>
            <span class="mi">7</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span>
            <span class="c1"># Path stats:</span>
            <span class="c1"># Mean free block size</span>
            <span class="c1"># Free slots</span>
            <span class="c1"># Path length (100 km)</span>
            <span class="c1"># Path length (hops)</span>
            <span class="c1"># Number of connections on path</span>
            <span class="c1"># Mean power of connection on path</span>
            <span class="c1"># Mean SNR of connection on path</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="xlron.environments.RMSAGNModelEnv.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">traffic_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">launch_power_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">list_of_requests</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the environment state and set as initial state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="xlron.environments.wrappers.chex.PRNGKey">PRNGKey</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PRNG key</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.wrappers.RSAGNModelEnvParams)" href="#xlron.environments.wrappers.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>traffic_matrix</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Traffic matrix</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>launch_power_array</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Launch power array</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/gn_model/rmsa_gn_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span>
        <span class="n">traffic_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">launch_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">laplacian_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the environment state and set as initial state.</span>

<span class="sd">    Args:</span>
<span class="sd">        key: PRNG key</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        traffic_matrix (optional): Traffic matrix</span>
<span class="sd">        launch_power_array (optional): Launch power array</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">traffic_matrix</span><span class="o">=</span><span class="n">traffic_matrix</span><span class="p">,</span> <span class="n">list_of_requests</span><span class="o">=</span><span class="n">list_of_requests</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="o">=</span><span class="n">laplacian_matrix</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">RMSAGNModelEnvState</span><span class="p">(</span>
        <span class="n">current_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">arrival_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">holding_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">total_timesteps</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">total_requests</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">init_link_slot_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">init_link_slot_departure_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">request_array</span><span class="o">=</span><span class="n">init_rsa_request_array</span><span class="p">(),</span>
        <span class="n">link_slot_mask</span><span class="o">=</span><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">),</span>
        <span class="n">traffic_matrix</span><span class="o">=</span><span class="n">traffic_matrix</span> <span class="k">if</span> <span class="n">traffic_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">init_traffic_matrix</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">),</span>
        <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">accepted_services</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">accepted_bitrate</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">list_of_requests</span><span class="o">=</span><span class="n">list_of_requests</span><span class="p">,</span>
        <span class="n">link_snr_array</span><span class="o">=</span><span class="n">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">path_index_array_prev</span><span class="o">=</span><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">init_modulation_format_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array_prev</span><span class="o">=</span><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">channel_power_array_prev</span><span class="o">=</span><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">modulation_format_index_array_prev</span><span class="o">=</span><span class="n">init_modulation_format_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">launch_power_array</span><span class="o">=</span><span class="n">launch_power_array</span><span class="p">,</span>
        <span class="n">mod_format_mask</span><span class="o">=</span><span class="n">init_mod_format_mask</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initial_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">init_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.RMSAGNModelEnv.action_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns mask of valid actions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="xlron.environments.RSAEnvState">RSAEnvState</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="xlron.environments.RSAEnvParams">RSAEnvParams</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><span title="xlron.environments.RSAEnvState">RSAEnvState</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state with action mask</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/gn_model/rmsa_gn_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">action_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">RSAEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RSAEnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns mask of valid actions.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Environment state with action mask</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">mask_slots_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.RMSAGNModelEnv.num_actions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_actions</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Number of actions possible in environment.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/gn_model/rmsa_gn_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">num_actions</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of actions possible in environment.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.RMSAGNModelEnv.observation_space" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">observation_space</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Observation space of the environment.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/gn_model/rmsa_gn_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">observation_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Observation space of the environment.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span>
        <span class="mi">3</span> <span class="o">+</span>  <span class="c1"># Request array</span>
        <span class="mi">1</span> <span class="o">+</span>  <span class="c1"># Holding time</span>
        <span class="mi">7</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span>
        <span class="c1"># Path stats:</span>
        <span class="c1"># Mean free block size</span>
        <span class="c1"># Free slots</span>
        <span class="c1"># Path length (100 km)</span>
        <span class="c1"># Path length (hops)</span>
        <span class="c1"># Number of connections on path</span>
        <span class="c1"># Mean power of connection on path</span>
        <span class="c1"># Mean SNR of connection on path</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.RMSAGNModelEnvParams" class="doc doc-heading">
            <code>RMSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulations_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.RMSAGNModelEnvState" class="doc doc-heading">
            <code>RMSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulation_format_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection</span>
    <span class="n">modulation_format_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection in previous timestep</span>
    <span class="n">mod_format_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format mask</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.RSAGNModelEnv" class="doc doc-heading">
            <code>RSAGNModelEnv</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="xlron.environments.RSAEnv">RSAEnv</span></code></p>


        <p>RMSA + GNN model environment.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/gn_model/rsa_gn_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnv</span><span class="p">(</span><span class="n">RSAEnv</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;RMSA + GNN model environment.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span>
            <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span>
            <span class="n">traffic_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">launch_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">laplacian_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the environment state and set as initial state.</span>

<span class="sd">        Args:</span>
<span class="sd">            key: PRNG key</span>
<span class="sd">            params: Environment parameters</span>
<span class="sd">            traffic_matrix (optional): Traffic matrix</span>
<span class="sd">            launch_power_array (optional): Launch power array</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">traffic_matrix</span><span class="o">=</span><span class="n">traffic_matrix</span><span class="p">,</span> <span class="n">list_of_requests</span><span class="o">=</span><span class="n">list_of_requests</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="o">=</span><span class="n">laplacian_matrix</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">RSAGNModelEnvState</span><span class="p">(</span>
            <span class="n">current_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">arrival_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">holding_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">total_timesteps</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">total_requests</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">link_slot_array</span><span class="o">=</span><span class="n">init_link_slot_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">init_link_slot_departure_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">request_array</span><span class="o">=</span><span class="n">init_rsa_request_array</span><span class="p">(),</span>
            <span class="n">link_slot_mask</span><span class="o">=</span><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">),</span>
            <span class="n">traffic_matrix</span><span class="o">=</span><span class="n">traffic_matrix</span> <span class="k">if</span> <span class="n">traffic_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">init_traffic_matrix</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">),</span>
            <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">accepted_services</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">accepted_bitrate</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
            <span class="n">total_bitrate</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
            <span class="n">list_of_requests</span><span class="o">=</span><span class="n">list_of_requests</span><span class="p">,</span>
            <span class="n">link_snr_array</span><span class="o">=</span><span class="n">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">path_index_array</span><span class="o">=</span><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">path_index_array_prev</span><span class="o">=</span><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">channel_power_array</span><span class="o">=</span><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">channel_centre_bw_array_prev</span><span class="o">=</span><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">channel_power_array_prev</span><span class="o">=</span><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">launch_power_array</span><span class="o">=</span><span class="n">launch_power_array</span><span class="p">,</span>
            <span class="n">active_lightpaths_array</span><span class="o">=</span><span class="n">init_active_lightpaths_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">active_lightpaths_array_departure</span><span class="o">=</span><span class="n">init_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
            <span class="n">throughput</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">init_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="p">))</span>


    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RSAEnvParams</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RSAEnvState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">RSAEnvState</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the environment and log the total throughput at episode end.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">throughput_condition</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span> <span class="ow">and</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">throughput</span> <span class="o">=</span> <span class="n">calculate_throughput_from_active_lightpaths</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span>
            <span class="n">throughput_condition</span><span class="p">)</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">throughput</span><span class="o">=</span><span class="n">throughput</span><span class="p">)</span>
        <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;resetting env, throughput: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">throughput</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obs</span><span class="p">,</span> <span class="n">state</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
        <span class="c1"># Monitoring active lightpaths is used to track total throughput at end of episode</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span><span class="p">:</span>
           <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">get_paths_obs_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_actions</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Number of actions possible in environment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">observation_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Observation space of the environment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span>
            <span class="mi">3</span> <span class="o">+</span>  <span class="c1"># Request array</span>
            <span class="mi">1</span> <span class="o">+</span>  <span class="c1"># Holding time</span>
            <span class="mi">7</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span>
            <span class="c1"># Path stats:</span>
            <span class="c1"># Mean free block size</span>
            <span class="c1"># Free slots</span>
            <span class="c1"># Path length (100 km)</span>
            <span class="c1"># Path length (hops)</span>
            <span class="c1"># Number of connections on path</span>
            <span class="c1"># Mean power of connection on path</span>
            <span class="c1"># Mean SNR of connection on path</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="xlron.environments.RSAGNModelEnv.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">traffic_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">launch_power_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">list_of_requests</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialise the environment state and set as initial state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="xlron.environments.wrappers.chex.PRNGKey">PRNGKey</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PRNG key</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.wrappers.RSAGNModelEnvParams)" href="#xlron.environments.wrappers.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>traffic_matrix</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Traffic matrix</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>launch_power_array</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Launch power array</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/gn_model/rsa_gn_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span>
        <span class="n">traffic_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">launch_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">laplacian_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise the environment state and set as initial state.</span>

<span class="sd">    Args:</span>
<span class="sd">        key: PRNG key</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        traffic_matrix (optional): Traffic matrix</span>
<span class="sd">        launch_power_array (optional): Launch power array</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">traffic_matrix</span><span class="o">=</span><span class="n">traffic_matrix</span><span class="p">,</span> <span class="n">list_of_requests</span><span class="o">=</span><span class="n">list_of_requests</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="o">=</span><span class="n">laplacian_matrix</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">RSAGNModelEnvState</span><span class="p">(</span>
        <span class="n">current_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">arrival_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">holding_time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">total_timesteps</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">total_requests</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">init_link_slot_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">init_link_slot_departure_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">request_array</span><span class="o">=</span><span class="n">init_rsa_request_array</span><span class="p">(),</span>
        <span class="n">link_slot_mask</span><span class="o">=</span><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">),</span>
        <span class="n">traffic_matrix</span><span class="o">=</span><span class="n">traffic_matrix</span> <span class="k">if</span> <span class="n">traffic_matrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">init_traffic_matrix</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">),</span>
        <span class="n">graph</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">accepted_services</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">accepted_bitrate</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">list_of_requests</span><span class="o">=</span><span class="n">list_of_requests</span><span class="p">,</span>
        <span class="n">link_snr_array</span><span class="o">=</span><span class="n">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">path_index_array_prev</span><span class="o">=</span><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array_prev</span><span class="o">=</span><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">channel_power_array_prev</span><span class="o">=</span><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">launch_power_array</span><span class="o">=</span><span class="n">launch_power_array</span><span class="p">,</span>
        <span class="n">active_lightpaths_array</span><span class="o">=</span><span class="n">init_active_lightpaths_array</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">active_lightpaths_array_departure</span><span class="o">=</span><span class="n">init_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">throughput</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initial_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">init_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">laplacian_matrix</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.RSAGNModelEnv.num_actions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_actions</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Number of actions possible in environment.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/gn_model/rsa_gn_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">num_actions</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Number of actions possible in environment.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.RSAGNModelEnv.observation_space" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">observation_space</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Observation space of the environment.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/gn_model/rsa_gn_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">observation_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Observation space of the environment.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">spaces</span><span class="o">.</span><span class="n">Discrete</span><span class="p">(</span>
        <span class="mi">3</span> <span class="o">+</span>  <span class="c1"># Request array</span>
        <span class="mi">1</span> <span class="o">+</span>  <span class="c1"># Holding time</span>
        <span class="mi">7</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span>
        <span class="c1"># Path stats:</span>
        <span class="c1"># Mean free block size</span>
        <span class="c1"># Free slots</span>
        <span class="c1"># Path length (100 km)</span>
        <span class="c1"># Path length (hops)</span>
        <span class="c1"># Number of connections on path</span>
        <span class="c1"># Mean power of connection on path</span>
        <span class="c1"># Mean SNR of connection on path</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.RSAGNModelEnv.reset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reset the environment and log the total throughput at episode end.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/gn_model/rsa_gn_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RSAEnvParams</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">RSAEnvState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">RSAEnvState</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset the environment and log the total throughput at episode end.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">throughput_condition</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span> <span class="ow">and</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">throughput</span> <span class="o">=</span> <span class="n">calculate_throughput_from_active_lightpaths</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span>
        <span class="n">throughput_condition</span><span class="p">)</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">throughput</span><span class="o">=</span><span class="n">throughput</span><span class="p">)</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;resetting env, throughput: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">throughput</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obs</span><span class="p">,</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.RSAGNModelEnvParams" class="doc doc-heading">
            <code>RSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">min_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fec_threshold</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.RSAGNModelEnvState" class="doc doc-heading">
            <code>RSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active_lightpaths_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array. 1 x M array. Each value is a lightpath index. Used to calculate total throughput.</span>
    <span class="n">active_lightpaths_array_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array departure time.</span>
    <span class="n">throughput</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Current network throughput</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h1 id="dataclasses">Dataclasses</h1>


<div class="doc doc-object doc-module">



<a id="xlron.environments.dataclasses"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.DeepRMSAEnvState" class="doc doc-heading">
            <code>DeepRMSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for DeepRMSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_stats</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path stats array containing</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DeepRMSAEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for DeepRMSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_stats (chex.Array): Path stats array containing</span>
<span class="sd">        1. Required slots on path</span>
<span class="sd">        2. Total available slots on path</span>
<span class="sd">        3. Size of 1st free spectrum block</span>
<span class="sd">        4. Avg. free block size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_stats</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.EnvParams" class="doc doc-heading">
            <code>EnvParams</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment parameters. Parameters are immutable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of requests in an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>incremental_loading</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Incremental increase in traffic load (non-expiring requests)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_first_blocking</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End episode on first blocking event</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>continuous_operation</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, do not reset the environment at the end of an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two column array defining source-dest node-pair edges of the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slot_size</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral width of frequency slot in GHz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>consider_modulation_format</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, consider modulation format to determine required slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_length_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of link lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots to aggregate into a single action (First-Fit with aggregation)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guardband</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Guard band in slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed_graph</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed (one fibre per link per transmission direction)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters. Parameters are immutable.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_requests (chex.Scalar): Maximum number of requests in an episode</span>
<span class="sd">        incremental_loading (chex.Scalar): Incremental increase in traffic load (non-expiring requests)</span>
<span class="sd">        end_first_blocking (chex.Scalar): End episode on first blocking event</span>
<span class="sd">        continuous_operation (chex.Scalar): If True, do not reset the environment at the end of an episode</span>
<span class="sd">        edges (chex.Array): Two column array defining source-dest node-pair edges of the graph</span>
<span class="sd">        slot_size (chex.Scalar): Spectral width of frequency slot in GHz</span>
<span class="sd">        consider_modulation_format (chex.Scalar): If True, consider modulation format to determine required slots</span>
<span class="sd">        link_length_array (chex.Array): Array of link lengths</span>
<span class="sd">        aggregate_slots (chex.Scalar): Number of slots to aggregate into a single action (First-Fit with aggregation)</span>
<span class="sd">        guardband (chex.Scalar): Guard band in slots</span>
<span class="sd">        directed_graph (bool): Whether graph is directed (one fibre per link per transmission direction)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">incremental_loading</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_first_blocking</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">continuous_operation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">slot_size</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">consider_modulation_format</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_length_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">aggregate_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">guardband</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">directed_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">maximise_throughput</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">reward_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">values_bw</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">truncate_holding_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traffic_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pack_path_bits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">relative_arrival_times</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.EnvState" class="doc doc-heading">
            <code>EnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>current_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current time in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Holding time of current request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_timesteps</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total timesteps in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total requests in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="jraph.GraphsTuple">GraphsTuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Graph tuple representing network state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action mask for link slot action (including if slot actions are aggregated)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_time (chex.Scalar): Current time in environment</span>
<span class="sd">        holding_time (chex.Scalar): Holding time of current request</span>
<span class="sd">        total_timesteps (chex.Scalar): Total timesteps in environment</span>
<span class="sd">        total_requests (chex.Scalar): Total requests in environment</span>
<span class="sd">        graph (jraph.GraphsTuple): Graph tuple representing network state</span>
<span class="sd">        full_link_slot_mask (chex.Array): Action mask for link slot action (including if slot actions are aggregated)</span>
<span class="sd">        accepted_services (chex.Array): Number of accepted services</span>
<span class="sd">        accepted_bitrate (chex.Array): Accepted bitrate</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">current_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">arrival_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_timesteps</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">graph</span><span class="p">:</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span>
    <span class="n">full_link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.GNModelEnvParams" class="doc doc-heading">
            <code>GNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment state for GN model environments.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GNModelEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for GN model environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_lambda</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_spans</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_span_length</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">nonlinear_coeff</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">raman_gain_slope</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">attenuation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">attenuation_bar</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dispersion_coeff</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dispersion_slope</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">transceiver_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">amplifier_noise_figure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">coherent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_roadms</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">roadm_loss</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_spans</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">launch_power_type</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">snr_margin</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">step_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">last_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">default_launch_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mod_format_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">monitor_active_lightpaths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Monitor active lightpaths for throughput calculation</span>
    <span class="n">gap_starts</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_widths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">uniform_spans</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.GNModelEnvState" class="doc doc-heading">
            <code>GNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GNModelEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_snr_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Available SNR on each link</span>
    <span class="n">channel_centre_bw_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel centre bandwidth for each active connection</span>
    <span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots (used for lightpath SNR calculation)</span>
    <span class="n">channel_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel power for each active connection</span>
    <span class="n">channel_centre_bw_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel centre bandwidth for each active connection in previous timestep</span>
    <span class="n">path_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots in previous timestep</span>
    <span class="n">channel_power_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel power for each active connection in previous timestep</span>
    <span class="n">launch_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Launch power array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.LogEnvState" class="doc doc-heading">
            <code>LogEnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state for logging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>env_state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lengths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cum_returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>episode_lengths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Episode lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>episode_returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Episode returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>done</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Done</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LogEnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for logging.</span>

<span class="sd">    Args:</span>
<span class="sd">        env_state (EnvState): Environment state</span>
<span class="sd">        lengths (chex.Scalar): Lengths</span>
<span class="sd">        returns (chex.Scalar): Returns</span>
<span class="sd">        cum_returns (chex.Scalar): Cumulative returns</span>
<span class="sd">        episode_lengths (chex.Scalar): Episode lengths</span>
<span class="sd">        episode_returns (chex.Scalar): Episode returns</span>
<span class="sd">        accepted_services (chex.Scalar): Accepted services</span>
<span class="sd">        accepted_bitrate (chex.Scalar): Accepted bitrate</span>
<span class="sd">        done (chex.Scalar): Done</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env_state</span><span class="p">:</span> <span class="n">EnvState</span>
    <span class="n">lengths</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">returns</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">cum_returns</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">utilisation</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">done</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.MultiBandRSAEnvParams" class="doc doc-heading">
            <code>MultiBandRSAEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiBandRSAEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_start</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_width</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.MultiBandRSAEnvState" class="doc doc-heading">
            <code>MultiBandRSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiBandRSAEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RMSAGNModelEnvParams" class="doc doc-heading">
            <code>RMSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulations_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RMSAGNModelEnvState" class="doc doc-heading">
            <code>RMSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulation_format_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection</span>
    <span class="n">modulation_format_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection in previous timestep</span>
    <span class="n">mod_format_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format mask</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RSAEnvParams" class="doc doc-heading">
            <code>RSAEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for RSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_nodes</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_links</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of links</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of link resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_paths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mean_service_holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean service holding time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Load</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arrival_rate</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arrival rate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_link_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path link array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_traffic</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random traffic matrix for RSA on each reset (else uniform or custom)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_se_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path spectral efficiency array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>deterministic_requests</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use deterministic requests</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>multiple_topologies</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use multiple topologies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAEnvParams</span><span class="p">(</span><span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for RSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_nodes (chex.Scalar): Number of nodes</span>
<span class="sd">        num_links (chex.Scalar): Number of links</span>
<span class="sd">        link_resources (chex.Scalar): Number of link resources</span>
<span class="sd">        k_paths (chex.Scalar): Number of paths</span>
<span class="sd">        mean_service_holding_time (chex.Scalar): Mean service holding time</span>
<span class="sd">        load (chex.Scalar): Load</span>
<span class="sd">        arrival_rate (chex.Scalar): Arrival rate</span>
<span class="sd">        path_link_array (chex.Array): Path link array</span>
<span class="sd">        random_traffic (bool): Random traffic matrix for RSA on each reset (else uniform or custom)</span>
<span class="sd">        max_slots (chex.Scalar): Maximum number of slots</span>
<span class="sd">        path_se_array (chex.Array): Path spectral efficiency array</span>
<span class="sd">        deterministic_requests (bool): If True, use deterministic requests</span>
<span class="sd">        multiple_topologies (bool): If True, use multiple topologies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_links</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">k_paths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mean_service_holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">load</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">arrival_rate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">random_traffic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_se_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">deterministic_requests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">multiple_topologies</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">log_actions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">disable_node_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RSAEnvState" class="doc doc-heading">
            <code>RSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_departure_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot mask</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>traffic_matrix</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Traffic matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAEnvState</span><span class="p">(</span><span class="n">EnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array (chex.Array): Link slot array</span>
<span class="sd">        request_array (chex.Array): Request array</span>
<span class="sd">        link_slot_departure_array (chex.Array): Link slot departure array</span>
<span class="sd">        link_slot_mask (chex.Array): Link slot mask</span>
<span class="sd">        traffic_matrix (chex.Array): Traffic matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">request_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">link_slot_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">traffic_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RSAGNModelEnvParams" class="doc doc-heading">
            <code>RSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">min_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fec_threshold</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RSAGNModelEnvState" class="doc doc-heading">
            <code>RSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active_lightpaths_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array. 1 x M array. Each value is a lightpath index. Used to calculate total throughput.</span>
    <span class="n">active_lightpaths_array_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array departure time.</span>
    <span class="n">throughput</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Current network throughput</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RSAMultibandEnvParams" class="doc doc-heading">
            <code>RSAMultibandEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAMultibandEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_starts</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_widths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RSAMultibandEnvState" class="doc doc-heading">
            <code>RSAMultibandEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAMultibandEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.RWALightpathReuseEnvState" class="doc doc-heading">
            <code>RWALightpathReuseEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for RWA with lightpath reuse.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_index_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains indices of lightpaths in use on slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains remaining capacity of each lightpath</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains remaining capacity of lightpath on each link-slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RWALightpathReuseEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RWA with lightpath reuse.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_index_array (chex.Array): Contains indices of lightpaths in use on slots</span>
<span class="sd">        path_capacity_array (chex.Array): Contains remaining capacity of each lightpath</span>
<span class="sd">        link_capacity_array (chex.Array): Contains remaining capacity of lightpath on each link-slot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots</span>
    <span class="n">path_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains remaining capacity of each lightpath</span>
    <span class="n">link_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains remaining capacity of lightpath on each link-slot</span>
    <span class="n">time_since_last_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Time since last departure</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.VONEEnvParams" class="doc doc-heading">
            <code>VONEEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for VONE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_edges</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VONEEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for VONE.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_resources (chex.Scalar): Number of node resources</span>
<span class="sd">        max_edges (chex.Scalar): Maximum number of edges</span>
<span class="sd">        min_node_resources (chex.Scalar): Minimum number of node resources</span>
<span class="sd">        max_node_resources (chex.Scalar): Maximum number of node resources</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.dataclasses.VONEEnvState" class="doc doc-heading">
            <code>VONEEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for VONE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node capacity array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_resource_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node resource array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_counter</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action counter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_history</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_mask_s</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node mask for source node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_mask_d</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node mask for destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>virtual_topology_patterns</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Virtual topology patterns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values_nodes</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values for nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VONEEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for VONE.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_capacity_array (chex.Array): Node capacity array</span>
<span class="sd">        node_resource_array (chex.Array): Node resource array</span>
<span class="sd">        node_departure_array (chex.Array): Node departure array</span>
<span class="sd">        action_counter (chex.Array): Action counter</span>
<span class="sd">        action_history (chex.Array): Action history</span>
<span class="sd">        node_mask_s (chex.Array): Node mask for source node</span>
<span class="sd">        node_mask_d (chex.Array): Node mask for destination node</span>
<span class="sd">        virtual_topology_patterns (chex.Array): Virtual topology patterns</span>
<span class="sd">        values_nodes (chex.Array): Values for nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_resource_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">action_counter</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">action_history</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_mask_s</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_mask_d</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">virtual_topology_patterns</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">values_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h1 id="environment-wrappers">Environment wrappers</h1>


<div class="doc doc-object doc-module">



<a id="xlron.environments.wrappers"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.DeepRMSAEnvState" class="doc doc-heading">
            <code>DeepRMSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for DeepRMSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_stats</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path stats array containing</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DeepRMSAEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for DeepRMSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_stats (chex.Array): Path stats array containing</span>
<span class="sd">        1. Required slots on path</span>
<span class="sd">        2. Total available slots on path</span>
<span class="sd">        3. Size of 1st free spectrum block</span>
<span class="sd">        4. Avg. free block size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_stats</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.EnvParams" class="doc doc-heading">
            <code>EnvParams</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment parameters. Parameters are immutable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of requests in an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>incremental_loading</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Incremental increase in traffic load (non-expiring requests)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_first_blocking</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End episode on first blocking event</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>continuous_operation</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, do not reset the environment at the end of an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two column array defining source-dest node-pair edges of the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slot_size</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral width of frequency slot in GHz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>consider_modulation_format</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, consider modulation format to determine required slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_length_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of link lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots to aggregate into a single action (First-Fit with aggregation)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guardband</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Guard band in slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed_graph</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed (one fibre per link per transmission direction)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters. Parameters are immutable.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_requests (chex.Scalar): Maximum number of requests in an episode</span>
<span class="sd">        incremental_loading (chex.Scalar): Incremental increase in traffic load (non-expiring requests)</span>
<span class="sd">        end_first_blocking (chex.Scalar): End episode on first blocking event</span>
<span class="sd">        continuous_operation (chex.Scalar): If True, do not reset the environment at the end of an episode</span>
<span class="sd">        edges (chex.Array): Two column array defining source-dest node-pair edges of the graph</span>
<span class="sd">        slot_size (chex.Scalar): Spectral width of frequency slot in GHz</span>
<span class="sd">        consider_modulation_format (chex.Scalar): If True, consider modulation format to determine required slots</span>
<span class="sd">        link_length_array (chex.Array): Array of link lengths</span>
<span class="sd">        aggregate_slots (chex.Scalar): Number of slots to aggregate into a single action (First-Fit with aggregation)</span>
<span class="sd">        guardband (chex.Scalar): Guard band in slots</span>
<span class="sd">        directed_graph (bool): Whether graph is directed (one fibre per link per transmission direction)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">incremental_loading</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_first_blocking</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">continuous_operation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">slot_size</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">consider_modulation_format</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_length_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">aggregate_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">guardband</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">directed_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">maximise_throughput</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">reward_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">values_bw</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">truncate_holding_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traffic_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pack_path_bits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">relative_arrival_times</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.EnvState" class="doc doc-heading">
            <code>EnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>current_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current time in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Holding time of current request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_timesteps</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total timesteps in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total requests in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="jraph.GraphsTuple">GraphsTuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Graph tuple representing network state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action mask for link slot action (including if slot actions are aggregated)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_time (chex.Scalar): Current time in environment</span>
<span class="sd">        holding_time (chex.Scalar): Holding time of current request</span>
<span class="sd">        total_timesteps (chex.Scalar): Total timesteps in environment</span>
<span class="sd">        total_requests (chex.Scalar): Total requests in environment</span>
<span class="sd">        graph (jraph.GraphsTuple): Graph tuple representing network state</span>
<span class="sd">        full_link_slot_mask (chex.Array): Action mask for link slot action (including if slot actions are aggregated)</span>
<span class="sd">        accepted_services (chex.Array): Number of accepted services</span>
<span class="sd">        accepted_bitrate (chex.Array): Accepted bitrate</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">current_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">arrival_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_timesteps</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">graph</span><span class="p">:</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span>
    <span class="n">full_link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.GNModelEnvParams" class="doc doc-heading">
            <code>GNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment state for GN model environments.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GNModelEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for GN model environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_lambda</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_spans</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_span_length</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">nonlinear_coeff</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">raman_gain_slope</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">attenuation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">attenuation_bar</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dispersion_coeff</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dispersion_slope</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">transceiver_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">amplifier_noise_figure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">coherent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_roadms</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">roadm_loss</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_spans</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">launch_power_type</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">snr_margin</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">step_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">last_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">default_launch_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mod_format_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">monitor_active_lightpaths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Monitor active lightpaths for throughput calculation</span>
    <span class="n">gap_starts</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_widths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">uniform_spans</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.GNModelEnvState" class="doc doc-heading">
            <code>GNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GNModelEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_snr_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Available SNR on each link</span>
    <span class="n">channel_centre_bw_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel centre bandwidth for each active connection</span>
    <span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots (used for lightpath SNR calculation)</span>
    <span class="n">channel_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel power for each active connection</span>
    <span class="n">channel_centre_bw_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel centre bandwidth for each active connection in previous timestep</span>
    <span class="n">path_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots in previous timestep</span>
    <span class="n">channel_power_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel power for each active connection in previous timestep</span>
    <span class="n">launch_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Launch power array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.HashableArrayWrapper" class="doc doc-heading">
            <code>HashableArrayWrapper</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="xlron.environments.wrappers.T">T</span>]</code></p>


        <p>Wrapper for making arrays hashable.
In order to access pre-computed data, such as shortest paths between node-pairs or the constituent links of a path,
within a jitted function, we need to make the arrays containing this data hashable. By defining this wrapper, we can
define a <strong>hash</strong> method that returns a hash of the array's bytes, thus making the array hashable.
From: https://github.com/google/jax/issues/4572#issuecomment-709677518</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/wrappers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HashableArrayWrapper</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for making arrays hashable.</span>
<span class="sd">    In order to access pre-computed data, such as shortest paths between node-pairs or the constituent links of a path,</span>
<span class="sd">    within a jitted function, we need to make the arrays containing this data hashable. By defining this wrapper, we can</span>
<span class="sd">    define a __hash__ method that returns a hash of the array&#39;s bytes, thus making the array hashable.</span>
<span class="sd">    From: https://github.com/google/jax/issues/4572#issuecomment-709677518</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">T</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">prop</span> <span class="o">==</span> <span class="s1">&#39;val&#39;</span> <span class="ow">or</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;__hash__&quot;</span> <span class="ow">or</span> <span class="n">prop</span> <span class="o">==</span> <span class="s2">&quot;__eq__&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">HashableArrayWrapper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">HashableArrayWrapper</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span>

        <span class="n">f</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="s2">&quot;__eq__&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.LogEnvState" class="doc doc-heading">
            <code>LogEnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state for logging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>env_state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lengths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cum_returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>episode_lengths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Episode lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>episode_returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Episode returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>done</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Done</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LogEnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for logging.</span>

<span class="sd">    Args:</span>
<span class="sd">        env_state (EnvState): Environment state</span>
<span class="sd">        lengths (chex.Scalar): Lengths</span>
<span class="sd">        returns (chex.Scalar): Returns</span>
<span class="sd">        cum_returns (chex.Scalar): Cumulative returns</span>
<span class="sd">        episode_lengths (chex.Scalar): Episode lengths</span>
<span class="sd">        episode_returns (chex.Scalar): Episode returns</span>
<span class="sd">        accepted_services (chex.Scalar): Accepted services</span>
<span class="sd">        accepted_bitrate (chex.Scalar): Accepted bitrate</span>
<span class="sd">        done (chex.Scalar): Done</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env_state</span><span class="p">:</span> <span class="n">EnvState</span>
    <span class="n">lengths</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">returns</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">cum_returns</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">utilisation</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">done</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.LogWrapper" class="doc doc-heading">
            <code>LogWrapper</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="gymnax.wrappers.purerl.GymnaxWrapper">GymnaxWrapper</span></code></p>


        <p>Log the episode returns and lengths.
Modified from: https://github.com/RobertTLange/gymnax/blob/master/gymnax/wrappers/purerl.py</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/wrappers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LogWrapper</span><span class="p">(</span><span class="n">GymnaxWrapper</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log the episode returns and lengths.</span>
<span class="sd">    Modified from: https://github.com/RobertTLange/gymnax/blob/master/gymnax/wrappers/purerl.py</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">environment</span><span class="o">.</span><span class="n">Environment</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">environment</span><span class="o">.</span><span class="n">EnvParams</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">environment</span><span class="o">.</span><span class="n">EnvState</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">environment</span><span class="o">.</span><span class="n">EnvState</span><span class="p">]:</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">env_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">LogEnvState</span><span class="p">(</span>
            <span class="n">env_state</span><span class="o">=</span><span class="n">env_state</span><span class="p">,</span>
            <span class="n">lengths</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">returns</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">cum_returns</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">accepted_services</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">accepted_bitrate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">total_bitrate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">utilisation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">done</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">obs</span><span class="p">,</span> <span class="n">state</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">environment</span><span class="o">.</span><span class="n">EnvState</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">environment</span><span class="o">.</span><span class="n">EnvParams</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">environment</span><span class="o">.</span><span class="n">EnvState</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">env_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">env_state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span>
        <span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">LogEnvState</span><span class="p">(</span>
            <span class="n">env_state</span><span class="o">=</span><span class="n">env_state</span><span class="p">,</span>
            <span class="n">lengths</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">lengths</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">done</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">returns</span><span class="o">=</span><span class="n">reward</span><span class="p">,</span>
            <span class="n">cum_returns</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">cum_returns</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">done</span><span class="p">)</span> <span class="o">+</span> <span class="n">reward</span><span class="p">,</span>
            <span class="n">accepted_services</span><span class="o">=</span><span class="n">env_state</span><span class="o">.</span><span class="n">accepted_services</span><span class="p">,</span>
            <span class="n">accepted_bitrate</span><span class="o">=</span><span class="n">env_state</span><span class="o">.</span><span class="n">accepted_bitrate</span><span class="p">,</span>
            <span class="n">total_bitrate</span><span class="o">=</span><span class="n">env_state</span><span class="o">.</span><span class="n">total_bitrate</span><span class="p">,</span>
            <span class="n">utilisation</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">env_state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span> <span class="o">/</span> <span class="n">env_state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
            <span class="n">done</span><span class="o">=</span><span class="n">done</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;lengths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">lengths</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;returns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">returns</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;cum_returns&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">cum_returns</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;accepted_services&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">accepted_services</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;accepted_bitrate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">accepted_bitrate</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;total_bitrate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;utilisation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">utilisation</span>
        <span class="n">info</span><span class="p">[</span><span class="s2">&quot;done&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">done</span>
        <span class="c1"># First check if we&#39;re dealing with RSAGNModelEnvParams</span>
        <span class="n">is_rsa_params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RSAGNModelEnvParams&quot;</span>

        <span class="c1"># For RSA params, unpack the action</span>
        <span class="k">if</span> <span class="n">is_rsa_params</span><span class="p">:</span>
            <span class="n">action</span><span class="p">,</span> <span class="n">power_action</span> <span class="o">=</span> <span class="n">action</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;launch_power&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">power_action</span>

        <span class="c1"># Now, if we need to log actions OR we have RSA params, compute the common fields</span>
        <span class="k">if</span> <span class="n">is_rsa_params</span> <span class="ow">or</span> <span class="n">params</span><span class="o">.</span><span class="n">log_actions</span><span class="p">:</span>
            <span class="c1"># Compute common fields</span>
            <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">dr_request</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">env_state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
            <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">path_index</span><span class="p">,</span> <span class="n">slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">env_state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

            <span class="c1"># Set common info</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;path_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">path_index</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;slot_index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slot_index</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;dest&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dest</span>
            <span class="n">info</span><span class="p">[</span><span class="s2">&quot;data_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dr_request</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># RSA-specific throughput info</span>
            <span class="k">if</span> <span class="n">is_rsa_params</span><span class="p">:</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;throughput&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_state</span><span class="o">.</span><span class="n">throughput</span> <span class="c1">#* done  # Only != 0 at end of episode</span>

            <span class="c1"># Logging-specific info</span>
            <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">log_actions</span><span class="p">:</span>
                <span class="c1"># RSA-specific logging</span>
                <span class="k">if</span> <span class="n">is_rsa_params</span><span class="p">:</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">path_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">)]</span>
                    <span class="n">info</span><span class="p">[</span><span class="s2">&quot;path_snr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_snr_for_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">env_state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">,</span> <span class="n">params</span><span class="p">)[</span>
                        <span class="n">slot_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">)]</span>
                <span class="c1"># Common logging fields</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;arrival_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_state</span><span class="o">.</span><span class="n">current_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">info</span><span class="p">[</span><span class="s2">&quot;departure_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_state</span><span class="o">.</span><span class="n">current_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">env_state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">obs</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_tree_flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">()</span>  <span class="c1"># arrays / dynamic values</span>
        <span class="n">aux_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;env&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">}</span>  <span class="c1"># static values</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">aux_data</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_tree_unflatten</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">aux_data</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">children</span><span class="p">,</span> <span class="o">**</span><span class="n">aux_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.MultiBandRSAEnvParams" class="doc doc-heading">
            <code>MultiBandRSAEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiBandRSAEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_start</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_width</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.MultiBandRSAEnvState" class="doc doc-heading">
            <code>MultiBandRSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiBandRSAEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RMSAGNModelEnvParams" class="doc doc-heading">
            <code>RMSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulations_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RMSAGNModelEnvState" class="doc doc-heading">
            <code>RMSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulation_format_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection</span>
    <span class="n">modulation_format_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection in previous timestep</span>
    <span class="n">mod_format_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format mask</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RSAEnvParams" class="doc doc-heading">
            <code>RSAEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for RSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_nodes</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_links</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of links</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of link resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_paths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mean_service_holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean service holding time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Load</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arrival_rate</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arrival rate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_link_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path link array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_traffic</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random traffic matrix for RSA on each reset (else uniform or custom)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_se_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path spectral efficiency array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>deterministic_requests</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use deterministic requests</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>multiple_topologies</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use multiple topologies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAEnvParams</span><span class="p">(</span><span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for RSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_nodes (chex.Scalar): Number of nodes</span>
<span class="sd">        num_links (chex.Scalar): Number of links</span>
<span class="sd">        link_resources (chex.Scalar): Number of link resources</span>
<span class="sd">        k_paths (chex.Scalar): Number of paths</span>
<span class="sd">        mean_service_holding_time (chex.Scalar): Mean service holding time</span>
<span class="sd">        load (chex.Scalar): Load</span>
<span class="sd">        arrival_rate (chex.Scalar): Arrival rate</span>
<span class="sd">        path_link_array (chex.Array): Path link array</span>
<span class="sd">        random_traffic (bool): Random traffic matrix for RSA on each reset (else uniform or custom)</span>
<span class="sd">        max_slots (chex.Scalar): Maximum number of slots</span>
<span class="sd">        path_se_array (chex.Array): Path spectral efficiency array</span>
<span class="sd">        deterministic_requests (bool): If True, use deterministic requests</span>
<span class="sd">        multiple_topologies (bool): If True, use multiple topologies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_links</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">k_paths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mean_service_holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">load</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">arrival_rate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">random_traffic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_se_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">deterministic_requests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">multiple_topologies</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">log_actions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">disable_node_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RSAEnvState" class="doc doc-heading">
            <code>RSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_departure_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot mask</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>traffic_matrix</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Traffic matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAEnvState</span><span class="p">(</span><span class="n">EnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array (chex.Array): Link slot array</span>
<span class="sd">        request_array (chex.Array): Request array</span>
<span class="sd">        link_slot_departure_array (chex.Array): Link slot departure array</span>
<span class="sd">        link_slot_mask (chex.Array): Link slot mask</span>
<span class="sd">        traffic_matrix (chex.Array): Traffic matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">request_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">link_slot_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">traffic_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RSAGNModelEnvParams" class="doc doc-heading">
            <code>RSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">min_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fec_threshold</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RSAGNModelEnvState" class="doc doc-heading">
            <code>RSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active_lightpaths_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array. 1 x M array. Each value is a lightpath index. Used to calculate total throughput.</span>
    <span class="n">active_lightpaths_array_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array departure time.</span>
    <span class="n">throughput</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Current network throughput</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RSAMultibandEnvParams" class="doc doc-heading">
            <code>RSAMultibandEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAMultibandEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_starts</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_widths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RSAMultibandEnvState" class="doc doc-heading">
            <code>RSAMultibandEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAMultibandEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RWALightpathReuseEnvState" class="doc doc-heading">
            <code>RWALightpathReuseEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for RWA with lightpath reuse.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_index_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains indices of lightpaths in use on slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains remaining capacity of each lightpath</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains remaining capacity of lightpath on each link-slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RWALightpathReuseEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RWA with lightpath reuse.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_index_array (chex.Array): Contains indices of lightpaths in use on slots</span>
<span class="sd">        path_capacity_array (chex.Array): Contains remaining capacity of each lightpath</span>
<span class="sd">        link_capacity_array (chex.Array): Contains remaining capacity of lightpath on each link-slot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots</span>
    <span class="n">path_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains remaining capacity of each lightpath</span>
    <span class="n">link_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains remaining capacity of lightpath on each link-slot</span>
    <span class="n">time_since_last_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Time since last departure</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.RolloutWrapper" class="doc doc-heading">
            <code>RolloutWrapper</code>


</h2>


    <div class="doc doc-contents ">


        <p>Wrapper to define batch evaluation for generation parameters. Used for genetic algorithm.
From: https://github.com/RobertTLange/gymnax/</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/wrappers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RolloutWrapper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper to define batch evaluation for generation parameters. Used for genetic algorithm.</span>
<span class="sd">    From: https://github.com/RobertTLange/gymnax/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model_forward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">env</span><span class="p">:</span> <span class="n">environment</span><span class="o">.</span><span class="n">Environment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">num_env_steps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">env_params</span><span class="p">:</span> <span class="n">EnvParams</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wrapper to define batch evaluation for generation parameters.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="c1"># Define the RL environment &amp; network forward function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span> <span class="o">=</span> <span class="n">env_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_forward</span> <span class="o">=</span> <span class="n">model_forward</span>

        <span class="k">if</span> <span class="n">num_env_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_env_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span><span class="o">.</span><span class="n">max_requests</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_env_steps</span> <span class="o">=</span> <span class="n">num_env_steps</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">population_rollout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reshape parameter vector and evaluate the generation.&quot;&quot;&quot;</span>
        <span class="c1"># Evaluate population of nets on gymnax task - vmap over rng &amp; params</span>
        <span class="n">pop_rollout</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_rollout</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">pop_rollout</span><span class="p">(</span><span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">)</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">batch_rollout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate a generation of networks on RL/Supervised/etc. task.&quot;&quot;&quot;</span>
        <span class="c1"># vmap over different MC fitness evaluations for single network</span>
        <span class="n">batch_rollout</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">single_rollout</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">batch_rollout</span><span class="p">(</span><span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">)</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">single_rollout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng_input</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rollout a pendulum episode with lax.scan.&quot;&quot;&quot;</span>
        <span class="c1"># Reset the environment</span>
        <span class="n">rng_reset</span><span class="p">,</span> <span class="n">rng_episode</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng_input</span><span class="p">)</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">rng_reset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">policy_step</span><span class="p">(</span><span class="n">state_input</span><span class="p">,</span> <span class="n">tmp</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;lax.scan compatible step transition in jax env.&quot;&quot;&quot;</span>
            <span class="n">obs</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">,</span> <span class="n">rng</span><span class="p">,</span> <span class="n">cum_reward</span><span class="p">,</span> <span class="n">valid_mask</span> <span class="o">=</span> <span class="n">state_input</span>
            <span class="n">rng</span><span class="p">,</span> <span class="n">rng_step</span><span class="p">,</span> <span class="n">rng_net</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_forward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_forward</span><span class="p">(</span><span class="n">policy_params</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">rng_net</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_params</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">rng_net</span><span class="p">)</span>
            <span class="n">next_obs</span><span class="p">,</span> <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
                <span class="n">rng_step</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span>
            <span class="p">)</span>
            <span class="n">new_cum_reward</span> <span class="o">=</span> <span class="n">cum_reward</span> <span class="o">+</span> <span class="n">reward</span> <span class="o">*</span> <span class="n">valid_mask</span>
            <span class="n">new_valid_mask</span> <span class="o">=</span> <span class="n">valid_mask</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">done</span><span class="p">)</span>
            <span class="n">carry</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">next_obs</span><span class="p">,</span>
                <span class="n">next_state</span><span class="p">,</span>
                <span class="n">policy_params</span><span class="p">,</span>
                <span class="n">rng</span><span class="p">,</span>
                <span class="n">new_cum_reward</span><span class="p">,</span>
                <span class="n">new_valid_mask</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_obs</span><span class="p">,</span> <span class="n">done</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">carry</span><span class="p">,</span> <span class="n">y</span>

        <span class="c1"># Scan over episode step loop</span>
        <span class="n">carry_out</span><span class="p">,</span> <span class="n">scan_out</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
            <span class="n">policy_step</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="n">obs</span><span class="p">,</span>
                <span class="n">state</span><span class="p">,</span>
                <span class="n">policy_params</span><span class="p">,</span>
                <span class="n">rng_episode</span><span class="p">,</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
            <span class="p">],</span>
            <span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_env_steps</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Return the sum of rewards accumulated by agent in episode rollout</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_obs</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="n">scan_out</span>
        <span class="n">cum_return</span> <span class="o">=</span> <span class="n">carry_out</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">obs</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_obs</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">cum_return</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">input_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the shape of the observation.&quot;&quot;&quot;</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obs</span><span class="o">.</span><span class="n">shape</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="xlron.environments.wrappers.RolloutWrapper.input_shape" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_shape</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the shape of the observation.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="xlron.environments.wrappers.RolloutWrapper.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model_forward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_env_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">env_params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Wrapper to define batch evaluation for generation parameters.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/wrappers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">model_forward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">environment</span><span class="o">.</span><span class="n">Environment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_env_steps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">env_params</span><span class="p">:</span> <span class="n">EnvParams</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper to define batch evaluation for generation parameters.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
    <span class="c1"># Define the RL environment &amp; network forward function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span> <span class="o">=</span> <span class="n">env_params</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_forward</span> <span class="o">=</span> <span class="n">model_forward</span>

    <span class="k">if</span> <span class="n">num_env_steps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_env_steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span><span class="o">.</span><span class="n">max_requests</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_env_steps</span> <span class="o">=</span> <span class="n">num_env_steps</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.wrappers.RolloutWrapper.batch_rollout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">batch_rollout</span><span class="p">(</span><span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Evaluate a generation of networks on RL/Supervised/etc. task.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/wrappers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">batch_rollout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate a generation of networks on RL/Supervised/etc. task.&quot;&quot;&quot;</span>
    <span class="c1"># vmap over different MC fitness evaluations for single network</span>
    <span class="n">batch_rollout</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">single_rollout</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">batch_rollout</span><span class="p">(</span><span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.wrappers.RolloutWrapper.population_rollout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">population_rollout</span><span class="p">(</span><span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reshape parameter vector and evaluate the generation.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/wrappers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">population_rollout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reshape parameter vector and evaluate the generation.&quot;&quot;&quot;</span>
    <span class="c1"># Evaluate population of nets on gymnax task - vmap over rng &amp; params</span>
    <span class="n">pop_rollout</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_rollout</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pop_rollout</span><span class="p">(</span><span class="n">rng_eval</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.environments.wrappers.RolloutWrapper.single_rollout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">single_rollout</span><span class="p">(</span><span class="n">rng_input</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Rollout a pendulum episode with lax.scan.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/wrappers.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">single_rollout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rng_input</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rollout a pendulum episode with lax.scan.&quot;&quot;&quot;</span>
    <span class="c1"># Reset the environment</span>
    <span class="n">rng_reset</span><span class="p">,</span> <span class="n">rng_episode</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng_input</span><span class="p">)</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="n">rng_reset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">policy_step</span><span class="p">(</span><span class="n">state_input</span><span class="p">,</span> <span class="n">tmp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;lax.scan compatible step transition in jax env.&quot;&quot;&quot;</span>
        <span class="n">obs</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">policy_params</span><span class="p">,</span> <span class="n">rng</span><span class="p">,</span> <span class="n">cum_reward</span><span class="p">,</span> <span class="n">valid_mask</span> <span class="o">=</span> <span class="n">state_input</span>
        <span class="n">rng</span><span class="p">,</span> <span class="n">rng_step</span><span class="p">,</span> <span class="n">rng_net</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rng</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_forward</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_forward</span><span class="p">(</span><span class="n">policy_params</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">rng_net</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env_params</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">rng_net</span><span class="p">)</span>
        <span class="n">next_obs</span><span class="p">,</span> <span class="n">next_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span>
            <span class="n">rng_step</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_params</span>
        <span class="p">)</span>
        <span class="n">new_cum_reward</span> <span class="o">=</span> <span class="n">cum_reward</span> <span class="o">+</span> <span class="n">reward</span> <span class="o">*</span> <span class="n">valid_mask</span>
        <span class="n">new_valid_mask</span> <span class="o">=</span> <span class="n">valid_mask</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">done</span><span class="p">)</span>
        <span class="n">carry</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">next_obs</span><span class="p">,</span>
            <span class="n">next_state</span><span class="p">,</span>
            <span class="n">policy_params</span><span class="p">,</span>
            <span class="n">rng</span><span class="p">,</span>
            <span class="n">new_cum_reward</span><span class="p">,</span>
            <span class="n">new_valid_mask</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_obs</span><span class="p">,</span> <span class="n">done</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">carry</span><span class="p">,</span> <span class="n">y</span>

    <span class="c1"># Scan over episode step loop</span>
    <span class="n">carry_out</span><span class="p">,</span> <span class="n">scan_out</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
        <span class="n">policy_step</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="n">obs</span><span class="p">,</span>
            <span class="n">state</span><span class="p">,</span>
            <span class="n">policy_params</span><span class="p">,</span>
            <span class="n">rng_episode</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="p">],</span>
        <span class="p">(),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_env_steps</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Return the sum of rewards accumulated by agent in episode rollout</span>
    <span class="n">obs</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_obs</span><span class="p">,</span> <span class="n">done</span> <span class="o">=</span> <span class="n">scan_out</span>
    <span class="n">cum_return</span> <span class="o">=</span> <span class="n">carry_out</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">obs</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">next_obs</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">cum_return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.TimeIt" class="doc doc-heading">
            <code>TimeIt</code>


</h2>


    <div class="doc doc-contents ">


        <p>Context manager for timing execution of code blocks.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/wrappers.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TimeIt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for timing execution of code blocks.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">=</span> <span class="n">frames</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_secs</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;: Elapsed time=</span><span class="si">%.2f</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_secs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frames</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;, FPS=</span><span class="si">%.2e</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frames</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_secs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.VONEEnvParams" class="doc doc-heading">
            <code>VONEEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for VONE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_edges</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VONEEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for VONE.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_resources (chex.Scalar): Number of node resources</span>
<span class="sd">        max_edges (chex.Scalar): Maximum number of edges</span>
<span class="sd">        min_node_resources (chex.Scalar): Minimum number of node resources</span>
<span class="sd">        max_node_resources (chex.Scalar): Maximum number of node resources</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.wrappers.VONEEnvState" class="doc doc-heading">
            <code>VONEEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for VONE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node capacity array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_resource_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node resource array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_counter</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action counter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_history</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_mask_s</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node mask for source node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_mask_d</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node mask for destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>virtual_topology_patterns</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Virtual topology patterns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values_nodes</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values for nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VONEEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for VONE.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_capacity_array (chex.Array): Node capacity array</span>
<span class="sd">        node_resource_array (chex.Array): Node resource array</span>
<span class="sd">        node_departure_array (chex.Array): Node departure array</span>
<span class="sd">        action_counter (chex.Array): Action counter</span>
<span class="sd">        action_history (chex.Array): Action history</span>
<span class="sd">        node_mask_s (chex.Array): Node mask for source node</span>
<span class="sd">        node_mask_d (chex.Array): Node mask for destination node</span>
<span class="sd">        virtual_topology_patterns (chex.Array): Virtual topology patterns</span>
<span class="sd">        values_nodes (chex.Array): Values for nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_resource_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">action_counter</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">action_history</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_mask_s</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_mask_d</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">virtual_topology_patterns</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">values_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h1 id="constituent-functions-of-environments">Constituent functions of environments</h1>


<div class="doc doc-object doc-module">



<a id="xlron.environments.env_funcs"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.DeepRMSAEnvState" class="doc doc-heading">
            <code>DeepRMSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for DeepRMSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_stats</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path stats array containing</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DeepRMSAEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for DeepRMSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_stats (chex.Array): Path stats array containing</span>
<span class="sd">        1. Required slots on path</span>
<span class="sd">        2. Total available slots on path</span>
<span class="sd">        3. Size of 1st free spectrum block</span>
<span class="sd">        4. Avg. free block size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_stats</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.EnvParams" class="doc doc-heading">
            <code>EnvParams</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment parameters. Parameters are immutable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of requests in an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>incremental_loading</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Incremental increase in traffic load (non-expiring requests)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_first_blocking</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End episode on first blocking event</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>continuous_operation</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, do not reset the environment at the end of an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two column array defining source-dest node-pair edges of the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slot_size</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral width of frequency slot in GHz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>consider_modulation_format</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, consider modulation format to determine required slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_length_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of link lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots to aggregate into a single action (First-Fit with aggregation)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guardband</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Guard band in slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed_graph</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed (one fibre per link per transmission direction)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters. Parameters are immutable.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_requests (chex.Scalar): Maximum number of requests in an episode</span>
<span class="sd">        incremental_loading (chex.Scalar): Incremental increase in traffic load (non-expiring requests)</span>
<span class="sd">        end_first_blocking (chex.Scalar): End episode on first blocking event</span>
<span class="sd">        continuous_operation (chex.Scalar): If True, do not reset the environment at the end of an episode</span>
<span class="sd">        edges (chex.Array): Two column array defining source-dest node-pair edges of the graph</span>
<span class="sd">        slot_size (chex.Scalar): Spectral width of frequency slot in GHz</span>
<span class="sd">        consider_modulation_format (chex.Scalar): If True, consider modulation format to determine required slots</span>
<span class="sd">        link_length_array (chex.Array): Array of link lengths</span>
<span class="sd">        aggregate_slots (chex.Scalar): Number of slots to aggregate into a single action (First-Fit with aggregation)</span>
<span class="sd">        guardband (chex.Scalar): Guard band in slots</span>
<span class="sd">        directed_graph (bool): Whether graph is directed (one fibre per link per transmission direction)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">incremental_loading</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_first_blocking</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">continuous_operation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">slot_size</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">consider_modulation_format</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_length_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">aggregate_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">guardband</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">directed_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">maximise_throughput</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">reward_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">values_bw</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">truncate_holding_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traffic_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pack_path_bits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">relative_arrival_times</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.EnvState" class="doc doc-heading">
            <code>EnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>current_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current time in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Holding time of current request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_timesteps</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total timesteps in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total requests in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="jraph.GraphsTuple">GraphsTuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Graph tuple representing network state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action mask for link slot action (including if slot actions are aggregated)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_time (chex.Scalar): Current time in environment</span>
<span class="sd">        holding_time (chex.Scalar): Holding time of current request</span>
<span class="sd">        total_timesteps (chex.Scalar): Total timesteps in environment</span>
<span class="sd">        total_requests (chex.Scalar): Total requests in environment</span>
<span class="sd">        graph (jraph.GraphsTuple): Graph tuple representing network state</span>
<span class="sd">        full_link_slot_mask (chex.Array): Action mask for link slot action (including if slot actions are aggregated)</span>
<span class="sd">        accepted_services (chex.Array): Number of accepted services</span>
<span class="sd">        accepted_bitrate (chex.Array): Accepted bitrate</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">current_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">arrival_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_timesteps</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">graph</span><span class="p">:</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span>
    <span class="n">full_link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.GNModelEnvParams" class="doc doc-heading">
            <code>GNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment state for GN model environments.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GNModelEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for GN model environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_lambda</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_spans</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_span_length</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">nonlinear_coeff</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">raman_gain_slope</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">attenuation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">attenuation_bar</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dispersion_coeff</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dispersion_slope</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">transceiver_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">amplifier_noise_figure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">coherent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_roadms</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">roadm_loss</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_spans</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">launch_power_type</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">snr_margin</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">step_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">last_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">default_launch_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mod_format_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">monitor_active_lightpaths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Monitor active lightpaths for throughput calculation</span>
    <span class="n">gap_starts</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_widths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">uniform_spans</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.GNModelEnvState" class="doc doc-heading">
            <code>GNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GNModelEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_snr_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Available SNR on each link</span>
    <span class="n">channel_centre_bw_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel centre bandwidth for each active connection</span>
    <span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots (used for lightpath SNR calculation)</span>
    <span class="n">channel_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel power for each active connection</span>
    <span class="n">channel_centre_bw_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel centre bandwidth for each active connection in previous timestep</span>
    <span class="n">path_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots in previous timestep</span>
    <span class="n">channel_power_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel power for each active connection in previous timestep</span>
    <span class="n">launch_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Launch power array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.LogEnvState" class="doc doc-heading">
            <code>LogEnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state for logging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>env_state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lengths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cum_returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>episode_lengths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Episode lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>episode_returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Episode returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>done</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Done</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LogEnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for logging.</span>

<span class="sd">    Args:</span>
<span class="sd">        env_state (EnvState): Environment state</span>
<span class="sd">        lengths (chex.Scalar): Lengths</span>
<span class="sd">        returns (chex.Scalar): Returns</span>
<span class="sd">        cum_returns (chex.Scalar): Cumulative returns</span>
<span class="sd">        episode_lengths (chex.Scalar): Episode lengths</span>
<span class="sd">        episode_returns (chex.Scalar): Episode returns</span>
<span class="sd">        accepted_services (chex.Scalar): Accepted services</span>
<span class="sd">        accepted_bitrate (chex.Scalar): Accepted bitrate</span>
<span class="sd">        done (chex.Scalar): Done</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env_state</span><span class="p">:</span> <span class="n">EnvState</span>
    <span class="n">lengths</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">returns</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">cum_returns</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">utilisation</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">done</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.MultiBandRSAEnvParams" class="doc doc-heading">
            <code>MultiBandRSAEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiBandRSAEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_start</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_width</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.MultiBandRSAEnvState" class="doc doc-heading">
            <code>MultiBandRSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiBandRSAEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RMSAGNModelEnvParams" class="doc doc-heading">
            <code>RMSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulations_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RMSAGNModelEnvState" class="doc doc-heading">
            <code>RMSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulation_format_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection</span>
    <span class="n">modulation_format_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection in previous timestep</span>
    <span class="n">mod_format_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format mask</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RSAEnvParams" class="doc doc-heading">
            <code>RSAEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for RSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_nodes</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_links</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of links</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of link resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_paths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mean_service_holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean service holding time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Load</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arrival_rate</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arrival rate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_link_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path link array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_traffic</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random traffic matrix for RSA on each reset (else uniform or custom)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_se_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path spectral efficiency array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>deterministic_requests</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use deterministic requests</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>multiple_topologies</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use multiple topologies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAEnvParams</span><span class="p">(</span><span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for RSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_nodes (chex.Scalar): Number of nodes</span>
<span class="sd">        num_links (chex.Scalar): Number of links</span>
<span class="sd">        link_resources (chex.Scalar): Number of link resources</span>
<span class="sd">        k_paths (chex.Scalar): Number of paths</span>
<span class="sd">        mean_service_holding_time (chex.Scalar): Mean service holding time</span>
<span class="sd">        load (chex.Scalar): Load</span>
<span class="sd">        arrival_rate (chex.Scalar): Arrival rate</span>
<span class="sd">        path_link_array (chex.Array): Path link array</span>
<span class="sd">        random_traffic (bool): Random traffic matrix for RSA on each reset (else uniform or custom)</span>
<span class="sd">        max_slots (chex.Scalar): Maximum number of slots</span>
<span class="sd">        path_se_array (chex.Array): Path spectral efficiency array</span>
<span class="sd">        deterministic_requests (bool): If True, use deterministic requests</span>
<span class="sd">        multiple_topologies (bool): If True, use multiple topologies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_links</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">k_paths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mean_service_holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">load</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">arrival_rate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">random_traffic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_se_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">deterministic_requests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">multiple_topologies</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">log_actions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">disable_node_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RSAEnvState" class="doc doc-heading">
            <code>RSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_departure_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot mask</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>traffic_matrix</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Traffic matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAEnvState</span><span class="p">(</span><span class="n">EnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array (chex.Array): Link slot array</span>
<span class="sd">        request_array (chex.Array): Request array</span>
<span class="sd">        link_slot_departure_array (chex.Array): Link slot departure array</span>
<span class="sd">        link_slot_mask (chex.Array): Link slot mask</span>
<span class="sd">        traffic_matrix (chex.Array): Traffic matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">request_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">link_slot_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">traffic_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RSAGNModelEnvParams" class="doc doc-heading">
            <code>RSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">min_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fec_threshold</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RSAGNModelEnvState" class="doc doc-heading">
            <code>RSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active_lightpaths_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array. 1 x M array. Each value is a lightpath index. Used to calculate total throughput.</span>
    <span class="n">active_lightpaths_array_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array departure time.</span>
    <span class="n">throughput</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Current network throughput</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RSAMultibandEnvParams" class="doc doc-heading">
            <code>RSAMultibandEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAMultibandEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_starts</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_widths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RSAMultibandEnvState" class="doc doc-heading">
            <code>RSAMultibandEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAMultibandEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.RWALightpathReuseEnvState" class="doc doc-heading">
            <code>RWALightpathReuseEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for RWA with lightpath reuse.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_index_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains indices of lightpaths in use on slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains remaining capacity of each lightpath</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains remaining capacity of lightpath on each link-slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RWALightpathReuseEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RWA with lightpath reuse.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_index_array (chex.Array): Contains indices of lightpaths in use on slots</span>
<span class="sd">        path_capacity_array (chex.Array): Contains remaining capacity of each lightpath</span>
<span class="sd">        link_capacity_array (chex.Array): Contains remaining capacity of lightpath on each link-slot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots</span>
    <span class="n">path_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains remaining capacity of each lightpath</span>
    <span class="n">link_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains remaining capacity of lightpath on each link-slot</span>
    <span class="n">time_since_last_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Time since last departure</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.VONEEnvParams" class="doc doc-heading">
            <code>VONEEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for VONE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_edges</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VONEEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for VONE.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_resources (chex.Scalar): Number of node resources</span>
<span class="sd">        max_edges (chex.Scalar): Maximum number of edges</span>
<span class="sd">        min_node_resources (chex.Scalar): Minimum number of node resources</span>
<span class="sd">        max_node_resources (chex.Scalar): Maximum number of node resources</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.environments.env_funcs.VONEEnvState" class="doc doc-heading">
            <code>VONEEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for VONE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node capacity array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_resource_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node resource array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_counter</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action counter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_history</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_mask_s</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node mask for source node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_mask_d</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node mask for destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>virtual_topology_patterns</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Virtual topology patterns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values_nodes</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values for nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VONEEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for VONE.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_capacity_array (chex.Array): Node capacity array</span>
<span class="sd">        node_resource_array (chex.Array): Node resource array</span>
<span class="sd">        node_departure_array (chex.Array): Node departure array</span>
<span class="sd">        action_counter (chex.Array): Action counter</span>
<span class="sd">        action_history (chex.Array): Action history</span>
<span class="sd">        node_mask_s (chex.Array): Node mask for source node</span>
<span class="sd">        node_mask_d (chex.Array): Node mask for destination node</span>
<span class="sd">        virtual_topology_patterns (chex.Array): Virtual topology patterns</span>
<span class="sd">        values_nodes (chex.Array): Values for nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_resource_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">action_counter</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">action_history</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_mask_s</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_mask_d</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">virtual_topology_patterns</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">values_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.aggregate_slots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregate_slots</span><span class="p">(</span><span class="n">full_mask</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Aggregate slot mask to reduce action space. Only used if the --aggregate_slots flag is set to &gt; 1.
Aggregated action is valid if there is one valid slot action within the aggregated action window.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>full_mask</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>slot mask</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>agg_mask</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>aggregated slot mask</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">aggregate_slots</span><span class="p">(</span><span class="n">full_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate slot mask to reduce action space. Only used if the --aggregate_slots flag is set to &gt; 1.</span>
<span class="sd">    Aggregated action is valid if there is one valid slot action within the aggregated action window.</span>

<span class="sd">    Args:</span>
<span class="sd">        full_mask: slot mask</span>
<span class="sd">        params: environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        agg_mask: aggregated slot mask</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_actions</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">)</span>
    <span class="n">agg_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mask_val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get maximum value of array slice of length aggregate_slots.&quot;&quot;&quot;</span>
        <span class="n">mask_slice</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
                <span class="n">mask_val</span><span class="p">,</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">,),</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span>  <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">,),</span>
            <span class="p">)</span>
        <span class="n">max_slice</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mask_slice</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_slice</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_window_max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update ith index &#39;agg_mask&#39; with max of ith slice of length aggregate_slots from &#39;full_mask&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            i: increments as += aggregate_slots</span>
<span class="sd">            val: tuple of (agg_mask, path_mask, path_index).</span>
<span class="sd">        Returns:</span>
<span class="sd">            new_agg_mask: agg_mask is updated with max of path_mask for window size aggregate_slots</span>
<span class="sd">            mask: mask is unchanged</span>
<span class="sd">            path_index: path_index is unchanged</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">agg_mask</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">full_mask</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">path_index</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">new_agg_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span>
            <span class="n">agg_mask</span><span class="p">,</span>
            <span class="n">get_max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">full_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="n">path_index</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_agg_mask</span><span class="p">,</span> <span class="n">full_mask</span><span class="p">,</span> <span class="n">path_index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_to_path_mask</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loop through each path for num_actions steps and get_window_max at each step.</span>

<span class="sd">        Args:</span>
<span class="sd">            i: path index</span>
<span class="sd">            val: tuple of (agg_mask, mask) where mask is original link-slot mask and agg_mask is resulting aggregated mask</span>
<span class="sd">        Returns:</span>
<span class="sd">            new_agg_mask: agg_mask is updated with aggregated path mask</span>
<span class="sd">            mask: mask is unchanged</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># aggregated mask (to be updated)</span>
            <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># mask for path i</span>
            <span class="n">i</span>  <span class="c1"># path index</span>
        <span class="p">)</span>
        <span class="n">new_agg_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">num_actions</span><span class="p">,</span>
            <span class="n">update_window_max</span><span class="p">,</span>
            <span class="n">val</span><span class="p">,</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_agg_mask</span><span class="p">,</span> <span class="n">full_mask</span>

    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span>
            <span class="n">apply_to_path_mask</span><span class="p">,</span>
            <span class="p">(</span><span class="n">agg_mask</span><span class="p">,</span> <span class="n">full_mask</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.calculate_path_capacity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_path_capacity</span><span class="p">(</span><span class="n">path_length</span><span class="p">,</span> <span class="n">min_request</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">,</span> <span class="n">NF</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">10000000000000.0</span><span class="p">,</span> <span class="n">R_s</span><span class="o">=</span><span class="mf">100000000000.0</span><span class="p">,</span> <span class="n">beta_2</span><span class="o">=-</span><span class="mf">2.17e-26</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0012</span><span class="p">,</span> <span class="n">L_s</span><span class="o">=</span><span class="mf">100000.0</span><span class="p">,</span> <span class="n">lambda0</span><span class="o">=</span><span class="mf">1.55e-06</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>From Nevin JOCN paper 2022: https://discovery.ucl.ac.uk/id/eprint/10175456/1/RL_JOCN_accepted.pdf</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_path_capacity</span><span class="p">(</span>
        <span class="n">path_length</span><span class="p">,</span>
        <span class="n">min_request</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Minimum data rate request size</span>
        <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Scale factor for link capacity</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2e-3</span><span class="p">,</span> <span class="c1"># Fibre attenuation coefficient</span>
        <span class="n">NF</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>  <span class="c1"># Amplifier noise figure</span>
        <span class="n">B</span><span class="o">=</span><span class="mf">10e12</span><span class="p">,</span>  <span class="c1"># Total modulated bandwidth</span>
        <span class="n">R_s</span><span class="o">=</span><span class="mf">100e9</span><span class="p">,</span>  <span class="c1"># Symbol rate</span>
        <span class="n">beta_2</span><span class="o">=-</span><span class="mf">21.7e-27</span><span class="p">,</span>  <span class="c1"># Dispersion parameter</span>
        <span class="n">gamma</span><span class="o">=</span><span class="mf">1.2e-3</span><span class="p">,</span>  <span class="c1"># Nonlinear coefficient</span>
        <span class="n">L_s</span><span class="o">=</span><span class="mf">100e3</span><span class="p">,</span>  <span class="c1"># Span length</span>
        <span class="n">lambda0</span><span class="o">=</span><span class="mf">1550e-9</span><span class="p">,</span>  <span class="c1"># Wavelength</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From Nevin JOCN paper 2022: https://discovery.ucl.ac.uk/id/eprint/10175456/1/RL_JOCN_accepted.pdf&quot;&quot;&quot;</span>
    <span class="n">alpha_lin</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">4.343</span>  <span class="c1"># Linear attenuation coefficient</span>
    <span class="n">N_spans</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">path_length</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="n">L_s</span><span class="p">)</span>  <span class="c1"># Number of fibre spans on path</span>
    <span class="n">L_eff</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha_lin</span> <span class="o">*</span> <span class="n">L_s</span><span class="p">))</span> <span class="o">/</span> <span class="n">alpha_lin</span>  <span class="c1"># Effective length of span in m</span>
    <span class="n">sigma_2_ase</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">alpha_lin</span> <span class="o">*</span> <span class="n">L_s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">NF</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="mf">2.998e8</span> <span class="o">*</span> <span class="n">R_s</span> <span class="o">/</span> <span class="n">lambda0</span>  <span class="c1"># ASE noise power</span>
    <span class="n">span_NSR</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_2_ase</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha_lin</span> <span class="o">*</span> <span class="n">gamma</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L_eff</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span>
                        <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">alpha_lin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">R_s</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># Noise-to-signal ratio per span</span>
    <span class="n">path_NSR</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">N_spans</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_spans</span><span class="p">)</span> <span class="o">*</span> <span class="n">span_NSR</span>  <span class="c1"># Noise-to-signal ratio per path</span>
    <span class="n">path_capacity</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">R_s</span><span class="o">/</span><span class="mf">1e9</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">path_NSR</span><span class="p">)</span>  <span class="c1"># Capacity of path in Gbps</span>
    <span class="c1"># Round link capacity down to nearest increment of minimum request size and apply scale factor</span>
    <span class="n">path_capacity</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">path_capacity</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="o">/</span> <span class="n">min_request</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_request</span>
    <span class="k">return</span> <span class="n">path_capacity</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.calculate_path_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_path_stats</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For use in DeepRMSA agent observation space.
Calculate:
1. Size of 1st suitable free spectrum block
2. Index of 1st suitable free spectrum block
3. Required slots on path
4. Avg. free block size
5. Free slots</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array in format [source_node, data-rate, destination_node]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>stats</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of calculated path statistics</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_path_stats</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For use in DeepRMSA agent observation space.</span>
<span class="sd">    Calculate:</span>
<span class="sd">    1. Size of 1st suitable free spectrum block</span>
<span class="sd">    2. Index of 1st suitable free spectrum block</span>
<span class="sd">    3. Required slots on path</span>
<span class="sd">    4. Avg. free block size</span>
<span class="sd">    5. Free slots</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        request: Request array in format [source_node, data-rate, destination_node]</span>

<span class="sd">    Returns:</span>
<span class="sd">        stats: Array of calculated path statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">init_val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="c1"># TODO - check if the normalisation is useful</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">body_fun</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">link_resources</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">slot_size</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>
        <span class="n">req_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">))</span>
        <span class="n">req_slots_norm</span> <span class="o">=</span> <span class="n">req_slots</span> <span class="o">*</span> <span class="n">slot_size</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="n">free_slots_norm</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">slots</span> <span class="o">==</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">),</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="n">link_resources</span>
        <span class="n">block_sizes</span> <span class="o">=</span> <span class="n">find_block_sizes</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span>
        <span class="n">first_block_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">block_sizes</span> <span class="o">&gt;=</span> <span class="n">req_slots</span><span class="p">)</span>
        <span class="n">first_block_index_norm</span> <span class="o">=</span> <span class="n">first_block_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span> <span class="o">/</span> <span class="n">link_resources</span>
        <span class="n">first_block_size_norm</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span>
            <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">,</span> <span class="p">(</span><span class="n">first_block_index</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">req_slots</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">avg_block_size_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">)</span> <span class="o">/</span>
                               <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">find_block_starts</span><span class="p">(</span><span class="n">slots</span><span class="p">),</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span>
                               <span class="n">req_slots</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span>
            <span class="n">val</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
                <span class="n">first_block_size_norm</span><span class="p">,</span>
                <span class="n">first_block_index_norm</span><span class="p">,</span>
                <span class="n">req_slots_norm</span><span class="p">,</span>
                <span class="n">avg_block_size_norm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">),</span>
                <span class="n">free_slots_norm</span>
            <span class="p">]]),</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># N.B. that all values are normalised</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span>
            <span class="n">body_fun</span><span class="p">,</span>
            <span class="n">init_val</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_action_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if action is valid for RSA GN model
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
    action (chex.Array): Action array
Returns:
    bool: True if action is invalid, False if action is valid</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if action is valid for RSA GN model</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">        action (chex.Array): Action array</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True if action is invalid, False if action is valid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if action is valid</span>
    <span class="c1"># TODO - log failure reasons in info</span>
    <span class="n">snr_sufficient_check</span> <span class="o">=</span> <span class="n">check_snr_sufficient</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">spectrum_reuse_check</span> <span class="o">=</span> <span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="c1"># jax.debug.print(&quot;spectrum_reuse_check {}&quot;, spectrum_reuse_check, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;snr_sufficient_check {}&quot;, snr_sufficient_check, ordered=True)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span>
        <span class="n">spectrum_reuse_check</span><span class="p">,</span>
        <span class="n">snr_sufficient_check</span><span class="p">,</span>
    <span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_action_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if action is valid.
Combines checks for:
- no spectrum reuse</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if action is valid.</span>
<span class="sd">    Combines checks for:</span>
<span class="sd">    - no spectrum reuse</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span>
        <span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
    <span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_action_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Combines checks for:
- no spectrum reuse
- lightpath available and existing</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combines checks for:</span>
<span class="sd">    - no spectrum reuse</span>
<span class="sd">    - lightpath available and existing</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span>
        <span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">check_lightpath_available_and_existing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_all_nodes_assigned" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_all_nodes_assigned</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Count negative values on each node (row) in node departure array, sum them, must equal total requested_nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array (N x R) where N is number of nodes and R is number of resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requested_nodes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total requested nodes (int)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_all_nodes_assigned</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count negative values on each node (row) in node departure array, sum them, must equal total requested_nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_departure_array: Node departure array (N x R) where N is number of nodes and R is number of resources</span>
<span class="sd">        total_requested_nodes: Total requested nodes (int)</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">!=</span> <span class="n">total_requested_nodes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_lightpath_available_and_existing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_lightpath_available_and_existing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if lightpath is available and existing.
Available means that the lightpath does not use slots occupied by a different lightpath.
Existing means that the lightpath has already been established.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lightpath_available_check</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if lightpath is available</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_lightpath_available_and_existing</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
        <span class="n">Tuple</span><span class="p">)[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if lightpath is available and existing.</span>
<span class="sd">    Available means that the lightpath does not use slots occupied by a different lightpath.</span>
<span class="sd">    Existing means that the lightpath has already been established.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        lightpath_available_check: True if lightpath is available</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span>
    <span class="c1"># Get unique lightpath index</span>
    <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">get_lightpath_index</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">path_index</span><span class="p">)</span>
    <span class="c1"># Get mask for slots that lightpath will occupy</span>
    <span class="c1"># negative numbers used so as not to conflict with lightpath indices</span>
    <span class="n">new_lightpath_mask</span> <span class="o">=</span> <span class="n">vmap_set_path_links</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">path_index_array</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">[:,</span> <span class="n">initial_slot_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">masked_path_index_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">new_lightpath_mask</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">path_index_array</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">lightpath_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">path_index_array</span> <span class="o">==</span> <span class="n">lightpath_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
    <span class="p">)</span>  <span class="c1"># Allow current lightpath</span>
    <span class="n">lightpath_existing_check</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">lightpath_mask</span><span class="p">,</span> <span class="n">new_lightpath_mask</span><span class="p">)</span>  <span class="c1"># True if all slots are same</span>
    <span class="n">lightpath_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masked_path_index_array</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lightpath_mask</span><span class="p">)</span>  <span class="c1"># Allow empty slots</span>
    <span class="c1"># True if all slots are same or empty</span>
    <span class="n">lightpath_available_check</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">lightpath_mask</span><span class="p">,</span> <span class="n">new_lightpath_mask</span><span class="p">),</span> <span class="n">lightpath_existing_check</span>
    <span class="p">)</span>
    <span class="n">curr_lightpath_capacity</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_lightpath_mask</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">[:,</span> <span class="n">initial_slot_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">lightpath_available_check</span><span class="p">,</span> <span class="n">lightpath_existing_check</span><span class="p">,</span> <span class="n">curr_lightpath_capacity</span><span class="p">,</span> <span class="n">lightpath_index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_min_two_nodes_assigned" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_min_two_nodes_assigned</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Count negative values on each node (row) in node departure array, sum them, must be 2 or greater.
This check is important if e.g. an action contains 2 nodes the same therefore only assigns 1 node.
Return False if check passed, True if check failed</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array (N x R) where N is number of nodes and R is number of resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_min_two_nodes_assigned</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count negative values on each node (row) in node departure array, sum them, must be 2 or greater.</span>
<span class="sd">    This check is important if e.g. an action contains 2 nodes the same therefore only assigns 1 node.</span>
<span class="sd">    Return False if check passed, True if check failed</span>

<span class="sd">    Args:</span>
<span class="sd">        node_departure_array: Node departure array (N x R) where N is number of nodes and R is number of resources</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_no_spectrum_reuse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>slot-=1 when used, should be zero when unoccupied, so check if any &lt; -1 in slot array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array (L x S) where L is number of links and S is number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;slot-=1 when used, should be zero when unoccupied, so check if any &lt; -1 in slot array.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array: Link slot array (L x S) where L is number of links and S is number of slots</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_node_capacities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_node_capacities</span><span class="p">(</span><span class="n">capacity_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sum selected nodes array and check less than node resources.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>capacity_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node capacity array (N x 1) where N is number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_node_capacities</span><span class="p">(</span><span class="n">capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sum selected nodes array and check less than node resources.</span>

<span class="sd">    Args:</span>
<span class="sd">        capacity_array: Node capacity array (N x 1) where N is number of nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">capacity_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_snr_sufficient" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_snr_sufficient</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if SNR is sufficient for all connections
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
Returns:
    jnp.array: 1 if SNR is sufficient for connection else 0</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_snr_sufficient</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if SNR is sufficient for all connections</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: 1 if SNR is sufficient for connection else 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - this check needs to be faster!</span>
    <span class="n">required_snr_array</span> <span class="o">=</span> <span class="n">get_required_snr_se_kurtosis_array</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Transform lightpath index array by getting lightpath value, getting path-link array, and summing inverse link SNRs</span>
    <span class="n">lightpath_snr_array</span> <span class="o">=</span> <span class="n">get_lightpath_snr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">check_snr_sufficient</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lightpath_snr_array</span> <span class="o">&gt;=</span> <span class="n">required_snr_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># jax.debug.print(&quot;check_snr_sufficient {}&quot;, check_snr_sufficient, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;required_snr_array {}&quot;, required_snr_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;lightpath_snr_array {}&quot;, lightpath_snr_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;state.modulation_format_index_array {}&quot;, state.modulation_format_index_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;state.channel_centre_bw_array {}&quot;, state.channel_centre_bw_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;state.channel_power_array {}&quot;, state.channel_power_array, ordered=True)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">check_snr_sufficient</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_topology" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_topology</span><span class="p">(</span><span class="n">action_history</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check that each unique virtual node (as indicated by topology pattern) is assigned to a consistent physical node
i.e. start and end node of ring is same physical node.
Method:
For each node index in topology pattern, mask action history with that index, then find max value in masked array.
If max value is not the same for all values for that virtual node in action history, then return 1, else 0.
Array should be all zeroes at the end, so do an any() check on that.
e.g. virtual topology pattern = [2,1,3,1,4,1,2]  3 node ring
action history = [0,34,4,0,3,1,0]
meaning v node "2" goes p node 0, v node "3" goes p node 4, v node "4" goes p node 3
The numbers in-between relate to the slot action.
If any value in the array is 1, a virtual node is assigned to multiple different physical nodes.
Need to check from both perspectives:
1. For each virtual node, check that all physical nodes are the same
2. For each physical node, check that all virtual nodes are the same</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>action_history</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>topology_pattern</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Topology pattern</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_topology</span><span class="p">(</span><span class="n">action_history</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that each unique virtual node (as indicated by topology pattern) is assigned to a consistent physical node</span>
<span class="sd">    i.e. start and end node of ring is same physical node.</span>
<span class="sd">    Method:</span>
<span class="sd">    For each node index in topology pattern, mask action history with that index, then find max value in masked array.</span>
<span class="sd">    If max value is not the same for all values for that virtual node in action history, then return 1, else 0.</span>
<span class="sd">    Array should be all zeroes at the end, so do an any() check on that.</span>
<span class="sd">    e.g. virtual topology pattern = [2,1,3,1,4,1,2]  3 node ring</span>
<span class="sd">    action history = [0,34,4,0,3,1,0]</span>
<span class="sd">    meaning v node &quot;2&quot; goes p node 0, v node &quot;3&quot; goes p node 4, v node &quot;4&quot; goes p node 3</span>
<span class="sd">    The numbers in-between relate to the slot action.</span>
<span class="sd">    If any value in the array is 1, a virtual node is assigned to multiple different physical nodes.</span>
<span class="sd">    Need to check from both perspectives:</span>
<span class="sd">    1. For each virtual node, check that all physical nodes are the same</span>
<span class="sd">    2. For each physical node, check that all virtual nodes are the same</span>

<span class="sd">    Args:</span>
<span class="sd">        action_history: Action history</span>
<span class="sd">        topology_pattern: Topology pattern</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">loop_func_virtual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Get indices of physical node in action history that correspond to virtual node i</span>
        <span class="n">masked_val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">topology_pattern</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Get maximum value at those indices (should all be same)</span>
        <span class="n">max_node</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">masked_val</span><span class="p">)</span>
        <span class="c1"># For relevant indices, if max value then return 0 else 1</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masked_val</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked_val</span> <span class="o">!=</span> <span class="n">max_node</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">loop_func_physical</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Get indices of virtual nodes in topology pattern that correspond to physical node i</span>
        <span class="n">masked_val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">action_history</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Get maximum value at those indices (should all be same)</span>
        <span class="n">max_node</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">masked_val</span><span class="p">)</span>
        <span class="c1"># For relevant indices, if max value then return 0 else 1</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masked_val</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked_val</span> <span class="o">!=</span> <span class="n">max_node</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
    <span class="n">topology_pattern</span> <span class="o">=</span> <span class="n">topology_pattern</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Only look at node indices, not slot actions</span>
    <span class="n">action_history</span> <span class="o">=</span> <span class="n">action_history</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">check_virtual</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop_func_virtual</span><span class="p">,</span> <span class="n">action_history</span><span class="p">)</span>
    <span class="n">check_physical</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">action_history</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">action_history</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop_func_physical</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">)</span>
    <span class="n">check</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">check_virtual</span><span class="p">,</span> <span class="n">check_physical</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_unique_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_unique_nodes</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Count negative values on each node (row) in node departure array, must not exceed 1.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array (N x R) where N is number of nodes and R is number of resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_unique_nodes</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count negative values on each node (row) in node departure array, must not exceed 1.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_departure_array: Node departure array (N x R) where N is number of nodes and R is number of resources</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">one</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.check_vone_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if action is valid.
Combines checks for:
- sufficient node capacities
- unique nodes assigned
- minimum two nodes assigned
- all requested nodes assigned
- correct topology pattern
- no spectrum reuse</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining_actions</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>remaining actions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requested_nodes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>total requested nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if action is valid.</span>
<span class="sd">    Combines checks for:</span>
<span class="sd">    - sufficient node capacities</span>
<span class="sd">    - unique nodes assigned</span>
<span class="sd">    - minimum two nodes assigned</span>
<span class="sd">    - all requested nodes assigned</span>
<span class="sd">    - correct topology pattern</span>
<span class="sd">    - no spectrum reuse</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>
<span class="sd">        remaining_actions: remaining actions</span>
<span class="sd">        total_requested_nodes: total requested nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span>
        <span class="n">check_node_capacities</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span><span class="p">),</span>
        <span class="n">check_unique_nodes</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">),</span>
        <span class="c1"># TODO (VONE) - Remove two nodes check if impairs performance</span>
        <span class="c1">#  (check_all_nodes_assigned is sufficient but fails after last action of request instead of earlier)</span>
        <span class="n">check_min_two_nodes_assigned</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">),</span>
        <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">remaining_actions</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">check_all_nodes_assigned</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">remaining_actions</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">check_topology</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">),</span>
        <span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
    <span class="p">))</span>
    <span class="c1">#jax.debug.print(&quot;Checks: {}&quot;, checks, ordered=True)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">checks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.convert_node_probs_to_traffic_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_node_probs_to_traffic_matrix</span><span class="p">(</span><span class="n">node_probs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert list of node probabilities to symmetric traffic matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_probs</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>node probabilities</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>traffic_matrix</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>traffic matrix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_node_probs_to_traffic_matrix</span><span class="p">(</span><span class="n">node_probs</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert list of node probabilities to symmetric traffic matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_probs: node probabilities</span>

<span class="sd">    Returns:</span>
<span class="sd">        traffic_matrix: traffic matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">node_probs</span><span class="p">,</span> <span class="n">node_probs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="c1"># Set lead diagonal to zero</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">normalise_traffic_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.create_run_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_run_name</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create name for run based on config flags</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_run_name</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">box</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create name for run based on config flags&quot;&quot;&quot;</span>
    <span class="n">env_type</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;env_type&quot;</span><span class="p">]</span>
    <span class="n">topology</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;topology_name&quot;</span><span class="p">]</span>
    <span class="n">slots</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;link_resources&quot;</span><span class="p">]</span>
    <span class="n">gnn</span> <span class="o">=</span> <span class="s2">&quot;_GNN&quot;</span> <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;USE_GNN&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">incremental</span> <span class="o">=</span> <span class="s2">&quot;_INC&quot;</span> <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;incremental_loading&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">run_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">env_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">topology</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">slots</span><span class="si">}{</span><span class="n">gnn</span><span class="si">}{</span><span class="n">incremental</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;EVAL_HEURISTIC&quot;</span><span class="p">]:</span>
        <span class="n">run_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_heuristic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">env_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;vone&quot;</span><span class="p">:</span>
            <span class="n">run_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;node_heuristic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;EVAL_MODEL&quot;</span><span class="p">]:</span>
        <span class="n">run_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_EVAL&quot;</span>
    <span class="k">return</span> <span class="n">run_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.decrement_action_counter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decrement_action_counter</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Decrement action counter in-place. Used in VONE environments.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decrement_action_counter</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decrement action counter in-place. Used in VONE environments.&quot;&quot;&quot;</span>
    <span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.finalise_action_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finalise_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Turn departure times positive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">finalise_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn departure times positive.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">make_positive</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">accepted_services</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_services</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">accepted_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_bitrate</span> <span class="o">+</span> <span class="n">requested_datarate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span> <span class="o">+</span> <span class="n">requested_datarate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.finalise_action_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finalise_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Turn departure times positive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">finalise_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn departure times positive.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">make_positive</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">accepted_services</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_services</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">accepted_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_bitrate</span> <span class="o">+</span> <span class="n">requested_datarate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span> <span class="o">+</span> <span class="n">requested_datarate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.finalise_vone_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finalise_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Turn departure times positive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">finalise_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn departure times positive.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_departure_array</span><span class="o">=</span><span class="n">make_positive</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">make_positive</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">accepted_services</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_services</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">accepted_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_bitrate</span>  <span class="c1"># TODO - get sum of bitrates for requested links</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.format_vone_slot_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_vone_slot_request</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Format slot request for VONE action into format (source-node, slot, destination-node).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>action to format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: formatted request</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">format_vone_slot_request</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format slot request for VONE action into format (source-node, slot, destination-node).</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>
<span class="sd">        action: action to format</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: formatted request</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">remaining_actions</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">full_request</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">unformatted_request</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">full_request</span><span class="p">,</span> <span class="p">(</span><span class="n">remaining_actions</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">node_s</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">requested_slots</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">unformatted_request</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">node_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">formatted_request</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">node_s</span><span class="p">,</span> <span class="n">requested_slots</span><span class="p">,</span> <span class="n">node_d</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">formatted_request</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.generate_arrival_holding_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_arrival_holding_times</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate arrival and holding times based on Poisson distributed events.
To understand how sampling from e^-x can be transformed to sample from lambda<em>e^-(x/lambda) see:
https://en.wikipedia.org/wiki/Inverse_transform_sampling#Examples
Basically, inverse transform sampling is used to sample from a distribution with CDF F(x).
The CDF of the exponential distribution (lambda</em>e^-{lambda<em>x}) is F(x) = 1 - e^-{lambda</em>x}.
Therefore, the inverse CDF is x = -ln(1-u)/lambda, where u is sample from uniform distribution.
Therefore, we need to divide jax.random.exponential() by lambda in order to scale the standard exponential CDF.
Experimental histograms of this method compared to random.expovariate() in Python's random library show that
the two methods are equivalent.
Also see: https://numpy.org/doc/stable/reference/random/generated/numpy.random.exponential.html
https://jax.readthedocs.io/en/latest/_autosummary/jax.random.exponential.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PRNG key</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>arrival_time</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arrival time</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>holding_time</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Holding time</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_arrival_holding_times</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate arrival and holding times based on Poisson distributed events.</span>
<span class="sd">    To understand how sampling from e^-x can be transformed to sample from lambda*e^-(x/lambda) see:</span>
<span class="sd">    https://en.wikipedia.org/wiki/Inverse_transform_sampling#Examples</span>
<span class="sd">    Basically, inverse transform sampling is used to sample from a distribution with CDF F(x).</span>
<span class="sd">    The CDF of the exponential distribution (lambda*e^-{lambda*x}) is F(x) = 1 - e^-{lambda*x}.</span>
<span class="sd">    Therefore, the inverse CDF is x = -ln(1-u)/lambda, where u is sample from uniform distribution.</span>
<span class="sd">    Therefore, we need to divide jax.random.exponential() by lambda in order to scale the standard exponential CDF.</span>
<span class="sd">    Experimental histograms of this method compared to random.expovariate() in Python&#39;s random library show that</span>
<span class="sd">    the two methods are equivalent.</span>
<span class="sd">    Also see: https://numpy.org/doc/stable/reference/random/generated/numpy.random.exponential.html</span>
<span class="sd">    https://jax.readthedocs.io/en/latest/_autosummary/jax.random.exponential.html</span>

<span class="sd">    Args:</span>
<span class="sd">        key: PRNG key</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        arrival_time: Arrival time</span>
<span class="sd">        holding_time: Holding time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key_arrival</span><span class="p">,</span> <span class="n">key_holding</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">arrival_time</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">key_arrival</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span> \
                   <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">arrival_rate</span>  <span class="c1"># Divide because it is rate (lambda)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">truncate_holding_time</span><span class="p">:</span>
        <span class="c1"># For DeepRMSA, need to generate holding times that are less than 2*mean_service_holding_time</span>
        <span class="n">key_holding</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">holding_times</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span> \
                                <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span><span class="p">)(</span><span class="n">key_holding</span><span class="p">)</span>
        <span class="n">holding_times</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">holding_times</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span><span class="p">,</span> <span class="n">holding_times</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
        <span class="c1"># Get first non-zero value in holding_times</span>
        <span class="n">non_zero_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">holding_times</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">holding_time</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">holding_times</span><span class="p">),</span> <span class="p">(</span><span class="n">non_zero_index</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">holding_time</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">key_holding</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span> \
                       <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span>  <span class="c1"># Multiply because it is mean (1/lambda)</span>
    <span class="k">return</span> <span class="n">arrival_time</span><span class="p">,</span> <span class="n">holding_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.generate_vone_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_vone_request</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate a new request for the VONE environment.
The request has two rows. The first row shows the node and slot values.
The first three elements of the second row show the number of unique nodes, the total number of steps, and the remaining steps.
These first three elements comprise the action counter.
The remaining elements of the second row show the virtual topology pattern, i.e. the connectivity of the virtual topology.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_vone_request</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a new request for the VONE environment.</span>
<span class="sd">    The request has two rows. The first row shows the node and slot values.</span>
<span class="sd">    The first three elements of the second row show the number of unique nodes, the total number of steps, and the remaining steps.</span>
<span class="sd">    These first three elements comprise the action counter.</span>
<span class="sd">    The remaining elements of the second row show the virtual topology pattern, i.e. the connectivity of the virtual topology.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">max_edges</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>  <span class="c1"># shape of request array</span>
    <span class="n">key_topology</span><span class="p">,</span> <span class="n">key_node</span><span class="p">,</span> <span class="n">key_slot</span><span class="p">,</span> <span class="n">key_times</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="c1"># Randomly select topology, node resources, slot resources</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">key_topology</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">virtual_topology_patterns</span><span class="p">)</span>
    <span class="n">action_counter</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
    <span class="n">topology_pattern</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">3</span><span class="p">,))</span>
    <span class="n">selected_node_values</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">key_node</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">values_nodes</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">shape</span><span class="p">,))</span>
    <span class="n">selected_bw_values</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">key_slot</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">shape</span><span class="p">,))</span>
    <span class="c1"># Create a mask for odd and even indices</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">shape</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)[:</span><span class="n">shape</span><span class="p">]</span>
    <span class="c1"># Vectorized conditional replacement using mask</span>
    <span class="n">first_row</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">selected_bw_values</span><span class="p">,</span> <span class="n">selected_node_values</span><span class="p">)</span>
    <span class="c1"># Make sure node request values are consistent for same virtual nodes</span>
    <span class="n">first_row</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
        <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Lowest node index in virtual topology requests is 2</span>
        <span class="n">shape</span><span class="p">,</span>  <span class="c1"># Highest possible node index in virtual topology requests is shape-1</span>
        <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">topology_pattern</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">selected_node_values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span>
        <span class="n">first_row</span>
    <span class="p">)</span>
    <span class="c1"># Mask out unused part of request array</span>
    <span class="n">first_row</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">topology_pattern</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">first_row</span><span class="p">)</span>
    <span class="c1"># Set times</span>
    <span class="n">arrival_time</span><span class="p">,</span> <span class="n">holding_time</span> <span class="o">=</span> <span class="n">generate_arrival_holding_times</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">holding_time</span><span class="o">=</span><span class="n">holding_time</span><span class="p">,</span>
        <span class="n">current_time</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">arrival_time</span><span class="p">,</span>
        <span class="n">action_counter</span><span class="o">=</span><span class="n">action_counter</span><span class="p">,</span>
        <span class="n">request_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">first_row</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">)),</span>
        <span class="n">action_history</span><span class="o">=</span><span class="n">init_action_history</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">total_requests</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_requests</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">remove_expired_node_requests</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">incremental_loading</span> <span class="k">else</span> <span class="n">state</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">remove_expired_services_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">incremental_loading</span> <span class="k">else</span> <span class="n">state</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_best_modulation_format" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_best_modulation_format</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get best modulation format for lightpath. "Best" is the highest order that has SNR requirements below available.
Try each modulation format, calculate SNR for each, then return the highest order possible.
Args:
    state (EnvState): Environment state
    path (chex.Array): Path array
    initial_slot_index (int): Initial slot index
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Acceptable modulation format indices</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_best_modulation_format</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get best modulation format for lightpath. &quot;Best&quot; is the highest order that has SNR requirements below available.</span>
<span class="sd">    Try each modulation format, calculate SNR for each, then return the highest order possible.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        path (chex.Array): Path array</span>
<span class="sd">        initial_slot_index (int): Initial slot index</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Acceptable modulation format indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">mod_format_count</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">acceptable_mod_format_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mod_format_count</span><span class="p">,),</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">acceptable_modulation_format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">acceptable_format_indices</span><span class="p">):</span>
        <span class="n">req_snr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">snr_margin</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">req_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="c1"># TODO - need to check we don&#39;t overwrite values in already occupied slots</span>
        <span class="c1"># Possible approaches:</span>
        <span class="c1"># Check slot occupancy? Probably would need to iterate through for num_slots, but that&#39;s an issue</span>
        <span class="c1"># What about we allocate and then fix up later, e.g. could it be possible to just add the modulation format on top without</span>
        <span class="c1"># check sum of path links prior to assigning?</span>
        <span class="c1">#</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
            <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">snr_value</span> <span class="o">=</span> <span class="n">get_minimum_snr_of_channels_on_path</span><span class="p">(</span><span class="n">new_state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="c1"># jax.debug.print(&quot;snr_value {}&quot;, snr_value, ordered=True)</span>
        <span class="c1"># jax.debug.print(&quot;req_snr {}&quot;, req_snr, ordered=True)</span>
        <span class="n">acceptable_format_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">snr_value</span> <span class="o">&gt;=</span> <span class="n">req_snr</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">acceptable_format_indices</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">acceptable_format_indices</span><span class="p">,</span> <span class="n">acceptable_format_index</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,))</span>
        <span class="c1"># jax.debug.print(&quot;acceptable_format_indices {}&quot;, acceptable_format_indices, ordered=True)</span>
        <span class="k">return</span> <span class="n">acceptable_format_indices</span>

    <span class="n">acceptable_mod_format_indices</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">mod_format_count</span><span class="p">,</span>
        <span class="n">acceptable_modulation_format</span><span class="p">,</span>
        <span class="n">acceptable_mod_format_indices</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">acceptable_mod_format_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_best_modulation_format_simple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_best_modulation_format_simple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get modulation format for lightpath.
Assume worst case (least Gaussian) modulation format when calculating SNR.
Args:
    state (EnvState): Environment state
    path (chex.Array): Path array
    initial_slot_index (int): Initial slot index
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Acceptable modulation format indices</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_best_modulation_format_simple</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get modulation format for lightpath.</span>
<span class="sd">    Assume worst case (least Gaussian) modulation format when calculating SNR.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        path (chex.Array): Path array</span>
<span class="sd">        initial_slot_index (int): Initial slot index</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Acceptable modulation format indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_snr_array</span> <span class="o">=</span> <span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">snr_value</span> <span class="o">=</span> <span class="n">get_snr_for_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link_snr_array</span><span class="p">,</span> <span class="n">params</span><span class="p">)[</span><span class="n">initial_slot_index</span><span class="p">]</span> <span class="o">-</span> <span class="n">params</span><span class="o">.</span><span class="n">snr_margin</span>  <span class="c1"># Margin</span>
    <span class="n">mod_format_count</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">acceptable_mod_format_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mod_format_count</span><span class="p">)</span>
    <span class="n">req_snr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">snr_margin</span>
    <span class="n">acceptable_mod_format_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">snr_value</span> <span class="o">&gt;=</span> <span class="n">req_snr</span><span class="p">,</span>
                                              <span class="n">acceptable_mod_format_indices</span><span class="p">,</span>
                                              <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mod_format_count</span><span class="p">,),</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">acceptable_mod_format_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_centre_frequency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_centre_frequency</span><span class="p">(</span><span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get centre frequency for new lightpath</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>initial_slot_index</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Centre frequency of first slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slots</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Centre frequency for new lightpath</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_centre_frequency</span><span class="p">(</span><span class="n">initial_slot_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get centre frequency for new lightpath</span>

<span class="sd">    Args:</span>
<span class="sd">        initial_slot_index (chex.Array): Centre frequency of first slot</span>
<span class="sd">        num_slots (float): Number of slots</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Centre frequency for new lightpath</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slot_centres</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span>
    <span class="k">return</span> <span class="n">slot_centres</span><span class="p">[</span><span class="n">initial_slot_index</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">slot_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_slots</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_edge_disjoint_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_edge_disjoint_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get edge disjoint paths between all nodes in graph.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>edge disjoint paths (path is list of edges)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_edge_disjoint_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get edge disjoint paths between all nodes in graph.</span>

<span class="sd">    Args:</span>
<span class="sd">        graph: graph</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: edge disjoint paths (path is list of edges)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="c1"># Sort by number of links in path</span>
        <span class="c1"># TODO - sort by path length</span>
        <span class="n">result</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="n">n2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">edge_disjoint_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="n">n2</span><span class="p">][</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">edge_disjoint_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n1</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_launch_power" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get launch power for new lightpath. N.B. launch power is specified in dBm but is converted to linear units
when stored in channel_power_array. This func returns linear units (mW).
Path action is used to determine the launch power in the case of tabular launch power type.
Power action is used to determine the launch power in the case of RL launch power type. During masking,
power action is set as state.launch_power_array[0], which is set by the RL agent.
Args:
    state (EnvState): Environment state
    path_action (chex.Array): Action specifying path index (0 to k_paths-1)
    power_action (chex.Array): Action specifying launch power in dBm
    params (EnvParams): Environment parameters
Returns:
    chex.Array: Launch power for new lightpath</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3429</span>
<span class="normal">3430</span>
<span class="normal">3431</span>
<span class="normal">3432</span>
<span class="normal">3433</span>
<span class="normal">3434</span>
<span class="normal">3435</span>
<span class="normal">3436</span>
<span class="normal">3437</span>
<span class="normal">3438</span>
<span class="normal">3439</span>
<span class="normal">3440</span>
<span class="normal">3441</span>
<span class="normal">3442</span>
<span class="normal">3443</span>
<span class="normal">3444</span>
<span class="normal">3445</span>
<span class="normal">3446</span>
<span class="normal">3447</span>
<span class="normal">3448</span>
<span class="normal">3449</span>
<span class="normal">3450</span>
<span class="normal">3451</span>
<span class="normal">3452</span>
<span class="normal">3453</span>
<span class="normal">3454</span>
<span class="normal">3455</span>
<span class="normal">3456</span>
<span class="normal">3457</span>
<span class="normal">3458</span>
<span class="normal">3459</span>
<span class="normal">3460</span>
<span class="normal">3461</span>
<span class="normal">3462</span>
<span class="normal">3463</span>
<span class="normal">3464</span>
<span class="normal">3465</span>
<span class="normal">3466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">path_action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">power_action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get launch power for new lightpath. N.B. launch power is specified in dBm but is converted to linear units</span>
<span class="sd">    when stored in channel_power_array. This func returns linear units (mW).</span>
<span class="sd">    Path action is used to determine the launch power in the case of tabular launch power type.</span>
<span class="sd">    Power action is used to determine the launch power in the case of RL launch power type. During masking,</span>
<span class="sd">    power action is set as state.launch_power_array[0], which is set by the RL agent.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        path_action (chex.Array): Action specifying path index (0 to k_paths-1)</span>
<span class="sd">        power_action (chex.Array): Action specifying launch power in dBm</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Launch power for new lightpath</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k_path_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path_action</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">launch_power_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Fixed</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">launch_power_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">launch_power_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Tabular (one row per path)</span>
        <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">launch_power_array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k_path_index</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">launch_power_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># RL</span>
        <span class="k">return</span> <span class="n">power_action</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">launch_power_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># Scaled</span>
        <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span>
        <span class="c1"># Get path length</span>
        <span class="n">link_length_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">path_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">link_length_array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k_path_index</span><span class="p">],</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">path_link_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">unpackbits</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">)[:,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">pack_path_bits</span> \
            <span class="k">else</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span>
        <span class="n">maximum_path_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">launch_power_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">path_length</span> <span class="o">/</span> <span class="n">maximum_path_length</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid launch power type. Check params.launch_power_type&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_lightpath_snr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_lightpath_snr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get SNR for each link on path.
N.B. that in most cases it is more efficient to calculate the SNR for every possible path, rather than a slot-by-slot basis.
But in some cases slot-by-slot is better i.e. when k<em>N(N-1)/2 &gt; L</em>S
Args:
    state (RSAGNModelEnvState): Environment state
    params (RSAGNModelEnvParams): Environment parameters</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.array: SNR for each link on path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_lightpath_snr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get SNR for each link on path.</span>
<span class="sd">    N.B. that in most cases it is more efficient to calculate the SNR for every possible path, rather than a slot-by-slot basis.</span>
<span class="sd">    But in some cases slot-by-slot is better i.e. when k*N(N-1)/2 &gt; L*S</span>
<span class="sd">    Args:</span>
<span class="sd">        state (RSAGNModelEnvState): Environment state</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.array: SNR for each link on path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the SNR for the channel that the path occupies</span>
    <span class="n">path_snr_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_snr_for_path</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Where value in path_index_array matches index of path_snr_array, substitute in SNR value</span>
    <span class="n">slot_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
    <span class="n">lightpath_snr_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">si</span><span class="p">:</span> <span class="n">path_snr_array</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">si</span><span class="p">],</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">slot_indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lightpath_snr_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_minimum_snr_of_channels_on_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_minimum_snr_of_channels_on_path</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the minimum value of the SNR on newly assigned channels.
N.B. this requires the link_snr_array to have already been calculated and present in state.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_minimum_snr_of_channels_on_path</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">slot_index</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the minimum value of the SNR on newly assigned channels.</span>
<span class="sd">    N.B. this requires the link_snr_array to have already been calculated and present in state.&quot;&quot;&quot;</span>
    <span class="n">snr_value_all_channels</span> <span class="o">=</span> <span class="n">get_snr_for_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">min_snr_value_sub_channels</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
            <span class="n">snr_value_all_channels</span><span class="p">[</span><span class="n">slot_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span>
            <span class="n">snr_value_all_channels</span><span class="p">[</span><span class="n">slot_index</span> <span class="o">+</span> <span class="n">req_slots</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
        <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">min_snr_value_sub_channels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_num_spectral_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_num_spectral_features</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Heuristic for number of spectral features based on graph size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_nodes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes in the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of spectral features to use, clamped between 3 and 15.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Follows log2(n_nodes) scaling as reasonable default.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_num_spectral_features</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Heuristic for number of spectral features based on graph size.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_nodes: Number of nodes in the graph</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of spectral features to use, clamped between 3 and 15.</span>
<span class="sd">        Follows log2(n_nodes) scaling as reasonable default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">))),</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_path_from_path_index_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path_from_path_index_array</span><span class="p">(</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path_link_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get path from path index array.
Args:
    path_index_array (chex.Array): Path index array
    path_link_array (chex.Array): Path link array</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: path index values replaced with binary path-link arrays</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path_from_path_index_array</span><span class="p">(</span><span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get path from path index array.</span>
<span class="sd">    Args:</span>
<span class="sd">        path_index_array (chex.Array): Path index array</span>
<span class="sd">        path_link_array (chex.Array): Path link array</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: path index values replaced with binary path-link arrays</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - support unpacking bits (if this function ends up being used)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_from_link</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">path_link_array</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">link</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_index_from_link</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">path_index_array</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_path_index_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Indices of paths between source and destination from path array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Indices of paths between source and destination from path array&quot;&quot;&quot;</span>
    <span class="c1"># get source and destination nodes in order (for accurate indexing of path-link array)</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span>
    <span class="n">index_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">index_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_path_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path_indices</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get path indices for a given source, destination and number of paths.
If source &gt; destination and the graph is directed (two fibres per link, one in each direction) then an offset is
added to the index to get the path in the other direction (the offset is the total number source-dest pairs).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node index</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Destination node index</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>N</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: Start index on path-link array for candidate paths</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path_indices</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get path indices for a given source, destination and number of paths.</span>
<span class="sd">    If source &gt; destination and the graph is directed (two fibres per link, one in each direction) then an offset is</span>
<span class="sd">    added to the index to get the path in the other direction (the offset is the total number source-dest pairs).</span>

<span class="sd">    Args:</span>
<span class="sd">        s (int): Source node index</span>
<span class="sd">        d (int): Destination node index</span>
<span class="sd">        k (int): Number of paths</span>
<span class="sd">        N (int): Number of nodes</span>
<span class="sd">        directed (bool, optional): Whether graph is directed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Start index on path-link array for candidate paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span>
    <span class="n">indices_to_s</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_indices</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">))</span>
    <span class="n">indices_to_d</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_indices</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">))</span>
    <span class="c1"># If two fibres per link, add offset to index to get fibre in other direction if source &gt; destination</span>
    <span class="n">directed_offset</span> <span class="o">=</span> <span class="n">directed</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1"># The following equation is based on the combinations formula</span>
    <span class="n">forward</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">indices_to_s</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">backward</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">d</span> <span class="o">+</span> <span class="n">s</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">indices_to_d</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">forward</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="n">backward</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="n">directed_offset</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_path_slots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path_slots</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get slots on each constitutent link of path from link_slot_array (L x S),
then aggregate to get (S x 1) representation of slots on path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>link-slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nodes_sd</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>source-destination nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>i</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path index</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>agg_func</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>aggregation function (max or sum).
If max, result will be available slots on path.
If sum, result will contain information on edge features.</p>
              </div>
            </td>
            <td>
                  <code>&#39;max&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>slots</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>slots on path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path_slots</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">agg_func</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get slots on each constitutent link of path from link_slot_array (L x S),</span>
<span class="sd">    then aggregate to get (S x 1) representation of slots on path.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array: link-slot array</span>
<span class="sd">        params: environment parameters</span>
<span class="sd">        nodes_sd: source-destination nodes</span>
<span class="sd">        i: path index</span>
<span class="sd">        agg_func: aggregation function (max or sum).</span>
<span class="sd">            If max, result will be available slots on path.</span>
<span class="sd">            If sum, result will contain information on edge features.</span>

<span class="sd">    Returns:</span>
<span class="sd">        slots: slots on path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># Get links and collapse to single dimension</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="k">if</span> <span class="n">agg_func</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">)</span>
    <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link_slot_array</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_slots</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">))</span>
    <span class="c1"># Make any -1s positive then get max for each slot across links</span>
    <span class="k">if</span> <span class="n">agg_func</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
        <span class="c1"># Use this for getting slots from link_slot_array</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">slots</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">agg_func</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
        <span class="c1"># TODO - consider using an RNN (or S5) to aggregate edge features</span>
        <span class="c1"># Use this (or alternative) for aggregating edge features from GNN</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">agg_func</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
        <span class="c1"># Use this for getting mean value in slot index along path</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;agg_func must be &#39;max&#39; or &#39;sum&#39; or &#39;mean&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">slots</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get k paths between source and destination</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get k paths between source and destination&quot;&quot;&quot;</span>
    <span class="n">index_array</span> <span class="o">=</span> <span class="n">get_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">index_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">pack_path_bits</span><span class="p">:</span>  <span class="c1"># Unpack the bit-packed paths</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">unpackbits</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="p">:</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_paths_obs_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_paths_obs_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get observation space for launch power optimization (with numerical stability).</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span>
<span class="normal">3472</span>
<span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span>
<span class="normal">3477</span>
<span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span>
<span class="normal">3486</span>
<span class="normal">3487</span>
<span class="normal">3488</span>
<span class="normal">3489</span>
<span class="normal">3490</span>
<span class="normal">3491</span>
<span class="normal">3492</span>
<span class="normal">3493</span>
<span class="normal">3494</span>
<span class="normal">3495</span>
<span class="normal">3496</span>
<span class="normal">3497</span>
<span class="normal">3498</span>
<span class="normal">3499</span>
<span class="normal">3500</span>
<span class="normal">3501</span>
<span class="normal">3502</span>
<span class="normal">3503</span>
<span class="normal">3504</span>
<span class="normal">3505</span>
<span class="normal">3506</span>
<span class="normal">3507</span>
<span class="normal">3508</span>
<span class="normal">3509</span>
<span class="normal">3510</span>
<span class="normal">3511</span>
<span class="normal">3512</span>
<span class="normal">3513</span>
<span class="normal">3514</span>
<span class="normal">3515</span>
<span class="normal">3516</span>
<span class="normal">3517</span>
<span class="normal">3518</span>
<span class="normal">3519</span>
<span class="normal">3520</span>
<span class="normal">3521</span>
<span class="normal">3522</span>
<span class="normal">3523</span>
<span class="normal">3524</span>
<span class="normal">3525</span>
<span class="normal">3526</span>
<span class="normal">3527</span>
<span class="normal">3528</span>
<span class="normal">3529</span>
<span class="normal">3530</span>
<span class="normal">3531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_paths_obs_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
    <span class="c1"># TODO - make this just show the stats from just one path at a time</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get observation space for launch power optimization (with numerical stability).&quot;&quot;&quot;</span>
    <span class="n">request_array</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">path_stats</span> <span class="o">=</span> <span class="n">calculate_path_stats</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request_array</span><span class="p">)</span>
    <span class="c1"># Remove first 3 items of path stats for each path</span>
    <span class="n">path_stats</span> <span class="o">=</span> <span class="n">path_stats</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:]</span>
    <span class="n">link_length_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lightpath_snr_array</span> <span class="o">=</span> <span class="n">get_lightpath_snr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_gn_path_stats</span><span class="p">(</span><span class="n">k_path_index</span><span class="p">,</span> <span class="n">init_val</span><span class="p">):</span>
        <span class="c1"># Get path index</span>
        <span class="n">path_index</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span>
                                      <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span> <span class="o">+</span> <span class="n">k_path_index</span>
        <span class="n">path_link_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">unpackbits</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="p">:</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">pack_path_bits</span> \
            <span class="k">else</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path_link_array</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span>
        <span class="n">path_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link_length_array</span><span class="p">)</span>
        <span class="n">max_path_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">link_length_array</span><span class="p">))</span>
        <span class="n">path_length_norm</span> <span class="o">=</span> <span class="n">path_length</span> <span class="o">/</span> <span class="n">max_path_length</span>
        <span class="n">max_path_length_hops</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">path_length_hops_norm</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span> <span class="o">/</span> <span class="n">max_path_length_hops</span>
        <span class="c1"># Connections on path</span>
        <span class="n">num_connections</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">num_connections_norm</span> <span class="o">=</span> <span class="n">num_connections</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="c1"># Mean power of connections on path</span>
        <span class="c1"># make path with row length equal to link_resource (+1 to avoid zero division)</span>
        <span class="n">mean_power_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span>
                           <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_connections</span> <span class="o">&gt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">num_connections</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">max_power</span><span class="p">))</span>
        <span class="c1"># Mean SNR of connections on the path links</span>
        <span class="n">max_snr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>  <span class="c1"># Nominal value for max GSNR in dB</span>
        <span class="n">mean_snr_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">lightpath_snr_array</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span>
                         <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_connections</span> <span class="o">&gt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">num_connections</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_snr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span>
            <span class="n">init_val</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
                <span class="n">path_length</span><span class="p">,</span>
                <span class="n">path_length_hops_norm</span><span class="p">,</span>
                <span class="n">num_connections_norm</span><span class="p">,</span>
                <span class="n">mean_power_norm</span><span class="p">,</span>
                <span class="n">mean_snr_norm</span>
            <span class="p">]]),</span>
            <span class="p">(</span><span class="n">k_path_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">gn_path_stats</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="n">gn_path_stats</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">calculate_gn_path_stats</span><span class="p">,</span> <span class="n">gn_path_stats</span>
    <span class="p">)</span>
    <span class="n">all_stats</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">path_stats</span><span class="p">,</span> <span class="n">gn_path_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">source</span><span class="p">]),</span>
            <span class="n">requested_datarate</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dest</span><span class="p">]),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">all_stats</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_paths_se" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get max. spectral efficiency of modulation format on k paths between source and destination</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get max. spectral efficiency of modulation format on k paths between source and destination&quot;&quot;&quot;</span>
    <span class="c1"># get source and destination nodes in order (for accurate indexing of path-link array)</span>
    <span class="n">index_array</span> <span class="o">=</span> <span class="n">get_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">path_se_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">index_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_required_snr_se_kurtosis_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_required_snr_se_kurtosis_array</span><span class="p">(</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert modulation format index to required SNR or spectral efficiency.
Modulation format index array contains the index of the modulation format used by the channel.
The modulation index references a row in the modulations array, which contains SNR and SE values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>modulation_format_index_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Modulation format index array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>col_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column index for required SNR or spectral efficiency</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: Required SNR for each channel (min. SNR for empty channel (mod. index 0))</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_required_snr_se_kurtosis_array</span><span class="p">(</span><span class="n">modulation_format_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">col_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert modulation format index to required SNR or spectral efficiency.</span>
<span class="sd">    Modulation format index array contains the index of the modulation format used by the channel.</span>
<span class="sd">    The modulation index references a row in the modulations array, which contains SNR and SE values.</span>

<span class="sd">    Args:</span>
<span class="sd">        modulation_format_index_array (chex.Array): Modulation format index array</span>
<span class="sd">        col_index (int): Column index for required SNR or spectral efficiency</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Required SNR for each channel (min. SNR for empty channel (mod. index 0))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_required_snr_se_kurtosis_on_link</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_snr_link_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get SNR per link
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
Returns:
    jnp.array: SNR per link</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get SNR per link</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: SNR per link</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_link_snr</span><span class="p">(</span><span class="n">link_index</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="c1"># Get channel power, channel centre, bandwidth, and noise figure</span>
        <span class="n">link_lengths</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="p">[</span><span class="n">link_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">num_spans</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">link_lengths</span><span class="p">)</span><span class="o">*</span><span class="mf">1e3</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">max_span_length</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mod_format_correction</span><span class="p">:</span>
            <span class="n">mod_format_link</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">[</span><span class="n">link_index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">kurtosis_link</span> <span class="o">=</span> <span class="n">get_required_snr_se_kurtosis_on_link</span><span class="p">(</span><span class="n">mod_format_link</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">se_link</span> <span class="o">=</span> <span class="n">get_required_snr_se_kurtosis_on_link</span><span class="p">(</span><span class="n">mod_format_link</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kurtosis_link</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
            <span class="n">se_link</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
        <span class="n">bw_link</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">[</span><span class="n">link_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ch_power_link</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">[</span><span class="n">link_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">required_slots_link</span> <span class="o">=</span> <span class="n">get_required_slots_on_link</span><span class="p">(</span><span class="n">bw_link</span><span class="p">,</span> <span class="n">se_link</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">ch_centres_link</span> <span class="o">=</span> <span class="n">get_centre_freq_on_link</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="n">required_slots_link</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="c1"># Calculate SNR</span>
        <span class="n">P</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">num_channels</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span>
            <span class="n">num_spans</span><span class="o">=</span><span class="n">num_spans</span><span class="p">,</span>
            <span class="n">max_spans</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">max_spans</span><span class="p">,</span>
            <span class="n">ref_lambda</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">ref_lambda</span><span class="p">,</span>
            <span class="n">length</span><span class="o">=</span><span class="n">link_lengths</span><span class="p">,</span>
            <span class="n">attenuation_i</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">attenuation</span><span class="p">),</span>
            <span class="n">attenuation_bar_i</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">attenuation_bar</span><span class="p">),</span>
            <span class="n">nonlinear_coeff</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">nonlinear_coeff</span><span class="p">),</span>
            <span class="n">raman_gain_slope_i</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">raman_gain_slope</span><span class="p">),</span>
            <span class="n">dispersion_coeff</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">dispersion_coeff</span><span class="p">),</span>
            <span class="n">dispersion_slope</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">dispersion_slope</span><span class="p">),</span>
            <span class="n">coherent</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">coherent</span><span class="p">,</span>
            <span class="n">num_roadms</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">num_roadms</span><span class="p">,</span>
            <span class="n">roadm_loss</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">roadm_loss</span><span class="p">,</span>
            <span class="n">amplifier_noise_figure</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">amplifier_noise_figure</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
            <span class="n">transceiver_snr</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">transceiver_snr</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
            <span class="n">mod_format_correction</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">mod_format_correction</span><span class="p">,</span>
            <span class="n">ch_power_w_i</span><span class="o">=</span><span class="n">ch_power_link</span><span class="p">,</span>
            <span class="n">ch_centre_i</span><span class="o">=</span><span class="n">ch_centres_link</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span>
            <span class="n">ch_bandwidth_i</span><span class="o">=</span><span class="n">bw_link</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span>
            <span class="n">excess_kurtosis_i</span><span class="o">=</span><span class="n">kurtosis_link</span><span class="p">,</span>
            <span class="n">uniform_spans</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">uniform_spans</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">snr</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">get_snr</span><span class="p">(</span><span class="o">**</span><span class="n">P</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">snr</span>

    <span class="n">link_snr_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_link_snr</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">),</span> <span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">link_snr_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">link_snr_array</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">link_snr_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.get_spectral_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_spectral_features</span><span class="p">(</span><span class="n">laplacian</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute spectral node features from symmetric normalized graph Laplacian.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>adj</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Adjacency matrix of the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_features</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of eigenvector features to extract</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jax.numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of shape (n_nodes, num_features) containing eigenvectors corresponding</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jax.numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>to the smallest non-zero eigenvalues of the graph Laplacian.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Skips trivial eigenvectors (those with near-zero eigenvalues)</li>
<li>Eigenvectors are ordered by ascending eigenvalue magnitude</li>
<li>Runtime is O(n^3) - use only for small/medium graphs</li>
<li>Eigenvector signs are arbitrary (may vary between runs)</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_spectral_features</span><span class="p">(</span><span class="n">laplacian</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">num_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute spectral node features from symmetric normalized graph Laplacian.</span>

<span class="sd">    Args:</span>
<span class="sd">        adj: Adjacency matrix of the graph</span>
<span class="sd">        num_features: Number of eigenvector features to extract</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array of shape (n_nodes, num_features) containing eigenvectors corresponding</span>
<span class="sd">        to the smallest non-zero eigenvalues of the graph Laplacian.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Skips trivial eigenvectors (those with near-zero eigenvalues)</span>
<span class="sd">        - Eigenvectors are ordered by ascending eigenvalue magnitude</span>
<span class="sd">        - Runtime is O(n^3) - use only for small/medium graphs</span>
<span class="sd">        - Eigenvector signs are arbitrary (may vary between runs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_nodes</span> <span class="o">=</span> <span class="n">laplacian</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">laplacian</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="p">:</span><span class="n">num_features</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.implement_action_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Implement action for RSA GN model. Update following arrays:
- link_slot_array
- link_slot_departure_array
- link_snr_array
- modulation_format_index_array
- channel_power_array
- active_path_array
Args:
    state (EnvState): Environment state
    action (chex.Array): Action tuple (first is path action, second is launch_power)
    params (EnvParams): Environment parameters
Returns:
    EnvState: Updated environment state</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_action_rmsa_gn_model</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement action for RSA GN model. Update following arrays:</span>
<span class="sd">    - link_slot_array</span>
<span class="sd">    - link_slot_departure_array</span>
<span class="sd">    - link_snr_array</span>
<span class="sd">    - modulation_format_index_array</span>
<span class="sd">    - channel_power_array</span>
<span class="sd">    - active_path_array</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        action (chex.Array): Action tuple (first is path action, second is launch_power)</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        EnvState: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span> <span class="o">=</span> <span class="n">action</span>
    <span class="n">path_action</span> <span class="o">=</span> <span class="n">path_action</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="n">k_path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path_action</span><span class="p">)</span>
    <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">get_lightpath_index</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">k_path_index</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">k_path_index</span><span class="p">]</span>
    <span class="n">launch_power</span> <span class="o">=</span> <span class="n">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># TODO(GN MODEL) - get mod. format based on maximum reach</span>
    <span class="n">mod_format_index</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
        <span class="n">state</span><span class="o">.</span><span class="n">mod_format_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">path_action</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">mod_format_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
    <span class="c1"># Update link_slot_array and link_slot_departure_array, then other arrays</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
        <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">mod_format_index</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># Update link_snr_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_snr_array</span><span class="o">=</span><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
    <span class="c1"># jax.debug.print(&quot;launch_power {}&quot;, launch_power, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;mod_format_index {}&quot;, mod_format_index, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;initial_slot_index {}&quot;, initial_slot_index, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;state.mod_format_mask {}&quot;, state.mod_format_mask, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;path_snr {}&quot;, get_snr_for_path(path, state.link_snr_array, params), ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;required_snr {}&quot;, params.modulations_array.val[mod_format_index][2] + params.snr_margin, ordered=True)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.implement_action_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Implement action to assign slots on links.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>action to implement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_action_rsa</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement action to assign slots on links.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>
<span class="sd">        action: action to implement</span>
<span class="sd">        params: environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RWALightpathReuseEnvParams&quot;</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">link_capacity_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">requested_datarate</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># TODO (Dynamic-RWALR) - to support diverse requested_datarates for RWA-LR, need to update masking</span>
        <span class="c1"># TODO (Dynamic-RWALR) - In order to enable dynamic RWA with lightpath reuse (as opposed to just incremental loading),</span>
        <span class="c1">#  need to keep track of active requests OR just randomly remove connections</span>
        <span class="c1">#  (could do this by using the link_slot_departure array in a novel way... i.e. don&#39;t fill it with departure time but current bw)</span>
        <span class="n">capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">over_capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">total_mask</span> <span class="o">=</span> <span class="n">capacity_mask</span> <span class="o">+</span> <span class="n">over_capacity_mask</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">link_slot_array</span><span class="o">=</span><span class="n">total_mask</span><span class="p">,</span>
            <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
                                                                       <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                                                       <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">one</span>
        <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.implement_action_rsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_action_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Implement action for RSA GN model. Update following arrays:
- link_slot_array
- link_slot_departure_array
- link_snr_array
- modulation_format_index_array
- channel_power_array
- active_path_array
Args:
    state (EnvState): Environment state
    action (chex.Array): Action tuple (first is path action, second is launch_power)
    params (EnvParams): Environment parameters
Returns:
    EnvState: Updated environment state</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_action_rsa_gn_model</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement action for RSA GN model. Update following arrays:</span>
<span class="sd">    - link_slot_array</span>
<span class="sd">    - link_slot_departure_array</span>
<span class="sd">    - link_snr_array</span>
<span class="sd">    - modulation_format_index_array</span>
<span class="sd">    - channel_power_array</span>
<span class="sd">    - active_path_array</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        action (chex.Array): Action tuple (first is path action, second is launch_power)</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        EnvState: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span> <span class="o">=</span> <span class="n">action</span>
    <span class="n">path_action</span> <span class="o">=</span> <span class="n">path_action</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="n">k_path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path_action</span><span class="p">)</span>
    <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">get_lightpath_index</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">k_path_index</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">k_path_index</span><span class="p">]</span>
    <span class="n">launch_power</span> <span class="o">=</span> <span class="n">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
    <span class="c1"># Update link_slot_array and link_slot_departure_array, then other arrays</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
        <span class="c1"># TODO - update this to use separate arrays to track channel centres and bandwidths and update with bandwidth (that may or may not equal slot size)</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">active_lightpaths_array</span><span class="o">=</span><span class="n">update_active_lightpaths_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">),</span>
            <span class="n">active_lightpaths_array_departure</span><span class="o">=</span><span class="n">update_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">current_time</span><span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># No need to check SNR until end of episode</span>
        <span class="k">return</span> <span class="n">state</span>
    <span class="c1"># Update link_snr_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_snr_array</span><span class="o">=</span><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.implement_action_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For use in RWALightpathReuseEnv.
Update link_slot_array and link_slot_departure_array to reflect new lightpath assignment.
Update link_capacity_array with new capacity if lightpath is available.
Undo link_capacity_update if over capacity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For use in RWALightpathReuseEnv.</span>
<span class="sd">    Update link_slot_array and link_slot_departure_array to reflect new lightpath assignment.</span>
<span class="sd">    Update link_capacity_array with new capacity if lightpath is available.</span>
<span class="sd">    Undo link_capacity_update if over capacity.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        action: Action array</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span>
    <span class="n">lightpath_available_check</span><span class="p">,</span> <span class="n">lightpath_existing_check</span><span class="p">,</span> <span class="n">curr_lightpath_capacity</span><span class="p">,</span> <span class="n">lightpath_index</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">check_lightpath_available_and_existing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># Get path capacity - request</span>
    <span class="n">lightpath_capacity</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">lightpath_existing_check</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">curr_lightpath_capacity</span> <span class="o">-</span> <span class="n">requested_datarate</span><span class="p">,</span>  <span class="c1"># Subtract requested_datarate from current lightpath</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_capacity_array</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">requested_datarate</span><span class="p">,</span>  <span class="c1"># Get initial capacity of lightpath - request</span>
        <span class="n">lightpath_index</span>
    <span class="p">)</span>
    <span class="c1"># Update link_capacity_array with new capacity if lightpath is available</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">lightpath_available_check</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">link_capacity_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lightpath_capacity</span>
            <span class="p">),</span>
            <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lightpath_index</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="n">state</span>
    <span class="p">)</span>
    <span class="n">capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">over_capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="c1"># Undo link_capacity_update if over capacity</span>
    <span class="c1"># N.B. this will fail if requested capacity is greater than total original capacity of lightpath</span>
    <span class="n">lightpath_capacity_before_action</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">lightpath_existing_check</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">curr_lightpath_capacity</span><span class="p">,</span>  <span class="c1"># Subtract requested_datarate from current lightpath</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span>  <span class="c1"># Empty slots have high capacity (1e6)</span>
        <span class="c1"># Get initial capacity of lightpath - request</span>
        <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_capacity_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">over_capacity_mask</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lightpath_capacity_before_action</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># Total mask will be 0 if space still available, -1 if capacity is zero or -2 if over capacity</span>
    <span class="n">total_mask</span> <span class="o">=</span> <span class="n">capacity_mask</span> <span class="o">+</span> <span class="n">over_capacity_mask</span>
    <span class="c1"># Update link_slot_array and link_slot_departure_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">total_mask</span><span class="p">,</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
                                                                 <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                                                 <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.implement_node_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_node_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">s_node</span><span class="p">,</span> <span class="n">d_node</span><span class="p">,</span> <span class="n">s_request</span><span class="p">,</span> <span class="n">d_request</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update node capacity, node resource and node departure arrays</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s_node</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>source node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_node</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s_request</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>source node request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_request</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>destination node request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of nodes to implement. Defaults to 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>State</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">implement_node_action</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">s_node</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">d_node</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">s_request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">d_request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update node capacity, node resource and node departure arrays</span>

<span class="sd">    Args:</span>
<span class="sd">        state (State): current state</span>
<span class="sd">        s_node (int): source node</span>
<span class="sd">        d_node (int): destination node</span>
<span class="sd">        s_request (int): source node request</span>
<span class="sd">        d_request (int): destination node request</span>
<span class="sd">        n (int, optional): number of nodes to implement. Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        State: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">curr_selected_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># d_request -ve so that selected node is +ve (so that argmin works correctly for node resource array update)</span>
    <span class="c1"># curr_selected_nodes is N x 1 array, with requested node resources at index of selected node</span>
    <span class="n">curr_selected_nodes</span> <span class="o">=</span> <span class="n">update_node_array</span><span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">curr_selected_nodes</span><span class="p">,</span> <span class="n">d_node</span><span class="p">,</span> <span class="o">-</span><span class="n">d_request</span><span class="p">)</span>
    <span class="n">curr_selected_nodes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">update_node_array</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">curr_selected_nodes</span><span class="p">,</span> <span class="n">s_node</span><span class="p">,</span> <span class="o">-</span><span class="n">s_request</span><span class="p">))</span>

    <span class="n">node_capacity_array</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">-</span> <span class="n">curr_selected_nodes</span>

    <span class="n">node_resource_array</span> <span class="o">=</span> <span class="n">vmap_update_node_resources</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">curr_selected_nodes</span><span class="p">)</span>

    <span class="n">node_departure_array</span> <span class="o">=</span> <span class="n">vmap_update_node_departure</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">curr_selected_nodes</span><span class="p">,</span> <span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">current_time</span><span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_capacity_array</span><span class="o">=</span><span class="n">node_capacity_array</span><span class="p">,</span>
        <span class="n">node_resource_array</span><span class="o">=</span><span class="n">node_resource_array</span><span class="p">,</span>
        <span class="n">node_departure_array</span><span class="o">=</span><span class="n">node_departure_array</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.implement_path_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update link-slot and link-slot departure arrays.
Times are set to negative until turned positive by finalisation (after checks).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to implement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_slot_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>initial slot index</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slots</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of slots to implement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update link-slot and link-slot departure arrays.</span>
<span class="sd">    Times are set to negative until turned positive by finalisation (after checks).</span>

<span class="sd">    Args:</span>
<span class="sd">        state (State): current state</span>
<span class="sd">        path (int): path to implement</span>
<span class="sd">        initial_slot_index (int): initial slot index</span>
<span class="sd">        num_slots (int): number of slots to implement</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">one</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span><span class="o">+</span><span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.implement_vone_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">total_actions</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Implement action to assign nodes (1, 2, or 0 nodes assigned per action) and assign slots and links for lightpath.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>action to implement (node, node, path_slot_action)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_actions</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>total number of actions to implement for current request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining_actions</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>remaining actions to implement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of paths to consider</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>N</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of nodes to assign</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_vone_action</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">total_actions</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
        <span class="n">remaining_actions</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement action to assign nodes (1, 2, or 0 nodes assigned per action) and assign slots and links for lightpath.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>
<span class="sd">        action: action to implement (node, node, path_slot_action)</span>
<span class="sd">        total_actions: total number of actions to implement for current request</span>
<span class="sd">        remaining_actions: remaining actions to implement</span>
<span class="sd">        k: number of paths to consider</span>
<span class="sd">        N: number of nodes to assign</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">((</span><span class="n">remaining_actions</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">node_request_s</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">node_request_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">action</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>

    <span class="c1"># jax.debug.print(&quot;state.request_array {}&quot;, state.request_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;path {}&quot;, path, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;slots {}&quot;, jnp.max(jnp.where(path.reshape(-1,1) == 1, state.link_slot_array, jnp.zeros(params.num_links).reshape(-1,1)), axis=0), ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;path_index {}&quot;, path_index, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;initial_slot_index {}&quot;, initial_slot_index, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;requested_datarate {}&quot;, requested_datarate, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;request {}&quot;, request, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;se {}&quot;, se, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;num_slots {}&quot;, num_slots, ordered=True)</span>

    <span class="n">n_nodes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">total_actions</span> <span class="o">==</span> <span class="n">remaining_actions</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">(</span><span class="n">total_actions</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">))</span>
    <span class="n">path_action_only_check</span> <span class="o">=</span> <span class="n">path_action_only</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">path_action_only_check</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">implement_node_action</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">node_request_s</span><span class="p">,</span> <span class="n">node_request_d</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_action_counter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_action_counter</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize action counter.
First index is num unique nodes, second index is total steps, final is remaining steps until completion of request.
Only used in VONE environments.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_action_counter</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize action counter.</span>
<span class="sd">    First index is num unique nodes, second index is total steps, final is remaining steps until completion of request.</span>
<span class="sd">    Only used in VONE environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_action_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_action_history</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize action history</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_action_history</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize action history&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_edges</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_active_lightpaths_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_active_lightpaths_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise active lightpath array. Stores path indices of all active paths on the network in a 1 x M array.
M is MIN(max_requests, num_links * link_resources / min_slots).
min_slots is the minimum number of slots required for a lightpath i.e. max(values_bw)/ slot_size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Active path array (default value -1, empty path)</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_active_lightpaths_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise active lightpath array. Stores path indices of all active paths on the network in a 1 x M array.</span>
<span class="sd">    M is MIN(max_requests, num_links * link_resources / min_slots).</span>
<span class="sd">    min_slots is the minimum number of slots required for a lightpath i.e. max(values_bw)/ slot_size.</span>

<span class="sd">    Args:</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Active path array (default value -1, empty path)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_slots</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>  <span class="c1"># total slots on networks</span>
    <span class="n">min_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span>  <span class="c1"># minimum number of slots required for lightpath</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">total_slots</span> <span class="o">/</span> <span class="n">min_slots</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_active_lightpaths_array_departure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise active lightpath array. Stores path indices of all active paths on the network in a 1 x M array.
M is MIN(max_requests, num_links * link_resources / min_slots).
min_slots is the minimum number of slots required for a lightpath i.e. max(values_bw)/ slot_size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Active path array (default value -1, empty path)</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise active lightpath array. Stores path indices of all active paths on the network in a 1 x M array.</span>
<span class="sd">    M is MIN(max_requests, num_links * link_resources / min_slots).</span>
<span class="sd">    min_slots is the minimum number of slots required for a lightpath i.e. max(values_bw)/ slot_size.</span>

<span class="sd">    Args:</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Active path array (default value -1, empty path)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_slots</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>  <span class="c1"># total slots on networks</span>
    <span class="n">min_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span>  <span class="c1"># minimum number of slots required for lightpath</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">total_slots</span> <span class="o">/</span> <span class="n">min_slots</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_active_path_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_active_path_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise active path array. Stores details of full path utilised by lightpath on each frequency slot.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Active path array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_active_path_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise active path array. Stores details of full path utilised by lightpath on each frequency slot.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Active path array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_channel_centre_bw_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise channel centre array.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Channel centre array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise channel centre array.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Channel centre array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_channel_power_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise channel power array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Channel power array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise channel power array.</span>

<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Channel power array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_graph_tuple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">adj</span><span class="p">,</span> <span class="n">exclude_source_dest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise graph tuple for use with Jraph GNNs.
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
    adj (jnp.array): Adjacency matrix of the graph
Returns:
    jraph.GraphsTuple: Graph tuple</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">adj</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">exclude_source_dest</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise graph tuple for use with Jraph GNNs.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">        adj (jnp.array): Adjacency matrix of the graph</span>
<span class="sd">    Returns:</span>
<span class="sd">        jraph.GraphsTuple: Graph tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">senders</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">receivers</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Get source and dest from request array</span>
    <span class="n">source_dest</span><span class="p">,</span> <span class="n">datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="c1"># Global feature is normalised data rate of current request</span>
    <span class="nb">globals</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datarate</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">exclude_source_dest</span><span class="p">:</span>
        <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">source_dest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source_dest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># One-hot encode source and destination (2 additional features)</span>
        <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">source_dest_features</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">source</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">source_dest_features</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dest</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">spectral_features</span> <span class="o">=</span> <span class="n">get_spectral_features</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">num_features</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># For dynamic traffic, edge_features are normalised remaining holding time instead of link_slot_array</span>
    <span class="n">holding_time_edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RSAGNModelEnvParams&quot;</span><span class="p">,</span> <span class="s2">&quot;RMSAGNModelEnvParams&quot;</span><span class="p">]:</span>
        <span class="c1"># Normalize by max parameters (converted to linear units)</span>
        <span class="n">max_power</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">from_dbm</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_power</span><span class="p">)</span>
        <span class="n">normalized_power</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span> <span class="o">/</span> <span class="n">max_power</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">max_snr</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">from_db</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_snr</span><span class="p">)</span>
        <span class="n">normalized_snr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span> <span class="o">/</span> <span class="n">max_snr</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">normalized_snr</span><span class="p">,</span> <span class="n">normalized_power</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;VONEEnvParams&quot;</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span> <span class="o">&gt;</span> <span class="mf">1e5</span> <span class="k">else</span> <span class="n">holding_time_edge_features</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;node_capacity_array&quot;</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">))</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">node_features</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">node_features</span><span class="p">,</span> <span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span> <span class="o">&gt;</span> <span class="mf">1e5</span> <span class="k">else</span> <span class="n">holding_time_edge_features</span>
        <span class="c1"># [n_edges] or [n_edges, ...]</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">disable_node_features</span><span class="p">:</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="c1"># Handle undirected graphs (duplicate edges after normalization)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">:</span>
        <span class="n">senders_</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">senders</span><span class="p">,</span> <span class="n">receivers</span><span class="p">])</span>
        <span class="n">receivers</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">receivers</span><span class="p">,</span> <span class="n">senders</span><span class="p">])</span>
        <span class="n">senders</span> <span class="o">=</span> <span class="n">senders_</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">edge_features</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span><span class="p">(</span>
        <span class="n">nodes</span><span class="o">=</span><span class="n">node_features</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="n">edge_features</span><span class="p">,</span>
        <span class="n">senders</span><span class="o">=</span><span class="n">senders</span><span class="p">,</span>
        <span class="n">receivers</span><span class="o">=</span><span class="n">receivers</span><span class="p">,</span>
        <span class="n">n_node</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="n">n_edge</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">senders</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_link_capacity_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_capacity_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise link capacity array. Represents available data rate for lightpath on each link.
Default is high value (1e6) for unoccupied slots. Once lightpath established, capacity is determined by
corresponding entry in path capacity array.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_link_capacity_array</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise link capacity array. Represents available data rate for lightpath on each link.</span>
<span class="sd">    Default is high value (1e6) for unoccupied slots. Once lightpath established, capacity is determined by</span>
<span class="sd">    corresponding entry in path capacity array.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="mf">1e6</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_link_length_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_length_array</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise link length array.
Args:
    graph (nx.Graph): NetworkX graph
Returns:</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_link_length_array</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise link length array.</span>
<span class="sd">    Args:</span>
<span class="sd">        graph (nx.Graph): NetworkX graph</span>
<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
        <span class="n">link_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">link_lengths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_link_length_array_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_length_array_gn_model</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">max_span_length</span><span class="p">,</span> <span class="n">max_spans</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise link length array for environements that use GN model of physical layer.
We assume each link has spans of equal length.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NetworkX graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Link length array (L x max_spans)</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_link_length_array_gn_model</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="n">max_span_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>  <span class="n">max_spans</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise link length array for environements that use GN model of physical layer.</span>
<span class="sd">    We assume each link has spans of equal length.</span>

<span class="sd">    Args:</span>
<span class="sd">        graph (nx.Graph): NetworkX graph</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Link length array (L x max_spans)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">directed</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
        <span class="n">link_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">directed</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">link_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">])</span>
    <span class="n">span_length_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">link_lengths</span><span class="p">:</span>
        <span class="n">num_spans</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="n">max_span_length</span><span class="p">)</span>
        <span class="n">avg_span_length</span> <span class="o">=</span> <span class="n">length</span> <span class="o">/</span> <span class="n">num_spans</span>
        <span class="n">span_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">avg_span_length</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_spans</span>
        <span class="n">span_lengths</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_spans</span> <span class="o">-</span> <span class="n">num_spans</span><span class="p">))</span>
        <span class="n">span_length_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span_lengths</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">span_length_array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_link_slot_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_slot_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize empty (all zeroes) link-slot array. 0 means slot is free, -1 means occupied.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Link slot array (E x S) where E is number of edges and S is number of slots</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_link_slot_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize empty (all zeroes) link-slot array. 0 means slot is free, -1 means occupied.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Link slot array (E x S) where E is number of edges and S is number of slots&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_link_slot_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize link mask</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">agg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize link mask&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">/</span> <span class="n">agg</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_link_snr_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise signal-to-noise ratio (SNR) array.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: SNR array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise signal-to-noise ratio (SNR) array.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The SNR is kept in linear units to allow summation of 1/SNR across links</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="o">-</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_mod_format_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_mod_format_mask</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize link mask</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_mod_format_mask</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize link mask&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_modulation_format_index_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_modulation_format_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise modulation format index array.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Modulation format index array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_modulation_format_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise modulation format index array.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Modulation format index array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>  <span class="c1"># -1 so that highest order is assumed (closest to Gaussian)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_modulations_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_modulations_array</span><span class="p">(</span><span class="n">modulations_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise array of maximum spectral efficiency for modulation format on path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>modulations_filepath</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to CSV file containing modulation formats. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Array of maximum spectral efficiency for modulation format on path.
    First two columns are maximum path length and spectral efficiency.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_modulations_array</span><span class="p">(</span><span class="n">modulations_filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise array of maximum spectral efficiency for modulation format on path.</span>

<span class="sd">    Args:</span>
<span class="sd">        modulations_filepath (str, optional): Path to CSV file containing modulation formats. Defaults to None.</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Array of maximum spectral efficiency for modulation format on path.</span>
<span class="sd">        First two columns are maximum path length and spectral efficiency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">modulations_filepath</span><span class="p">)</span> <span class="k">if</span> <span class="n">modulations_filepath</span> <span class="k">else</span> <span class="p">(</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;modulations&quot;</span> <span class="o">/</span> <span class="s2">&quot;modulations.csv&quot;</span><span class="p">)</span>
    <span class="n">modulations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="c1"># Drop empty first row (headers) and column (name)</span>
    <span class="n">modulations</span> <span class="o">=</span> <span class="n">modulations</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modulations</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_node_capacity_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_node_capacity_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize node array with uniform resources.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Node capacity array (N x 1) where N is number of nodes</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_node_capacity_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize node array with uniform resources.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Node capacity array (N x 1) where N is number of nodes&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">params</span><span class="o">.</span><span class="n">node_resources</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_node_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_node_mask</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize node mask</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_node_mask</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize node mask&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_node_resource_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_node_resource_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Array to track node resources occupied by virtual nodes</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_node_resource_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Array to track node resources occupied by virtual nodes&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">node_resources</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_path_capacity_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_capacity_array</span><span class="p">(</span><span class="n">link_length_array</span><span class="p">,</span> <span class="n">path_link_array</span><span class="p">,</span> <span class="n">min_request</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">,</span> <span class="n">NF</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">10000000000000.0</span><span class="p">,</span> <span class="n">R_s</span><span class="o">=</span><span class="mf">100000000000.0</span><span class="p">,</span> <span class="n">beta_2</span><span class="o">=-</span><span class="mf">2.17e-26</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0012</span><span class="p">,</span> <span class="n">L_s</span><span class="o">=</span><span class="mf">100000.0</span><span class="p">,</span> <span class="n">lambda0</span><span class="o">=</span><span class="mf">1.55e-06</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculated from Nevin paper:
https://api.repository.cam.ac.uk/server/api/core/bitstreams/b80e7a9c-a86b-4b30-a6d6-05017c60b0c8/content</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_length_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of link lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_link_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of links on paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_request</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum data rate request size. Defaults to 100 GBps.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale_factor</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scale factor for link capacity. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fibre attenuation coefficient. Defaults to 0.2e-3 /m</p>
              </div>
            </td>
            <td>
                  <code>0.0002</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>NF</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amplifier noise figure. Defaults to 4.5 dB.</p>
              </div>
            </td>
            <td>
                  <code>4.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>B</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total modulated bandwidth. Defaults to 10e12 Hz.</p>
              </div>
            </td>
            <td>
                  <code>10000000000000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>R_s</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol rate. Defaults to 100e9 Baud.</p>
              </div>
            </td>
            <td>
                  <code>100000000000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta_2</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dispersion parameter. Defaults to -21.7e-27 s^2/m.</p>
              </div>
            </td>
            <td>
                  <code>-2.17e-26</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nonlinear coefficient. Defaults to 1.2e-3 /W/m.</p>
              </div>
            </td>
            <td>
                  <code>0.0012</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>L_s</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Span length. Defaults to 100e3 m.</p>
              </div>
            </td>
            <td>
                  <code>100000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lambda0</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wavelength. Defaults to 1550e-9 m.</p>
              </div>
            </td>
            <td>
                  <code>1.55e-06</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Array of link capacities in Gbps</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_capacity_array</span><span class="p">(</span>
        <span class="n">link_length_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">min_request</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Minimum data rate request size</span>
        <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Scale factor for link capacity</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2e-3</span><span class="p">,</span>  <span class="c1"># Fibre attenuation coefficient</span>
        <span class="n">NF</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>  <span class="c1"># Amplifier noise figure</span>
        <span class="n">B</span><span class="o">=</span><span class="mf">10e12</span><span class="p">,</span>  <span class="c1"># Total modulated bandwidth</span>
        <span class="n">R_s</span><span class="o">=</span><span class="mf">100e9</span><span class="p">,</span>  <span class="c1"># Symbol rate</span>
        <span class="n">beta_2</span><span class="o">=-</span><span class="mf">21.7e-27</span><span class="p">,</span>  <span class="c1"># Dispersion parameter</span>
        <span class="n">gamma</span><span class="o">=</span><span class="mf">1.2e-3</span><span class="p">,</span>  <span class="c1"># Nonlinear coefficient</span>
        <span class="n">L_s</span><span class="o">=</span><span class="mf">100e3</span><span class="p">,</span>  <span class="c1"># span length</span>
        <span class="n">lambda0</span><span class="o">=</span><span class="mf">1550e-9</span><span class="p">,</span>  <span class="c1"># Wavelength</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculated from Nevin paper:</span>
<span class="sd">    https://api.repository.cam.ac.uk/server/api/core/bitstreams/b80e7a9c-a86b-4b30-a6d6-05017c60b0c8/content</span>

<span class="sd">    Args:</span>
<span class="sd">        link_length_array (chex.Array): Array of link lengths</span>
<span class="sd">        path_link_array (chex.Array): Array of links on paths</span>
<span class="sd">        min_request (int, optional): Minimum data rate request size. Defaults to 100 GBps.</span>
<span class="sd">        scale_factor (float, optional): Scale factor for link capacity. Defaults to 1.0.</span>
<span class="sd">        alpha (float, optional): Fibre attenuation coefficient. Defaults to 0.2e-3 /m</span>
<span class="sd">        NF (float, optional): Amplifier noise figure. Defaults to 4.5 dB.</span>
<span class="sd">        B (float, optional): Total modulated bandwidth. Defaults to 10e12 Hz.</span>
<span class="sd">        R_s (float, optional): Symbol rate. Defaults to 100e9 Baud.</span>
<span class="sd">        beta_2 (float, optional): Dispersion parameter. Defaults to -21.7e-27 s^2/m.</span>
<span class="sd">        gamma (float, optional): Nonlinear coefficient. Defaults to 1.2e-3 /W/m.</span>
<span class="sd">        L_s (float, optional): Span length. Defaults to 100e3 m.</span>
<span class="sd">        lambda0 (float, optional): Wavelength. Defaults to 1550e-9 m.</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Array of link capacities in Gbps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_length_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">link_length_array</span><span class="p">)</span>
    <span class="n">path_capacity_array</span> <span class="o">=</span> <span class="n">calculate_path_capacity</span><span class="p">(</span>
        <span class="n">path_length_array</span><span class="p">,</span>
        <span class="n">min_request</span><span class="o">=</span><span class="n">min_request</span><span class="p">,</span>
        <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">NF</span><span class="o">=</span><span class="n">NF</span><span class="p">,</span>
        <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span>
        <span class="n">R_s</span><span class="o">=</span><span class="n">R_s</span><span class="p">,</span>
        <span class="n">beta_2</span><span class="o">=</span><span class="n">beta_2</span><span class="p">,</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
        <span class="n">L_s</span><span class="o">=</span><span class="n">L_s</span><span class="p">,</span>
        <span class="n">lambda0</span><span class="o">=</span><span class="n">lambda0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">path_capacity_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_path_index_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise path index array. Represents index of lightpath occupying each slot.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise path index array. Represents index of lightpath occupying each slot.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_path_length_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_length_array</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise path length array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_link_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path-link array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NetworkX graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    chex.Array: Path length array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_length_array</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise path length array.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_link_array (chex.Array): Path-link array</span>
<span class="sd">        graph (nx.Graph): NetworkX graph</span>
<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Path length array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_length_array</span> <span class="o">=</span> <span class="n">init_link_length_array</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">path_lengths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">link_length_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_lengths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_path_link_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_link_array</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">disjoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">modulations_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rwa_lr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">path_snr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise path-link array.
Each path is defined by a link utilisation array (one row in the path-link array).
1 indicates link corresponding to index is used, 0 indicates not used.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NetworkX graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>disjoint</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use edge-disjoint paths. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weight</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sort paths by edge attribute. Defaults to "weight".</p>
              </div>
            </td>
            <td>
                  <code>&#39;weight&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modulations_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of maximum spectral efficiency for modulation format on path. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rwa_lr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the environment is RWA with lightpath reuse (affects path ordering).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_snr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If GN model is used, include extra row of zeroes for unutilised paths</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Path-link array (N(N-1)*k x E) where N is number of nodes, E is number of edges, k is number of shortest paths</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_link_array</span><span class="p">(</span>
        <span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">disjoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">weight</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span>
        <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">modulations_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rwa_lr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">path_snr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise path-link array.</span>
<span class="sd">    Each path is defined by a link utilisation array (one row in the path-link array).</span>
<span class="sd">    1 indicates link corresponding to index is used, 0 indicates not used.</span>

<span class="sd">    Args:</span>
<span class="sd">        graph (nx.Graph): NetworkX graph</span>
<span class="sd">        k (int): Number of paths</span>
<span class="sd">        disjoint (bool, optional): Whether to use edge-disjoint paths. Defaults to False.</span>
<span class="sd">        weight (str, optional): Sort paths by edge attribute. Defaults to &quot;weight&quot;.</span>
<span class="sd">        directed (bool, optional): Whether graph is directed. Defaults to False.</span>
<span class="sd">        modulations_array (chex.Array, optional): Array of maximum spectral efficiency for modulation format on path. Defaults to None.</span>
<span class="sd">        rwa_lr (bool, optional): Whether the environment is RWA with lightpath reuse (affects path ordering).</span>
<span class="sd">        path_snr (bool, optional): If GN model is used, include extra row of zeroes for unutilised paths</span>
<span class="sd">        to ensure correct SNR calculation for empty paths (path index -1).</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Path-link array (N(N-1)*k x E) where N is number of nodes, E is number of edges, k is number of shortest paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_k_shortest_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">islice</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_simple_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">),</span> <span class="n">k</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_k_disjoint_shortest_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="n">k_paths_disjoint_unsorted</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">edge_disjoint_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
        <span class="n">k_paths_shortest</span> <span class="o">=</span> <span class="n">get_k_shortest_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>

        <span class="c1"># Keep disjoint paths and add unique shortest paths until k paths reached</span>
        <span class="n">disjoint_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">k_paths_disjoint_unsorted</span><span class="p">]</span>
        <span class="n">k_paths</span> <span class="o">=</span> <span class="n">k_paths_disjoint_unsorted</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">k_paths_shortest</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disjoint_ids</span><span class="p">:</span>
                <span class="n">k_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">k_paths</span> <span class="o">=</span> <span class="n">k_paths</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">k_paths</span>

    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

    <span class="c1"># Get the k-shortest paths for each node pair</span>
    <span class="n">k_path_collections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">get_paths</span> <span class="o">=</span> <span class="n">get_k_disjoint_shortest_paths</span> <span class="k">if</span> <span class="n">disjoint</span> <span class="k">else</span> <span class="n">get_k_shortest_paths</span>
    <span class="k">for</span> <span class="n">node_pair</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>

        <span class="n">k_paths</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">node_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">k_path_collections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_paths</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">directed</span><span class="p">:</span>  <span class="c1"># Get paths in reverse direction</span>
        <span class="k">for</span> <span class="n">node_pair</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">k_paths_rev</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">node_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">node_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
            <span class="n">k_path_collections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_paths_rev</span><span class="p">)</span>

    <span class="c1"># Sort the paths for each node pair</span>
    <span class="n">max_missing_paths</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">k_paths</span> <span class="ow">in</span> <span class="n">k_path_collections</span><span class="p">:</span>

        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">k_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">k_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Sort the paths by # of hops then by length, or just length</span>
        <span class="n">path_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">nx</span><span class="o">.</span><span class="n">path_weight</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">k_paths</span><span class="p">]</span>
        <span class="n">path_num_links</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">k_paths</span><span class="p">]</span>

        <span class="c1"># Get maximum spectral efficiency for modulation format on path</span>
        <span class="k">if</span> <span class="n">modulations_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rwa_lr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">se_of_path</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">modulations_array</span> <span class="o">=</span> <span class="n">modulations_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">path_lengths</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">modulation</span> <span class="ow">in</span> <span class="n">modulations_array</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="n">modulation</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">se_of_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modulation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">break</span>
            <span class="c1"># Sorting by the num_links/se instead of just path length is observed to improve performance</span>
            <span class="n">path_weighting</span> <span class="o">=</span> <span class="p">[</span><span class="n">num_links</span><span class="o">/</span><span class="n">se</span> <span class="k">for</span> <span class="n">se</span><span class="p">,</span> <span class="n">num_links</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">se_of_path</span><span class="p">,</span> <span class="n">path_num_links</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">rwa_lr</span><span class="p">:</span>
            <span class="n">path_capacity</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">calculate_path_capacity</span><span class="p">(</span><span class="n">path_length</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">path_length</span> <span class="ow">in</span> <span class="n">path_lengths</span><span class="p">]</span>
            <span class="n">path_weighting</span> <span class="o">=</span> <span class="p">[</span><span class="n">num_links</span><span class="o">/</span><span class="n">path_capacity</span> <span class="k">for</span> <span class="n">num_links</span><span class="p">,</span> <span class="n">path_capacity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path_num_links</span><span class="p">,</span> <span class="n">path_capacity</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path_weighting</span> <span class="o">=</span> <span class="n">path_num_links</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path_weighting</span> <span class="o">=</span> <span class="n">path_lengths</span>

        <span class="c1"># if less then k unique paths, add empty paths</span>
        <span class="n">empty_path</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">num_missing_paths</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_paths</span><span class="p">)</span>
        <span class="n">max_missing_paths</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_missing_paths</span><span class="p">,</span> <span class="n">num_missing_paths</span><span class="p">)</span>
        <span class="n">k_paths</span> <span class="o">=</span> <span class="n">k_paths</span> <span class="o">+</span> <span class="p">[</span><span class="n">empty_path</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_missing_paths</span>
        <span class="n">path_weighting</span> <span class="o">=</span> <span class="n">path_weighting</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1e6</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_missing_paths</span>
        <span class="n">path_lengths</span> <span class="o">=</span> <span class="n">path_lengths</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1e6</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_missing_paths</span>

        <span class="c1"># Sort by number of links then by length (or just by length if weight is specified)</span>
        <span class="n">unsorted_paths</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">path_weighting</span><span class="p">,</span> <span class="n">path_lengths</span><span class="p">)</span>
        <span class="n">k_paths_sorted</span> <span class="o">=</span> <span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">weighting</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">weighting</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unsorted_paths</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>

        <span class="c1"># Keep only first k paths</span>
        <span class="n">k_paths_sorted</span> <span class="o">=</span> <span class="n">k_paths_sorted</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>

        <span class="n">prev_link_usage</span> <span class="o">=</span> <span class="n">empty_path</span>
        <span class="k">for</span> <span class="n">k_path</span> <span class="ow">in</span> <span class="n">k_paths_sorted</span><span class="p">:</span>
            <span class="n">k_path</span> <span class="o">=</span> <span class="n">k_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">link_usage</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>  <span class="c1"># Initialise empty path</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">k_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">link_usage</span> <span class="o">=</span> <span class="n">prev_link_usage</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_path</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">s</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">k_path</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k_path</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
                        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span><span class="p">)</span> <span class="k">if</span> <span class="n">directed</span> <span class="k">else</span> \
                            <span class="p">((</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span> <span class="ow">and</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
                            <span class="n">link_usage</span><span class="p">[</span><span class="n">edge_index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">link_usage</span>
            <span class="n">prev_link_usage</span> <span class="o">=</span> <span class="n">link_usage</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># If using GN model, add extra row of zeroes for empty paths for SNR calculation</span>
    <span class="k">if</span> <span class="n">path_snr</span><span class="p">:</span>
        <span class="n">empty_path</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_path_se_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_se_array</span><span class="p">(</span><span class="n">path_length_array</span><span class="p">,</span> <span class="n">modulations_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise array of maximum spectral efficiency for highest-order modulation format on path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_length_array</code>
            </td>
            <td>
                  <code><span title="jax.numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of path lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modulations_array</code>
            </td>
            <td>
                  <code><span title="jax.numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of maximum spectral efficiency for modulation format on path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: Array of maximum spectral efficiency for on path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_se_array</span><span class="p">(</span><span class="n">path_length_array</span><span class="p">,</span> <span class="n">modulations_array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise array of maximum spectral efficiency for highest-order modulation format on path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_length_array (jnp.array): Array of path lengths</span>
<span class="sd">        modulations_array (jnp.array): Array of maximum spectral efficiency for modulation format on path</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Array of maximum spectral efficiency for on path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">se_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Flip the modulation array so that the shortest path length is first</span>
    <span class="n">modulations_array</span> <span class="o">=</span> <span class="n">modulations_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">path_length_array</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">modulation</span> <span class="ow">in</span> <span class="n">modulations_array</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="n">modulation</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">se_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modulation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">se_list</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_rsa_request_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_rsa_request_array</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize request array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_rsa_request_array</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize request array&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_traffic_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_traffic_matrix</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize traffic matrix. Allows for random traffic matrix or uniform traffic matrix.
Source-dest traffic requests are sampled probabilistically from the resulting traffic matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.PRNGKey">PRNGKey</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PRNG key</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: Traffic matrix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_traffic_matrix</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize traffic matrix. Allows for random traffic matrix or uniform traffic matrix.</span>
<span class="sd">    Source-dest traffic requests are sampled probabilistically from the resulting traffic matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (chex.PRNGKey): PRNG key</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Traffic matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">random_traffic</span><span class="p">:</span>
        <span class="n">traffic_matrix</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">traffic_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="n">diag_elements</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">)</span>
    <span class="c1"># Set main diagonal to zero so no requests from node to itself</span>
    <span class="n">traffic_matrix</span> <span class="o">=</span> <span class="n">traffic_matrix</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">diag_elements</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">traffic_matrix</span> <span class="o">=</span> <span class="n">normalise_traffic_matrix</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">traffic_matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_transceiver_amplifier_noise_arrays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_transceiver_amplifier_noise_arrays</span><span class="p">(</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">ref_lambda</span><span class="p">,</span> <span class="n">slot_size</span><span class="p">,</span> <span class="n">noise_data_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise transceiver and amplifier noise arrays.
Args:
    link_resources (int): Number of link resources
    ref_lambda (float): Reference wavelength
    slot_size (float): Slot size
    noise_data_filepath (str, optional): Path to CSV file containing modulation formats. Defaults to None.
Returns:
    Tuple[chex.Array, chex.Array]: Transceiver noise array, Amplifier noise array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_transceiver_amplifier_noise_arrays</span><span class="p">(</span>
        <span class="n">link_resources</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ref_lambda</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">slot_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">noise_data_filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise transceiver and amplifier noise arrays.</span>
<span class="sd">    Args:</span>
<span class="sd">        link_resources (int): Number of link resources</span>
<span class="sd">        ref_lambda (float): Reference wavelength</span>
<span class="sd">        slot_size (float): Slot size</span>
<span class="sd">        noise_data_filepath (str, optional): Path to CSV file containing modulation formats. Defaults to None.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple[chex.Array, chex.Array]: Transceiver noise array, Amplifier noise array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">noise_data_filepath</span><span class="p">)</span> <span class="k">if</span> <span class="n">noise_data_filepath</span> <span class="k">else</span> <span class="p">(</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;gn_model&quot;</span> <span class="o">/</span> <span class="s2">&quot;transceiver_amplifier_data.csv&quot;</span><span class="p">)</span>
    <span class="n">noise_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="c1"># Drop empty first row (headers) and column (name)</span>
    <span class="n">noise_data</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="c1"># Columns are: wavelength_min_nm,wavelength_max_nm,frequency_min_ghz,frequency_max_ghz,NF_ASE_dB,SNR_TRX_dB</span>
    <span class="n">frequency_min_ghz</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">frequency_max_ghz</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">amplifier_noise_db</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>  <span class="c1"># NF_ASE_dB</span>
    <span class="n">transceiver_snr_db</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># SNR_TRX_dB</span>

    <span class="c1"># Define slot centres in GHz relative to central wavelength</span>
    <span class="n">slot_centres</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">link_resources</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">link_resources</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">slot_size</span>

    <span class="c1"># Transform relative slot centres to absolute frequencies in GHz</span>
    <span class="n">ref_frequency_ghz</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="n">ref_lambda</span> <span class="o">/</span> <span class="mf">1e9</span>
    <span class="n">slot_frequencies_ghz</span> <span class="o">=</span> <span class="n">ref_frequency_ghz</span> <span class="o">+</span> <span class="n">slot_centres</span>

    <span class="c1"># Initialize output arrays</span>
    <span class="n">transceiver_snr_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">link_resources</span><span class="p">)</span>
    <span class="n">amplifier_noise_figure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">link_resources</span><span class="p">)</span>

    <span class="c1"># For each slot, find which band it belongs to</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slot_frequencies_ghz</span><span class="p">):</span>
        <span class="c1"># Find the band this frequency falls into</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequency_min_ghz</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">frequency_min_ghz</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">freq</span> <span class="o">&lt;=</span> <span class="n">frequency_max_ghz</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">transceiver_snr_array</span> <span class="o">=</span> <span class="n">transceiver_snr_array</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">transceiver_snr_db</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">amplifier_noise_figure_array</span> <span class="o">=</span> <span class="n">amplifier_noise_figure_array</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">amplifier_noise_db</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If frequency is outside all bands, could raise error or use default</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> GHz is outside the defined bands&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transceiver_snr_array</span><span class="p">,</span> <span class="n">amplifier_noise_figure_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_virtual_topology_patterns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_virtual_topology_patterns</span><span class="p">(</span><span class="n">pattern_names</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise virtual topology patterns.
First 3 digits comprise the "action counter": first index is num unique nodes, second index is total steps,
final is remaining steps until completion of request.
Remaining digits define the topology pattern, with 1 to indicate links and other positive integers are node indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern_names</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of virtual topology pattern names</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Array of virtual topology patterns</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_virtual_topology_patterns</span><span class="p">(</span><span class="n">pattern_names</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise virtual topology patterns.</span>
<span class="sd">    First 3 digits comprise the &quot;action counter&quot;: first index is num unique nodes, second index is total steps,</span>
<span class="sd">    final is remaining steps until completion of request.</span>
<span class="sd">    Remaining digits define the topology pattern, with 1 to indicate links and other positive integers are node indices.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern_names (list): List of virtual topology pattern names</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Array of virtual topology patterns</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">patterns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># TODO - Allow 2 node requests in VONE (check if any modifications necessary other than below)</span>
    <span class="c1">#if &quot;2_bus&quot; in pattern_names:</span>
    <span class="c1">#    patterns.append([2, 1, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0])</span>
    <span class="k">if</span> <span class="s2">&quot;3_bus&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;3_ring&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;4_bus&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;4_ring&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;5_bus&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;5_ring&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;6_bus&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
    <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">])</span>
    <span class="c1"># Pad patterns with zeroes to match longest</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
        <span class="n">pattern</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">max_length</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.init_vone_request_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_vone_request_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize request array either with uniform resources</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_vone_request_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize request array either with uniform resources&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">max_edges</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.make_graph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_graph</span><span class="p">(</span><span class="n">topology_name</span><span class="o">=</span><span class="s1">&#39;conus&#39;</span><span class="p">,</span> <span class="n">topology_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create graph from topology definition.
Topologies must be defined in JSON format in the topologies directory and
named as the topology name with .json extension.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>topology_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>topology name</p>
              </div>
            </td>
            <td>
                  <code>&#39;conus&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>topology_directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>topology directory</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>graph</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>graph</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_graph</span><span class="p">(</span><span class="n">topology_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;conus&quot;</span><span class="p">,</span> <span class="n">topology_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create graph from topology definition.</span>
<span class="sd">    Topologies must be defined in JSON format in the topologies directory and</span>
<span class="sd">    named as the topology name with .json extension.</span>

<span class="sd">    Args:</span>
<span class="sd">        topology_name: topology name</span>
<span class="sd">        topology_directory: topology directory</span>

<span class="sd">    Returns:</span>
<span class="sd">        graph: graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">topology_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">topology_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">topology_directory</span> <span class="k">else</span> <span class="p">(</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;topologies&quot;</span><span class="p">)</span>
    <span class="c1"># Create topology</span>
    <span class="k">if</span> <span class="n">topology_name</span> <span class="o">==</span> <span class="s2">&quot;4node&quot;</span><span class="p">:</span>
        <span class="c1"># 4 node ring</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_numpy_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]))</span>
        <span class="c1"># Add edge weights to graph</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">topology_name</span> <span class="o">==</span> <span class="s2">&quot;7node&quot;</span><span class="p">:</span>
        <span class="c1"># 7 node ring</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_numpy_array</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]))</span>
        <span class="c1"># Add edge weights to graph</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mi">4</span><span class="p">},</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">topology_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topology_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">node_link_graph</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">graph</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.mask_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_nodes</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns mask of valid actions for node selection. 1 for valid action, 0 for invalid action.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_nodes</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mask_nodes</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns mask of valid actions for node selection. 1 for valid action, 0 for invalid action.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        num_nodes: Number of nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_actions</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">remaining_actions</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">full_request</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">virtual_topology</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">full_request</span><span class="p">,</span> <span class="p">(</span><span class="n">remaining_actions</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">node_request_s</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">node_request_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">prev_action</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="p">(</span><span class="n">remaining_actions</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">prev_dest</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">prev_action</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">node_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">)</span>
    <span class="c1"># Get requested indices from request array virtual topology</span>
    <span class="n">requested_indices</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">virtual_topology</span><span class="p">,</span> <span class="p">(</span><span class="n">remaining_actions</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">requested_index_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">requested_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Get index of previous selected node</span>
    <span class="n">prev_selected_node</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">virtual_topology</span> <span class="o">==</span> <span class="n">requested_index_d</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">virtual_topology</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># will be current index if node only occurs once in virtual topology or will be different index if occurs more than once</span>
    <span class="n">prev_selected_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prev_selected_node</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="n">prev_selected_node_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="n">prev_selected_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># If first action, source and dest both to be assigned -&gt; just mask all nodes based on resources</span>
    <span class="c1"># Thereafter, source must be previous dest. Dest can be any node (except previous allocations).</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_s</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">remaining_actions</span><span class="p">,</span> <span class="n">total_actions</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">&gt;=</span> <span class="n">node_request_s</span><span class="p">,</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">node_indices</span> <span class="o">==</span> <span class="n">prev_dest</span><span class="p">,</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_d</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">&gt;=</span> <span class="n">node_request_d</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># If not first move, set node_mask_d to zero wherever node_mask_s is 1</span>
    <span class="c1"># to avoid same node selection for s and d</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_d</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">remaining_actions</span><span class="p">,</span> <span class="n">total_actions</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">node_mask_s</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span>
                <span class="n">x</span>
            <span class="p">),</span>
            <span class="n">state</span><span class="o">.</span><span class="n">node_mask_d</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mask_previous_selections</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Disallow previously allocated nodes</span>
        <span class="n">update_slice</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">j</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice_in_dim</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span> <span class="n">j</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">update_slice</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># i is node request index</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">update_slice</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># i is slot request index (so add 1 to get next node)</span>
            <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_d</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="n">remaining_actions</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">mask_previous_selections</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">node_mask_d</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># If requested node index is new then disallow previously allocated nodes</span>
    <span class="c1"># If not new, then must match previously allocated node for that index</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_d</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">prev_selected_node_d</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">node_indices</span> <span class="o">==</span> <span class="n">prev_selected_node_d</span><span class="p">,</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">node_mask_d</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.mask_slots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_slots</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns binary mask of valid actions. 1 for valid action, 0 for invalid action.</p>
<ol>
<li>Check request for source and destination nodes</li>
<li>For each path:<ul>
<li>Get current slots on path (with padding on end to avoid out of bounds)</li>
<li>Get mask for required slots on path</li>
<li>Multiply through current slots with required slots mask to check if slots available on path</li>
<li>Remove padding from mask</li>
<li>Return path mask</li>
</ul>
</li>
<li>Update total mask with path mask</li>
<li>If aggregate_slots &gt; 1, aggregate slot mask to reduce action space</li>
</ol>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array in format [source_node, data-rate, destination_node]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mask_slots</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns binary mask of valid actions. 1 for valid action, 0 for invalid action.</span>

<span class="sd">    1. Check request for source and destination nodes</span>
<span class="sd">    2. For each path:</span>
<span class="sd">        - Get current slots on path (with padding on end to avoid out of bounds)</span>
<span class="sd">        - Get mask for required slots on path</span>
<span class="sd">        - Multiply through current slots with required slots mask to check if slots available on path</span>
<span class="sd">        - Remove padding from mask</span>
<span class="sd">        - Return path mask</span>
<span class="sd">    3. Update total mask with path mask</span>
<span class="sd">    4. If aggregate_slots &gt; 1, aggregate slot mask to reduce action space</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        request: Request array in format [source_node, data-rate, destination_node]</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">init_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mask_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="c1"># Get slots for path</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1"># Add padding to slots at end</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">slots</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_slots</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)))</span>
        <span class="c1"># Convert bandwidth to slots for each path</span>
        <span class="n">spectral_efficiency</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">one</span>
        <span class="n">requested_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">spectral_efficiency</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="c1"># Get mask used to check if request will fit slots</span>
        <span class="n">request_mask</span> <span class="o">=</span> <span class="n">get_request_mask</span><span class="p">(</span><span class="n">requested_slots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">check_slots_available</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="c1"># Multiply through by request mask to check if slots available</span>
            <span class="n">request_slice</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_slots</span><span class="p">,))</span>
            <span class="n">slot_sum</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">request_mask</span> <span class="o">*</span> <span class="n">request_slice</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">zero</span>
            <span class="n">slot_sum</span> <span class="o">=</span> <span class="n">slot_sum</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">slot_sum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,))</span>

        <span class="c1"># Mask out slots that are not valid</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># No need to check last requested_slots-1 slots</span>
            <span class="n">check_slots_available</span><span class="p">,</span>
            <span class="n">slots</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Cut off padding</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">path_mask</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="c1"># Update total mask with path mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">path_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="c1"># Loop over each path</span>
    <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">mask_path</span><span class="p">,</span> <span class="n">init_mask</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Full link slot mask is used in process_path_action to get the correct slot from the aggregated slot action</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
        <span class="n">link_slot_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">aggregate_slots</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.mask_slots_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_slots_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For use in RSAGNModelEnv.
1. For each path:
    1.1 Get path slots
    1.2 Get launch power</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvState (xlron.environments.dataclasses.RSAGNModelEnvState)" href="#xlron.environments.dataclasses.RSAGNModelEnvState">RSAGNModelEnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array in format [source_node, data-rate, destination_node]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3306</span>
<span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span>
<span class="normal">3310</span>
<span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span>
<span class="normal">3314</span>
<span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span>
<span class="normal">3318</span>
<span class="normal">3319</span>
<span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span>
<span class="normal">3350</span>
<span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span>
<span class="normal">3354</span>
<span class="normal">3355</span>
<span class="normal">3356</span>
<span class="normal">3357</span>
<span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span>
<span class="normal">3369</span>
<span class="normal">3370</span>
<span class="normal">3371</span>
<span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span>
<span class="normal">3378</span>
<span class="normal">3379</span>
<span class="normal">3380</span>
<span class="normal">3381</span>
<span class="normal">3382</span>
<span class="normal">3383</span>
<span class="normal">3384</span>
<span class="normal">3385</span>
<span class="normal">3386</span>
<span class="normal">3387</span>
<span class="normal">3388</span>
<span class="normal">3389</span>
<span class="normal">3390</span>
<span class="normal">3391</span>
<span class="normal">3392</span>
<span class="normal">3393</span>
<span class="normal">3394</span>
<span class="normal">3395</span>
<span class="normal">3396</span>
<span class="normal">3397</span>
<span class="normal">3398</span>
<span class="normal">3399</span>
<span class="normal">3400</span>
<span class="normal">3401</span>
<span class="normal">3402</span>
<span class="normal">3403</span>
<span class="normal">3404</span>
<span class="normal">3405</span>
<span class="normal">3406</span>
<span class="normal">3407</span>
<span class="normal">3408</span>
<span class="normal">3409</span>
<span class="normal">3410</span>
<span class="normal">3411</span>
<span class="normal">3412</span>
<span class="normal">3413</span>
<span class="normal">3414</span>
<span class="normal">3415</span>
<span class="normal">3416</span>
<span class="normal">3417</span>
<span class="normal">3418</span>
<span class="normal">3419</span>
<span class="normal">3420</span>
<span class="normal">3421</span>
<span class="normal">3422</span>
<span class="normal">3423</span>
<span class="normal">3424</span>
<span class="normal">3425</span>
<span class="normal">3426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mask_slots_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For use in RSAGNModelEnv.</span>
<span class="sd">    1. For each path:</span>
<span class="sd">        1.1 Get path slots</span>
<span class="sd">        1.2 Get launch power</span>


<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        request: Request array in format [source_node, data-rate, destination_node]</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">init_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mask_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># Get slots for path</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1"># Add padding to slots at end</span>
        <span class="c1"># 0 means slot is free, 1 is occupied</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">slots</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_slots</span><span class="p">)))</span>
        <span class="n">launch_power</span> <span class="o">=</span> <span class="n">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">launch_power_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">get_lightpath_index</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="c1"># This function checks through each available modulation format, checks the first and last available slots,</span>
        <span class="c1"># calculates the SNR, checks it meets the requirements, and returns the resulting mask</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">check_modulation_format</span><span class="p">(</span><span class="n">mod_format_index</span><span class="p">,</span> <span class="n">init_path_mask</span><span class="p">):</span>
            <span class="n">se</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">mod_format_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">req_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">bandwidth_per_subchannel</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span>
            <span class="n">req_snr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">mod_format_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">snr_margin</span>
            <span class="c1"># Get mask used to check if request will fit slots</span>
            <span class="n">request_mask</span> <span class="o">=</span> <span class="n">get_request_mask</span><span class="p">(</span><span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">check_slots_available</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
                <span class="c1"># Multiply through by request mask to check if slots available</span>
                <span class="n">slot_sum</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">request_mask</span> <span class="o">*</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_slots</span><span class="p">,)),</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                <span class="n">slot_sum</span> <span class="o">=</span> <span class="n">slot_sum</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">slot_sum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,))</span>

            <span class="c1"># Mask out slots that are not valid</span>
            <span class="n">slot_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># No need to check last requested_slots-1 slots</span>
                <span class="n">check_slots_available</span><span class="p">,</span>
                <span class="n">slots</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Cut off padding</span>
            <span class="n">slot_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">slot_mask</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
            <span class="c1"># Check first and last available slots for suitability</span>
            <span class="n">ff_path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">slot_mask</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">lf_path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">slot_mask</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">first_available_slot_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ff_path_mask</span><span class="p">)</span>
            <span class="n">last_available_slot_index</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lf_path_mask</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c1"># Assign &quot;req_slots&quot; subchannels (each with bandwidth = slot width) for the first and last possible slots</span>
            <span class="n">ff_temp_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">bandwidth_per_subchannel</span><span class="p">),</span>
                <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
                <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">),</span>
                <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">mod_format_index</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">lf_temp_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">bandwidth_per_subchannel</span><span class="p">),</span>
                <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
                <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">),</span>
                <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">mod_format_index</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">ff_temp_state</span> <span class="o">=</span> <span class="n">ff_temp_state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_snr_array</span><span class="o">=</span><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">ff_temp_state</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
            <span class="n">lf_temp_state</span> <span class="o">=</span> <span class="n">lf_temp_state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_snr_array</span><span class="o">=</span><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">lf_temp_state</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
            <span class="c1"># Take the minimum value of SNR from all the subchannels</span>
            <span class="n">ff_snr_value</span> <span class="o">=</span> <span class="n">get_minimum_snr_of_channels_on_path</span><span class="p">(</span>
                <span class="n">ff_temp_state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span>
            <span class="p">)</span>
            <span class="n">lf_snr_value</span> <span class="o">=</span> <span class="n">get_minimum_snr_of_channels_on_path</span><span class="p">(</span>
                <span class="n">lf_temp_state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span>
            <span class="p">)</span>
            <span class="c1"># Check that other paths SNR is still sufficient (True if failure)</span>
            <span class="n">ff_snr_check</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">check_action_rmsa_gn_model</span><span class="p">(</span><span class="n">ff_temp_state</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">lf_snr_check</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">check_action_rmsa_gn_model</span><span class="p">(</span><span class="n">lf_temp_state</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">ff_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">ff_snr_value</span> <span class="o">&gt;=</span> <span class="n">req_snr</span><span class="p">)</span> <span class="o">*</span> <span class="n">ff_snr_check</span>
            <span class="n">lf_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">lf_snr_value</span> <span class="o">&gt;=</span> <span class="n">req_snr</span><span class="p">)</span> <span class="o">*</span> <span class="n">lf_snr_check</span>

            <span class="n">slot_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
            <span class="n">mod_format_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">slot_indices</span> <span class="o">==</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">ff_check</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">mod_format_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">slot_indices</span> <span class="o">==</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">lf_check</span><span class="p">,</span> <span class="n">mod_format_mask</span><span class="p">)</span>
            <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mod_format_mask</span><span class="p">,</span> <span class="n">mod_format_index</span><span class="p">,</span> <span class="n">init_path_mask</span><span class="p">)</span>
            <span class="c1"># jax.debug.print(&quot;ff_snr_check {}&quot;, ff_snr_check, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;lf_snr_check {}&quot;, lf_snr_check, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;ff_snr_value {}&quot;, ff_snr_value, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;lf_snr_value {}&quot;, lf_snr_value, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;first_available_slot_index {}&quot;, first_available_slot_index, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;last_available_slot_index {}&quot;, last_available_slot_index, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;req_snr {}&quot;, req_snr, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;mod_format_mask {}&quot;, mod_format_mask, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;path_mask {}&quot;, path_mask, ordered=True)</span>
            <span class="k">return</span> <span class="n">path_mask</span>

        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">check_modulation_format</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,),</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">))</span>

        <span class="c1"># Update total mask with path mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">path_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="c1"># Loop over each path</span>
    <span class="n">mod_format_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">mask_path</span><span class="p">,</span> <span class="n">init_mask</span><span class="p">)</span>
    <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mod_format_mask</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Full link slot mask is used in process_path_action to get the correct slot from the aggregated slot action</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
        <span class="n">link_slot_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">aggregate_slots</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">,</span>
        <span class="n">mod_format_mask</span><span class="o">=</span><span class="n">mod_format_mask</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.mask_slots_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_slots_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For use in RWALightpathReuseEnv.
Each lightpath has a maximum capacity defined in path_capacity_array. This is updated when a lightpath is assigned.
If remaining path capacity is less than current request, corresponding link-slots are masked out.
If link-slot is in use by another lightpath for a different source and destination node (even if not full) it is masked out.
Step 1:
- Mask out slots that are not valid based on path capacity (check link_capacity_array)
Step 2:
- Mask out slots that are not valid based on lightpath reuse (check path_index_array)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array in format [source_node, data-rate, destination_node]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mask_slots_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For use in RWALightpathReuseEnv.</span>
<span class="sd">    Each lightpath has a maximum capacity defined in path_capacity_array. This is updated when a lightpath is assigned.</span>
<span class="sd">    If remaining path capacity is less than current request, corresponding link-slots are masked out.</span>
<span class="sd">    If link-slot is in use by another lightpath for a different source and destination node (even if not full) it is masked out.</span>
<span class="sd">    Step 1:</span>
<span class="sd">    - Mask out slots that are not valid based on path capacity (check link_capacity_array)</span>
<span class="sd">    Step 2:</span>
<span class="sd">    - Mask out slots that are not valid based on lightpath reuse (check path_index_array)</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        request: Request array in format [source_node, data-rate, destination_node]</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">init_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">))</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>
    <span class="n">path_start_index</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span>
    <span class="c1">#jax.debug.print(&quot;path_start_index {}&quot;, path_start_index, ordered=True)</span>
    <span class="c1">#jax.debug.print(&quot;link_capacity_array {}&quot;, state.link_capacity_array, ordered=True)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mask_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="c1"># Step 1 - mask capacity</span>
        <span class="n">capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;</span> <span class="n">requested_datarate</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="c1">#jax.debug.print(&quot;capacity_mask {}&quot;, capacity_mask, ordered=True)</span>
        <span class="n">capacity_slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">capacity_mask</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1">#jax.debug.print(&quot;capacity_slots {}&quot;, capacity_slots, ordered=True)</span>
        <span class="c1"># Step 2 - mask lightpath reuse</span>
        <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">path_start_index</span> <span class="o">+</span> <span class="n">i</span>
        <span class="c1">#jax.debug.print(&quot;lightpath_index {}&quot;, lightpath_index, ordered=True)</span>
        <span class="n">lightpath_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span> <span class="o">==</span> <span class="n">lightpath_index</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>  <span class="c1"># Allow current lightpath</span>
        <span class="c1">#jax.debug.print(&quot;lightpath_mask {}&quot;, lightpath_mask, ordered=True)</span>
        <span class="n">lightpath_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">lightpath_mask</span><span class="p">)</span>  <span class="c1"># Allow empty slots</span>
        <span class="c1">#jax.debug.print(&quot;lightpath_mask {}&quot;, lightpath_mask, ordered=True)</span>
        <span class="n">lightpath_slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">lightpath_mask</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1">#jax.debug.print(&quot;lightpath_slots {}&quot;, lightpath_slots, ordered=True)</span>
        <span class="c1"># Step 3 combine masks</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">capacity_slots</span><span class="p">,</span> <span class="n">lightpath_slots</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Swap zeros for ones</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="c1">#jax.debug.print(&quot;path_mask {}&quot;, path_mask, ordered=True)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">path_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="c1"># Loop over each path</span>
    <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">mask_path</span><span class="p">,</span> <span class="n">init_mask</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Full link slot mask is used in process_path_action to get the correct slot from the aggregated slot action</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
        <span class="n">link_slot_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">aggregate_slots</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.normalise_traffic_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalise_traffic_matrix</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Normalise traffic matrix to sum to 1</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalise_traffic_matrix</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalise traffic matrix to sum to 1&quot;&quot;&quot;</span>
    <span class="n">traffic_matrix</span> <span class="o">/=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">traffic_matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.pad_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pad_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Pad a ragged multidimensional array to rectangular shape.
Used for training on multiple topologies.
Source: https://codereview.stackexchange.com/questions/222623/pad-a-ragged-multidimensional-array-to-rectangular-shape</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array to pad</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value to fill with</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>result</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>padded array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pad_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pad a ragged multidimensional array to rectangular shape.</span>
<span class="sd">    Used for training on multiple topologies.</span>
<span class="sd">    Source: https://codereview.stackexchange.com/questions/222623/pad-a-ragged-multidimensional-array-to-rectangular-shape</span>

<span class="sd">    Args:</span>
<span class="sd">        array: array to pad</span>
<span class="sd">        fill_value: value to fill with</span>

<span class="sd">    Returns:</span>
<span class="sd">        result: padded array</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dimensions</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">level</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">array</span><span class="p">:</span>
                <span class="k">yield from</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1">#not an iterable</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_max_shape</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
            <span class="n">dimensions</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dimensions</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">length</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">())]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iterate_nested_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">()):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">iterate_nested_array</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1"># final level</span>
            <span class="k">yield</span> <span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">))),</span> <span class="n">array</span>

    <span class="n">dimensions</span> <span class="o">=</span> <span class="n">get_max_shape</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iterate_nested_array</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.path_action_only" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">path_action_only</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">,</span> <span class="n">action_counter</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This is to check if node has already been assigned, therefore just need to assign slots (n=0)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>topology_pattern</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Topology pattern</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_counter</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action counter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining_actions</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Remaining actions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if only path action, False if node action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">path_action_only</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">action_counter</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is to check if node has already been assigned, therefore just need to assign slots (n=0)</span>

<span class="sd">    Args:</span>
<span class="sd">        topology_pattern: Topology pattern</span>
<span class="sd">        action_counter: Action counter</span>
<span class="sd">        remaining_actions: Remaining actions</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if only path action, False if node action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get topology segment to be assigned e.g. [2,1,4]</span>
    <span class="n">topology_segment</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">,</span> <span class="p">((</span><span class="n">remaining_actions</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">topology_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">topology_pattern</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Check if the latest node in the segment is found in &quot;prev_assigned_topology&quot;</span>
    <span class="n">new_node_to_be_assigned</span> <span class="o">=</span> <span class="n">topology_segment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">prev_assigned_topology</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">topology_indices</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">action_counter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">nodes_already_assigned_check</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prev_assigned_topology</span> <span class="o">==</span> <span class="n">new_node_to_be_assigned</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nodes_already_assigned_check</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.poisson" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">poisson</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float_</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sample Exponential random values with given shape and float dtype.</p>
<p>The values are distributed according to the probability density function:</p>
<p>.. math::
 f(x) = \lambda e^{-\lambda x}</p>
<p>on the domain :math:<code>0 \le x &lt; \infty</code>.</p>
<p>Args:
key: a PRNG key used as the random key.
lam: a positive float32 or float64 <code>Tensor</code> indicating the rate parameter
shape: optional, a tuple of nonnegative integers representing the result
  shape. Default ().
dtype: optional, a float dtype for the returned values (default float64 if
  jax_enable_x64 is true, otherwise float32).</p>
<p>Returns:
A random array with the specified shape and dtype.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">poisson</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span><span class="p">],</span>
            <span class="n">lam</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
            <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="n">DTypeLike</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">float_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sample Exponential random values with given shape and float dtype.</span>

<span class="sd">    The values are distributed according to the probability density function:</span>

<span class="sd">    .. math::</span>
<span class="sd">     f(x) = \lambda e^{-\lambda x}</span>

<span class="sd">    on the domain :math:`0 \le x &lt; \infty`.</span>

<span class="sd">    Args:</span>
<span class="sd">    key: a PRNG key used as the random key.</span>
<span class="sd">    lam: a positive float32 or float64 `Tensor` indicating the rate parameter</span>
<span class="sd">    shape: optional, a tuple of nonnegative integers representing the result</span>
<span class="sd">      shape. Default ().</span>
<span class="sd">    dtype: optional, a float dtype for the returned values (default float64 if</span>
<span class="sd">      jax_enable_x64 is true, otherwise float32).</span>

<span class="sd">    Returns:</span>
<span class="sd">    A random array with the specified shape and dtype.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">_check_prng_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dtype argument to `exponential` must be a float &quot;</span>
                       <span class="sa">f</span><span class="s2">&quot;dtype, got </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">canonicalize_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">canonicalize_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_poisson</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.process_path_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path_action</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Process path action to get path index and initial slot index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="Params">Params</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_action</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path action</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>(<span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path index</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>(<span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>initial slot index</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">path_action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process path action to get path index and initial slot index.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (State): current state</span>
<span class="sd">        params (Params): environment parameters</span>
<span class="sd">        path_action (int): path action</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: path index</span>
<span class="sd">        int: initial slot index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_slot_actions</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">)</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">path_action</span> <span class="o">/</span> <span class="n">num_slot_actions</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">initial_aggregated_slot_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">path_action</span><span class="p">,</span> <span class="n">num_slot_actions</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">initial_aggregated_slot_index</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Get the path mask do a dynamic slice and get the index of first unoccupied slot in the slice</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">full_link_slot_mask</span><span class="p">,</span> <span class="n">path_index</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="n">path_mask_slice</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">path_mask</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">,))</span>
        <span class="c1"># Use argmax to get index of first 1 in slice of mask</span>
        <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">initial_slot_index</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">path_mask_slice</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">initial_slot_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.read_rsa_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read RSA request from request array. Return source-destination nodes and bandwidth request.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>request_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>request array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[chex.Array, chex.Array]: source-destination nodes and bandwidth request</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_rsa_request</span><span class="p">(</span><span class="n">request_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read RSA request from request array. Return source-destination nodes and bandwidth request.</span>

<span class="sd">    Args:</span>
<span class="sd">        request_array: request array</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[chex.Array, chex.Array]: source-destination nodes and bandwidth request</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_s</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request_array</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request_array</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">node_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request_array</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">nodes_sd</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">node_s</span><span class="p">,</span> <span class="n">node_d</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.remove_expired_node_requests" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_node_requests</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check for values in node_departure_array that are less than the current time but greater than zero
(negative time indicates the request is not yet finalised).
If found, set to infinity in node_departure_array, set to zero in node_resource_array, and increase
node_capacity_array by expired resources on each node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_node_requests</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for values in node_departure_array that are less than the current time but greater than zero</span>
<span class="sd">    (negative time indicates the request is not yet finalised).</span>
<span class="sd">    If found, set to infinity in node_departure_array, set to zero in node_resource_array, and increase</span>
<span class="sd">    node_capacity_array by expired resources on each node.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">current_time</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">expired_resources</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_capacity_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">+</span> <span class="n">expired_resources</span><span class="p">,</span>
        <span class="n">node_resource_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">),</span>
        <span class="n">node_departure_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.remove_expired_services_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_services_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_services_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set one where link_slot_departure_array is &gt;= zero and &lt;= current time</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">arrival_time</span>
    <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
        <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span><span class="p">:</span>
        <span class="n">mask_subtract</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_subtract</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                                                      <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">),</span>
                                                      <span class="n">updated_link_slot_departure_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">updated_link_slot_departure_array</span><span class="p">,</span>
        <span class="n">link_snr_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">),</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">),</span>
        <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">),</span>
        <span class="n">path_index_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array_prev</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array_prev</span><span class="p">),</span>
        <span class="n">channel_power_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array_prev</span><span class="p">),</span>
        <span class="n">modulation_format_index_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array_prev</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.remove_expired_services_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_services_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check for values in link_slot_departure_array that are less than the current time but greater than zero
(negative time indicates the request is not yet finalised).
If found, set to zero in link_slot_array and link_slot_departure_array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_services_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for values in link_slot_departure_array that are less than the current time but greater than zero</span>
<span class="sd">    (negative time indicates the request is not yet finalised).</span>
<span class="sd">    If found, set to zero in link_slot_array and link_slot_departure_array.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set one where link_slot_departure_array is &gt;= zero and &lt;= current time</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">arrival_time</span>
    <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
        <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="n">updated_link_slot_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span><span class="p">:</span>
        <span class="n">mask_subtract</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_subtract</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                                                     <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">),</span>
                                                     <span class="n">updated_link_slot_departure_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">updated_link_slot_array</span><span class="p">,</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">updated_link_slot_departure_array</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.remove_expired_services_rsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_services_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_services_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set one where link_slot_departure_array is &gt;= zero and &lt;= current time</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">arrival_time</span>
    <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
        <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span><span class="p">:</span>
        <span class="n">mask_subtract</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_subtract</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                                                      <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">),</span>
                                                      <span class="n">updated_link_slot_departure_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">updated_link_slot_departure_array</span><span class="p">,</span>
        <span class="n">link_snr_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">),</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">),</span>
        <span class="n">path_index_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array_prev</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array_prev</span><span class="p">),</span>
        <span class="n">channel_power_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array_prev</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span><span class="p">:</span>
        <span class="c1"># The active_lightpaths_array is set to -1 when the lightpath is not active</span>
        <span class="c1"># The active_lightpaths_array_departure is set to 0 when the lightpath is not active</span>
        <span class="c1"># (active_lightpaths_array is used to calculate the total throughput)</span>
        <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
            <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">active_lightpaths_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">),</span>
            <span class="n">active_lightpaths_array_departure</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.remove_expired_services_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_services_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_services_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set one where link_slot_departure_array is &gt;= zero and &lt;= current time</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">arrival_time</span>
    <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
        <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span><span class="p">:</span>
        <span class="n">mask_subtract</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_subtract</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                                                     <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">),</span>
                                                     <span class="n">updated_link_slot_departure_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">updated_link_slot_departure_array</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.required_slots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">required_slots</span><span class="p">(</span><span class="n">bitrate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">channel_width</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate required slots for a given bitrate and spectral efficiency.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bit_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bit rate in Gbps</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>se</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral efficiency in bps/Hz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>channel_width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Channel width in GHz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guardband</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Guard band. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required slots</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">required_slots</span><span class="p">(</span><span class="n">bitrate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">se</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">channel_width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">guardband</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate required slots for a given bitrate and spectral efficiency.</span>

<span class="sd">    Args:</span>
<span class="sd">        bit_rate (float): Bit rate in Gbps</span>
<span class="sd">        se (float): Spectral efficiency in bps/Hz</span>
<span class="sd">        channel_width (float): Channel width in GHz</span>
<span class="sd">        guardband (int, optional): Guard band. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Required slots</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If bitrate is zero, then required slots should be zero</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">bitrate</span><span class="o">/</span><span class="p">(</span><span class="n">se</span><span class="o">*</span><span class="n">channel_width</span><span class="p">))</span><span class="o">+</span><span class="n">guardband</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="p">(</span><span class="n">bitrate</span> <span class="o">==</span> <span class="n">zero</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.set_band_gaps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_band_gaps</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Set band gaps in link slot array
Args:
    link_slot_array (chex.Array): Link slot array
    params (RSAGNModelEnvParams): Environment parameters
    val (int): Value to set
Returns:
    chex.Array: Link slot array with band gaps</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_band_gaps</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set band gaps in link slot array</span>
<span class="sd">    Args:</span>
<span class="sd">        link_slot_array (chex.Array): Link slot array</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>
<span class="sd">        val (int): Value to set</span>
<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Link slot array with band gaps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create array that is size of link_slot array with values of column index</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_band_gap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="n">gap_start</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">gap_starts</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gap_end</span> <span class="o">=</span> <span class="n">gap_start</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">gap_widths</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;=</span> <span class="n">gap_start</span><span class="p">,</span> <span class="n">arr</span> <span class="o">&lt;</span> <span class="n">gap_end</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">gap_widths</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">set_band_gap</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="n">link_slot_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">link_slot_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">link_slot_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.undo_action_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Undo action for RMSA GN model
Args:
    state (EnvState): Environment state
    action (chex.Array): Action array
    params (EnvParams): Environment parameters
Returns:
    EnvState: Updated environment state</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Undo action for RMSA GN model</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        action (chex.Array): Action array</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        EnvState: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">undo_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>  <span class="c1"># Undo link_slot_array and link_slot_departure_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">set_band_gaps</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">),</span>  <span class="c1"># Set C+L band gap</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array_prev</span><span class="p">,</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array_prev</span><span class="p">,</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array_prev</span><span class="p">,</span>
        <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array_prev</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.undo_action_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.
Partial resource allocation is indicated by negative time in link slot departure array.
Check for values in link_slot_departure_array that are less than zero.
If found, increase link_slot_array by +1 and link_slot_departure_array by current_time + holding_time of current request.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.</span>
<span class="sd">    Partial resource allocation is indicated by negative time in link slot departure array.</span>
<span class="sd">    Check for values in link_slot_departure_array that are less than zero.</span>
<span class="sd">    If found, increase link_slot_array by +1 and link_slot_departure_array by current_time + holding_time of current request.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If departure array is negative, then undo the action</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="c1"># If link slot array is &lt; -1, then undo the action</span>
    <span class="c1"># (departure might be positive because existing service had holding time after current)</span>
    <span class="c1"># e.g. (time_in_array = t1 - t2) where t2 &lt; t1 and t2 = current_time + holding_time</span>
    <span class="c1"># but link_slot_array = -2 due to double allocation, so undo the action</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">+</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span> <span class="o">+</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.undo_action_rsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_action_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Undo action for RSA GN model
Args:
    state (EnvState): Environment state
    action (chex.Array): Action array
    params (EnvParams): Environment parameters
Returns:
    EnvState: Updated environment state</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_action_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Undo action for RSA GN model</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        action (chex.Array): Action array</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        EnvState: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">undo_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>  <span class="c1"># Undo link_slot_array and link_slot_departure_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">set_band_gaps</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">),</span>  <span class="c1"># Set C+L band gap</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array_prev</span><span class="p">,</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array_prev</span><span class="p">,</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array_prev</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span><span class="p">:</span>
        <span class="c1"># If departure array is negative, then undo the action</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span>  <span class="n">zero</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">active_lightpaths_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">),</span>
            <span class="n">active_lightpaths_array_departure</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">,</span>
                <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.undo_action_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.
Partial resource allocation is indicated by negative time in link slot departure array.
Check for values in link_slot_departure_array that are less than zero.
If found, increase link_slot_array by +1 and link_slot_departure_array by current_time + holding_time of current request.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.</span>
<span class="sd">    Partial resource allocation is indicated by negative time in link slot departure array.</span>
<span class="sd">    Check for values in link_slot_departure_array that are less than zero.</span>
<span class="sd">    If found, increase link_slot_array by +1 and link_slot_departure_array by current_time + holding_time of current request.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If departure array is negative, then undo the action</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="c1"># If link slot array is &lt; -1, then undo the action</span>
    <span class="c1"># (departure might be positive because existing service had holding time after current)</span>
    <span class="c1"># e.g. (time_in_array = t1 - t2) where t2 &lt; t1 and t2 = current_time + holding_time</span>
    <span class="c1"># but link_slot_array = -2 due to double allocation, so undo the action</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">+</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span> <span class="o">+</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.undo_node_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_node_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.
Partial resource allocation is indicated by negative time in node departure array.
Check for values in node_departure_array that are less than zero.
If found, set to infinity in node_departure_array, set to zero in node_resource_array, and increase
node_capacity_array by expired resources on each node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_node_action</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.</span>
<span class="sd">    Partial resource allocation is indicated by negative time in node departure array.</span>
<span class="sd">    Check for values in node_departure_array that are less than zero.</span>
<span class="sd">    If found, set to infinity in node_departure_array, set to zero in node_resource_array, and increase</span>
<span class="sd">    node_capacity_array by expired resources on each node.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - Check that node resource clash doesn&#39;t happen (so time is always negative after implementation)</span>
    <span class="c1">#  and undoing always succeeds with negative time</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">resources</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_capacity_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">+</span> <span class="n">resources</span><span class="p">,</span>
        <span class="n">node_resource_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">),</span>
        <span class="n">node_departure_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.update_action_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_action_history</span><span class="p">(</span><span class="n">action_history</span><span class="p">,</span> <span class="n">action_counter</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update action history by adding action to first available index starting from the end.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>action_history</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_counter</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action counter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action to add to history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated action_history</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_action_history</span><span class="p">(</span><span class="n">action_history</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">action_counter</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update action history by adding action to first available index starting from the end.</span>

<span class="sd">    Args:</span>
<span class="sd">        action_history: Action history</span>
<span class="sd">        action_counter: Action counter</span>
<span class="sd">        action: Action to add to history</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated action_history</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">action_history</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="p">((</span><span class="n">action_counter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.update_active_lightpaths_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_active_lightpaths_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update active lightpaths array with new path index.
Find the first index of the array with value -1 and replace with path index.
Args:
    state (RSAGNModelEnvState): Environment state
    path_index (int): Path index to add to active lightpaths array
Returns:
    jnp.array: Updated active lightpaths array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_active_lightpaths_array</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">path_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update active lightpaths array with new path index.</span>
<span class="sd">    Find the first index of the array with value -1 and replace with path index.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (RSAGNModelEnvState): Environment state</span>
<span class="sd">        path_index (int): Path index to add to active lightpaths array</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Updated active lightpaths array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_empty_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Just look at the first column</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]),</span> <span class="p">(</span><span class="n">first_empty_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.update_active_lightpaths_array_departure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update active lightpaths array with new path index.
Find the first index of the array with value -1 and replace with path index.
Args:
    state (RSAGNModelEnvState): Environment state
    time (float): Departure time
Returns:
    jnp.array: Updated active lightpaths array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update active lightpaths array with new path index.</span>
<span class="sd">    Find the first index of the array with value -1 and replace with path index.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (RSAGNModelEnvState): Environment state</span>
<span class="sd">        time (float): Departure time</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Updated active lightpaths array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_empty_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Just look at the first column</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="p">)),</span> <span class="p">(</span><span class="n">first_empty_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.update_graph_tuple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update graph tuple for use with Jraph GNNs.
Edge and node features are updated from link_slot_array and node_capacity_array respectively.
Global features are updated as request_array.
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
Returns:
    state (EnvState): Environment state with updated graph tuple</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update graph tuple for use with Jraph GNNs.</span>
<span class="sd">    Edge and node features are updated from link_slot_array and node_capacity_array respectively.</span>
<span class="sd">    Global features are updated as request_array.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        state (EnvState): Environment state with updated graph tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get source and dest from request array</span>
    <span class="n">source_dest</span><span class="p">,</span> <span class="n">datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">source_dest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source_dest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Global feature is normalised data rate of current request</span>
    <span class="nb">globals</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datarate</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="c1"># One-hot encode source and destination</span>
    <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">source_dest_features</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">source</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">source_dest_features</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dest</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">spectral_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">holding_time_edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RSAGNModelEnvParams&quot;</span><span class="p">,</span> <span class="s2">&quot;RMSAGNModelEnvParams&quot;</span><span class="p">]:</span>
        <span class="c1"># Normalize by max parameters (converted to linear units)</span>
        <span class="n">max_power</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">from_dbm</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_power</span><span class="p">)</span>
        <span class="n">normalized_power</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span> <span class="o">/</span> <span class="n">max_power</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">max_snr</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">from_db</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_snr</span><span class="p">)</span>
        <span class="n">normalized_snr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span> <span class="o">/</span> <span class="n">max_snr</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">normalized_snr</span><span class="p">,</span> <span class="n">normalized_power</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;VONEEnvParams&quot;</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span> <span class="o">&gt;</span> <span class="mf">1e5</span> <span class="k">else</span> <span class="n">holding_time_edge_features</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;node_capacity_array&quot;</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">))</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">node_features</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">node_features</span><span class="p">,</span> <span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span> <span class="o">&gt;</span> <span class="mf">1e5</span> <span class="k">else</span> <span class="n">holding_time_edge_features</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">disable_node_features</span><span class="p">:</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="n">edge_features</span> <span class="o">=</span> <span class="n">edge_features</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">edge_features</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">node_features</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edge_features</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.update_node_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_node_array</span><span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Used to udated selected_nodes array with new requested resources on each node, for use in</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_node_array</span><span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used to udated selected_nodes array with new requested resources on each node, for use in &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_indices</span> <span class="o">==</span> <span class="n">node</span><span class="p">,</span> <span class="n">array</span><span class="o">-</span><span class="n">request</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.vmap_set_path_links" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Set relevant slots along links in path to val.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path (row from path-link array that indicates links used by path)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_slot</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slots</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to set on link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated link slot array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vmap_set_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set relevant slots along links in path to val.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array: Link slot array</span>
<span class="sd">        path: Path (row from path-link array that indicates links used by path)</span>
<span class="sd">        initial_slot: Initial slot</span>
<span class="sd">        num_slots: Number of slots</span>
<span class="sd">        value: Value to set on link slot array</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated link slot array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">set_path</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.vmap_update_node_departure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vmap_update_node_departure</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Called when implementing node action.
Sets request departure time ("value") in place of first "inf" i.e. unoccupied index on node departure array for selected nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N x R) Node departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selected_nodes</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N x 1) Selected nodes (non-zero value on selected node indices)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to set on node departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated node departure array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vmap_update_node_departure</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Called when implementing node action.</span>
<span class="sd">    Sets request departure time (&quot;value&quot;) in place of first &quot;inf&quot; i.e. unoccupied index on node departure array for selected nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_departure_array: (N x R) Node departure array</span>
<span class="sd">        selected_nodes: (N x 1) Selected nodes (non-zero value on selected node indices)</span>
<span class="sd">        value: Value to set on node departure array</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated node departure array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_inf_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">update_selected_node_departure</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">,</span> <span class="n">first_inf_indices</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.vmap_update_node_resources" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vmap_update_node_resources</span><span class="p">(</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Called when implementing node action.
Sets requested node resources on selected nodes in place of first "zero" i.e.
unoccupied index on node resource array for selected nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_resource_array</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N x R) Node resource array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selected_nodes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N x 1) Requested resources on selected nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated node resource array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vmap_update_node_resources</span><span class="p">(</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Called when implementing node action.</span>
<span class="sd">    Sets requested node resources on selected nodes in place of first &quot;zero&quot; i.e.</span>
<span class="sd">    unoccupied index on node resource array for selected nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_resource_array: (N x R) Node resource array</span>
<span class="sd">        selected_nodes: (N x 1) Requested resources on selected nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated node resource array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_zero_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">update_selected_node_resources</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">,</span> <span class="n">first_zero_indices</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.environments.env_funcs.vmap_update_path_links" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update relevant slots along links in path to current_val - val.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path (row from path-link array that indicates links used by path)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_slot</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slots</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to subtract from link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated link slot array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vmap_update_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update relevant slots along links in path to current_val - val.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array: Link slot array</span>
<span class="sd">        path: Path (row from path-link array that indicates links used by path)</span>
<span class="sd">        initial_slot: Initial slot</span>
<span class="sd">        num_slots: Number of slots</span>
<span class="sd">        value: Value to subtract from link slot array</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated link slot array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">update_path</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<h1 id="models">Models</h1>


<div class="doc doc-object doc-module">



<a id="xlron.models.models"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="xlron.models.models.ActorCriticGNN" class="doc doc-heading">
            <code>ActorCriticGNN</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.linen.Module">Module</span></code></p>


        <p>Combine the GNN actor and critic networks into a single class</p>







              <details class="quote">
                <summary>Source code in <code>xlron/models/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ActorCriticGNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the GNN actor and critic networks into a single class&quot;&quot;&quot;</span>
    <span class="n">activation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>
    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">num_units</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">message_passing_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">edge_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">edge_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">edge_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">edge_output_size_actor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">edge_output_size_critic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">global_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">global_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_output_size_actor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_output_size_critic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">node_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">node_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">node_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">node_output_size_actor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">node_output_size_critic</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">attn_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">attn_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">gnn_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">use_attention</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">normalise_by_link_length</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Normalise the processed edge features by the link length</span>
    <span class="n">gnn_layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">mlp_layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">vmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="c1"># Launch power specific parameters</span>
    <span class="n">min_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">max_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">step_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">discrete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Beta distribution parameters (used only if discrete=False)</span>
    <span class="n">min_concentration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">max_concentration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span>
    <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="c1"># Bools to determine which actions to output</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">output_power</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="n">edge_output_size_actor</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="n">edge_output_size_critic</span> <span class="o">+</span> <span class="n">global_output_size_critic</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_power_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate number of power levels dynamically&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_power_dbm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">power_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate power levels dynamically&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_power_levels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="nd">@nn</span><span class="o">.</span><span class="n">compact</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">ActorGNN</span><span class="p">(</span>
            <span class="n">num_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="p">,</span>
            <span class="n">num_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_units</span><span class="p">,</span>
            <span class="n">message_passing_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message_passing_steps</span><span class="p">,</span>
            <span class="n">mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layers</span><span class="p">,</span>
            <span class="n">mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_latent</span><span class="p">,</span>
            <span class="n">edge_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_embedding_size</span><span class="p">,</span>
            <span class="n">edge_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_layers</span><span class="p">,</span>
            <span class="n">edge_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_latent</span><span class="p">,</span>
            <span class="n">edge_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size_actor</span><span class="p">,</span>
            <span class="n">global_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_embedding_size</span><span class="p">,</span>
            <span class="n">global_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_layers</span><span class="p">,</span>
            <span class="n">global_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_latent</span><span class="p">,</span>
            <span class="n">global_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_output_size_actor</span><span class="p">,</span>
            <span class="n">node_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_embedding_size</span><span class="p">,</span>
            <span class="n">node_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_layers</span><span class="p">,</span>
            <span class="n">node_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_latent</span><span class="p">,</span>
            <span class="n">node_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_output_size_actor</span><span class="p">,</span>
            <span class="n">attn_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_layers</span><span class="p">,</span>
            <span class="n">attn_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_latent</span><span class="p">,</span>
            <span class="n">use_attention</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_attention</span><span class="p">,</span>
            <span class="n">normalise_by_link_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalise_by_link_length</span><span class="p">,</span>
            <span class="n">gnn_layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gnn_layer_norm</span><span class="p">,</span>
            <span class="n">mlp_layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
            <span class="n">temperature</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span>
            <span class="n">min_power_dbm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">,</span>
            <span class="n">max_power_dbm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span><span class="p">,</span>
            <span class="n">step_power_dbm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step_power_dbm</span><span class="p">,</span>
            <span class="n">discrete</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">,</span>
            <span class="n">min_concentration</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span><span class="p">,</span>
            <span class="n">max_concentration</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_concentration</span><span class="p">,</span>
            <span class="n">epsilon</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">critic</span> <span class="o">=</span> <span class="n">CriticGNN</span><span class="p">(</span>
            <span class="n">activation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">,</span>
            <span class="n">num_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="p">,</span>
            <span class="n">num_units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_units</span><span class="p">,</span>
            <span class="n">message_passing_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message_passing_steps</span><span class="p">,</span>
            <span class="n">mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layers</span><span class="p">,</span>
            <span class="n">mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_latent</span><span class="p">,</span>
            <span class="n">edge_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_embedding_size</span><span class="p">,</span>
            <span class="n">edge_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_layers</span><span class="p">,</span>
            <span class="n">edge_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_latent</span><span class="p">,</span>
            <span class="n">edge_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size_critic</span><span class="p">,</span>
            <span class="n">global_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_embedding_size</span><span class="p">,</span>
            <span class="n">global_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_layers</span><span class="p">,</span>
            <span class="n">global_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_latent</span><span class="p">,</span>
            <span class="n">global_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_output_size_critic</span><span class="p">,</span>
            <span class="n">node_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_embedding_size</span><span class="p">,</span>
            <span class="n">node_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_layers</span><span class="p">,</span>
            <span class="n">node_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_latent</span><span class="p">,</span>
            <span class="n">node_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_output_size_critic</span><span class="p">,</span>
            <span class="n">attn_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_layers</span><span class="p">,</span>
            <span class="n">attn_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_latent</span><span class="p">,</span>
            <span class="n">use_attention</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_attention</span><span class="p">,</span>
            <span class="n">normalise_by_link_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">normalise_by_link_length</span><span class="p">,</span>
            <span class="n">gnn_layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gnn_layer_norm</span><span class="p">,</span>
            <span class="n">mlp_layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vmap</span><span class="p">:</span>
            <span class="n">actor</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">critic</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">critic</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">actor_out</span> <span class="o">=</span> <span class="n">actor</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">critic_out</span> <span class="o">=</span> <span class="n">critic</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">actor_out</span><span class="p">,</span> <span class="n">critic_out</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_action_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample an action from the distribution.&quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">probs</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span> <span class="k">if</span> <span class="n">deterministic</span> <span class="k">else</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_action_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample an action and convert to power level&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
                <span class="c1"># Take most probable action</span>
                <span class="n">raw_action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Sample from distribution</span>
                <span class="n">raw_action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">processed_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_levels</span><span class="p">[</span><span class="n">raw_action</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
                <span class="c1"># Use mean of Beta distribution for deterministic action</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
                <span class="n">raw_action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Sample from Beta (clipping to avoid edge values with undefined gradient) and scale to power range</span>
                <span class="n">raw_action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
            <span class="n">processed_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span> <span class="o">+</span> <span class="n">raw_action</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">)</span>
        <span class="n">processed_action</span> <span class="o">=</span> <span class="n">from_dbm</span><span class="p">(</span><span class="n">processed_action</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">processed_action</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">raw_action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">processed_action</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_action_path_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample an action from the distributions.</span>
<span class="sd">        This assumes dist is a tuple of path and power distributions.&quot;&quot;&quot;</span>
        <span class="n">path_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_path</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
        <span class="n">power_action</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_power</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">path_action</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">power_action</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path_action</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">power_action</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample an action from the distributions.</span>
<span class="sd">        This assumes dist is a tuple of path and power distributions OR just the appropriate distribution.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_power</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_path_power</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_path</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_power</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_power</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No action type specified for sampling.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="xlron.models.models.ActorCriticGNN.num_power_levels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_power_levels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate number of power levels dynamically</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="xlron.models.models.ActorCriticGNN.power_levels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">power_levels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate power levels dynamically</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="xlron.models.models.ActorCriticGNN.sample_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_action</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sample an action from the distributions.
This assumes dist is a tuple of path and power distributions OR just the appropriate distribution.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample an action from the distributions.</span>
<span class="sd">    This assumes dist is a tuple of path and power distributions OR just the appropriate distribution.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_power</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_path_power</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_path</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_power</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_power</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No action type specified for sampling.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.models.models.ActorCriticGNN.sample_action_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_action_path</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sample an action from the distribution.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_action_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample an action from the distribution.&quot;&quot;&quot;</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">probs</span><span class="p">())</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span> <span class="k">if</span> <span class="n">deterministic</span> <span class="k">else</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.models.models.ActorCriticGNN.sample_action_path_power" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_action_path_power</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sample an action from the distributions.
This assumes dist is a tuple of path and power distributions.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_action_path_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample an action from the distributions.</span>
<span class="sd">    This assumes dist is a tuple of path and power distributions.&quot;&quot;&quot;</span>
    <span class="n">path_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_path</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
    <span class="n">power_action</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_action_power</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">log_prob</span><span class="o">=</span><span class="n">log_prob</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="n">deterministic</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">path_action</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">power_action</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">path_action</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">power_action</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.models.models.ActorCriticGNN.sample_action_power" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_action_power</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sample an action and convert to power level</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_action_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample an action and convert to power level&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
            <span class="c1"># Take most probable action</span>
            <span class="n">raw_action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Sample from distribution</span>
            <span class="n">raw_action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">processed_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_levels</span><span class="p">[</span><span class="n">raw_action</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
            <span class="c1"># Use mean of Beta distribution for deterministic action</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
            <span class="n">raw_action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Sample from Beta (clipping to avoid edge values with undefined gradient) and scale to power range</span>
            <span class="n">raw_action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="n">processed_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span> <span class="o">+</span> <span class="n">raw_action</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">)</span>
    <span class="n">processed_action</span> <span class="o">=</span> <span class="n">from_dbm</span><span class="p">(</span><span class="n">processed_action</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">processed_action</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">raw_action</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">processed_action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.models.models.ActorCriticMLP" class="doc doc-heading">
            <code>ActorCriticMLP</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.linen.Module">Module</span></code></p>








              <details class="quote">
                <summary>Source code in <code>xlron/models/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ActorCriticMLP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="n">action_dim</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">activation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>
    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">num_units</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="nd">@nn</span><span class="o">.</span><span class="n">compact</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">actor_mean</span> <span class="o">=</span> <span class="n">make_dense_layers</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">)</span>
        <span class="n">stacked_logits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">actor_mean_dim</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action_dim</span><span class="p">,</span>
            <span class="n">kernel_init</span><span class="o">=</span><span class="n">orthogonal</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span>
            <span class="n">bias_init</span><span class="o">=</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span>
            <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,</span>
        <span class="p">)(</span><span class="n">actor_mean</span><span class="p">)</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="n">actor_mean_dim</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">stacked_logits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">logits</span><span class="p">)</span>

        <span class="c1"># If there are multiple action dimensions, concatenate the logits</span>
        <span class="n">action_dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">logits</span><span class="p">)</span>

        <span class="n">critic</span> <span class="o">=</span> <span class="n">make_dense_layers</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">,</span> <span class="n">layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_norm</span><span class="p">)</span>
        <span class="n">critic</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">kernel_init</span><span class="o">=</span><span class="n">orthogonal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span>
            <span class="n">bias_init</span><span class="o">=</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span>
            <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,</span>
        <span class="p">)(</span>
            <span class="n">critic</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">action_dist</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">critic</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span>  <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample an action from the distribution&quot;&quot;&quot;</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">probs</span><span class="p">())</span> <span class="k">if</span> <span class="n">deterministic</span> <span class="k">else</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="xlron.models.models.ActorCriticMLP.sample_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_action</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sample an action from the distribution</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span>  <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample an action from the distribution&quot;&quot;&quot;</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">probs</span><span class="p">())</span> <span class="k">if</span> <span class="n">deterministic</span> <span class="k">else</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">action</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.models.models.ActorGNN" class="doc doc-heading">
            <code>ActorGNN</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.linen.Module">Module</span></code></p>


        <p>Actor network for PPO algorithm. Takes the current state and returns a distrax.Categorical distribution
over actions.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/models/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ActorGNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Actor network for PPO algorithm. Takes the current state and returns a distrax.Categorical distribution</span>
<span class="sd">    over actions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">activation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>
    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">num_units</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">edge_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">edge_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">edge_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">edge_output_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">global_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_output_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">node_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">node_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">node_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">node_output_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">attn_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">attn_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">message_passing_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">use_attention</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">normalise_by_link_length</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Normalise the processed edge features by the link length</span>
    <span class="n">gnn_layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">mlp_layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="c1"># Launch power specific parameters</span>
    <span class="n">min_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">max_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">step_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">discrete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Beta distribution parameters (used only if discrete=False)</span>
    <span class="n">min_concentration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">max_concentration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span>
    <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_power_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate number of power levels dynamically&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_power_dbm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">power_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate power levels dynamically&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_power_levels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="nd">@nn</span><span class="o">.</span><span class="n">compact</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The ActorGNN network takes the current network state in the form of a GraphTuple and returns</span>
<span class="sd">        a distrax.Categorical distribution over actions.</span>
<span class="sd">        The graph is processed by a GraphNet module, and the resulting graph is indexed to construct a matrix of</span>
<span class="sd">        the edge features. The edge features are then normalised by the link length from the environment parameters,</span>
<span class="sd">        and the current request is read from the request array.</span>
<span class="sd">        The request is used to retrieve the edge features from the edge_features array for the corresponding</span>
<span class="sd">        shortest k-paths. The edge features are aggregated for each path according to the &quot;agg_func&quot; e.g. sum,</span>
<span class="sd">        and the action distribution array is updated.</span>
<span class="sd">        Returns a distrax.Categorical distribution, from which actions can be sampled.</span>

<span class="sd">        :param state: EnvState</span>
<span class="sd">        :param params: EnvParams</span>

<span class="sd">        :return: distrax.Categorical distribution over actions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">processed_graph</span> <span class="o">=</span> <span class="n">GraphNet</span><span class="p">(</span>
            <span class="n">message_passing_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message_passing_steps</span><span class="p">,</span>
            <span class="n">mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layers</span><span class="p">,</span>
            <span class="n">mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_latent</span><span class="p">,</span>
            <span class="n">edge_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_embedding_size</span><span class="p">,</span>
            <span class="n">edge_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_layers</span><span class="p">,</span>
            <span class="n">edge_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_latent</span><span class="p">,</span>
            <span class="n">edge_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size</span><span class="p">,</span>
            <span class="n">global_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_embedding_size</span><span class="p">,</span>
            <span class="n">global_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_layers</span><span class="p">,</span>
            <span class="n">global_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_latent</span><span class="p">,</span>
            <span class="n">global_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_output_size</span><span class="p">,</span>
            <span class="n">node_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_embedding_size</span><span class="p">,</span>
            <span class="n">node_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_layers</span><span class="p">,</span>
            <span class="n">node_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_latent</span><span class="p">,</span>
            <span class="n">node_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_output_size</span><span class="p">,</span>
            <span class="n">attn_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_layers</span><span class="p">,</span>
            <span class="n">attn_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_latent</span><span class="p">,</span>
            <span class="n">use_attention</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_attention</span><span class="p">,</span>
            <span class="n">gnn_layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gnn_layer_norm</span><span class="p">,</span>
            <span class="n">mlp_layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
        <span class="p">)(</span><span class="n">state</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>

        <span class="c1"># Index edge features to resemble the link-slot array</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">processed_graph</span><span class="o">.</span><span class="n">edges</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span> <span class="k">else</span> <span class="n">processed_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
        <span class="c1"># Normalise features by normalised link length from state.link_length_array</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalise_by_link_length</span><span class="p">:</span>
            <span class="n">edge_features</span> <span class="o">=</span> <span class="n">edge_features</span> <span class="o">*</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="o">/</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="c1"># Get the current request and initialise array of action distributions per path</span>
        <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_bw</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
        <span class="n">init_action_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>

        <span class="c1"># Define a body func to retrieve path slots and update action array</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">get_path_action_dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">action_array</span><span class="p">):</span>
            <span class="c1"># Get the processed graph edge features corresponding to the i-th path</span>
            <span class="n">path_features</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">edge_features</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>
            <span class="c1"># Update the action array with the path features</span>
            <span class="n">action_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">action_array</span><span class="p">,</span> <span class="n">path_features</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size</span><span class="p">,))</span>
            <span class="k">return</span> <span class="n">action_array</span>

        <span class="n">path_action_logits</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">get_path_action_dist</span><span class="p">,</span> <span class="n">init_action_array</span><span class="p">)</span>
        <span class="n">path_action_logits</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">path_action_logits</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>

        <span class="n">power_action_dist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">mlp_features</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_units</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span>
        <span class="n">output_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_power_levels</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span> <span class="k">else</span> <span class="mi">2</span>
        <span class="n">path_mlp</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span>
            <span class="n">mlp_features</span> <span class="o">+</span> <span class="p">[</span><span class="n">output_size</span><span class="p">],</span>
            <span class="n">dropout_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">,</span>
            <span class="n">deterministic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deterministic</span><span class="p">,</span>
            <span class="n">layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RSAGNModelEnvParams&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_output_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">power_logits</span> <span class="o">=</span> <span class="n">processed_graph</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">init_feature_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">edge_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
                <span class="c1"># Define a body func to retrieve path slots and update action array</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">get_power_action_dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">feature_array</span><span class="p">):</span>
                    <span class="c1"># Get the processed graph edge features corresponding to the i-th path</span>
                    <span class="n">path_features</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">edge_features</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                    <span class="c1"># Update the array with the path features</span>
                    <span class="n">action_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">feature_array</span><span class="p">,</span> <span class="n">path_features</span><span class="p">,(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">action_array</span>
                <span class="n">path_feature_batch</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">get_power_action_dist</span><span class="p">,</span> <span class="n">init_feature_array</span><span class="p">)</span>
                <span class="n">power_logits</span> <span class="o">=</span> <span class="n">path_mlp</span><span class="p">(</span><span class="n">path_feature_batch</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
                <span class="n">power_action_dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">power_logits</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span> <span class="o">+</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">power_logits</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_concentration</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span>
                <span class="p">)</span>
                <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span> <span class="o">+</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">power_logits</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_concentration</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span>
                <span class="p">)</span>
                <span class="n">power_action_dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

        <span class="c1"># Return a distrax.Categorical distribution over actions (which can be masked later)</span>
        <span class="n">path_action_dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">path_action_logits</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">path_action_dist</span><span class="p">,</span> <span class="n">power_action_dist</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="xlron.models.models.ActorGNN.num_power_levels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_power_levels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate number of power levels dynamically</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="xlron.models.models.ActorGNN.power_levels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">power_levels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate power levels dynamically</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="xlron.models.models.ActorGNN.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>The ActorGNN network takes the current network state in the form of a GraphTuple and returns
a distrax.Categorical distribution over actions.
The graph is processed by a GraphNet module, and the resulting graph is indexed to construct a matrix of
the edge features. The edge features are then normalised by the link length from the environment parameters,
and the current request is read from the request array.
The request is used to retrieve the edge features from the edge_features array for the corresponding
shortest k-paths. The edge features are aggregated for each path according to the "agg_func" e.g. sum,
and the action distribution array is updated.
Returns a distrax.Categorical distribution, from which actions can be sampled.</p>
<p>:param state: EnvState
:param params: EnvParams</p>
<p>:return: distrax.Categorical distribution over actions</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@nn</span><span class="o">.</span><span class="n">compact</span>
<span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The ActorGNN network takes the current network state in the form of a GraphTuple and returns</span>
<span class="sd">    a distrax.Categorical distribution over actions.</span>
<span class="sd">    The graph is processed by a GraphNet module, and the resulting graph is indexed to construct a matrix of</span>
<span class="sd">    the edge features. The edge features are then normalised by the link length from the environment parameters,</span>
<span class="sd">    and the current request is read from the request array.</span>
<span class="sd">    The request is used to retrieve the edge features from the edge_features array for the corresponding</span>
<span class="sd">    shortest k-paths. The edge features are aggregated for each path according to the &quot;agg_func&quot; e.g. sum,</span>
<span class="sd">    and the action distribution array is updated.</span>
<span class="sd">    Returns a distrax.Categorical distribution, from which actions can be sampled.</span>

<span class="sd">    :param state: EnvState</span>
<span class="sd">    :param params: EnvParams</span>

<span class="sd">    :return: distrax.Categorical distribution over actions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed_graph</span> <span class="o">=</span> <span class="n">GraphNet</span><span class="p">(</span>
        <span class="n">message_passing_steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">message_passing_steps</span><span class="p">,</span>
        <span class="n">mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layers</span><span class="p">,</span>
        <span class="n">mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_latent</span><span class="p">,</span>
        <span class="n">edge_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_embedding_size</span><span class="p">,</span>
        <span class="n">edge_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_layers</span><span class="p">,</span>
        <span class="n">edge_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_latent</span><span class="p">,</span>
        <span class="n">edge_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size</span><span class="p">,</span>
        <span class="n">global_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_embedding_size</span><span class="p">,</span>
        <span class="n">global_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_layers</span><span class="p">,</span>
        <span class="n">global_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_latent</span><span class="p">,</span>
        <span class="n">global_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">global_output_size</span><span class="p">,</span>
        <span class="n">node_embedding_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_embedding_size</span><span class="p">,</span>
        <span class="n">node_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_layers</span><span class="p">,</span>
        <span class="n">node_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_latent</span><span class="p">,</span>
        <span class="n">node_output_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_output_size</span><span class="p">,</span>
        <span class="n">attn_mlp_layers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_layers</span><span class="p">,</span>
        <span class="n">attn_mlp_latent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_latent</span><span class="p">,</span>
        <span class="n">use_attention</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">use_attention</span><span class="p">,</span>
        <span class="n">gnn_layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gnn_layer_norm</span><span class="p">,</span>
        <span class="n">mlp_layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
    <span class="p">)(</span><span class="n">state</span><span class="o">.</span><span class="n">graph</span><span class="p">)</span>

    <span class="c1"># Index edge features to resemble the link-slot array</span>
    <span class="n">edge_features</span> <span class="o">=</span> <span class="n">processed_graph</span><span class="o">.</span><span class="n">edges</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span> <span class="k">else</span> <span class="n">processed_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">processed_graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Normalise features by normalised link length from state.link_length_array</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalise_by_link_length</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">edge_features</span> <span class="o">*</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="o">/</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="c1"># Get the current request and initialise array of action distributions per path</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_bw</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">init_action_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>

    <span class="c1"># Define a body func to retrieve path slots and update action array</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_path_action_dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">action_array</span><span class="p">):</span>
        <span class="c1"># Get the processed graph edge features corresponding to the i-th path</span>
        <span class="n">path_features</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">edge_features</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>
        <span class="c1"># Update the action array with the path features</span>
        <span class="n">action_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">action_array</span><span class="p">,</span> <span class="n">path_features</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">action_array</span>

    <span class="n">path_action_logits</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">get_path_action_dist</span><span class="p">,</span> <span class="n">init_action_array</span><span class="p">)</span>
    <span class="n">path_action_logits</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">path_action_logits</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>

    <span class="n">power_action_dist</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mlp_features</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_units</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_power_levels</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span> <span class="k">else</span> <span class="mi">2</span>
    <span class="n">path_mlp</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span>
        <span class="n">mlp_features</span> <span class="o">+</span> <span class="p">[</span><span class="n">output_size</span><span class="p">],</span>
        <span class="n">dropout_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">,</span>
        <span class="n">deterministic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deterministic</span><span class="p">,</span>
        <span class="n">layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RSAGNModelEnvParams&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_output_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">power_logits</span> <span class="o">=</span> <span class="n">processed_graph</span><span class="o">.</span><span class="n">globals</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">init_feature_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">edge_features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
            <span class="c1"># Define a body func to retrieve path slots and update action array</span>
            <span class="k">def</span><span class="w"> </span><span class="nf">get_power_action_dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">feature_array</span><span class="p">):</span>
                <span class="c1"># Get the processed graph edge features corresponding to the i-th path</span>
                <span class="n">path_features</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">edge_features</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="c1"># Update the array with the path features</span>
                <span class="n">action_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">feature_array</span><span class="p">,</span> <span class="n">path_features</span><span class="p">,(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">action_array</span>
            <span class="n">path_feature_batch</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">get_power_action_dist</span><span class="p">,</span> <span class="n">init_feature_array</span><span class="p">)</span>
            <span class="n">power_logits</span> <span class="o">=</span> <span class="n">path_mlp</span><span class="p">(</span><span class="n">path_feature_batch</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
            <span class="n">power_action_dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">power_logits</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span> <span class="o">+</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">power_logits</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_concentration</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span>
            <span class="p">)</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span> <span class="o">+</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">power_logits</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">max_concentration</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span>
            <span class="p">)</span>
            <span class="n">power_action_dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="c1"># Return a distrax.Categorical distribution over actions (which can be masked later)</span>
    <span class="n">path_action_dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">path_action_logits</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">path_action_dist</span><span class="p">,</span> <span class="n">power_action_dist</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.models.models.GraphNet" class="doc doc-heading">
            <code>GraphNet</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.linen.Module">Module</span></code></p>


        <p>A complete Graph Network model defined with Jraph.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/models/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GraphNet</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A complete Graph Network model defined with Jraph.&quot;&quot;&quot;</span>

    <span class="n">message_passing_steps</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">edge_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">edge_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">edge_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">edge_output_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">global_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">global_output_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">node_embedding_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">node_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">node_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">node_output_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">attn_mlp_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">attn_mlp_latent</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">skip_connections</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">use_edge_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">gnn_layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">mlp_layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># If true, no dropout (better for RL purposes)</span>
    <span class="n">use_attention</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@nn</span><span class="o">.</span><span class="n">compact</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graphs</span><span class="p">:</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span><span class="p">:</span>
        <span class="c1"># Template code from here: https://github.com/google/flax/blob/main/examples/ogbg_molpcba/models.py</span>
        <span class="c1"># We will first linearly project the original features as &#39;embeddings&#39;.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlp_latent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">global_mlp_dims</span> <span class="o">=</span> <span class="n">edge_mlp_dims</span> <span class="o">=</span> <span class="n">node_mlp_dims</span> <span class="o">=</span> <span class="n">attn_mlp_dims</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_latent</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mlp_layers</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">global_mlp_dims</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_latent</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_mlp_layers</span>
            <span class="n">edge_mlp_dims</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_latent</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_mlp_layers</span>
            <span class="n">node_mlp_dims</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_latent</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_mlp_layers</span>
            <span class="n">attn_mlp_dims</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_latent</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">attn_mlp_layers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_connections</span><span class="p">:</span>
            <span class="c1"># If using skip connections, we need to add the input dimensions to the output dimensions,</span>
            <span class="c1"># so that the output of the MLP is the same size as the input for summing output/input</span>
            <span class="n">edge_mlp_dims</span> <span class="o">=</span> <span class="n">edge_mlp_dims</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_embedding_size</span><span class="p">]</span>
            <span class="n">node_mlp_dims</span> <span class="o">=</span> <span class="n">node_mlp_dims</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_embedding_size</span><span class="p">]</span>
            <span class="n">global_mlp_dims</span> <span class="o">=</span> <span class="n">global_mlp_dims</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">global_embedding_size</span><span class="p">]</span>

        <span class="n">embedder</span> <span class="o">=</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphMapFeatures</span><span class="p">(</span>
            <span class="n">embed_edge_fn</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_embedding_size</span><span class="p">),</span>
            <span class="n">embed_node_fn</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_embedding_size</span><span class="p">),</span>
            <span class="n">embed_global_fn</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_embedding_size</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">graphs</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># Dims are (edges, slots, features e.g. power, source/dest)</span>
            <span class="c1"># Keep the leading dimension fixed and combine the remaining dimensions</span>
            <span class="n">edges</span> <span class="o">=</span> <span class="n">graphs</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">graphs</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">graphs</span> <span class="o">=</span> <span class="n">graphs</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">edges</span><span class="o">=</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">processed_graphs</span> <span class="o">=</span> <span class="n">embedder</span><span class="p">(</span><span class="n">graphs</span><span class="p">)</span>

        <span class="c1"># Now, we will apply a Graph Network once for each message-passing round.</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_passing_steps</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_edge_model</span><span class="p">:</span>
                <span class="n">update_edge_fn</span> <span class="o">=</span> <span class="n">jraph</span><span class="o">.</span><span class="n">concatenated_args</span><span class="p">(</span>
                    <span class="n">MLP</span><span class="p">(</span>
                        <span class="n">edge_mlp_dims</span><span class="p">,</span>
                        <span class="n">dropout_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">,</span>
                        <span class="n">deterministic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deterministic</span><span class="p">,</span>
                        <span class="n">layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">update_edge_fn</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">update_node_fn</span> <span class="o">=</span> <span class="n">jraph</span><span class="o">.</span><span class="n">concatenated_args</span><span class="p">(</span>
                <span class="n">MLP</span><span class="p">(</span>
                    <span class="n">node_mlp_dims</span><span class="p">,</span>
                    <span class="n">dropout_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">,</span>
                    <span class="n">deterministic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deterministic</span><span class="p">,</span>
                    <span class="n">layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_output_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">update_global_fn</span> <span class="o">=</span> <span class="n">jraph</span><span class="o">.</span><span class="n">concatenated_args</span><span class="p">(</span>
                    <span class="n">MLP</span><span class="p">(</span>
                        <span class="n">global_mlp_dims</span><span class="p">,</span>
                        <span class="n">dropout_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">,</span>
                        <span class="n">deterministic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deterministic</span><span class="p">,</span>
                        <span class="n">layer_norm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mlp_layer_norm</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">update_global_fn</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_attention</span><span class="p">:</span>
                <span class="k">def</span><span class="w"> </span><span class="nf">_attention_logit_fn</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">sender_attr</span><span class="p">,</span> <span class="n">receiver_attr</span><span class="p">,</span> <span class="n">global_edge_attributes</span><span class="p">):</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;Calculate attention logits using edges, nodes and global attributes.&quot;&quot;&quot;</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">edges</span><span class="p">,</span> <span class="n">sender_attr</span><span class="p">,</span> <span class="n">receiver_attr</span><span class="p">,</span> <span class="n">global_edge_attributes</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">MLP</span><span class="p">(</span><span class="n">attn_mlp_dims</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dropout_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">,</span>
                               <span class="n">deterministic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deterministic</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>

                <span class="k">def</span><span class="w"> </span><span class="nf">_attention_reduce_fn</span><span class="p">(</span>
                    <span class="n">edges</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">attention</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span>
                <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="c1"># TODO - try more sophisticated attention reduce function (not sure what it would be)</span>
                    <span class="c1">#  (here might help https://uvadlc-notebooks.readthedocs.io/en/latest/tutorial_notebooks/JAX/tutorial7/GNN_overview.html)</span>
                    <span class="k">return</span> <span class="n">attention</span> <span class="o">*</span> <span class="n">edges</span>

                <span class="n">graph_net</span> <span class="o">=</span> <span class="n">GraphNetGAT</span><span class="p">(</span>
                    <span class="n">update_node_fn</span><span class="o">=</span><span class="n">update_node_fn</span><span class="p">,</span>
                    <span class="n">update_edge_fn</span><span class="o">=</span><span class="n">update_edge_fn</span><span class="p">,</span>  <span class="c1"># Update the edges with MLP prior to attention</span>
                    <span class="n">update_global_fn</span><span class="o">=</span><span class="n">update_global_fn</span><span class="p">,</span>
                    <span class="n">attention_logit_fn</span><span class="o">=</span><span class="n">_attention_logit_fn</span><span class="p">,</span>
                    <span class="n">attention_reduce_fn</span><span class="o">=</span><span class="n">_attention_reduce_fn</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graph_net</span> <span class="o">=</span> <span class="n">GraphNetwork</span><span class="p">(</span>
                    <span class="n">update_node_fn</span><span class="o">=</span><span class="n">update_node_fn</span><span class="p">,</span>
                    <span class="n">update_edge_fn</span><span class="o">=</span><span class="n">update_edge_fn</span><span class="p">,</span>
                    <span class="n">update_global_fn</span><span class="o">=</span><span class="n">update_global_fn</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skip_connections</span><span class="p">:</span>
                <span class="n">processed_graphs</span> <span class="o">=</span> <span class="n">add_graphs_tuples</span><span class="p">(</span>
                <span class="n">graph_net</span><span class="p">(</span><span class="n">processed_graphs</span><span class="p">),</span> <span class="n">processed_graphs</span>
            <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">processed_graphs</span> <span class="o">=</span> <span class="n">graph_net</span><span class="p">(</span><span class="n">processed_graphs</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gnn_layer_norm</span><span class="p">:</span>
                <span class="n">processed_graphs</span> <span class="o">=</span> <span class="n">processed_graphs</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
                    <span class="n">nodes</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)(</span><span class="n">processed_graphs</span><span class="o">.</span><span class="n">nodes</span><span class="p">),</span>
                    <span class="n">edges</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)(</span><span class="n">processed_graphs</span><span class="o">.</span><span class="n">edges</span><span class="p">),</span>
                    <span class="nb">globals</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)(</span><span class="n">processed_graphs</span><span class="o">.</span><span class="n">globals</span><span class="p">)</span> <span class="k">if</span> <span class="n">processed_graphs</span><span class="o">.</span><span class="n">globals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">decoder</span> <span class="o">=</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphMapFeatures</span><span class="p">(</span>
            <span class="n">embed_global_fn</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">global_output_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_output_size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">embed_node_fn</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_output_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_output_size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">embed_edge_fn</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edge_output_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,),</span>
        <span class="p">)</span>
        <span class="n">processed_graphs</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">(</span><span class="n">processed_graphs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">processed_graphs</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.models.models.LaunchPowerActorCriticMLP" class="doc doc-heading">
            <code>LaunchPowerActorCriticMLP</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.linen.Module">Module</span></code></p>


        <p>In this implementation, we take an observation of th current request + statistics on each of the K candidate paths.
We make K forward passes, one for each path, and output a distribution over power levels for each path.
In action selection, we then sample from each distribution and use the sampled power levels to mask paths for the
routing heuristic, which then determines the path taken. The selected path index is then used to select which output
action, distribution, and value to use for the loss calculation.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/models/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">LaunchPowerActorCriticMLP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;In this implementation, we take an observation of th current request + statistics on each of the K candidate paths.</span>
<span class="sd">    We make K forward passes, one for each path, and output a distribution over power levels for each path.</span>
<span class="sd">    In action selection, we then sample from each distribution and use the sampled power levels to mask paths for the</span>
<span class="sd">    routing heuristic, which then determines the path taken. The selected path index is then used to select which output</span>
<span class="sd">    action, distribution, and value to use for the loss calculation.&quot;&quot;&quot;</span>
    <span class="n">action_dim</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">activation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>
    <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">num_units</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">min_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">max_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">step_power_dbm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">discrete</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">k_paths</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">num_base_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">num_path_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="c1"># Beta distribution parameters (used only if discrete=False)</span>
    <span class="n">min_concentration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">max_concentration</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">20.0</span>
    <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">num_power_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate number of power levels dynamically&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">step_power_dbm</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">power_levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate power levels dynamically&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_power_levels</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="nd">@nn</span><span class="o">.</span><span class="n">compact</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># Helper function to create MLP layers</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">make_mlp</span><span class="p">(</span><span class="n">prefix</span><span class="p">):</span>
            <span class="n">layers</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_layers</span><span class="p">):</span>
                <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">num_units</span><span class="p">,</span>
                    <span class="n">kernel_init</span><span class="o">=</span><span class="n">orthogonal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>
                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_dense_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span>
                    <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,</span>
                <span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_norm</span><span class="p">:</span>
                    <span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_norm_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,))</span>
            <span class="k">return</span> <span class="n">layers</span>

        <span class="c1"># Initialize actor network layers</span>
        <span class="n">actor_net</span> <span class="o">=</span> <span class="n">make_mlp</span><span class="p">(</span><span class="s2">&quot;actor&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
            <span class="n">actor_out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_power_levels</span><span class="p">,</span>
                <span class="n">kernel_init</span><span class="o">=</span><span class="n">orthogonal</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;actor_output&quot;</span><span class="p">,</span>
                <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span>
                <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha_out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_init</span><span class="o">=</span><span class="n">orthogonal</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)</span>
            <span class="n">beta_out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_init</span><span class="o">=</span><span class="n">orthogonal</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">activate</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">==</span> <span class="s2">&quot;relu&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span> <span class="o">==</span> <span class="s2">&quot;crelu&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="n">crelu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">layers</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">activate</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="n">num_base_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_base_features</span>
        <span class="n">num_path_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_path_features</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">discrete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span>
        <span class="n">min_concentration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_concentration</span>
        <span class="n">max_concentration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_concentration</span>

        <span class="c1"># Create a class to handle the scan</span>
        <span class="k">class</span><span class="w"> </span><span class="nc">PathProcessor</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
            <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">carry</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
                <span class="n">base</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="n">num_base_features</span><span class="p">]</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">num_base_features</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span><span class="n">num_path_features</span><span class="p">,),</span>
                    <span class="p">(</span><span class="n">num_path_features</span><span class="p">,)</span>
                <span class="p">)</span>
                <span class="n">features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">])</span>
                <span class="n">actor_hidden</span> <span class="o">=</span> <span class="n">forward</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">actor_net</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">discrete</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">actor_out</span><span class="p">(</span><span class="n">actor_hidden</span><span class="p">)</span> <span class="o">/</span> <span class="n">temperature</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="n">min_concentration</span> <span class="o">+</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">alpha_out</span><span class="p">(</span><span class="n">actor_hidden</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">max_concentration</span> <span class="o">-</span> <span class="n">min_concentration</span>
                    <span class="p">)</span>
                    <span class="n">beta</span> <span class="o">=</span> <span class="n">min_concentration</span> <span class="o">+</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softplus</span><span class="p">(</span><span class="n">beta_out</span><span class="p">(</span><span class="n">actor_hidden</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span>
                            <span class="n">max_concentration</span> <span class="o">-</span> <span class="n">min_concentration</span>
                    <span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">carry</span><span class="p">,</span> <span class="n">out</span>

        <span class="c1"># Scan over paths</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">dist_params</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
            <span class="n">PathProcessor</span><span class="p">,</span>
            <span class="n">variable_broadcast</span><span class="o">=</span><span class="s2">&quot;params&quot;</span><span class="p">,</span>
            <span class="n">split_rngs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
            <span class="n">length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span>
        <span class="p">)()(</span><span class="kc">None</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">))</span>

        <span class="c1"># Initialize critic network layers</span>
        <span class="n">critic_net</span> <span class="o">=</span> <span class="n">make_mlp</span><span class="p">(</span><span class="s2">&quot;critic&quot;</span><span class="p">)</span>
        <span class="n">critic_out</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_init</span><span class="o">=</span><span class="n">orthogonal</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;critic_output&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">critic_out</span><span class="p">(</span><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">critic_net</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Create appropriate distribution</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">logits</span><span class="o">=</span><span class="n">dist_params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">distrax</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="n">dist_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,)),</span> <span class="n">dist_params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,)))</span>
        <span class="c1"># N.B. that this is a single distribution object, but it is batched over K paths</span>

        <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">dist</span><span class="p">],</span> <span class="n">value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sample an action and convert to power level&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
                <span class="c1"># Take most probable action</span>
                <span class="n">raw_action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Sample from distribution</span>
                <span class="n">raw_action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
            <span class="n">processed_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_levels</span><span class="p">[</span><span class="n">raw_action</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
                <span class="c1"># Use mean of Beta distribution for deterministic action</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
                <span class="n">raw_action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Sample from Beta (clipping to avoid edge values with undefined gradient) and scale to power range</span>
                <span class="n">raw_action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
            <span class="n">processed_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span> <span class="o">+</span> <span class="n">raw_action</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">)</span>
        <span class="n">processed_action</span> <span class="o">=</span> <span class="n">from_dbm</span><span class="p">(</span><span class="n">processed_action</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">processed_action</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">raw_action</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">processed_action</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_action_probs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get probabilities for discrete case or pdf for continuous case&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dist</span><span class="o">.</span><span class="n">probs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dist</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="xlron.models.models.LaunchPowerActorCriticMLP.num_power_levels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">num_power_levels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate number of power levels dynamically</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="xlron.models.models.LaunchPowerActorCriticMLP.power_levels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">power_levels</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate power levels dynamically</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="xlron.models.models.LaunchPowerActorCriticMLP.get_action_probs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_action_probs</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get probabilities for discrete case or pdf for continuous case</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_action_probs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dist</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get probabilities for discrete case or pdf for continuous case&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dist</span><span class="o">.</span><span class="n">probs</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dist</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlron.models.models.LaunchPowerActorCriticMLP.sample_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_action</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Sample an action and convert to power level</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sample_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">log_prob</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample an action and convert to power level&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">discrete</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
            <span class="c1"># Take most probable action</span>
            <span class="n">raw_action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Sample from distribution</span>
            <span class="n">raw_action</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">processed_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_levels</span><span class="p">[</span><span class="n">raw_action</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">deterministic</span><span class="p">:</span>
            <span class="c1"># Use mean of Beta distribution for deterministic action</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">/</span> <span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">alpha</span> <span class="o">+</span> <span class="n">dist</span><span class="o">.</span><span class="n">beta</span><span class="p">)</span>
            <span class="n">raw_action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Sample from Beta (clipping to avoid edge values with undefined gradient) and scale to power range</span>
            <span class="n">raw_action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="n">processed_action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span> <span class="o">+</span> <span class="n">raw_action</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_power_dbm</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_power_dbm</span><span class="p">)</span>
    <span class="n">processed_action</span> <span class="o">=</span> <span class="n">from_dbm</span><span class="p">(</span><span class="n">processed_action</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">log_prob</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">processed_action</span><span class="p">,</span> <span class="n">dist</span><span class="o">.</span><span class="n">log_prob</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">raw_action</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">processed_action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.models.models.MLP" class="doc doc-heading">
            <code>MLP</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="flax.linen.Module">Module</span></code></p>


        <p>A multi-layer perceptron.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/models/models.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MLP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A multi-layer perceptron.&quot;&quot;&quot;</span>

    <span class="n">feature_sizes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">deterministic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">activation</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">tanh</span>
    <span class="n">layer_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@nn</span><span class="o">.</span><span class="n">compact</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">inputs</span>
        <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_sizes</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                         <span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span>
                         <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dropout_rate</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">deterministic</span><span class="p">)(</span>
                <span class="n">x</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_norm</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerNorm</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">COMPUTE_DTYPE</span><span class="p">,</span> <span class="n">param_dtype</span><span class="o">=</span><span class="n">PARAMS_DTYPE</span><span class="p">,)(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlron.models.models.add_graphs_tuples" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_graphs_tuples</span><span class="p">(</span><span class="n">graphs</span><span class="p">,</span> <span class="n">other_graphs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Adds the nodes, edges and global features from other_graphs to graphs.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_graphs_tuples</span><span class="p">(</span>
    <span class="n">graphs</span><span class="p">:</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span><span class="p">,</span> <span class="n">other_graphs</span><span class="p">:</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds the nodes, edges and global features from other_graphs to graphs.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">graphs</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span>
        <span class="n">nodes</span><span class="o">=</span><span class="n">graphs</span><span class="o">.</span><span class="n">nodes</span> <span class="o">+</span> <span class="n">other_graphs</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="n">graphs</span><span class="o">.</span><span class="n">edges</span> <span class="o">+</span> <span class="n">other_graphs</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span>
        <span class="nb">globals</span><span class="o">=</span><span class="n">graphs</span><span class="o">.</span><span class="n">globals</span> <span class="o">+</span> <span class="n">other_graphs</span><span class="o">.</span><span class="n">globals</span> <span class="k">if</span> <span class="n">graphs</span><span class="o">.</span><span class="n">globals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.models.models.crelu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">crelu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Computes the Concatenated ReLU (CReLU) activation function.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/models/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">crelu</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the Concatenated ReLU (CReLU) activation function.&quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<h1 id="heuristics">Heuristics</h1>


<div class="doc doc-object doc-module">



<a id="xlron.heuristics.heuristics"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.DeepRMSAEnvState" class="doc doc-heading">
            <code>DeepRMSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for DeepRMSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_stats</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path stats array containing</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">DeepRMSAEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for DeepRMSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_stats (chex.Array): Path stats array containing</span>
<span class="sd">        1. Required slots on path</span>
<span class="sd">        2. Total available slots on path</span>
<span class="sd">        3. Size of 1st free spectrum block</span>
<span class="sd">        4. Avg. free block size</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_stats</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.EnvParams" class="doc doc-heading">
            <code>EnvParams</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment parameters. Parameters are immutable.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>max_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of requests in an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>incremental_loading</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Incremental increase in traffic load (non-expiring requests)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_first_blocking</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End episode on first blocking event</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>continuous_operation</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, do not reset the environment at the end of an episode</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Two column array defining source-dest node-pair edges of the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slot_size</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral width of frequency slot in GHz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>consider_modulation_format</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, consider modulation format to determine required slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_length_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of link lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aggregate_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots to aggregate into a single action (First-Fit with aggregation)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guardband</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Guard band in slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed_graph</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed (one fibre per link per transmission direction)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvParams</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters. Parameters are immutable.</span>

<span class="sd">    Args:</span>
<span class="sd">        max_requests (chex.Scalar): Maximum number of requests in an episode</span>
<span class="sd">        incremental_loading (chex.Scalar): Incremental increase in traffic load (non-expiring requests)</span>
<span class="sd">        end_first_blocking (chex.Scalar): End episode on first blocking event</span>
<span class="sd">        continuous_operation (chex.Scalar): If True, do not reset the environment at the end of an episode</span>
<span class="sd">        edges (chex.Array): Two column array defining source-dest node-pair edges of the graph</span>
<span class="sd">        slot_size (chex.Scalar): Spectral width of frequency slot in GHz</span>
<span class="sd">        consider_modulation_format (chex.Scalar): If True, consider modulation format to determine required slots</span>
<span class="sd">        link_length_array (chex.Array): Array of link lengths</span>
<span class="sd">        aggregate_slots (chex.Scalar): Number of slots to aggregate into a single action (First-Fit with aggregation)</span>
<span class="sd">        guardband (chex.Scalar): Guard band in slots</span>
<span class="sd">        directed_graph (bool): Whether graph is directed (one fibre per link per transmission direction)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">max_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">incremental_loading</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_first_blocking</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">continuous_operation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">slot_size</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">consider_modulation_format</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_length_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">aggregate_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">guardband</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">directed_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">maximise_throughput</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">reward_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">values_bw</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">truncate_holding_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">traffic_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">pack_path_bits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">relative_arrival_times</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.EnvState" class="doc doc-heading">
            <code>EnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>current_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current time in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Holding time of current request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_timesteps</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total timesteps in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requests</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total requests in environment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="jraph.GraphsTuple">GraphsTuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Graph tuple representing network state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action mask for link slot action (including if slot actions are aggregated)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state. State is mutable and arrays are traced on JIT compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        current_time (chex.Scalar): Current time in environment</span>
<span class="sd">        holding_time (chex.Scalar): Holding time of current request</span>
<span class="sd">        total_timesteps (chex.Scalar): Total timesteps in environment</span>
<span class="sd">        total_requests (chex.Scalar): Total requests in environment</span>
<span class="sd">        graph (jraph.GraphsTuple): Graph tuple representing network state</span>
<span class="sd">        full_link_slot_mask (chex.Array): Action mask for link slot action (including if slot actions are aggregated)</span>
<span class="sd">        accepted_services (chex.Array): Number of accepted services</span>
<span class="sd">        accepted_bitrate (chex.Array): Accepted bitrate</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">current_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">arrival_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_timesteps</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">total_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span>
    <span class="n">graph</span><span class="p">:</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span>
    <span class="n">full_link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">list_of_requests</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.GNModelEnvParams" class="doc doc-heading">
            <code>GNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment state for GN model environments.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GNModelEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for GN model environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ref_lambda</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_spans</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_span_length</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">nonlinear_coeff</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">raman_gain_slope</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">attenuation</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">attenuation_bar</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dispersion_coeff</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">dispersion_slope</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">transceiver_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">amplifier_noise_figure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">coherent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_roadms</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">roadm_loss</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_spans</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">launch_power_type</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">snr_margin</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">step_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">last_fit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">default_launch_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mod_format_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">monitor_active_lightpaths</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Monitor active lightpaths for throughput calculation</span>
    <span class="n">gap_starts</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_widths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">uniform_spans</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.GNModelEnvState" class="doc doc-heading">
            <code>GNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GNModelEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_snr_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Available SNR on each link</span>
    <span class="n">channel_centre_bw_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel centre bandwidth for each active connection</span>
    <span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots (used for lightpath SNR calculation)</span>
    <span class="n">channel_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel power for each active connection</span>
    <span class="n">channel_centre_bw_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel centre bandwidth for each active connection in previous timestep</span>
    <span class="n">path_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots in previous timestep</span>
    <span class="n">channel_power_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Channel power for each active connection in previous timestep</span>
    <span class="n">launch_power_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Launch power array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.LogEnvState" class="doc doc-heading">
            <code>LogEnvState</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dataclass to hold environment state for logging.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>env_state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lengths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cum_returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cumulative returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>episode_lengths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Episode lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>episode_returns</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Episode returns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_services</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted services</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>accepted_bitrate</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accepted bitrate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>done</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Done</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LogEnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for logging.</span>

<span class="sd">    Args:</span>
<span class="sd">        env_state (EnvState): Environment state</span>
<span class="sd">        lengths (chex.Scalar): Lengths</span>
<span class="sd">        returns (chex.Scalar): Returns</span>
<span class="sd">        cum_returns (chex.Scalar): Cumulative returns</span>
<span class="sd">        episode_lengths (chex.Scalar): Episode lengths</span>
<span class="sd">        episode_returns (chex.Scalar): Episode returns</span>
<span class="sd">        accepted_services (chex.Scalar): Accepted services</span>
<span class="sd">        accepted_bitrate (chex.Scalar): Accepted bitrate</span>
<span class="sd">        done (chex.Scalar): Done</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">env_state</span><span class="p">:</span> <span class="n">EnvState</span>
    <span class="n">lengths</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">returns</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">cum_returns</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">accepted_services</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">accepted_bitrate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">total_bitrate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">utilisation</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">done</span><span class="p">:</span> <span class="nb">bool</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.MultiBandRSAEnvParams" class="doc doc-heading">
            <code>MultiBandRSAEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiBandRSAEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_start</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_width</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.MultiBandRSAEnvState" class="doc doc-heading">
            <code>MultiBandRSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MultiBandRSAEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RMSAGNModelEnvParams" class="doc doc-heading">
            <code>RMSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulations_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RMSAGNModelEnvState" class="doc doc-heading">
            <code>RMSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RMSA with GN model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_snr_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link SNR array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RMSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RMSA with GN model.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_snr_array (chex.Array): Link SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">modulation_format_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection</span>
    <span class="n">modulation_format_index_array_prev</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format index for each active connection in previous timestep</span>
    <span class="n">mod_format_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Modulation format mask</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RSAEnvParams" class="doc doc-heading">
            <code>RSAEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for RSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_nodes</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_links</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of links</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of link resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_paths</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mean_service_holding_time</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean service holding time</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Load</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>arrival_rate</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arrival rate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_link_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path link array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>random_traffic</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Random traffic matrix for RSA on each reset (else uniform or custom)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_slots</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_se_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path spectral efficiency array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>deterministic_requests</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use deterministic requests</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>multiple_topologies</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, use multiple topologies</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAEnvParams</span><span class="p">(</span><span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for RSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_nodes (chex.Scalar): Number of nodes</span>
<span class="sd">        num_links (chex.Scalar): Number of links</span>
<span class="sd">        link_resources (chex.Scalar): Number of link resources</span>
<span class="sd">        k_paths (chex.Scalar): Number of paths</span>
<span class="sd">        mean_service_holding_time (chex.Scalar): Mean service holding time</span>
<span class="sd">        load (chex.Scalar): Load</span>
<span class="sd">        arrival_rate (chex.Scalar): Arrival rate</span>
<span class="sd">        path_link_array (chex.Array): Path link array</span>
<span class="sd">        random_traffic (bool): Random traffic matrix for RSA on each reset (else uniform or custom)</span>
<span class="sd">        max_slots (chex.Scalar): Maximum number of slots</span>
<span class="sd">        path_se_array (chex.Array): Path spectral efficiency array</span>
<span class="sd">        deterministic_requests (bool): If True, use deterministic requests</span>
<span class="sd">        multiple_topologies (bool): If True, use multiple topologies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">num_links</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">link_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">k_paths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">mean_service_holding_time</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">load</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">arrival_rate</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">random_traffic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">path_se_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">deterministic_requests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">multiple_topologies</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">log_actions</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">disable_node_features</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RSAEnvState" class="doc doc-heading">
            <code>RSAEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_departure_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_mask</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot mask</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>traffic_matrix</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Traffic matrix</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAEnvState</span><span class="p">(</span><span class="n">EnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array (chex.Array): Link slot array</span>
<span class="sd">        request_array (chex.Array): Request array</span>
<span class="sd">        link_slot_departure_array (chex.Array): Link slot departure array</span>
<span class="sd">        link_slot_mask (chex.Array): Link slot mask</span>
<span class="sd">        traffic_matrix (chex.Array): Traffic matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">request_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">link_slot_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">link_slot_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">traffic_matrix</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RSAGNModelEnvParams" class="doc doc-heading">
            <code>RSAGNModelEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvParams (xlron.environments.dataclasses.GNModelEnvParams)" href="#xlron.environments.dataclasses.GNModelEnvParams">GNModelEnvParams</a></code></p>


        <p>Dataclass to hold environment params for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvParams</span><span class="p">(</span><span class="n">GNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment params for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">min_snr</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fec_threshold</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RSAGNModelEnvState" class="doc doc-heading">
            <code>RSAGNModelEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="GNModelEnvState (xlron.environments.dataclasses.GNModelEnvState)" href="#xlron.environments.dataclasses.GNModelEnvState">GNModelEnvState</a></code></p>


        <p>Dataclass to hold environment state for RSA with GN model.</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAGNModelEnvState</span><span class="p">(</span><span class="n">GNModelEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RSA with GN model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">active_lightpaths_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array. 1 x M array. Each value is a lightpath index. Used to calculate total throughput.</span>
    <span class="n">active_lightpaths_array_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Active lightpath array departure time.</span>
    <span class="n">throughput</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Current network throughput</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RSAMultibandEnvParams" class="doc doc-heading">
            <code>RSAMultibandEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAMultibandEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gap_starts</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">gap_widths</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RSAMultibandEnvState" class="doc doc-heading">
            <code>RSAMultibandEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for MultiBandRSA (RBSA).</p>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RSAMultibandEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for MultiBandRSA (RBSA).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.RWALightpathReuseEnvState" class="doc doc-heading">
            <code>RWALightpathReuseEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for RWA with lightpath reuse.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_index_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains indices of lightpaths in use on slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains remaining capacity of each lightpath</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>link_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Contains remaining capacity of lightpath on each link-slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">RWALightpathReuseEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for RWA with lightpath reuse.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_index_array (chex.Array): Contains indices of lightpaths in use on slots</span>
<span class="sd">        path_capacity_array (chex.Array): Contains remaining capacity of each lightpath</span>
<span class="sd">        link_capacity_array (chex.Array): Contains remaining capacity of lightpath on each link-slot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains indices of lightpaths in use on slots</span>
    <span class="n">path_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains remaining capacity of each lightpath</span>
    <span class="n">link_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Contains remaining capacity of lightpath on each link-slot</span>
    <span class="n">time_since_last_departure</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>  <span class="c1"># Time since last departure</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.VONEEnvParams" class="doc doc-heading">
            <code>VONEEnvParams</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvParams (xlron.environments.dataclasses.RSAEnvParams)" href="#xlron.environments.dataclasses.RSAEnvParams">RSAEnvParams</a></code></p>


        <p>Dataclass to hold environment parameters for VONE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_edges</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of edges</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_node_resources</code>
            </td>
            <td>
                  <code><span title="chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of node resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VONEEnvParams</span><span class="p">(</span><span class="n">RSAEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment parameters for VONE.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_resources (chex.Scalar): Number of node resources</span>
<span class="sd">        max_edges (chex.Scalar): Maximum number of edges</span>
<span class="sd">        min_node_resources (chex.Scalar): Minimum number of node resources</span>
<span class="sd">        max_node_resources (chex.Scalar): Maximum number of node resources</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_edges</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">min_node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">max_node_resources</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">pytree_node</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlron.heuristics.heuristics.VONEEnvState" class="doc doc-heading">
            <code>VONEEnvState</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RSAEnvState (xlron.environments.dataclasses.RSAEnvState)" href="#xlron.environments.dataclasses.RSAEnvState">RSAEnvState</a></code></p>


        <p>Dataclass to hold environment state for VONE.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_capacity_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node capacity array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_resource_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node resource array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_counter</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action counter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_history</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_mask_s</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node mask for source node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>node_mask_d</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node mask for destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>virtual_topology_patterns</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Virtual topology patterns</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values_nodes</code>
            </td>
            <td>
                  <code><span title="chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Values for nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>







              <details class="quote">
                <summary>Source code in <code>xlron/environments/dataclasses.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@struct</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">VONEEnvState</span><span class="p">(</span><span class="n">RSAEnvState</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dataclass to hold environment state for VONE.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_capacity_array (chex.Array): Node capacity array</span>
<span class="sd">        node_resource_array (chex.Array): Node resource array</span>
<span class="sd">        node_departure_array (chex.Array): Node departure array</span>
<span class="sd">        action_counter (chex.Array): Action counter</span>
<span class="sd">        action_history (chex.Array): Action history</span>
<span class="sd">        node_mask_s (chex.Array): Node mask for source node</span>
<span class="sd">        node_mask_d (chex.Array): Node mask for destination node</span>
<span class="sd">        virtual_topology_patterns (chex.Array): Virtual topology patterns</span>
<span class="sd">        values_nodes (chex.Array): Values for nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_resource_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">action_counter</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">action_history</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_mask_s</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">node_mask_d</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">virtual_topology_patterns</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
    <span class="n">values_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.aggregate_slots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregate_slots</span><span class="p">(</span><span class="n">full_mask</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Aggregate slot mask to reduce action space. Only used if the --aggregate_slots flag is set to &gt; 1.
Aggregated action is valid if there is one valid slot action within the aggregated action window.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>full_mask</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>slot mask</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>agg_mask</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>aggregated slot mask</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">aggregate_slots</span><span class="p">(</span><span class="n">full_mask</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Aggregate slot mask to reduce action space. Only used if the --aggregate_slots flag is set to &gt; 1.</span>
<span class="sd">    Aggregated action is valid if there is one valid slot action within the aggregated action window.</span>

<span class="sd">    Args:</span>
<span class="sd">        full_mask: slot mask</span>
<span class="sd">        params: environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        agg_mask: aggregated slot mask</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">num_actions</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">)</span>
    <span class="n">agg_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">num_actions</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mask_val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get maximum value of array slice of length aggregate_slots.&quot;&quot;&quot;</span>
        <span class="n">mask_slice</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
                <span class="n">mask_val</span><span class="p">,</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">,),</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span>  <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">,),</span>
            <span class="p">)</span>
        <span class="n">max_slice</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mask_slice</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_slice</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">update_window_max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update ith index &#39;agg_mask&#39; with max of ith slice of length aggregate_slots from &#39;full_mask&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            i: increments as += aggregate_slots</span>
<span class="sd">            val: tuple of (agg_mask, path_mask, path_index).</span>
<span class="sd">        Returns:</span>
<span class="sd">            new_agg_mask: agg_mask is updated with max of path_mask for window size aggregate_slots</span>
<span class="sd">            mask: mask is unchanged</span>
<span class="sd">            path_index: path_index is unchanged</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">agg_mask</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">full_mask</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">path_index</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">new_agg_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span>
            <span class="n">agg_mask</span><span class="p">,</span>
            <span class="n">get_max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">full_mask</span><span class="p">),</span>
            <span class="p">(</span><span class="n">path_index</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">new_agg_mask</span><span class="p">,</span> <span class="n">full_mask</span><span class="p">,</span> <span class="n">path_index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">apply_to_path_mask</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loop through each path for num_actions steps and get_window_max at each step.</span>

<span class="sd">        Args:</span>
<span class="sd">            i: path index</span>
<span class="sd">            val: tuple of (agg_mask, mask) where mask is original link-slot mask and agg_mask is resulting aggregated mask</span>
<span class="sd">        Returns:</span>
<span class="sd">            new_agg_mask: agg_mask is updated with aggregated path mask</span>
<span class="sd">            mask: mask is unchanged</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="c1"># aggregated mask (to be updated)</span>
            <span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># mask for path i</span>
            <span class="n">i</span>  <span class="c1"># path index</span>
        <span class="p">)</span>
        <span class="n">new_agg_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">num_actions</span><span class="p">,</span>
            <span class="n">update_window_max</span><span class="p">,</span>
            <span class="n">val</span><span class="p">,</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">new_agg_mask</span><span class="p">,</span> <span class="n">full_mask</span>

    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span>
            <span class="n">apply_to_path_mask</span><span class="p">,</span>
            <span class="p">(</span><span class="n">agg_mask</span><span class="p">,</span> <span class="n">full_mask</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.best_fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">best_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Best-Fit Spectrum Allocation. Returns the best fit slot for each path.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">best_fit</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Best-Fit Spectrum Allocation. Returns the best fit slot for each path.&quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">link_slot_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_bw</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>

    <span class="c1"># We need to define a wrapper function in order to vmap with named arguments</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_find_block_sizes</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">starts_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">find_block_sizes</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">arr</span><span class="p">,</span> <span class="n">starts_only</span><span class="p">,</span> <span class="n">reverse</span><span class="p">)</span>

    <span class="n">block_sizes_right</span> <span class="o">=</span> <span class="n">_find_block_sizes</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">starts_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">block_sizes_left</span> <span class="o">=</span> <span class="n">_find_block_sizes</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">starts_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">block_sizes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">((</span><span class="n">block_sizes_left</span> <span class="o">+</span> <span class="n">block_sizes_right</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,))</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">required_slots</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">requested_bw</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>

    <span class="c1"># Quantify how well the request fits within a free spectral block</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_bf_on_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">):</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)(</span><span class="n">blocks</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fits</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fits</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
        <span class="n">path_fit</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path_fit</span>
    <span class="n">fits_block</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">get_bf_on_path</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">paths</span><span class="p">,</span> <span class="n">block_sizes</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>

    <span class="c1"># Quantity much of a gap there is between the assigned slots and the next occupied slots on the left</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_bf_on_path_left</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">):</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)(</span><span class="n">blocks</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fits</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fits</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
        <span class="n">fits_shift</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">fits</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">fits_shift</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">fits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="n">fits_shift</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fits</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">fits_shift</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">path_fit</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path_fit</span>
    <span class="n">fits_left</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">get_bf_on_path_left</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">paths</span><span class="p">,</span> <span class="n">block_sizes_left</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>

    <span class="c1"># Quantity much of a gap there is between the assigned slots and the next occupied slots on the right</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_bf_on_path_right</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">blocks</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">):</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">-</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)(</span><span class="n">blocks</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fits</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fits</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
        <span class="n">fits_shift</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">fits</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">fits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">fits_shift</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">fits_shift</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">fits</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fits</span> <span class="o">=</span> <span class="n">fits</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">fits_shift</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">path_fit</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path_fit</span>
    <span class="n">fits_right</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">get_bf_on_path_right</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">paths</span><span class="p">,</span> <span class="n">block_sizes_right</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>

    <span class="c1"># Sum the contribution to the overall quality of fit, and scale down the left/right contributions</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">fits_block</span><span class="p">,</span> <span class="n">fits_left</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">fits_right</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Mask out occupied lightpaths (in case the quality of fit on some links is good enough to be considered, even if the overall path is invalid)</span>
    <span class="n">fits</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">fits</span><span class="p">)</span>
    <span class="n">best_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">fits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">best_fits</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fits</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_slots</span><span class="p">,</span> <span class="n">best_fits</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.bf_ksp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bf_ksp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the first available slot from the first k-shortest paths
Method: Go through action mask and find the first available slot on all paths</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">bf_ksp</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the first available slot from the first k-shortest paths</span>
<span class="sd">    Method: Go through action mask and find the first available slot on all paths</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">best_slots</span><span class="p">,</span> <span class="n">fitness</span> <span class="o">=</span> <span class="n">best_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Chosen path is the one with the best fit</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">fitness</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">best_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.calculate_path_capacity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_path_capacity</span><span class="p">(</span><span class="n">path_length</span><span class="p">,</span> <span class="n">min_request</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">,</span> <span class="n">NF</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">10000000000000.0</span><span class="p">,</span> <span class="n">R_s</span><span class="o">=</span><span class="mf">100000000000.0</span><span class="p">,</span> <span class="n">beta_2</span><span class="o">=-</span><span class="mf">2.17e-26</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0012</span><span class="p">,</span> <span class="n">L_s</span><span class="o">=</span><span class="mf">100000.0</span><span class="p">,</span> <span class="n">lambda0</span><span class="o">=</span><span class="mf">1.55e-06</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>From Nevin JOCN paper 2022: https://discovery.ucl.ac.uk/id/eprint/10175456/1/RL_JOCN_accepted.pdf</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_path_capacity</span><span class="p">(</span>
        <span class="n">path_length</span><span class="p">,</span>
        <span class="n">min_request</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>  <span class="c1"># Minimum data rate request size</span>
        <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Scale factor for link capacity</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2e-3</span><span class="p">,</span> <span class="c1"># Fibre attenuation coefficient</span>
        <span class="n">NF</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>  <span class="c1"># Amplifier noise figure</span>
        <span class="n">B</span><span class="o">=</span><span class="mf">10e12</span><span class="p">,</span>  <span class="c1"># Total modulated bandwidth</span>
        <span class="n">R_s</span><span class="o">=</span><span class="mf">100e9</span><span class="p">,</span>  <span class="c1"># Symbol rate</span>
        <span class="n">beta_2</span><span class="o">=-</span><span class="mf">21.7e-27</span><span class="p">,</span>  <span class="c1"># Dispersion parameter</span>
        <span class="n">gamma</span><span class="o">=</span><span class="mf">1.2e-3</span><span class="p">,</span>  <span class="c1"># Nonlinear coefficient</span>
        <span class="n">L_s</span><span class="o">=</span><span class="mf">100e3</span><span class="p">,</span>  <span class="c1"># Span length</span>
        <span class="n">lambda0</span><span class="o">=</span><span class="mf">1550e-9</span><span class="p">,</span>  <span class="c1"># Wavelength</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From Nevin JOCN paper 2022: https://discovery.ucl.ac.uk/id/eprint/10175456/1/RL_JOCN_accepted.pdf&quot;&quot;&quot;</span>
    <span class="n">alpha_lin</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mf">4.343</span>  <span class="c1"># Linear attenuation coefficient</span>
    <span class="n">N_spans</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">path_length</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">/</span> <span class="n">L_s</span><span class="p">)</span>  <span class="c1"># Number of fibre spans on path</span>
    <span class="n">L_eff</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha_lin</span> <span class="o">*</span> <span class="n">L_s</span><span class="p">))</span> <span class="o">/</span> <span class="n">alpha_lin</span>  <span class="c1"># Effective length of span in m</span>
    <span class="n">sigma_2_ase</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">alpha_lin</span> <span class="o">*</span> <span class="n">L_s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">NF</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="mf">2.998e8</span> <span class="o">*</span> <span class="n">R_s</span> <span class="o">/</span> <span class="n">lambda0</span>  <span class="c1"># ASE noise power</span>
    <span class="n">span_NSR</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">cbrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_2_ase</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha_lin</span> <span class="o">*</span> <span class="n">gamma</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">L_eff</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span>
                        <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">alpha_lin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">beta_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">R_s</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>  <span class="c1"># Noise-to-signal ratio per span</span>
    <span class="n">path_NSR</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">N_spans</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N_spans</span><span class="p">)</span> <span class="o">*</span> <span class="n">span_NSR</span>  <span class="c1"># Noise-to-signal ratio per path</span>
    <span class="n">path_capacity</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">R_s</span><span class="o">/</span><span class="mf">1e9</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">path_NSR</span><span class="p">)</span>  <span class="c1"># Capacity of path in Gbps</span>
    <span class="c1"># Round link capacity down to nearest increment of minimum request size and apply scale factor</span>
    <span class="n">path_capacity</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">path_capacity</span> <span class="o">*</span> <span class="n">scale_factor</span> <span class="o">/</span> <span class="n">min_request</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_request</span>
    <span class="k">return</span> <span class="n">path_capacity</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.calculate_path_stats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_path_stats</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For use in DeepRMSA agent observation space.
Calculate:
1. Size of 1st suitable free spectrum block
2. Index of 1st suitable free spectrum block
3. Required slots on path
4. Avg. free block size
5. Free slots</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array in format [source_node, data-rate, destination_node]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>stats</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of calculated path statistics</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">calculate_path_stats</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For use in DeepRMSA agent observation space.</span>
<span class="sd">    Calculate:</span>
<span class="sd">    1. Size of 1st suitable free spectrum block</span>
<span class="sd">    2. Index of 1st suitable free spectrum block</span>
<span class="sd">    3. Required slots on path</span>
<span class="sd">    4. Avg. free block size</span>
<span class="sd">    5. Free slots</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        request: Request array in format [source_node, data-rate, destination_node]</span>

<span class="sd">    Returns:</span>
<span class="sd">        stats: Array of calculated path statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">init_val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="c1"># TODO - check if the normalisation is useful</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">body_fun</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">link_resources</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">slot_size</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>
        <span class="n">req_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">))</span>
        <span class="n">req_slots_norm</span> <span class="o">=</span> <span class="n">req_slots</span> <span class="o">*</span> <span class="n">slot_size</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
        <span class="n">free_slots_norm</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">slots</span> <span class="o">==</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">),</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span> <span class="n">link_resources</span>
        <span class="n">block_sizes</span> <span class="o">=</span> <span class="n">find_block_sizes</span><span class="p">(</span><span class="n">slots</span><span class="p">)</span>
        <span class="n">first_block_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">block_sizes</span> <span class="o">&gt;=</span> <span class="n">req_slots</span><span class="p">)</span>
        <span class="n">first_block_index_norm</span> <span class="o">=</span> <span class="n">first_block_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span> <span class="o">/</span> <span class="n">link_resources</span>
        <span class="n">first_block_size_norm</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span>
            <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">,</span> <span class="p">(</span><span class="n">first_block_index</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
        <span class="p">)</span> <span class="o">/</span> <span class="n">req_slots</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">avg_block_size_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">)</span> <span class="o">/</span>
                               <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">find_block_starts</span><span class="p">(</span><span class="n">slots</span><span class="p">),</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span>
                               <span class="n">req_slots</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span>
            <span class="n">val</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
                <span class="n">first_block_size_norm</span><span class="p">,</span>
                <span class="n">first_block_index_norm</span><span class="p">,</span>
                <span class="n">req_slots_norm</span><span class="p">,</span>
                <span class="n">avg_block_size_norm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">),</span>
                <span class="n">free_slots_norm</span>
            <span class="p">]]),</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># N.B. that all values are normalised</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="n">stats</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span>
            <span class="n">body_fun</span><span class="p">,</span>
            <span class="n">init_val</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_action_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if action is valid for RSA GN model
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
    action (chex.Array): Action array
Returns:
    bool: True if action is invalid, False if action is valid</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">],</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if action is valid for RSA GN model</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">        action (chex.Array): Action array</span>
<span class="sd">    Returns:</span>
<span class="sd">        bool: True if action is invalid, False if action is valid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if action is valid</span>
    <span class="c1"># TODO - log failure reasons in info</span>
    <span class="n">snr_sufficient_check</span> <span class="o">=</span> <span class="n">check_snr_sufficient</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">spectrum_reuse_check</span> <span class="o">=</span> <span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="c1"># jax.debug.print(&quot;spectrum_reuse_check {}&quot;, spectrum_reuse_check, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;snr_sufficient_check {}&quot;, snr_sufficient_check, ordered=True)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span>
        <span class="n">spectrum_reuse_check</span><span class="p">,</span>
        <span class="n">snr_sufficient_check</span><span class="p">,</span>
    <span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_action_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if action is valid.
Combines checks for:
- no spectrum reuse</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if action is valid.</span>
<span class="sd">    Combines checks for:</span>
<span class="sd">    - no spectrum reuse</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span>
        <span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
    <span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_action_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Combines checks for:
- no spectrum reuse
- lightpath available and existing</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combines checks for:</span>
<span class="sd">    - no spectrum reuse</span>
<span class="sd">    - lightpath available and existing</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span>
        <span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">check_lightpath_available_and_existing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_all_nodes_assigned" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_all_nodes_assigned</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Count negative values on each node (row) in node departure array, sum them, must equal total requested_nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array (N x R) where N is number of nodes and R is number of resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requested_nodes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total requested nodes (int)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_all_nodes_assigned</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count negative values on each node (row) in node departure array, sum them, must equal total requested_nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_departure_array: Node departure array (N x R) where N is number of nodes and R is number of resources</span>
<span class="sd">        total_requested_nodes: Total requested nodes (int)</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">!=</span> <span class="n">total_requested_nodes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_lightpath_available_and_existing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_lightpath_available_and_existing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if lightpath is available and existing.
Available means that the lightpath does not use slots occupied by a different lightpath.
Existing means that the lightpath has already been established.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>lightpath_available_check</code></td>            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if lightpath is available</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_lightpath_available_and_existing</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
        <span class="n">Tuple</span><span class="p">)[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if lightpath is available and existing.</span>
<span class="sd">    Available means that the lightpath does not use slots occupied by a different lightpath.</span>
<span class="sd">    Existing means that the lightpath has already been established.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        lightpath_available_check: True if lightpath is available</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span>
    <span class="c1"># Get unique lightpath index</span>
    <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">get_lightpath_index</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">path_index</span><span class="p">)</span>
    <span class="c1"># Get mask for slots that lightpath will occupy</span>
    <span class="c1"># negative numbers used so as not to conflict with lightpath indices</span>
    <span class="n">new_lightpath_mask</span> <span class="o">=</span> <span class="n">vmap_set_path_links</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">path</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">path_index_array</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">[:,</span> <span class="n">initial_slot_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">masked_path_index_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">new_lightpath_mask</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">path_index_array</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
    <span class="p">)</span>
    <span class="n">lightpath_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">path_index_array</span> <span class="o">==</span> <span class="n">lightpath_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span>
    <span class="p">)</span>  <span class="c1"># Allow current lightpath</span>
    <span class="n">lightpath_existing_check</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">lightpath_mask</span><span class="p">,</span> <span class="n">new_lightpath_mask</span><span class="p">)</span>  <span class="c1"># True if all slots are same</span>
    <span class="n">lightpath_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masked_path_index_array</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lightpath_mask</span><span class="p">)</span>  <span class="c1"># Allow empty slots</span>
    <span class="c1"># True if all slots are same or empty</span>
    <span class="n">lightpath_available_check</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">lightpath_mask</span><span class="p">,</span> <span class="n">new_lightpath_mask</span><span class="p">),</span> <span class="n">lightpath_existing_check</span>
    <span class="p">)</span>
    <span class="n">curr_lightpath_capacity</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_lightpath_mask</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">[:,</span> <span class="n">initial_slot_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">lightpath_available_check</span><span class="p">,</span> <span class="n">lightpath_existing_check</span><span class="p">,</span> <span class="n">curr_lightpath_capacity</span><span class="p">,</span> <span class="n">lightpath_index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_min_two_nodes_assigned" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_min_two_nodes_assigned</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Count negative values on each node (row) in node departure array, sum them, must be 2 or greater.
This check is important if e.g. an action contains 2 nodes the same therefore only assigns 1 node.
Return False if check passed, True if check failed</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array (N x R) where N is number of nodes and R is number of resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_min_two_nodes_assigned</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count negative values on each node (row) in node departure array, sum them, must be 2 or greater.</span>
<span class="sd">    This check is important if e.g. an action contains 2 nodes the same therefore only assigns 1 node.</span>
<span class="sd">    Return False if check passed, True if check failed</span>

<span class="sd">    Args:</span>
<span class="sd">        node_departure_array: Node departure array (N x R) where N is number of nodes and R is number of resources</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_no_spectrum_reuse" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>slot-=1 when used, should be zero when unoccupied, so check if any &lt; -1 in slot array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array (L x S) where L is number of links and S is number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;slot-=1 when used, should be zero when unoccupied, so check if any &lt; -1 in slot array.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array: Link slot array (L x S) where L is number of links and S is number of slots</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_node_capacities" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_node_capacities</span><span class="p">(</span><span class="n">capacity_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sum selected nodes array and check less than node resources.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>capacity_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node capacity array (N x 1) where N is number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_node_capacities</span><span class="p">(</span><span class="n">capacity_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sum selected nodes array and check less than node resources.</span>

<span class="sd">    Args:</span>
<span class="sd">        capacity_array: Node capacity array (N x 1) where N is number of nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">capacity_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_snr_sufficient" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_snr_sufficient</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if SNR is sufficient for all connections
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
Returns:
    jnp.array: 1 if SNR is sufficient for connection else 0</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_snr_sufficient</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if SNR is sufficient for all connections</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: 1 if SNR is sufficient for connection else 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - this check needs to be faster!</span>
    <span class="n">required_snr_array</span> <span class="o">=</span> <span class="n">get_required_snr_se_kurtosis_array</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Transform lightpath index array by getting lightpath value, getting path-link array, and summing inverse link SNRs</span>
    <span class="n">lightpath_snr_array</span> <span class="o">=</span> <span class="n">get_lightpath_snr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">check_snr_sufficient</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lightpath_snr_array</span> <span class="o">&gt;=</span> <span class="n">required_snr_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># jax.debug.print(&quot;check_snr_sufficient {}&quot;, check_snr_sufficient, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;required_snr_array {}&quot;, required_snr_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;lightpath_snr_array {}&quot;, lightpath_snr_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;state.modulation_format_index_array {}&quot;, state.modulation_format_index_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;state.channel_centre_bw_array {}&quot;, state.channel_centre_bw_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;state.channel_power_array {}&quot;, state.channel_power_array, ordered=True)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">check_snr_sufficient</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_topology" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_topology</span><span class="p">(</span><span class="n">action_history</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check that each unique virtual node (as indicated by topology pattern) is assigned to a consistent physical node
i.e. start and end node of ring is same physical node.
Method:
For each node index in topology pattern, mask action history with that index, then find max value in masked array.
If max value is not the same for all values for that virtual node in action history, then return 1, else 0.
Array should be all zeroes at the end, so do an any() check on that.
e.g. virtual topology pattern = [2,1,3,1,4,1,2]  3 node ring
action history = [0,34,4,0,3,1,0]
meaning v node "2" goes p node 0, v node "3" goes p node 4, v node "4" goes p node 3
The numbers in-between relate to the slot action.
If any value in the array is 1, a virtual node is assigned to multiple different physical nodes.
Need to check from both perspectives:
1. For each virtual node, check that all physical nodes are the same
2. For each physical node, check that all virtual nodes are the same</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>action_history</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>topology_pattern</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Topology pattern</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_topology</span><span class="p">(</span><span class="n">action_history</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that each unique virtual node (as indicated by topology pattern) is assigned to a consistent physical node</span>
<span class="sd">    i.e. start and end node of ring is same physical node.</span>
<span class="sd">    Method:</span>
<span class="sd">    For each node index in topology pattern, mask action history with that index, then find max value in masked array.</span>
<span class="sd">    If max value is not the same for all values for that virtual node in action history, then return 1, else 0.</span>
<span class="sd">    Array should be all zeroes at the end, so do an any() check on that.</span>
<span class="sd">    e.g. virtual topology pattern = [2,1,3,1,4,1,2]  3 node ring</span>
<span class="sd">    action history = [0,34,4,0,3,1,0]</span>
<span class="sd">    meaning v node &quot;2&quot; goes p node 0, v node &quot;3&quot; goes p node 4, v node &quot;4&quot; goes p node 3</span>
<span class="sd">    The numbers in-between relate to the slot action.</span>
<span class="sd">    If any value in the array is 1, a virtual node is assigned to multiple different physical nodes.</span>
<span class="sd">    Need to check from both perspectives:</span>
<span class="sd">    1. For each virtual node, check that all physical nodes are the same</span>
<span class="sd">    2. For each physical node, check that all virtual nodes are the same</span>

<span class="sd">    Args:</span>
<span class="sd">        action_history: Action history</span>
<span class="sd">        topology_pattern: Topology pattern</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">loop_func_virtual</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Get indices of physical node in action history that correspond to virtual node i</span>
        <span class="n">masked_val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">topology_pattern</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Get maximum value at those indices (should all be same)</span>
        <span class="n">max_node</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">masked_val</span><span class="p">)</span>
        <span class="c1"># For relevant indices, if max value then return 0 else 1</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masked_val</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked_val</span> <span class="o">!=</span> <span class="n">max_node</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">loop_func_physical</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Get indices of virtual nodes in topology pattern that correspond to physical node i</span>
        <span class="n">masked_val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">action_history</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Get maximum value at those indices (should all be same)</span>
        <span class="n">max_node</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">masked_val</span><span class="p">)</span>
        <span class="c1"># For relevant indices, if max value then return 0 else 1</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">masked_val</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">masked_val</span> <span class="o">!=</span> <span class="n">max_node</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>
    <span class="n">topology_pattern</span> <span class="o">=</span> <span class="n">topology_pattern</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Only look at node indices, not slot actions</span>
    <span class="n">action_history</span> <span class="o">=</span> <span class="n">action_history</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">check_virtual</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop_func_virtual</span><span class="p">,</span> <span class="n">action_history</span><span class="p">)</span>
    <span class="n">check_physical</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">action_history</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">action_history</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">loop_func_physical</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">)</span>
    <span class="n">check</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">check_virtual</span><span class="p">,</span> <span class="n">check_physical</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">check</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_unique_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_unique_nodes</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Count negative values on each node (row) in node departure array, must not exceed 1.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Node departure array (N x R) where N is number of nodes and R is number of resources</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">check_unique_nodes</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count negative values on each node (row) in node departure array, must not exceed 1.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_departure_array: Node departure array (N x R) where N is number of nodes and R is number of resources</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">one</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.check_vone_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check if action is valid.
Combines checks for:
- sufficient node capacities
- unique nodes assigned
- minimum two nodes assigned
- all requested nodes assigned
- correct topology pattern
- no spectrum reuse</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining_actions</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>remaining actions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_requested_nodes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>total requested nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if check failed, False if check passed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if action is valid.</span>
<span class="sd">    Combines checks for:</span>
<span class="sd">    - sufficient node capacities</span>
<span class="sd">    - unique nodes assigned</span>
<span class="sd">    - minimum two nodes assigned</span>
<span class="sd">    - all requested nodes assigned</span>
<span class="sd">    - correct topology pattern</span>
<span class="sd">    - no spectrum reuse</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>
<span class="sd">        remaining_actions: remaining actions</span>
<span class="sd">        total_requested_nodes: total requested nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if check failed, False if check passed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checks</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span>
        <span class="n">check_node_capacities</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span><span class="p">),</span>
        <span class="n">check_unique_nodes</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">),</span>
        <span class="c1"># TODO (VONE) - Remove two nodes check if impairs performance</span>
        <span class="c1">#  (check_all_nodes_assigned is sufficient but fails after last action of request instead of earlier)</span>
        <span class="n">check_min_two_nodes_assigned</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">),</span>
        <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">remaining_actions</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">check_all_nodes_assigned</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">total_requested_nodes</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">remaining_actions</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">check_topology</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">),</span>
        <span class="n">check_no_spectrum_reuse</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
    <span class="p">))</span>
    <span class="c1">#jax.debug.print(&quot;Checks: {}&quot;, checks, ordered=True)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">checks</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.convert_node_probs_to_traffic_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_node_probs_to_traffic_matrix</span><span class="p">(</span><span class="n">node_probs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert list of node probabilities to symmetric traffic matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_probs</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>node probabilities</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>traffic_matrix</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>traffic matrix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_node_probs_to_traffic_matrix</span><span class="p">(</span><span class="n">node_probs</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert list of node probabilities to symmetric traffic matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_probs: node probabilities</span>

<span class="sd">    Returns:</span>
<span class="sd">        traffic_matrix: traffic matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">node_probs</span><span class="p">,</span> <span class="n">node_probs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="c1"># Set lead diagonal to zero</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>
    <span class="n">matrix</span> <span class="o">=</span> <span class="n">normalise_traffic_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.create_run_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_run_name</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create name for run based on config flags</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_run_name</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">box</span><span class="o">.</span><span class="n">Box</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create name for run based on config flags&quot;&quot;&quot;</span>
    <span class="n">env_type</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;env_type&quot;</span><span class="p">]</span>
    <span class="n">topology</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;topology_name&quot;</span><span class="p">]</span>
    <span class="n">slots</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;link_resources&quot;</span><span class="p">]</span>
    <span class="n">gnn</span> <span class="o">=</span> <span class="s2">&quot;_GNN&quot;</span> <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;USE_GNN&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">incremental</span> <span class="o">=</span> <span class="s2">&quot;_INC&quot;</span> <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;incremental_loading&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="n">run_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">env_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">topology</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">slots</span><span class="si">}{</span><span class="n">gnn</span><span class="si">}{</span><span class="n">incremental</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;EVAL_HEURISTIC&quot;</span><span class="p">]:</span>
        <span class="n">run_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path_heuristic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="n">env_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;vone&quot;</span><span class="p">:</span>
            <span class="n">run_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;node_heuristic&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;EVAL_MODEL&quot;</span><span class="p">]:</span>
        <span class="n">run_name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;_EVAL&quot;</span>
    <span class="k">return</span> <span class="n">run_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.decrement_action_counter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">decrement_action_counter</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Decrement action counter in-place. Used in VONE environments.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">decrement_action_counter</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decrement action counter in-place. Used in VONE environments.&quot;&quot;&quot;</span>
    <span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.ff_ksp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ff_ksp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the first available slot from all paths
Method: Go through action mask and find the first available slot on all paths</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ff_ksp</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the first available slot from all paths</span>
<span class="sd">    Method: Go through action mask and find the first available slot on all paths</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_slots</span> <span class="o">=</span> <span class="n">first_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Chosen path is the one with the lowest index of first available slot</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">first_slots</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.finalise_action_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finalise_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Turn departure times positive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">finalise_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn departure times positive.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">make_positive</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">accepted_services</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_services</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">accepted_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_bitrate</span> <span class="o">+</span> <span class="n">requested_datarate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span> <span class="o">+</span> <span class="n">requested_datarate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.finalise_action_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finalise_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Turn departure times positive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">finalise_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn departure times positive.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">make_positive</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">accepted_services</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_services</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">accepted_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_bitrate</span> <span class="o">+</span> <span class="n">requested_datarate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span> <span class="o">+</span> <span class="n">requested_datarate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.finalise_vone_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">finalise_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Turn departure times positive.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">finalise_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Turn departure times positive.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_departure_array</span><span class="o">=</span><span class="n">make_positive</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">make_positive</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">accepted_services</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_services</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">accepted_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">accepted_bitrate</span>  <span class="c1"># TODO - get sum of bitrates for requested links</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.first_fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">first_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>First-Fit Spectrum Allocation. Returns the first fit slot for each path.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">first_fit</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;First-Fit Spectrum Allocation. Returns the first fit slot for each path.&quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Add a column of ones to the mask to make sure that occupied paths have non-zero index in &quot;first_slots&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">mask</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Get index of first available slots for each path</span>
    <span class="n">first_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">first_slots</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.format_vone_slot_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_vone_slot_request</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Format slot request for VONE action into format (source-node, slot, destination-node).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>action to format</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: formatted request</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">format_vone_slot_request</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Format slot request for VONE action into format (source-node, slot, destination-node).</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>
<span class="sd">        action: action to format</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: formatted request</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">remaining_actions</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">full_request</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">unformatted_request</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">full_request</span><span class="p">,</span> <span class="p">(</span><span class="n">remaining_actions</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">node_s</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">requested_slots</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">unformatted_request</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">node_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">formatted_request</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">node_s</span><span class="p">,</span> <span class="n">requested_slots</span><span class="p">,</span> <span class="n">node_d</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">formatted_request</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.generate_arrival_holding_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_arrival_holding_times</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate arrival and holding times based on Poisson distributed events.
To understand how sampling from e^-x can be transformed to sample from lambda<em>e^-(x/lambda) see:
https://en.wikipedia.org/wiki/Inverse_transform_sampling#Examples
Basically, inverse transform sampling is used to sample from a distribution with CDF F(x).
The CDF of the exponential distribution (lambda</em>e^-{lambda<em>x}) is F(x) = 1 - e^-{lambda</em>x}.
Therefore, the inverse CDF is x = -ln(1-u)/lambda, where u is sample from uniform distribution.
Therefore, we need to divide jax.random.exponential() by lambda in order to scale the standard exponential CDF.
Experimental histograms of this method compared to random.expovariate() in Python's random library show that
the two methods are equivalent.
Also see: https://numpy.org/doc/stable/reference/random/generated/numpy.random.exponential.html
https://jax.readthedocs.io/en/latest/_autosummary/jax.random.exponential.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PRNG key</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>arrival_time</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arrival time</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>holding_time</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Holding time</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_arrival_holding_times</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate arrival and holding times based on Poisson distributed events.</span>
<span class="sd">    To understand how sampling from e^-x can be transformed to sample from lambda*e^-(x/lambda) see:</span>
<span class="sd">    https://en.wikipedia.org/wiki/Inverse_transform_sampling#Examples</span>
<span class="sd">    Basically, inverse transform sampling is used to sample from a distribution with CDF F(x).</span>
<span class="sd">    The CDF of the exponential distribution (lambda*e^-{lambda*x}) is F(x) = 1 - e^-{lambda*x}.</span>
<span class="sd">    Therefore, the inverse CDF is x = -ln(1-u)/lambda, where u is sample from uniform distribution.</span>
<span class="sd">    Therefore, we need to divide jax.random.exponential() by lambda in order to scale the standard exponential CDF.</span>
<span class="sd">    Experimental histograms of this method compared to random.expovariate() in Python&#39;s random library show that</span>
<span class="sd">    the two methods are equivalent.</span>
<span class="sd">    Also see: https://numpy.org/doc/stable/reference/random/generated/numpy.random.exponential.html</span>
<span class="sd">    https://jax.readthedocs.io/en/latest/_autosummary/jax.random.exponential.html</span>

<span class="sd">    Args:</span>
<span class="sd">        key: PRNG key</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        arrival_time: Arrival time</span>
<span class="sd">        holding_time: Holding time</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key_arrival</span><span class="p">,</span> <span class="n">key_holding</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">arrival_time</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">key_arrival</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span> \
                   <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">arrival_rate</span>  <span class="c1"># Divide because it is rate (lambda)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">truncate_holding_time</span><span class="p">:</span>
        <span class="c1"># For DeepRMSA, need to generate holding times that are less than 2*mean_service_holding_time</span>
        <span class="n">key_holding</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">holding_times</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span> \
                                <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span><span class="p">)(</span><span class="n">key_holding</span><span class="p">)</span>
        <span class="n">holding_times</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">holding_times</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span><span class="p">,</span> <span class="n">holding_times</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
        <span class="c1"># Get first non-zero value in holding_times</span>
        <span class="n">non_zero_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">holding_times</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">holding_time</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">holding_times</span><span class="p">),</span> <span class="p">(</span><span class="n">non_zero_index</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">holding_time</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="n">key_holding</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span> \
                       <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span>  <span class="c1"># Multiply because it is mean (1/lambda)</span>
    <span class="k">return</span> <span class="n">arrival_time</span><span class="p">,</span> <span class="n">holding_time</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.generate_vone_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_vone_request</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate a new request for the VONE environment.
The request has two rows. The first row shows the node and slot values.
The first three elements of the second row show the number of unique nodes, the total number of steps, and the remaining steps.
These first three elements comprise the action counter.
The remaining elements of the second row show the virtual topology pattern, i.e. the connectivity of the virtual topology.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_vone_request</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a new request for the VONE environment.</span>
<span class="sd">    The request has two rows. The first row shows the node and slot values.</span>
<span class="sd">    The first three elements of the second row show the number of unique nodes, the total number of steps, and the remaining steps.</span>
<span class="sd">    These first three elements comprise the action counter.</span>
<span class="sd">    The remaining elements of the second row show the virtual topology pattern, i.e. the connectivity of the virtual topology.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">max_edges</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>  <span class="c1"># shape of request array</span>
    <span class="n">key_topology</span><span class="p">,</span> <span class="n">key_node</span><span class="p">,</span> <span class="n">key_slot</span><span class="p">,</span> <span class="n">key_times</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="c1"># Randomly select topology, node resources, slot resources</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">key_topology</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">virtual_topology_patterns</span><span class="p">)</span>
    <span class="n">action_counter</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
    <span class="n">topology_pattern</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,),</span> <span class="p">(</span><span class="n">pattern</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">3</span><span class="p">,))</span>
    <span class="n">selected_node_values</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">key_node</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">values_nodes</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">shape</span><span class="p">,))</span>
    <span class="n">selected_bw_values</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">key_slot</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">shape</span><span class="p">,))</span>
    <span class="c1"># Create a mask for odd and even indices</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">shape</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)[:</span><span class="n">shape</span><span class="p">]</span>
    <span class="c1"># Vectorized conditional replacement using mask</span>
    <span class="n">first_row</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">selected_bw_values</span><span class="p">,</span> <span class="n">selected_node_values</span><span class="p">)</span>
    <span class="c1"># Make sure node request values are consistent for same virtual nodes</span>
    <span class="n">first_row</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
        <span class="mi">2</span><span class="p">,</span>  <span class="c1"># Lowest node index in virtual topology requests is 2</span>
        <span class="n">shape</span><span class="p">,</span>  <span class="c1"># Highest possible node index in virtual topology requests is shape-1</span>
        <span class="k">lambda</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">topology_pattern</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="n">selected_node_values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span>
        <span class="n">first_row</span>
    <span class="p">)</span>
    <span class="c1"># Mask out unused part of request array</span>
    <span class="n">first_row</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">topology_pattern</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">first_row</span><span class="p">)</span>
    <span class="c1"># Set times</span>
    <span class="n">arrival_time</span><span class="p">,</span> <span class="n">holding_time</span> <span class="o">=</span> <span class="n">generate_arrival_holding_times</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">holding_time</span><span class="o">=</span><span class="n">holding_time</span><span class="p">,</span>
        <span class="n">current_time</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">arrival_time</span><span class="p">,</span>
        <span class="n">action_counter</span><span class="o">=</span><span class="n">action_counter</span><span class="p">,</span>
        <span class="n">request_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">first_row</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">)),</span>
        <span class="n">action_history</span><span class="o">=</span><span class="n">init_action_history</span><span class="p">(</span><span class="n">params</span><span class="p">),</span>
        <span class="n">total_requests</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_requests</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">remove_expired_node_requests</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">incremental_loading</span> <span class="k">else</span> <span class="n">state</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">remove_expired_services_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">incremental_loading</span> <span class="k">else</span> <span class="n">state</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_action_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>N.B. The mask must already be present in the state!</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;N.B. The mask must already be present in the state!&quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_mask</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;DeepRMSAEnvParams&quot;</span> <span class="k">else</span> <span class="p">(</span>
        <span class="n">mask_slots</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span><span class="o">.</span><span class="n">link_slot_mask</span>
    <span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">mask</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_best_modulation_format" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_best_modulation_format</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get best modulation format for lightpath. "Best" is the highest order that has SNR requirements below available.
Try each modulation format, calculate SNR for each, then return the highest order possible.
Args:
    state (EnvState): Environment state
    path (chex.Array): Path array
    initial_slot_index (int): Initial slot index
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Acceptable modulation format indices</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_best_modulation_format</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get best modulation format for lightpath. &quot;Best&quot; is the highest order that has SNR requirements below available.</span>
<span class="sd">    Try each modulation format, calculate SNR for each, then return the highest order possible.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        path (chex.Array): Path array</span>
<span class="sd">        initial_slot_index (int): Initial slot index</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Acceptable modulation format indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">mod_format_count</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">acceptable_mod_format_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mod_format_count</span><span class="p">,),</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">acceptable_modulation_format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">acceptable_format_indices</span><span class="p">):</span>
        <span class="n">req_snr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">snr_margin</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">req_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="c1"># TODO - need to check we don&#39;t overwrite values in already occupied slots</span>
        <span class="c1"># Possible approaches:</span>
        <span class="c1"># Check slot occupancy? Probably would need to iterate through for num_slots, but that&#39;s an issue</span>
        <span class="c1"># What about we allocate and then fix up later, e.g. could it be possible to just add the modulation format on top without</span>
        <span class="c1"># check sum of path links prior to assigning?</span>
        <span class="c1">#</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
            <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">snr_value</span> <span class="o">=</span> <span class="n">get_minimum_snr_of_channels_on_path</span><span class="p">(</span><span class="n">new_state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="c1"># jax.debug.print(&quot;snr_value {}&quot;, snr_value, ordered=True)</span>
        <span class="c1"># jax.debug.print(&quot;req_snr {}&quot;, req_snr, ordered=True)</span>
        <span class="n">acceptable_format_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">snr_value</span> <span class="o">&gt;=</span> <span class="n">req_snr</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">acceptable_format_indices</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">acceptable_format_indices</span><span class="p">,</span> <span class="n">acceptable_format_index</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,))</span>
        <span class="c1"># jax.debug.print(&quot;acceptable_format_indices {}&quot;, acceptable_format_indices, ordered=True)</span>
        <span class="k">return</span> <span class="n">acceptable_format_indices</span>

    <span class="n">acceptable_mod_format_indices</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="n">mod_format_count</span><span class="p">,</span>
        <span class="n">acceptable_modulation_format</span><span class="p">,</span>
        <span class="n">acceptable_mod_format_indices</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">acceptable_mod_format_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_best_modulation_format_simple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_best_modulation_format_simple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get modulation format for lightpath.
Assume worst case (least Gaussian) modulation format when calculating SNR.
Args:
    state (EnvState): Environment state
    path (chex.Array): Path array
    initial_slot_index (int): Initial slot index
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Acceptable modulation format indices</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_best_modulation_format_simple</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get modulation format for lightpath.</span>
<span class="sd">    Assume worst case (least Gaussian) modulation format when calculating SNR.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        path (chex.Array): Path array</span>
<span class="sd">        initial_slot_index (int): Initial slot index</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Acceptable modulation format indices</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_snr_array</span> <span class="o">=</span> <span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">snr_value</span> <span class="o">=</span> <span class="n">get_snr_for_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link_snr_array</span><span class="p">,</span> <span class="n">params</span><span class="p">)[</span><span class="n">initial_slot_index</span><span class="p">]</span> <span class="o">-</span> <span class="n">params</span><span class="o">.</span><span class="n">snr_margin</span>  <span class="c1"># Margin</span>
    <span class="n">mod_format_count</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">acceptable_mod_format_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">mod_format_count</span><span class="p">)</span>
    <span class="n">req_snr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">snr_margin</span>
    <span class="n">acceptable_mod_format_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">snr_value</span> <span class="o">&gt;=</span> <span class="n">req_snr</span><span class="p">,</span>
                                              <span class="n">acceptable_mod_format_indices</span><span class="p">,</span>
                                              <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mod_format_count</span><span class="p">,),</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">acceptable_mod_format_indices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_centre_frequency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_centre_frequency</span><span class="p">(</span><span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get centre frequency for new lightpath</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>initial_slot_index</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Centre frequency of first slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slots</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Centre frequency for new lightpath</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_centre_frequency</span><span class="p">(</span><span class="n">initial_slot_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get centre frequency for new lightpath</span>

<span class="sd">    Args:</span>
<span class="sd">        initial_slot_index (chex.Array): Centre frequency of first slot</span>
<span class="sd">        num_slots (float): Number of slots</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Centre frequency for new lightpath</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">slot_centres</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span>
    <span class="k">return</span> <span class="n">slot_centres</span><span class="p">[</span><span class="n">initial_slot_index</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">slot_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_slots</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_edge_disjoint_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_edge_disjoint_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get edge disjoint paths between all nodes in graph.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>edge disjoint paths (path is list of edges)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_edge_disjoint_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get edge disjoint paths between all nodes in graph.</span>

<span class="sd">    Args:</span>
<span class="sd">        graph: graph</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: edge disjoint paths (path is list of edges)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="p">{}</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">graph</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="c1"># Sort by number of links in path</span>
        <span class="c1"># TODO - sort by path length</span>
        <span class="n">result</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="n">n2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">edge_disjoint_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="n">n2</span><span class="p">][</span><span class="n">n1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">edge_disjoint_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n1</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_launch_power" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get launch power for new lightpath. N.B. launch power is specified in dBm but is converted to linear units
when stored in channel_power_array. This func returns linear units (mW).
Path action is used to determine the launch power in the case of tabular launch power type.
Power action is used to determine the launch power in the case of RL launch power type. During masking,
power action is set as state.launch_power_array[0], which is set by the RL agent.
Args:
    state (EnvState): Environment state
    path_action (chex.Array): Action specifying path index (0 to k_paths-1)
    power_action (chex.Array): Action specifying launch power in dBm
    params (EnvParams): Environment parameters
Returns:
    chex.Array: Launch power for new lightpath</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3429</span>
<span class="normal">3430</span>
<span class="normal">3431</span>
<span class="normal">3432</span>
<span class="normal">3433</span>
<span class="normal">3434</span>
<span class="normal">3435</span>
<span class="normal">3436</span>
<span class="normal">3437</span>
<span class="normal">3438</span>
<span class="normal">3439</span>
<span class="normal">3440</span>
<span class="normal">3441</span>
<span class="normal">3442</span>
<span class="normal">3443</span>
<span class="normal">3444</span>
<span class="normal">3445</span>
<span class="normal">3446</span>
<span class="normal">3447</span>
<span class="normal">3448</span>
<span class="normal">3449</span>
<span class="normal">3450</span>
<span class="normal">3451</span>
<span class="normal">3452</span>
<span class="normal">3453</span>
<span class="normal">3454</span>
<span class="normal">3455</span>
<span class="normal">3456</span>
<span class="normal">3457</span>
<span class="normal">3458</span>
<span class="normal">3459</span>
<span class="normal">3460</span>
<span class="normal">3461</span>
<span class="normal">3462</span>
<span class="normal">3463</span>
<span class="normal">3464</span>
<span class="normal">3465</span>
<span class="normal">3466</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">path_action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">power_action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get launch power for new lightpath. N.B. launch power is specified in dBm but is converted to linear units</span>
<span class="sd">    when stored in channel_power_array. This func returns linear units (mW).</span>
<span class="sd">    Path action is used to determine the launch power in the case of tabular launch power type.</span>
<span class="sd">    Power action is used to determine the launch power in the case of RL launch power type. During masking,</span>
<span class="sd">    power action is set as state.launch_power_array[0], which is set by the RL agent.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        path_action (chex.Array): Action specifying path index (0 to k_paths-1)</span>
<span class="sd">        power_action (chex.Array): Action specifying launch power in dBm</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Launch power for new lightpath</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">k_path_index</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path_action</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">launch_power_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Fixed</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">launch_power_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">launch_power_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Tabular (one row per path)</span>
        <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">launch_power_array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k_path_index</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">launch_power_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># RL</span>
        <span class="k">return</span> <span class="n">power_action</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="n">launch_power_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>  <span class="c1"># Scaled</span>
        <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span>
        <span class="c1"># Get path length</span>
        <span class="n">link_length_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">path_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">link_length_array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">k_path_index</span><span class="p">],</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">path_link_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">unpackbits</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">)[:,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">pack_path_bits</span> \
            <span class="k">else</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span>
        <span class="n">maximum_path_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="n">launch_power_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">path_length</span> <span class="o">/</span> <span class="n">maximum_path_length</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid launch power type. Check params.launch_power_type&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_lightpath_snr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_lightpath_snr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get SNR for each link on path.
N.B. that in most cases it is more efficient to calculate the SNR for every possible path, rather than a slot-by-slot basis.
But in some cases slot-by-slot is better i.e. when k<em>N(N-1)/2 &gt; L</em>S
Args:
    state (RSAGNModelEnvState): Environment state
    params (RSAGNModelEnvParams): Environment parameters</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.array: SNR for each link on path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_lightpath_snr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get SNR for each link on path.</span>
<span class="sd">    N.B. that in most cases it is more efficient to calculate the SNR for every possible path, rather than a slot-by-slot basis.</span>
<span class="sd">    But in some cases slot-by-slot is better i.e. when k*N(N-1)/2 &gt; L*S</span>
<span class="sd">    Args:</span>
<span class="sd">        state (RSAGNModelEnvState): Environment state</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.array: SNR for each link on path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the SNR for the channel that the path occupies</span>
    <span class="n">path_snr_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_snr_for_path</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Where value in path_index_array matches index of path_snr_array, substitute in SNR value</span>
    <span class="n">slot_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
    <span class="n">lightpath_snr_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">si</span><span class="p">:</span> <span class="n">path_snr_array</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="n">si</span><span class="p">],</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">slot_indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lightpath_snr_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_link_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_link_weights</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get link weights based on occupancy for use in congestion-aware routing heuristics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Link weights</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_link_weights</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get link weights based on occupancy for use in congestion-aware routing heuristics.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Link weights</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;RWALightpathReuseEnvParams&quot;</span><span class="p">:</span>
        <span class="n">link_occupancy</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">initial_path_capacity</span> <span class="o">=</span> <span class="n">init_path_capacity_array</span><span class="p">(</span>
            <span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="p">)</span>
        <span class="n">initial_path_capacity</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">initial_path_capacity</span><span class="p">[</span><span class="n">x</span><span class="p">])(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">))</span>
        <span class="n">utilisation</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">initial_path_capacity</span> <span class="o">-</span> <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="n">initial_path_capacity</span> <span class="o">-</span> <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">)</span> <span class="o">/</span> <span class="n">initial_path_capacity</span>
        <span class="n">link_occupancy</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">utilisation</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">link_weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">link_occupancy</span> <span class="o">/</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">link_weights</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_minimum_snr_of_channels_on_path" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_minimum_snr_of_channels_on_path</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the minimum value of the SNR on newly assigned channels.
N.B. this requires the link_snr_array to have already been calculated and present in state.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3290</span>
<span class="normal">3291</span>
<span class="normal">3292</span>
<span class="normal">3293</span>
<span class="normal">3294</span>
<span class="normal">3295</span>
<span class="normal">3296</span>
<span class="normal">3297</span>
<span class="normal">3298</span>
<span class="normal">3299</span>
<span class="normal">3300</span>
<span class="normal">3301</span>
<span class="normal">3302</span>
<span class="normal">3303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_minimum_snr_of_channels_on_path</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">slot_index</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the minimum value of the SNR on newly assigned channels.</span>
<span class="sd">    N.B. this requires the link_snr_array to have already been calculated and present in state.&quot;&quot;&quot;</span>
    <span class="n">snr_value_all_channels</span> <span class="o">=</span> <span class="n">get_snr_for_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">min_snr_value_sub_channels</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
            <span class="n">snr_value_all_channels</span><span class="p">[</span><span class="n">slot_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span>
            <span class="n">snr_value_all_channels</span><span class="p">[</span><span class="n">slot_index</span> <span class="o">+</span> <span class="n">req_slots</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
        <span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">min_snr_value_sub_channels</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_num_spectral_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_num_spectral_features</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Heuristic for number of spectral features based on graph size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n_nodes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes in the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of spectral features to use, clamped between 3 and 15.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Follows log2(n_nodes) scaling as reasonable default.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_num_spectral_features</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Heuristic for number of spectral features based on graph size.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_nodes: Number of nodes in the graph</span>

<span class="sd">    Returns:</span>
<span class="sd">        Number of spectral features to use, clamped between 3 and 15.</span>
<span class="sd">        Follows log2(n_nodes) scaling as reasonable default.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">))),</span> <span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_path_from_path_index_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path_from_path_index_array</span><span class="p">(</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path_link_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get path from path index array.
Args:
    path_index_array (chex.Array): Path index array
    path_link_array (chex.Array): Path link array</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: path index values replaced with binary path-link arrays</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path_from_path_index_array</span><span class="p">(</span><span class="n">path_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get path from path index array.</span>
<span class="sd">    Args:</span>
<span class="sd">        path_index_array (chex.Array): Path index array</span>
<span class="sd">        path_link_array (chex.Array): Path link array</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: path index values replaced with binary path-link arrays</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - support unpacking bits (if this function ends up being used)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_from_link</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">path_link_array</span><span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">link</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_index_from_link</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">path_index_array</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_path_index_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Indices of paths between source and destination from path array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Indices of paths between source and destination from path array&quot;&quot;&quot;</span>
    <span class="c1"># get source and destination nodes in order (for accurate indexing of path-link array)</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span>
    <span class="n">index_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">),</span> <span class="p">(</span><span class="n">i</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,))</span>
    <span class="k">return</span> <span class="n">index_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_path_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path_indices</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get path indices for a given source, destination and number of paths.
If source &gt; destination and the graph is directed (two fibres per link, one in each direction) then an offset is
added to the index to get the path in the other direction (the offset is the total number source-dest pairs).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>s</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source node index</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Destination node index</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>N</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: Start index on path-link array for candidate paths</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path_indices</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">N</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get path indices for a given source, destination and number of paths.</span>
<span class="sd">    If source &gt; destination and the graph is directed (two fibres per link, one in each direction) then an offset is</span>
<span class="sd">    added to the index to get the path in the other direction (the offset is the total number source-dest pairs).</span>

<span class="sd">    Args:</span>
<span class="sd">        s (int): Source node index</span>
<span class="sd">        d (int): Destination node index</span>
<span class="sd">        k (int): Number of paths</span>
<span class="sd">        N (int): Number of nodes</span>
<span class="sd">        directed (bool, optional): Whether graph is directed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Start index on path-link array for candidate paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span>
    <span class="n">indices_to_s</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_indices</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">))</span>
    <span class="n">indices_to_d</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_indices</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">,</span> <span class="n">node_indices</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">))</span>
    <span class="c1"># If two fibres per link, add offset to index to get fibre in other direction if source &gt; destination</span>
    <span class="n">directed_offset</span> <span class="o">=</span> <span class="n">directed</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1"># The following equation is based on the combinations formula</span>
    <span class="n">forward</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">s</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">indices_to_s</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">backward</span> <span class="o">=</span> <span class="p">((</span><span class="n">N</span> <span class="o">*</span> <span class="n">d</span> <span class="o">+</span> <span class="n">s</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">indices_to_d</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">forward</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="n">backward</span> <span class="o">*</span> <span class="p">(</span><span class="n">s</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="n">directed_offset</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_path_slots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_path_slots</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get slots on each constitutent link of path from link_slot_array (L x S),
then aggregate to get (S x 1) representation of slots on path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>link-slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nodes_sd</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>source-destination nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>i</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path index</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>agg_func</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>aggregation function (max or sum).
If max, result will be available slots on path.
If sum, result will contain information on edge features.</p>
              </div>
            </td>
            <td>
                  <code>&#39;max&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>slots</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>slots on path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_path_slots</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">agg_func</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get slots on each constitutent link of path from link_slot_array (L x S),</span>
<span class="sd">    then aggregate to get (S x 1) representation of slots on path.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array: link-slot array</span>
<span class="sd">        params: environment parameters</span>
<span class="sd">        nodes_sd: source-destination nodes</span>
<span class="sd">        i: path index</span>
<span class="sd">        agg_func: aggregation function (max or sum).</span>
<span class="sd">            If max, result will be available slots on path.</span>
<span class="sd">            If sum, result will contain information on edge features.</span>

<span class="sd">    Returns:</span>
<span class="sd">        slots: slots on path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># Get links and collapse to single dimension</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="k">if</span> <span class="n">agg_func</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="k">else</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">)</span>
    <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link_slot_array</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_slots</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">))</span>
    <span class="c1"># Make any -1s positive then get max for each slot across links</span>
    <span class="k">if</span> <span class="n">agg_func</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
        <span class="c1"># Use this for getting slots from link_slot_array</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">slots</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">agg_func</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
        <span class="c1"># TODO - consider using an RNN (or S5) to aggregate edge features</span>
        <span class="c1"># Use this (or alternative) for aggregating edge features from GNN</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">agg_func</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
        <span class="c1"># Use this for getting mean value in slot index along path</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">slots</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;agg_func must be &#39;max&#39; or &#39;sum&#39; or &#39;mean&#39;&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">slots</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_paths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get k paths between source and destination</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get k paths between source and destination&quot;&quot;&quot;</span>
    <span class="n">index_array</span> <span class="o">=</span> <span class="n">get_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">index_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">pack_path_bits</span><span class="p">:</span>  <span class="c1"># Unpack the bit-packed paths</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">unpackbits</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="p">:</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">paths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_paths_obs_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_paths_obs_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get observation space for launch power optimization (with numerical stability).</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3469</span>
<span class="normal">3470</span>
<span class="normal">3471</span>
<span class="normal">3472</span>
<span class="normal">3473</span>
<span class="normal">3474</span>
<span class="normal">3475</span>
<span class="normal">3476</span>
<span class="normal">3477</span>
<span class="normal">3478</span>
<span class="normal">3479</span>
<span class="normal">3480</span>
<span class="normal">3481</span>
<span class="normal">3482</span>
<span class="normal">3483</span>
<span class="normal">3484</span>
<span class="normal">3485</span>
<span class="normal">3486</span>
<span class="normal">3487</span>
<span class="normal">3488</span>
<span class="normal">3489</span>
<span class="normal">3490</span>
<span class="normal">3491</span>
<span class="normal">3492</span>
<span class="normal">3493</span>
<span class="normal">3494</span>
<span class="normal">3495</span>
<span class="normal">3496</span>
<span class="normal">3497</span>
<span class="normal">3498</span>
<span class="normal">3499</span>
<span class="normal">3500</span>
<span class="normal">3501</span>
<span class="normal">3502</span>
<span class="normal">3503</span>
<span class="normal">3504</span>
<span class="normal">3505</span>
<span class="normal">3506</span>
<span class="normal">3507</span>
<span class="normal">3508</span>
<span class="normal">3509</span>
<span class="normal">3510</span>
<span class="normal">3511</span>
<span class="normal">3512</span>
<span class="normal">3513</span>
<span class="normal">3514</span>
<span class="normal">3515</span>
<span class="normal">3516</span>
<span class="normal">3517</span>
<span class="normal">3518</span>
<span class="normal">3519</span>
<span class="normal">3520</span>
<span class="normal">3521</span>
<span class="normal">3522</span>
<span class="normal">3523</span>
<span class="normal">3524</span>
<span class="normal">3525</span>
<span class="normal">3526</span>
<span class="normal">3527</span>
<span class="normal">3528</span>
<span class="normal">3529</span>
<span class="normal">3530</span>
<span class="normal">3531</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_paths_obs_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
    <span class="c1"># TODO - make this just show the stats from just one path at a time</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get observation space for launch power optimization (with numerical stability).&quot;&quot;&quot;</span>
    <span class="n">request_array</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">path_stats</span> <span class="o">=</span> <span class="n">calculate_path_stats</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request_array</span><span class="p">)</span>
    <span class="c1"># Remove first 3 items of path stats for each path</span>
    <span class="n">path_stats</span> <span class="o">=</span> <span class="n">path_stats</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">:]</span>
    <span class="n">link_length_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lightpath_snr_array</span> <span class="o">=</span> <span class="n">get_lightpath_snr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_gn_path_stats</span><span class="p">(</span><span class="n">k_path_index</span><span class="p">,</span> <span class="n">init_val</span><span class="p">):</span>
        <span class="c1"># Get path index</span>
        <span class="n">path_index</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span>
                                      <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span> <span class="o">+</span> <span class="n">k_path_index</span>
        <span class="n">path_link_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">unpackbits</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="p">:</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">pack_path_bits</span> \
            <span class="k">else</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">path_link_array</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span>
        <span class="n">path_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">link_length_array</span><span class="p">)</span>
        <span class="n">max_path_length</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">link_length_array</span><span class="p">))</span>
        <span class="n">path_length_norm</span> <span class="o">=</span> <span class="n">path_length</span> <span class="o">/</span> <span class="n">max_path_length</span>
        <span class="n">max_path_length_hops</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">path_length_hops_norm</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span> <span class="o">/</span> <span class="n">max_path_length_hops</span>
        <span class="c1"># Connections on path</span>
        <span class="n">num_connections</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">num_connections_norm</span> <span class="o">=</span> <span class="n">num_connections</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="c1"># Mean power of connections on path</span>
        <span class="c1"># make path with row length equal to link_resource (+1 to avoid zero division)</span>
        <span class="n">mean_power_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span>
                           <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_connections</span> <span class="o">&gt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">num_connections</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">max_power</span><span class="p">))</span>
        <span class="c1"># Mean SNR of connections on the path links</span>
        <span class="n">max_snr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>  <span class="c1"># Nominal value for max GSNR in dB</span>
        <span class="n">mean_snr_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">lightpath_snr_array</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">/</span>
                         <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">num_connections</span> <span class="o">&gt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">num_connections</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span> <span class="o">*</span> <span class="n">max_snr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span>
            <span class="n">init_val</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>
                <span class="n">path_length</span><span class="p">,</span>
                <span class="n">path_length_hops_norm</span><span class="p">,</span>
                <span class="n">num_connections_norm</span><span class="p">,</span>
                <span class="n">mean_power_norm</span><span class="p">,</span>
                <span class="n">mean_snr_norm</span>
            <span class="p">]]),</span>
            <span class="p">(</span><span class="n">k_path_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">gn_path_stats</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="n">gn_path_stats</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
        <span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">calculate_gn_path_stats</span><span class="p">,</span> <span class="n">gn_path_stats</span>
    <span class="p">)</span>
    <span class="n">all_stats</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">path_stats</span><span class="p">,</span> <span class="n">gn_path_stats</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">source</span><span class="p">]),</span>
            <span class="n">requested_datarate</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dest</span><span class="p">]),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">all_stats</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="p">),</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_paths_se" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get max. spectral efficiency of modulation format on k paths between source and destination</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get max. spectral efficiency of modulation format on k paths between source and destination&quot;&quot;&quot;</span>
    <span class="c1"># get source and destination nodes in order (for accurate indexing of path-link array)</span>
    <span class="n">index_array</span> <span class="o">=</span> <span class="n">get_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">path_se_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">index_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_required_snr_se_kurtosis_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_required_snr_se_kurtosis_array</span><span class="p">(</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert modulation format index to required SNR or spectral efficiency.
Modulation format index array contains the index of the modulation format used by the channel.
The modulation index references a row in the modulations array, which contains SNR and SE values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>modulation_format_index_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Modulation format index array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>col_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Column index for required SNR or spectral efficiency</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: Required SNR for each channel (min. SNR for empty channel (mod. index 0))</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_required_snr_se_kurtosis_array</span><span class="p">(</span><span class="n">modulation_format_index_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">col_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert modulation format index to required SNR or spectral efficiency.</span>
<span class="sd">    Modulation format index array contains the index of the modulation format used by the channel.</span>
<span class="sd">    The modulation index references a row in the modulations array, which contains SNR and SE values.</span>

<span class="sd">    Args:</span>
<span class="sd">        modulation_format_index_array (chex.Array): Modulation format index array</span>
<span class="sd">        col_index (int): Column index for required SNR or spectral efficiency</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Required SNR for each channel (min. SNR for empty channel (mod. index 0))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_required_snr_se_kurtosis_on_link</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_snr_link_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get SNR per link
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
Returns:
    jnp.array: SNR per link</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get SNR per link</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: SNR per link</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_link_snr</span><span class="p">(</span><span class="n">link_index</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="c1"># Get channel power, channel centre, bandwidth, and noise figure</span>
        <span class="n">link_lengths</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="p">[</span><span class="n">link_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">num_spans</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">link_lengths</span><span class="p">)</span><span class="o">*</span><span class="mf">1e3</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">max_span_length</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mod_format_correction</span><span class="p">:</span>
            <span class="n">mod_format_link</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">[</span><span class="n">link_index</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">kurtosis_link</span> <span class="o">=</span> <span class="n">get_required_snr_se_kurtosis_on_link</span><span class="p">(</span><span class="n">mod_format_link</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">se_link</span> <span class="o">=</span> <span class="n">get_required_snr_se_kurtosis_on_link</span><span class="p">(</span><span class="n">mod_format_link</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kurtosis_link</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
            <span class="n">se_link</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
        <span class="n">bw_link</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">[</span><span class="n">link_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ch_power_link</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">[</span><span class="n">link_index</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">required_slots_link</span> <span class="o">=</span> <span class="n">get_required_slots_on_link</span><span class="p">(</span><span class="n">bw_link</span><span class="p">,</span> <span class="n">se_link</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">ch_centres_link</span> <span class="o">=</span> <span class="n">get_centre_freq_on_link</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="n">required_slots_link</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

        <span class="c1"># Calculate SNR</span>
        <span class="n">P</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">num_channels</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span>
            <span class="n">num_spans</span><span class="o">=</span><span class="n">num_spans</span><span class="p">,</span>
            <span class="n">max_spans</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">max_spans</span><span class="p">,</span>
            <span class="n">ref_lambda</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">ref_lambda</span><span class="p">,</span>
            <span class="n">length</span><span class="o">=</span><span class="n">link_lengths</span><span class="p">,</span>
            <span class="n">attenuation_i</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">attenuation</span><span class="p">),</span>
            <span class="n">attenuation_bar_i</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">attenuation_bar</span><span class="p">),</span>
            <span class="n">nonlinear_coeff</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">nonlinear_coeff</span><span class="p">),</span>
            <span class="n">raman_gain_slope_i</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">raman_gain_slope</span><span class="p">),</span>
            <span class="n">dispersion_coeff</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">dispersion_coeff</span><span class="p">),</span>
            <span class="n">dispersion_slope</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">dispersion_slope</span><span class="p">),</span>
            <span class="n">coherent</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">coherent</span><span class="p">,</span>
            <span class="n">num_roadms</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">num_roadms</span><span class="p">,</span>
            <span class="n">roadm_loss</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">roadm_loss</span><span class="p">,</span>
            <span class="n">amplifier_noise_figure</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">amplifier_noise_figure</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
            <span class="n">transceiver_snr</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">transceiver_snr</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
            <span class="n">mod_format_correction</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">mod_format_correction</span><span class="p">,</span>
            <span class="n">ch_power_w_i</span><span class="o">=</span><span class="n">ch_power_link</span><span class="p">,</span>
            <span class="n">ch_centre_i</span><span class="o">=</span><span class="n">ch_centres_link</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span>
            <span class="n">ch_bandwidth_i</span><span class="o">=</span><span class="n">bw_link</span><span class="o">*</span><span class="mf">1e9</span><span class="p">,</span>
            <span class="n">excess_kurtosis_i</span><span class="o">=</span><span class="n">kurtosis_link</span><span class="p">,</span>
            <span class="n">uniform_spans</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">uniform_spans</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">snr</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">get_snr</span><span class="p">(</span><span class="o">**</span><span class="n">P</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">snr</span>

    <span class="n">link_snr_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_link_snr</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">),</span> <span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">link_snr_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">link_snr_array</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">link_snr_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.get_spectral_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_spectral_features</span><span class="p">(</span><span class="n">laplacian</span><span class="p">,</span> <span class="n">num_features</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Compute spectral node features from symmetric normalized graph Laplacian.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>adj</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Adjacency matrix of the graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_features</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of eigenvector features to extract</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jax.numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of shape (n_nodes, num_features) containing eigenvectors corresponding</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="jax.numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>to the smallest non-zero eigenvalues of the graph Laplacian.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="notes" open>
  <summary>Notes</summary>
  <ul>
<li>Skips trivial eigenvectors (those with near-zero eigenvalues)</li>
<li>Eigenvectors are ordered by ascending eigenvalue magnitude</li>
<li>Runtime is O(n^3) - use only for small/medium graphs</li>
<li>Eigenvector signs are arbitrary (may vary between runs)</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_spectral_features</span><span class="p">(</span><span class="n">laplacian</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">num_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute spectral node features from symmetric normalized graph Laplacian.</span>

<span class="sd">    Args:</span>
<span class="sd">        adj: Adjacency matrix of the graph</span>
<span class="sd">        num_features: Number of eigenvector features to extract</span>

<span class="sd">    Returns:</span>
<span class="sd">        Array of shape (n_nodes, num_features) containing eigenvectors corresponding</span>
<span class="sd">        to the smallest non-zero eigenvalues of the graph Laplacian.</span>

<span class="sd">    Notes:</span>
<span class="sd">        - Skips trivial eigenvectors (those with near-zero eigenvalues)</span>
<span class="sd">        - Eigenvectors are ordered by ascending eigenvalue magnitude</span>
<span class="sd">        - Runtime is O(n^3) - use only for small/medium graphs</span>
<span class="sd">        - Eigenvector signs are arbitrary (may vary between runs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n_nodes</span> <span class="o">=</span> <span class="n">laplacian</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">eigenvalues</span><span class="p">,</span> <span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">laplacian</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">eigenvectors</span><span class="p">[:,</span> <span class="p">:</span><span class="n">num_features</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.implement_action_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Implement action for RSA GN model. Update following arrays:
- link_slot_array
- link_slot_departure_array
- link_snr_array
- modulation_format_index_array
- channel_power_array
- active_path_array
Args:
    state (EnvState): Environment state
    action (chex.Array): Action tuple (first is path action, second is launch_power)
    params (EnvParams): Environment parameters
Returns:
    EnvState: Updated environment state</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_action_rmsa_gn_model</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement action for RSA GN model. Update following arrays:</span>
<span class="sd">    - link_slot_array</span>
<span class="sd">    - link_slot_departure_array</span>
<span class="sd">    - link_snr_array</span>
<span class="sd">    - modulation_format_index_array</span>
<span class="sd">    - channel_power_array</span>
<span class="sd">    - active_path_array</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        action (chex.Array): Action tuple (first is path action, second is launch_power)</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        EnvState: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span> <span class="o">=</span> <span class="n">action</span>
    <span class="n">path_action</span> <span class="o">=</span> <span class="n">path_action</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="n">k_path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path_action</span><span class="p">)</span>
    <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">get_lightpath_index</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">k_path_index</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">k_path_index</span><span class="p">]</span>
    <span class="n">launch_power</span> <span class="o">=</span> <span class="n">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># TODO(GN MODEL) - get mod. format based on maximum reach</span>
    <span class="n">mod_format_index</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
        <span class="n">state</span><span class="o">.</span><span class="n">mod_format_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">path_action</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">mod_format_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
    <span class="c1"># Update link_slot_array and link_slot_departure_array, then other arrays</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
        <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">mod_format_index</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="c1"># Update link_snr_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_snr_array</span><span class="o">=</span><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
    <span class="c1"># jax.debug.print(&quot;launch_power {}&quot;, launch_power, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;mod_format_index {}&quot;, mod_format_index, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;initial_slot_index {}&quot;, initial_slot_index, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;state.mod_format_mask {}&quot;, state.mod_format_mask, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;path_snr {}&quot;, get_snr_for_path(path, state.link_snr_array, params), ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;required_snr {}&quot;, params.modulations_array.val[mod_format_index][2] + params.snr_margin, ordered=True)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.implement_action_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Implement action to assign slots on links.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>action to implement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_action_rsa</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement action to assign slots on links.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>
<span class="sd">        action: action to implement</span>
<span class="sd">        params: environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RWALightpathReuseEnvParams&quot;</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">link_capacity_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">requested_datarate</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># TODO (Dynamic-RWALR) - to support diverse requested_datarates for RWA-LR, need to update masking</span>
        <span class="c1"># TODO (Dynamic-RWALR) - In order to enable dynamic RWA with lightpath reuse (as opposed to just incremental loading),</span>
        <span class="c1">#  need to keep track of active requests OR just randomly remove connections</span>
        <span class="c1">#  (could do this by using the link_slot_departure array in a novel way... i.e. don&#39;t fill it with departure time but current bw)</span>
        <span class="n">capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">over_capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">total_mask</span> <span class="o">=</span> <span class="n">capacity_mask</span> <span class="o">+</span> <span class="n">over_capacity_mask</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">link_slot_array</span><span class="o">=</span><span class="n">total_mask</span><span class="p">,</span>
            <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
                                                                       <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                                                       <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">one</span>
        <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.implement_action_rsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_action_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Implement action for RSA GN model. Update following arrays:
- link_slot_array
- link_slot_departure_array
- link_snr_array
- modulation_format_index_array
- channel_power_array
- active_path_array
Args:
    state (EnvState): Environment state
    action (chex.Array): Action tuple (first is path action, second is launch_power)
    params (EnvParams): Environment parameters
Returns:
    EnvState: Updated environment state</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_action_rsa_gn_model</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement action for RSA GN model. Update following arrays:</span>
<span class="sd">    - link_slot_array</span>
<span class="sd">    - link_slot_departure_array</span>
<span class="sd">    - link_snr_array</span>
<span class="sd">    - modulation_format_index_array</span>
<span class="sd">    - channel_power_array</span>
<span class="sd">    - active_path_array</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        action (chex.Array): Action tuple (first is path action, second is launch_power)</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        EnvState: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span> <span class="o">=</span> <span class="n">action</span>
    <span class="n">path_action</span> <span class="o">=</span> <span class="n">path_action</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="n">k_path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path_action</span><span class="p">)</span>
    <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">get_lightpath_index</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">k_path_index</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">k_path_index</span><span class="p">]</span>
    <span class="n">launch_power</span> <span class="o">=</span> <span class="n">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path_action</span><span class="p">,</span> <span class="n">power_action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
    <span class="c1"># Update link_slot_array and link_slot_departure_array, then other arrays</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
        <span class="c1"># TODO - update this to use separate arrays to track channel centres and bandwidths and update with bandwidth (that may or may not equal slot size)</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">active_lightpaths_array</span><span class="o">=</span><span class="n">update_active_lightpaths_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="o">-</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">),</span>
            <span class="n">active_lightpaths_array_departure</span><span class="o">=</span><span class="n">update_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">current_time</span><span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="c1"># No need to check SNR until end of episode</span>
        <span class="k">return</span> <span class="n">state</span>
    <span class="c1"># Update link_snr_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_snr_array</span><span class="o">=</span><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.implement_action_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For use in RWALightpathReuseEnv.
Update link_slot_array and link_slot_departure_array to reflect new lightpath assignment.
Update link_capacity_array with new capacity if lightpath is available.
Undo link_capacity_update if over capacity.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For use in RWALightpathReuseEnv.</span>
<span class="sd">    Update link_slot_array and link_slot_departure_array to reflect new lightpath assignment.</span>
<span class="sd">    Update link_capacity_array with new capacity if lightpath is available.</span>
<span class="sd">    Undo link_capacity_update if over capacity.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        action: Action array</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span>
    <span class="n">lightpath_available_check</span><span class="p">,</span> <span class="n">lightpath_existing_check</span><span class="p">,</span> <span class="n">curr_lightpath_capacity</span><span class="p">,</span> <span class="n">lightpath_index</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">check_lightpath_available_and_existing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># Get path capacity - request</span>
    <span class="n">lightpath_capacity</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">lightpath_existing_check</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">curr_lightpath_capacity</span> <span class="o">-</span> <span class="n">requested_datarate</span><span class="p">,</span>  <span class="c1"># Subtract requested_datarate from current lightpath</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_capacity_array</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="n">requested_datarate</span><span class="p">,</span>  <span class="c1"># Get initial capacity of lightpath - request</span>
        <span class="n">lightpath_index</span>
    <span class="p">)</span>
    <span class="c1"># Update link_capacity_array with new capacity if lightpath is available</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">lightpath_available_check</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">link_capacity_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lightpath_capacity</span>
            <span class="p">),</span>
            <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">lightpath_index</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="n">state</span>
    <span class="p">)</span>
    <span class="n">capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;=</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">over_capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="c1"># Undo link_capacity_update if over capacity</span>
    <span class="c1"># N.B. this will fail if requested capacity is greater than total original capacity of lightpath</span>
    <span class="n">lightpath_capacity_before_action</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">lightpath_existing_check</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">curr_lightpath_capacity</span><span class="p">,</span>  <span class="c1"># Subtract requested_datarate from current lightpath</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span>  <span class="c1"># Empty slots have high capacity (1e6)</span>
        <span class="c1"># Get initial capacity of lightpath - request</span>
        <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_capacity_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">over_capacity_mask</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lightpath_capacity_before_action</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># Total mask will be 0 if space still available, -1 if capacity is zero or -2 if over capacity</span>
    <span class="n">total_mask</span> <span class="o">=</span> <span class="n">capacity_mask</span> <span class="o">+</span> <span class="n">over_capacity_mask</span>
    <span class="c1"># Update link_slot_array and link_slot_departure_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">total_mask</span><span class="p">,</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
                                                                 <span class="n">initial_slot_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                                                                 <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.implement_node_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_node_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">s_node</span><span class="p">,</span> <span class="n">d_node</span><span class="p">,</span> <span class="n">s_request</span><span class="p">,</span> <span class="n">d_request</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update node capacity, node resource and node departure arrays</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s_node</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>source node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_node</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>destination node</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>s_request</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>source node request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_request</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>destination node request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of nodes to implement. Defaults to 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>State</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">implement_node_action</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">s_node</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">d_node</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">s_request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">d_request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update node capacity, node resource and node departure arrays</span>

<span class="sd">    Args:</span>
<span class="sd">        state (State): current state</span>
<span class="sd">        s_node (int): source node</span>
<span class="sd">        d_node (int): destination node</span>
<span class="sd">        s_request (int): source node request</span>
<span class="sd">        d_request (int): destination node request</span>
<span class="sd">        n (int, optional): number of nodes to implement. Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        State: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">curr_selected_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># d_request -ve so that selected node is +ve (so that argmin works correctly for node resource array update)</span>
    <span class="c1"># curr_selected_nodes is N x 1 array, with requested node resources at index of selected node</span>
    <span class="n">curr_selected_nodes</span> <span class="o">=</span> <span class="n">update_node_array</span><span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">curr_selected_nodes</span><span class="p">,</span> <span class="n">d_node</span><span class="p">,</span> <span class="o">-</span><span class="n">d_request</span><span class="p">)</span>
    <span class="n">curr_selected_nodes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">update_node_array</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">curr_selected_nodes</span><span class="p">,</span> <span class="n">s_node</span><span class="p">,</span> <span class="o">-</span><span class="n">s_request</span><span class="p">))</span>

    <span class="n">node_capacity_array</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">-</span> <span class="n">curr_selected_nodes</span>

    <span class="n">node_resource_array</span> <span class="o">=</span> <span class="n">vmap_update_node_resources</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">curr_selected_nodes</span><span class="p">)</span>

    <span class="n">node_departure_array</span> <span class="o">=</span> <span class="n">vmap_update_node_departure</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">curr_selected_nodes</span><span class="p">,</span> <span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">current_time</span><span class="o">-</span><span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_capacity_array</span><span class="o">=</span><span class="n">node_capacity_array</span><span class="p">,</span>
        <span class="n">node_resource_array</span><span class="o">=</span><span class="n">node_resource_array</span><span class="p">,</span>
        <span class="n">node_departure_array</span><span class="o">=</span><span class="n">node_departure_array</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.implement_path_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update link-slot and link-slot departure arrays.
Times are set to negative until turned positive by finalisation (after checks).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to implement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_slot_index</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>initial slot index</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slots</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of slots to implement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update link-slot and link-slot departure arrays.</span>
<span class="sd">    Times are set to negative until turned positive by finalisation (after checks).</span>

<span class="sd">    Args:</span>
<span class="sd">        state (State): current state</span>
<span class="sd">        path (int): path to implement</span>
<span class="sd">        initial_slot_index (int): initial slot index</span>
<span class="sd">        num_slots (int): number of slots to implement</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">one</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span><span class="o">+</span><span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.implement_vone_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">implement_vone_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">total_actions</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Implement action to assign nodes (1, 2, or 0 nodes assigned per action) and assign slots and links for lightpath.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>action to implement (node, node, path_slot_action)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_actions</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>total number of actions to implement for current request</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining_actions</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>remaining actions to implement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of paths to consider</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>N</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of nodes to assign</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>updated state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">implement_vone_action</span><span class="p">(</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">total_actions</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
        <span class="n">remaining_actions</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span><span class="p">,</span>
        <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implement action to assign nodes (1, 2, or 0 nodes assigned per action) and assign slots and links for lightpath.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: current state</span>
<span class="sd">        action: action to implement (node, node, path_slot_action)</span>
<span class="sd">        total_actions: total number of actions to implement for current request</span>
<span class="sd">        remaining_actions: remaining actions to implement</span>
<span class="sd">        k: number of paths to consider</span>
<span class="sd">        N: number of nodes to assign</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: updated state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">((</span><span class="n">remaining_actions</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">node_request_s</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">node_request_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">action</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">action</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span>
    <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes</span><span class="p">)[</span><span class="n">path_index</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>

    <span class="c1"># jax.debug.print(&quot;state.request_array {}&quot;, state.request_array, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;path {}&quot;, path, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;slots {}&quot;, jnp.max(jnp.where(path.reshape(-1,1) == 1, state.link_slot_array, jnp.zeros(params.num_links).reshape(-1,1)), axis=0), ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;path_index {}&quot;, path_index, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;initial_slot_index {}&quot;, initial_slot_index, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;requested_datarate {}&quot;, requested_datarate, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;request {}&quot;, request, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;se {}&quot;, se, ordered=True)</span>
    <span class="c1"># jax.debug.print(&quot;num_slots {}&quot;, num_slots, ordered=True)</span>

    <span class="n">n_nodes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">total_actions</span> <span class="o">==</span> <span class="n">remaining_actions</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">(</span><span class="n">total_actions</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">))</span>
    <span class="n">path_action_only_check</span> <span class="o">=</span> <span class="n">path_action_only</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
        <span class="n">path_action_only_check</span><span class="p">,</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">implement_node_action</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">node_request_s</span><span class="p">,</span> <span class="n">node_request_d</span><span class="p">,</span> <span class="n">n_nodes</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">implement_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_action_counter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_action_counter</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize action counter.
First index is num unique nodes, second index is total steps, final is remaining steps until completion of request.
Only used in VONE environments.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_action_counter</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize action counter.</span>
<span class="sd">    First index is num unique nodes, second index is total steps, final is remaining steps until completion of request.</span>
<span class="sd">    Only used in VONE environments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_action_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_action_history</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize action history</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_action_history</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize action history&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_edges</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_active_lightpaths_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_active_lightpaths_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise active lightpath array. Stores path indices of all active paths on the network in a 1 x M array.
M is MIN(max_requests, num_links * link_resources / min_slots).
min_slots is the minimum number of slots required for a lightpath i.e. max(values_bw)/ slot_size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Active path array (default value -1, empty path)</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_active_lightpaths_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise active lightpath array. Stores path indices of all active paths on the network in a 1 x M array.</span>
<span class="sd">    M is MIN(max_requests, num_links * link_resources / min_slots).</span>
<span class="sd">    min_slots is the minimum number of slots required for a lightpath i.e. max(values_bw)/ slot_size.</span>

<span class="sd">    Args:</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Active path array (default value -1, empty path)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_slots</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>  <span class="c1"># total slots on networks</span>
    <span class="n">min_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span>  <span class="c1"># minimum number of slots required for lightpath</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">total_slots</span> <span class="o">/</span> <span class="n">min_slots</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_active_lightpaths_array_departure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise active lightpath array. Stores path indices of all active paths on the network in a 1 x M array.
M is MIN(max_requests, num_links * link_resources / min_slots).
min_slots is the minimum number of slots required for a lightpath i.e. max(values_bw)/ slot_size.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Active path array (default value -1, empty path)</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise active lightpath array. Stores path indices of all active paths on the network in a 1 x M array.</span>
<span class="sd">    M is MIN(max_requests, num_links * link_resources / min_slots).</span>
<span class="sd">    min_slots is the minimum number of slots required for a lightpath i.e. max(values_bw)/ slot_size.</span>

<span class="sd">    Args:</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Active path array (default value -1, empty path)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_slots</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>  <span class="c1"># total slots on networks</span>
    <span class="n">min_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span>  <span class="c1"># minimum number of slots required for lightpath</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">total_slots</span> <span class="o">/</span> <span class="n">min_slots</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_active_path_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_active_path_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise active path array. Stores details of full path utilised by lightpath on each frequency slot.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Active path array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_active_path_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise active path array. Stores details of full path utilised by lightpath on each frequency slot.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Active path array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_channel_centre_bw_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise channel centre array.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Channel centre array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_channel_centre_bw_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise channel centre array.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Channel centre array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_channel_power_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise channel power array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Channel power array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_channel_power_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise channel power array.</span>

<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Channel power array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_graph_tuple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">adj</span><span class="p">,</span> <span class="n">exclude_source_dest</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise graph tuple for use with Jraph GNNs.
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
    adj (jnp.array): Adjacency matrix of the graph
Returns:
    jraph.GraphsTuple: Graph tuple</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">adj</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">exclude_source_dest</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise graph tuple for use with Jraph GNNs.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">        adj (jnp.array): Adjacency matrix of the graph</span>
<span class="sd">    Returns:</span>
<span class="sd">        jraph.GraphsTuple: Graph tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">senders</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">receivers</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Get source and dest from request array</span>
    <span class="n">source_dest</span><span class="p">,</span> <span class="n">datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="c1"># Global feature is normalised data rate of current request</span>
    <span class="nb">globals</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datarate</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">exclude_source_dest</span><span class="p">:</span>
        <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">source_dest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source_dest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="c1"># One-hot encode source and destination (2 additional features)</span>
        <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
        <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">source_dest_features</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">source</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">source_dest_features</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dest</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">spectral_features</span> <span class="o">=</span> <span class="n">get_spectral_features</span><span class="p">(</span><span class="n">adj</span><span class="p">,</span> <span class="n">num_features</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># For dynamic traffic, edge_features are normalised remaining holding time instead of link_slot_array</span>
    <span class="n">holding_time_edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RSAGNModelEnvParams&quot;</span><span class="p">,</span> <span class="s2">&quot;RMSAGNModelEnvParams&quot;</span><span class="p">]:</span>
        <span class="c1"># Normalize by max parameters (converted to linear units)</span>
        <span class="n">max_power</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">from_dbm</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_power</span><span class="p">)</span>
        <span class="n">normalized_power</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span> <span class="o">/</span> <span class="n">max_power</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">max_snr</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">from_db</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_snr</span><span class="p">)</span>
        <span class="n">normalized_snr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span> <span class="o">/</span> <span class="n">max_snr</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">normalized_snr</span><span class="p">,</span> <span class="n">normalized_power</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;VONEEnvParams&quot;</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span> <span class="o">&gt;</span> <span class="mf">1e5</span> <span class="k">else</span> <span class="n">holding_time_edge_features</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;node_capacity_array&quot;</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">))</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">node_features</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">node_features</span><span class="p">,</span> <span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span> <span class="o">&gt;</span> <span class="mf">1e5</span> <span class="k">else</span> <span class="n">holding_time_edge_features</span>
        <span class="c1"># [n_edges] or [n_edges, ...]</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">disable_node_features</span><span class="p">:</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="c1"># Handle undirected graphs (duplicate edges after normalization)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">:</span>
        <span class="n">senders_</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">senders</span><span class="p">,</span> <span class="n">receivers</span><span class="p">])</span>
        <span class="n">receivers</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">receivers</span><span class="p">,</span> <span class="n">senders</span><span class="p">])</span>
        <span class="n">senders</span> <span class="o">=</span> <span class="n">senders_</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">edge_features</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jraph</span><span class="o">.</span><span class="n">GraphsTuple</span><span class="p">(</span>
        <span class="n">nodes</span><span class="o">=</span><span class="n">node_features</span><span class="p">,</span>
        <span class="n">edges</span><span class="o">=</span><span class="n">edge_features</span><span class="p">,</span>
        <span class="n">senders</span><span class="o">=</span><span class="n">senders</span><span class="p">,</span>
        <span class="n">receivers</span><span class="o">=</span><span class="n">receivers</span><span class="p">,</span>
        <span class="n">n_node</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="n">n_edge</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">senders</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)),</span>
        <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_link_capacity_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_capacity_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise link capacity array. Represents available data rate for lightpath on each link.
Default is high value (1e6) for unoccupied slots. Once lightpath established, capacity is determined by
corresponding entry in path capacity array.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_link_capacity_array</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise link capacity array. Represents available data rate for lightpath on each link.</span>
<span class="sd">    Default is high value (1e6) for unoccupied slots. Once lightpath established, capacity is determined by</span>
<span class="sd">    corresponding entry in path capacity array.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="mf">1e6</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_link_length_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_length_array</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise link length array.
Args:
    graph (nx.Graph): NetworkX graph
Returns:</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_link_length_array</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise link length array.</span>
<span class="sd">    Args:</span>
<span class="sd">        graph (nx.Graph): NetworkX graph</span>
<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">):</span>
        <span class="n">link_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">link_lengths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_link_length_array_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_length_array_gn_model</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">max_span_length</span><span class="p">,</span> <span class="n">max_spans</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise link length array for environements that use GN model of physical layer.
We assume each link has spans of equal length.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NetworkX graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Link length array (L x max_spans)</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_link_length_array_gn_model</span><span class="p">(</span><span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span> <span class="n">max_span_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>  <span class="n">max_spans</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise link length array for environements that use GN model of physical layer.</span>
<span class="sd">    We assume each link has spans of equal length.</span>

<span class="sd">    Args:</span>
<span class="sd">        graph (nx.Graph): NetworkX graph</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Link length array (L x max_spans)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_lengths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">directed</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">is_directed</span><span class="p">()</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">to_undirected</span><span class="p">()</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
        <span class="n">link_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">directed</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">link_lengths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s2">&quot;weight&quot;</span><span class="p">])</span>
    <span class="n">span_length_array</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">link_lengths</span><span class="p">:</span>
        <span class="n">num_spans</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">length</span> <span class="o">/</span> <span class="n">max_span_length</span><span class="p">)</span>
        <span class="n">avg_span_length</span> <span class="o">=</span> <span class="n">length</span> <span class="o">/</span> <span class="n">num_spans</span>
        <span class="n">span_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">avg_span_length</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_spans</span>
        <span class="n">span_lengths</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_spans</span> <span class="o">-</span> <span class="n">num_spans</span><span class="p">))</span>
        <span class="n">span_length_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">span_lengths</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">span_length_array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_link_slot_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_slot_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize empty (all zeroes) link-slot array. 0 means slot is free, -1 means occupied.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Link slot array (E x S) where E is number of edges and S is number of slots</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_link_slot_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize empty (all zeroes) link-slot array. 0 means slot is free, -1 means occupied.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Link slot array (E x S) where E is number of edges and S is number of slots&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_link_slot_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize link mask</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_link_slot_mask</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">agg</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize link mask&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">/</span> <span class="n">agg</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_link_snr_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise signal-to-noise ratio (SNR) array.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: SNR array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_link_snr_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise signal-to-noise ratio (SNR) array.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: SNR array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The SNR is kept in linear units to allow summation of 1/SNR across links</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="o">-</span><span class="mf">1e5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_mod_format_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_mod_format_mask</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize link mask</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_mod_format_mask</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize link mask&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,),</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_modulation_format_index_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_modulation_format_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise modulation format index array.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Modulation format index array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_modulation_format_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise modulation format index array.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Modulation format index array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>  <span class="c1"># -1 so that highest order is assumed (closest to Gaussian)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_modulations_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_modulations_array</span><span class="p">(</span><span class="n">modulations_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise array of maximum spectral efficiency for modulation format on path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>modulations_filepath</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to CSV file containing modulation formats. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    jnp.array: Array of maximum spectral efficiency for modulation format on path.
    First two columns are maximum path length and spectral efficiency.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_modulations_array</span><span class="p">(</span><span class="n">modulations_filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise array of maximum spectral efficiency for modulation format on path.</span>

<span class="sd">    Args:</span>
<span class="sd">        modulations_filepath (str, optional): Path to CSV file containing modulation formats. Defaults to None.</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Array of maximum spectral efficiency for modulation format on path.</span>
<span class="sd">        First two columns are maximum path length and spectral efficiency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">modulations_filepath</span><span class="p">)</span> <span class="k">if</span> <span class="n">modulations_filepath</span> <span class="k">else</span> <span class="p">(</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;modulations&quot;</span> <span class="o">/</span> <span class="s2">&quot;modulations.csv&quot;</span><span class="p">)</span>
    <span class="n">modulations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="c1"># Drop empty first row (headers) and column (name)</span>
    <span class="n">modulations</span> <span class="o">=</span> <span class="n">modulations</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modulations</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_node_capacity_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_node_capacity_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize node array with uniform resources.
Args:
    params (EnvParams): Environment parameters
Returns:
    jnp.array: Node capacity array (N x 1) where N is number of nodes</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_node_capacity_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize node array with uniform resources.</span>
<span class="sd">    Args:</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Node capacity array (N x 1) where N is number of nodes&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">params</span><span class="o">.</span><span class="n">node_resources</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_node_mask" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_node_mask</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize node mask</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_node_mask</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize node mask&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_node_resource_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_node_resource_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Array to track node resources occupied by virtual nodes</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_node_resource_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Array to track node resources occupied by virtual nodes&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">node_resources</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_path_capacity_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_capacity_array</span><span class="p">(</span><span class="n">link_length_array</span><span class="p">,</span> <span class="n">path_link_array</span><span class="p">,</span> <span class="n">min_request</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">,</span> <span class="n">NF</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="mf">10000000000000.0</span><span class="p">,</span> <span class="n">R_s</span><span class="o">=</span><span class="mf">100000000000.0</span><span class="p">,</span> <span class="n">beta_2</span><span class="o">=-</span><span class="mf">2.17e-26</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.0012</span><span class="p">,</span> <span class="n">L_s</span><span class="o">=</span><span class="mf">100000.0</span><span class="p">,</span> <span class="n">lambda0</span><span class="o">=</span><span class="mf">1.55e-06</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculated from Nevin paper:
https://api.repository.cam.ac.uk/server/api/core/bitstreams/b80e7a9c-a86b-4b30-a6d6-05017c60b0c8/content</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_length_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of link lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_link_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of links on paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_request</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum data rate request size. Defaults to 100 GBps.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale_factor</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Scale factor for link capacity. Defaults to 1.0.</p>
              </div>
            </td>
            <td>
                  <code>1.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fibre attenuation coefficient. Defaults to 0.2e-3 /m</p>
              </div>
            </td>
            <td>
                  <code>0.0002</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>NF</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Amplifier noise figure. Defaults to 4.5 dB.</p>
              </div>
            </td>
            <td>
                  <code>4.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>B</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total modulated bandwidth. Defaults to 10e12 Hz.</p>
              </div>
            </td>
            <td>
                  <code>10000000000000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>R_s</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Symbol rate. Defaults to 100e9 Baud.</p>
              </div>
            </td>
            <td>
                  <code>100000000000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta_2</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dispersion parameter. Defaults to -21.7e-27 s^2/m.</p>
              </div>
            </td>
            <td>
                  <code>-2.17e-26</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Nonlinear coefficient. Defaults to 1.2e-3 /W/m.</p>
              </div>
            </td>
            <td>
                  <code>0.0012</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>L_s</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Span length. Defaults to 100e3 m.</p>
              </div>
            </td>
            <td>
                  <code>100000.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lambda0</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wavelength. Defaults to 1550e-9 m.</p>
              </div>
            </td>
            <td>
                  <code>1.55e-06</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Array of link capacities in Gbps</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_capacity_array</span><span class="p">(</span>
        <span class="n">link_length_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
        <span class="n">min_request</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Minimum data rate request size</span>
        <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># Scale factor for link capacity</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2e-3</span><span class="p">,</span>  <span class="c1"># Fibre attenuation coefficient</span>
        <span class="n">NF</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>  <span class="c1"># Amplifier noise figure</span>
        <span class="n">B</span><span class="o">=</span><span class="mf">10e12</span><span class="p">,</span>  <span class="c1"># Total modulated bandwidth</span>
        <span class="n">R_s</span><span class="o">=</span><span class="mf">100e9</span><span class="p">,</span>  <span class="c1"># Symbol rate</span>
        <span class="n">beta_2</span><span class="o">=-</span><span class="mf">21.7e-27</span><span class="p">,</span>  <span class="c1"># Dispersion parameter</span>
        <span class="n">gamma</span><span class="o">=</span><span class="mf">1.2e-3</span><span class="p">,</span>  <span class="c1"># Nonlinear coefficient</span>
        <span class="n">L_s</span><span class="o">=</span><span class="mf">100e3</span><span class="p">,</span>  <span class="c1"># span length</span>
        <span class="n">lambda0</span><span class="o">=</span><span class="mf">1550e-9</span><span class="p">,</span>  <span class="c1"># Wavelength</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculated from Nevin paper:</span>
<span class="sd">    https://api.repository.cam.ac.uk/server/api/core/bitstreams/b80e7a9c-a86b-4b30-a6d6-05017c60b0c8/content</span>

<span class="sd">    Args:</span>
<span class="sd">        link_length_array (chex.Array): Array of link lengths</span>
<span class="sd">        path_link_array (chex.Array): Array of links on paths</span>
<span class="sd">        min_request (int, optional): Minimum data rate request size. Defaults to 100 GBps.</span>
<span class="sd">        scale_factor (float, optional): Scale factor for link capacity. Defaults to 1.0.</span>
<span class="sd">        alpha (float, optional): Fibre attenuation coefficient. Defaults to 0.2e-3 /m</span>
<span class="sd">        NF (float, optional): Amplifier noise figure. Defaults to 4.5 dB.</span>
<span class="sd">        B (float, optional): Total modulated bandwidth. Defaults to 10e12 Hz.</span>
<span class="sd">        R_s (float, optional): Symbol rate. Defaults to 100e9 Baud.</span>
<span class="sd">        beta_2 (float, optional): Dispersion parameter. Defaults to -21.7e-27 s^2/m.</span>
<span class="sd">        gamma (float, optional): Nonlinear coefficient. Defaults to 1.2e-3 /W/m.</span>
<span class="sd">        L_s (float, optional): Span length. Defaults to 100e3 m.</span>
<span class="sd">        lambda0 (float, optional): Wavelength. Defaults to 1550e-9 m.</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Array of link capacities in Gbps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_length_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">link_length_array</span><span class="p">)</span>
    <span class="n">path_capacity_array</span> <span class="o">=</span> <span class="n">calculate_path_capacity</span><span class="p">(</span>
        <span class="n">path_length_array</span><span class="p">,</span>
        <span class="n">min_request</span><span class="o">=</span><span class="n">min_request</span><span class="p">,</span>
        <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">NF</span><span class="o">=</span><span class="n">NF</span><span class="p">,</span>
        <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">,</span>
        <span class="n">R_s</span><span class="o">=</span><span class="n">R_s</span><span class="p">,</span>
        <span class="n">beta_2</span><span class="o">=</span><span class="n">beta_2</span><span class="p">,</span>
        <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
        <span class="n">L_s</span><span class="o">=</span><span class="n">L_s</span><span class="p">,</span>
        <span class="n">lambda0</span><span class="o">=</span><span class="n">lambda0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">path_capacity_array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_path_index_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise path index array. Represents index of lightpath occupying each slot.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_index_array</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise path index array. Represents index of lightpath occupying each slot.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_path_length_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_length_array</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise path length array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_link_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path-link array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NetworkX graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    chex.Array: Path length array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_length_array</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise path length array.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_link_array (chex.Array): Path-link array</span>
<span class="sd">        graph (nx.Graph): NetworkX graph</span>
<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Path length array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">link_length_array</span> <span class="o">=</span> <span class="n">init_link_length_array</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
    <span class="n">path_lengths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path_link_array</span><span class="p">,</span> <span class="n">link_length_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_lengths</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_path_link_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_link_array</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">disjoint</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">modulations_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rwa_lr</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">path_snr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise path-link array.
Each path is defined by a link utilisation array (one row in the path-link array).
1 indicates link corresponding to index is used, 0 indicates not used.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>graph</code>
            </td>
            <td>
                  <code><span title="networkx.Graph">Graph</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>NetworkX graph</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>disjoint</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use edge-disjoint paths. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weight</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sort paths by edge attribute. Defaults to "weight".</p>
              </div>
            </td>
            <td>
                  <code>&#39;weight&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directed</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether graph is directed. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modulations_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of maximum spectral efficiency for modulation format on path. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rwa_lr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the environment is RWA with lightpath reuse (affects path ordering).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_snr</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If GN model is used, include extra row of zeroes for unutilised paths</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Path-link array (N(N-1)*k x E) where N is number of nodes, E is number of edges, k is number of shortest paths</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_link_array</span><span class="p">(</span>
        <span class="n">graph</span><span class="p">:</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">,</span>
        <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">disjoint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">weight</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span>
        <span class="n">directed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">modulations_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">rwa_lr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="n">path_snr</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise path-link array.</span>
<span class="sd">    Each path is defined by a link utilisation array (one row in the path-link array).</span>
<span class="sd">    1 indicates link corresponding to index is used, 0 indicates not used.</span>

<span class="sd">    Args:</span>
<span class="sd">        graph (nx.Graph): NetworkX graph</span>
<span class="sd">        k (int): Number of paths</span>
<span class="sd">        disjoint (bool, optional): Whether to use edge-disjoint paths. Defaults to False.</span>
<span class="sd">        weight (str, optional): Sort paths by edge attribute. Defaults to &quot;weight&quot;.</span>
<span class="sd">        directed (bool, optional): Whether graph is directed. Defaults to False.</span>
<span class="sd">        modulations_array (chex.Array, optional): Array of maximum spectral efficiency for modulation format on path. Defaults to None.</span>
<span class="sd">        rwa_lr (bool, optional): Whether the environment is RWA with lightpath reuse (affects path ordering).</span>
<span class="sd">        path_snr (bool, optional): If GN model is used, include extra row of zeroes for unutilised paths</span>
<span class="sd">        to ensure correct SNR calculation for empty paths (path index -1).</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Path-link array (N(N-1)*k x E) where N is number of nodes, E is number of edges, k is number of shortest paths</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_k_shortest_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">islice</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_simple_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">),</span> <span class="n">k</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_k_disjoint_shortest_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
        <span class="n">k_paths_disjoint_unsorted</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">edge_disjoint_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
        <span class="n">k_paths_shortest</span> <span class="o">=</span> <span class="n">get_k_shortest_paths</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>

        <span class="c1"># Keep disjoint paths and add unique shortest paths until k paths reached</span>
        <span class="n">disjoint_ids</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">k_paths_disjoint_unsorted</span><span class="p">]</span>
        <span class="n">k_paths</span> <span class="o">=</span> <span class="n">k_paths_disjoint_unsorted</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">k_paths_shortest</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">disjoint_ids</span><span class="p">:</span>
                <span class="n">k_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">k_paths</span> <span class="o">=</span> <span class="n">k_paths</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">k_paths</span>

    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

    <span class="c1"># Get the k-shortest paths for each node pair</span>
    <span class="n">k_path_collections</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">get_paths</span> <span class="o">=</span> <span class="n">get_k_disjoint_shortest_paths</span> <span class="k">if</span> <span class="n">disjoint</span> <span class="k">else</span> <span class="n">get_k_shortest_paths</span>
    <span class="k">for</span> <span class="n">node_pair</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>

        <span class="n">k_paths</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">node_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">k_path_collections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_paths</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">directed</span><span class="p">:</span>  <span class="c1"># Get paths in reverse direction</span>
        <span class="k">for</span> <span class="n">node_pair</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">k_paths_rev</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">node_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">node_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>
            <span class="n">k_path_collections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_paths_rev</span><span class="p">)</span>

    <span class="c1"># Sort the paths for each node pair</span>
    <span class="n">max_missing_paths</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">k_paths</span> <span class="ow">in</span> <span class="n">k_path_collections</span><span class="p">:</span>

        <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">k_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">k_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Sort the paths by # of hops then by length, or just length</span>
        <span class="n">path_lengths</span> <span class="o">=</span> <span class="p">[</span><span class="n">nx</span><span class="o">.</span><span class="n">path_weight</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">k_paths</span><span class="p">]</span>
        <span class="n">path_num_links</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">k_paths</span><span class="p">]</span>

        <span class="c1"># Get maximum spectral efficiency for modulation format on path</span>
        <span class="k">if</span> <span class="n">modulations_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rwa_lr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">se_of_path</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">modulations_array</span> <span class="o">=</span> <span class="n">modulations_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">path_lengths</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">modulation</span> <span class="ow">in</span> <span class="n">modulations_array</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="n">modulation</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">se_of_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modulation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">break</span>
            <span class="c1"># Sorting by the num_links/se instead of just path length is observed to improve performance</span>
            <span class="n">path_weighting</span> <span class="o">=</span> <span class="p">[</span><span class="n">num_links</span><span class="o">/</span><span class="n">se</span> <span class="k">for</span> <span class="n">se</span><span class="p">,</span> <span class="n">num_links</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">se_of_path</span><span class="p">,</span> <span class="n">path_num_links</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">rwa_lr</span><span class="p">:</span>
            <span class="n">path_capacity</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">calculate_path_capacity</span><span class="p">(</span><span class="n">path_length</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">))</span> <span class="k">for</span> <span class="n">path_length</span> <span class="ow">in</span> <span class="n">path_lengths</span><span class="p">]</span>
            <span class="n">path_weighting</span> <span class="o">=</span> <span class="p">[</span><span class="n">num_links</span><span class="o">/</span><span class="n">path_capacity</span> <span class="k">for</span> <span class="n">num_links</span><span class="p">,</span> <span class="n">path_capacity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path_num_links</span><span class="p">,</span> <span class="n">path_capacity</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path_weighting</span> <span class="o">=</span> <span class="n">path_num_links</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">path_weighting</span> <span class="o">=</span> <span class="n">path_lengths</span>

        <span class="c1"># if less then k unique paths, add empty paths</span>
        <span class="n">empty_path</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">num_missing_paths</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">k_paths</span><span class="p">)</span>
        <span class="n">max_missing_paths</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_missing_paths</span><span class="p">,</span> <span class="n">num_missing_paths</span><span class="p">)</span>
        <span class="n">k_paths</span> <span class="o">=</span> <span class="n">k_paths</span> <span class="o">+</span> <span class="p">[</span><span class="n">empty_path</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_missing_paths</span>
        <span class="n">path_weighting</span> <span class="o">=</span> <span class="n">path_weighting</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1e6</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_missing_paths</span>
        <span class="n">path_lengths</span> <span class="o">=</span> <span class="n">path_lengths</span> <span class="o">+</span> <span class="p">[</span><span class="mf">1e6</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_missing_paths</span>

        <span class="c1"># Sort by number of links then by length (or just by length if weight is specified)</span>
        <span class="n">unsorted_paths</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">path_weighting</span><span class="p">,</span> <span class="n">path_lengths</span><span class="p">)</span>
        <span class="n">k_paths_sorted</span> <span class="o">=</span> <span class="p">[(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">weighting</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">weighting</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">unsorted_paths</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="n">weight</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span>

        <span class="c1"># Keep only first k paths</span>
        <span class="n">k_paths_sorted</span> <span class="o">=</span> <span class="n">k_paths_sorted</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>

        <span class="n">prev_link_usage</span> <span class="o">=</span> <span class="n">empty_path</span>
        <span class="k">for</span> <span class="n">k_path</span> <span class="ow">in</span> <span class="n">k_paths_sorted</span><span class="p">:</span>
            <span class="n">k_path</span> <span class="o">=</span> <span class="n">k_path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">link_usage</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>  <span class="c1"># Initialise empty path</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">k_path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">link_usage</span> <span class="o">=</span> <span class="n">prev_link_usage</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k_path</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">s</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">k_path</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k_path</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">edge</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
                        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span><span class="p">)</span> <span class="k">if</span> <span class="n">directed</span> <span class="k">else</span> \
                            <span class="p">((</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span> <span class="ow">and</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span> <span class="ow">and</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
                            <span class="n">link_usage</span><span class="p">[</span><span class="n">edge_index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">link_usage</span>
            <span class="n">prev_link_usage</span> <span class="o">=</span> <span class="n">link_usage</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c1"># If using GN model, add extra row of zeroes for empty paths for SNR calculation</span>
    <span class="k">if</span> <span class="n">path_snr</span><span class="p">:</span>
        <span class="n">empty_path</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">empty_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_path_se_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_path_se_array</span><span class="p">(</span><span class="n">path_length_array</span><span class="p">,</span> <span class="n">modulations_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise array of maximum spectral efficiency for highest-order modulation format on path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_length_array</code>
            </td>
            <td>
                  <code><span title="jax.numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of path lengths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modulations_array</code>
            </td>
            <td>
                  <code><span title="jax.numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of maximum spectral efficiency for modulation format on path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: Array of maximum spectral efficiency for on path</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_path_se_array</span><span class="p">(</span><span class="n">path_length_array</span><span class="p">,</span> <span class="n">modulations_array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise array of maximum spectral efficiency for highest-order modulation format on path.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_length_array (jnp.array): Array of path lengths</span>
<span class="sd">        modulations_array (jnp.array): Array of maximum spectral efficiency for modulation format on path</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Array of maximum spectral efficiency for on path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">se_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Flip the modulation array so that the shortest path length is first</span>
    <span class="n">modulations_array</span> <span class="o">=</span> <span class="n">modulations_array</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">path_length_array</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">modulation</span> <span class="ow">in</span> <span class="n">modulations_array</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="n">modulation</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">se_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modulation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">se_list</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_rsa_request_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_rsa_request_array</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize request array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_rsa_request_array</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize request array&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_traffic_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_traffic_matrix</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize traffic matrix. Allows for random traffic matrix or uniform traffic matrix.
Source-dest traffic requests are sampled probabilistically from the resulting traffic matrix.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.PRNGKey">PRNGKey</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>PRNG key</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>jnp.array: Traffic matrix</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_traffic_matrix</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize traffic matrix. Allows for random traffic matrix or uniform traffic matrix.</span>
<span class="sd">    Source-dest traffic requests are sampled probabilistically from the resulting traffic matrix.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (chex.PRNGKey): PRNG key</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Traffic matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">random_traffic</span><span class="p">:</span>
        <span class="n">traffic_matrix</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">traffic_matrix</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="n">diag_elements</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag_indices_from</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">)</span>
    <span class="c1"># Set main diagonal to zero so no requests from node to itself</span>
    <span class="n">traffic_matrix</span> <span class="o">=</span> <span class="n">traffic_matrix</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">diag_elements</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">traffic_matrix</span> <span class="o">=</span> <span class="n">normalise_traffic_matrix</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">traffic_matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_transceiver_amplifier_noise_arrays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_transceiver_amplifier_noise_arrays</span><span class="p">(</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">ref_lambda</span><span class="p">,</span> <span class="n">slot_size</span><span class="p">,</span> <span class="n">noise_data_filepath</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise transceiver and amplifier noise arrays.
Args:
    link_resources (int): Number of link resources
    ref_lambda (float): Reference wavelength
    slot_size (float): Slot size
    noise_data_filepath (str, optional): Path to CSV file containing modulation formats. Defaults to None.
Returns:
    Tuple[chex.Array, chex.Array]: Transceiver noise array, Amplifier noise array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_transceiver_amplifier_noise_arrays</span><span class="p">(</span>
        <span class="n">link_resources</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">ref_lambda</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">slot_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">noise_data_filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise transceiver and amplifier noise arrays.</span>
<span class="sd">    Args:</span>
<span class="sd">        link_resources (int): Number of link resources</span>
<span class="sd">        ref_lambda (float): Reference wavelength</span>
<span class="sd">        slot_size (float): Slot size</span>
<span class="sd">        noise_data_filepath (str, optional): Path to CSV file containing modulation formats. Defaults to None.</span>
<span class="sd">    Returns:</span>
<span class="sd">        Tuple[chex.Array, chex.Array]: Transceiver noise array, Amplifier noise array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">noise_data_filepath</span><span class="p">)</span> <span class="k">if</span> <span class="n">noise_data_filepath</span> <span class="k">else</span> <span class="p">(</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;gn_model&quot;</span> <span class="o">/</span> <span class="s2">&quot;transceiver_amplifier_data.csv&quot;</span><span class="p">)</span>
    <span class="n">noise_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="c1"># Drop empty first row (headers) and column (name)</span>
    <span class="n">noise_data</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>
    <span class="c1"># Columns are: wavelength_min_nm,wavelength_max_nm,frequency_min_ghz,frequency_max_ghz,NF_ASE_dB,SNR_TRX_dB</span>
    <span class="n">frequency_min_ghz</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">frequency_max_ghz</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">amplifier_noise_db</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span>  <span class="c1"># NF_ASE_dB</span>
    <span class="n">transceiver_snr_db</span> <span class="o">=</span> <span class="n">noise_data</span><span class="p">[:,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1"># SNR_TRX_dB</span>

    <span class="c1"># Define slot centres in GHz relative to central wavelength</span>
    <span class="n">slot_centres</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">link_resources</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">link_resources</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">slot_size</span>

    <span class="c1"># Transform relative slot centres to absolute frequencies in GHz</span>
    <span class="n">ref_frequency_ghz</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="n">ref_lambda</span> <span class="o">/</span> <span class="mf">1e9</span>
    <span class="n">slot_frequencies_ghz</span> <span class="o">=</span> <span class="n">ref_frequency_ghz</span> <span class="o">+</span> <span class="n">slot_centres</span>

    <span class="c1"># Initialize output arrays</span>
    <span class="n">transceiver_snr_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">link_resources</span><span class="p">)</span>
    <span class="n">amplifier_noise_figure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">link_resources</span><span class="p">)</span>

    <span class="c1"># For each slot, find which band it belongs to</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">slot_frequencies_ghz</span><span class="p">):</span>
        <span class="c1"># Find the band this frequency falls into</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frequency_min_ghz</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">frequency_min_ghz</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">freq</span> <span class="o">&lt;=</span> <span class="n">frequency_max_ghz</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="n">transceiver_snr_array</span> <span class="o">=</span> <span class="n">transceiver_snr_array</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">transceiver_snr_db</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">amplifier_noise_figure_array</span> <span class="o">=</span> <span class="n">amplifier_noise_figure_array</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">amplifier_noise_db</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If frequency is outside all bands, could raise error or use default</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frequency </span><span class="si">{</span><span class="n">freq</span><span class="si">}</span><span class="s2"> GHz is outside the defined bands&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">transceiver_snr_array</span><span class="p">,</span> <span class="n">amplifier_noise_figure_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_virtual_topology_patterns" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_virtual_topology_patterns</span><span class="p">(</span><span class="n">pattern_names</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialise virtual topology patterns.
First 3 digits comprise the "action counter": first index is num unique nodes, second index is total steps,
final is remaining steps until completion of request.
Remaining digits define the topology pattern, with 1 to indicate links and other positive integers are node indices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pattern_names</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of virtual topology pattern names</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Array of virtual topology patterns</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_virtual_topology_patterns</span><span class="p">(</span><span class="n">pattern_names</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialise virtual topology patterns.</span>
<span class="sd">    First 3 digits comprise the &quot;action counter&quot;: first index is num unique nodes, second index is total steps,</span>
<span class="sd">    final is remaining steps until completion of request.</span>
<span class="sd">    Remaining digits define the topology pattern, with 1 to indicate links and other positive integers are node indices.</span>

<span class="sd">    Args:</span>
<span class="sd">        pattern_names (list): List of virtual topology pattern names</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Array of virtual topology patterns</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">patterns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># TODO - Allow 2 node requests in VONE (check if any modifications necessary other than below)</span>
    <span class="c1">#if &quot;2_bus&quot; in pattern_names:</span>
    <span class="c1">#    patterns.append([2, 1, 1, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0])</span>
    <span class="k">if</span> <span class="s2">&quot;3_bus&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;3_ring&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;4_bus&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;4_ring&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;5_bus&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;5_ring&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="s2">&quot;6_bus&quot;</span> <span class="ow">in</span> <span class="n">pattern_names</span><span class="p">:</span>
        <span class="n">patterns</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
    <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">])</span>
    <span class="c1"># Pad patterns with zeroes to match longest</span>
    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
        <span class="n">pattern</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">max_length</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">pattern</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">patterns</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">SMALL_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.init_vone_request_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_vone_request_array</span><span class="p">(</span><span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Initialize request array either with uniform resources</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">init_vone_request_array</span><span class="p">(</span><span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize request array either with uniform resources&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">max_edges</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.kca_ff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kca_ff</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Congestion-aware First Fit. Only suitable for RSA/RMSA.
Method:</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">kca_ff</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Congestion-aware First Fit. Only suitable for RSA/RMSA.</span>
<span class="sd">    Method:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Get index of first available slots for each path</span>
    <span class="n">first_slots</span> <span class="o">=</span> <span class="n">first_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Get nodes</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="c1"># Initialise array to hold congestion on each path</span>
    <span class="n">path_congestion_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">link_weights</span> <span class="o">=</span> <span class="n">get_link_weights</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_path_congestion</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Get links on path</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># Get congestion</span>
        <span class="n">path_link_congestion</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">link_weights</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">path_congestion</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">path_link_congestion</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">path_congestion</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,))</span>

    <span class="n">path_congestion_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">get_path_congestion</span><span class="p">,</span> <span class="n">path_congestion_array</span><span class="p">)</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">path_congestion_array</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.kmc_ff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kmc_ff</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>K-Minimum Cut. Only suitable for RSA/RMSA.
Method:
1. Go through action mask and find the first available slot on all paths.
2. For each path, allocate the first available slot.
3. Sum number of new consecutive zero regions (cuts) created by assignment (on each link)
4. Choose path that creates the fewest cuts.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">kmc_ff</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;K-Minimum Cut. Only suitable for RSA/RMSA.</span>
<span class="sd">    Method:</span>
<span class="sd">    1. Go through action mask and find the first available slot on all paths.</span>
<span class="sd">    2. For each path, allocate the first available slot.</span>
<span class="sd">    3. Sum number of new consecutive zero regions (cuts) created by assignment (on each link)</span>
<span class="sd">    4. Choose path that creates the fewest cuts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">first_slots</span> <span class="o">=</span> <span class="n">first_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">link_slot_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_bw</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">block_sizes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">find_block_sizes</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="n">block_sizes_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">block_sizes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>  <span class="c1"># Binary array showing initial block starts</span>
    <span class="n">block_count</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">block_sizes_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_cuts_on_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_bw</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="c1"># Make link-slot_array positive</span>
        <span class="n">updated_slots</span> <span class="o">=</span> <span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">updated_block_sizes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">find_block_sizes</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">updated_slots</span><span class="p">)</span>
        <span class="n">updated_block_sizes_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_block_sizes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Binary array showing updated block starts</span>
        <span class="n">updated_block_count</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">updated_block_sizes_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">num_cuts</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">initial_slot_index</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># If true, no valid action for path</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,),</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>  <span class="c1"># Return max no. of cuts</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">updated_block_count</span> <span class="o">-</span> <span class="n">block_count</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span>  <span class="c1"># Else, return number of cuts</span>
            <span class="mf">1.</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">num_cuts</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Initialise array to hold number of cuts on each path</span>
    <span class="n">path_cuts_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">path_cuts_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">get_cuts_on_path</span><span class="p">,</span> <span class="n">path_cuts_array</span><span class="p">)</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">path_cuts_array</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.kme_ff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kme_ff</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>K-Minimum Entropy. Only suitable for RSA/RMSA.
Method:
1. Go through action mask and find the first available slot on all paths.
2. For each path, allocate the first available slot.
3. Sum number of new consecutive zero regions (cuts) created by assignment (on each link)
4. Choose path that creates the fewest cuts.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">kme_ff</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;K-Minimum Entropy. Only suitable for RSA/RMSA.</span>
<span class="sd">    Method:</span>
<span class="sd">    1. Go through action mask and find the first available slot on all paths.</span>
<span class="sd">    2. For each path, allocate the first available slot.</span>
<span class="sd">    3. Sum number of new consecutive zero regions (cuts) created by assignment (on each link)</span>
<span class="sd">    4. Choose path that creates the fewest cuts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">first_slots</span> <span class="o">=</span> <span class="n">first_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">link_slot_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_bw</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">max_entropy</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">))</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_link_entropy</span><span class="p">(</span><span class="n">blocks</span><span class="p">):</span>
        <span class="n">ent</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">/</span><span class="n">x</span><span class="p">)),</span> <span class="n">in_axes</span><span class="o">=</span><span class="mi">0</span><span class="p">)(</span><span class="n">blocks</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">blocks</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ent</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_entropy_on_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_bw</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="c1"># Make link-slot_array positive</span>
        <span class="n">updated_slots</span> <span class="o">=</span> <span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">updated_block_sizes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">find_block_sizes</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">updated_slots</span><span class="p">)</span>
        <span class="n">updated_entropy</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">get_link_entropy</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">updated_block_sizes</span><span class="p">)</span>
        <span class="n">new_path_entropy</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">updated_entropy</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span>
        <span class="n">new_path_entropy</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">initial_slot_index</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># If true, no valid action for path</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">max_entropy</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span>  <span class="c1"># Return maximum entropy</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_path_entropy</span><span class="p">,</span>  <span class="c1"># Else, return number of cuts</span>
            <span class="mf">1.</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">new_path_entropy</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="n">path_entropy_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">path_entropy_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">get_entropy_on_path</span><span class="p">,</span> <span class="n">path_entropy_array</span><span class="p">)</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">path_entropy_array</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.kmf_ff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kmf_ff</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>K-Minimum Frag-size. Only suitable for RSA/RMSA.
Method:
1. Go through action mask and find the first available slot on all paths.
2. For each path, allocate the first available slot.
3. Sum number of new consecutive zero regions (cuts) created by assignment (on each link)
4. Choose path that creates the fewest cuts.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">kmf_ff</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;K-Minimum Frag-size. Only suitable for RSA/RMSA.</span>
<span class="sd">    Method:</span>
<span class="sd">    1. Go through action mask and find the first available slot on all paths.</span>
<span class="sd">    2. For each path, allocate the first available slot.</span>
<span class="sd">    3. Sum number of new consecutive zero regions (cuts) created by assignment (on each link)</span>
<span class="sd">    4. Choose path that creates the fewest cuts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">first_slots</span> <span class="o">=</span> <span class="n">first_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">link_slot_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_bw</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">blocks</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">find_block_sizes</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">link_slot_array</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_frags_on_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">se</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">num_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_bw</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="c1"># Mask on path links</span>
        <span class="n">block_sizes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">path</span><span class="p">,</span> <span class="n">blocks</span><span class="p">)</span>
        <span class="n">updated_slots</span> <span class="o">=</span> <span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">updated_block_sizes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">find_block_sizes</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))(</span><span class="n">updated_slots</span><span class="p">)</span>
        <span class="c1"># Mask on path links</span>
        <span class="n">updated_block_sizes</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">path</span><span class="p">,</span> <span class="n">updated_block_sizes</span><span class="p">)</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">updated_block_sizes</span> <span class="o">-</span> <span class="n">block_sizes</span>
        <span class="n">new_frags</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">difference</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">block_sizes</span> <span class="o">+</span> <span class="n">difference</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="c1"># Slice new frags up to initial slot index (so as to only consider frags to the left)</span>
        <span class="n">new_frags</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">new_frags</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="n">new_frag_size</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">new_frags</span><span class="p">)</span>
        <span class="n">num_frags</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">initial_slot_index</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">,</span>  <span class="c1"># If true, no valid action for path</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="mi">1</span><span class="p">,),</span> <span class="nb">float</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">)),</span>  <span class="c1"># Return max frag size</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">new_frag_size</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span>
            <span class="c1"># Else, return number of cuts</span>
            <span class="mf">1.</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">num_frags</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># Initialise array to hold number of cuts on each path</span>
    <span class="n">path_frags_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="mf">0.</span><span class="p">)</span>
    <span class="n">path_frags_array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">get_frags_on_path</span><span class="p">,</span> <span class="n">path_frags_array</span><span class="p">)</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">path_frags_array</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.ksp_bf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ksp_bf</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the first available slot from all k-shortest paths
Method: Go through action mask and find the first available slot, starting from shortest path</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ksp_bf</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the first available slot from all k-shortest paths</span>
<span class="sd">    Method: Go through action mask and find the first available slot, starting from shortest path</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">best_slots</span><span class="p">,</span> <span class="n">fitness</span> <span class="o">=</span> <span class="n">best_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Chosen path is the first one with an available slot</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fitness</span> <span class="o">&lt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">best_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.ksp_ff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ksp_ff</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the first available slot from the shortest available path
Method: Go through action mask and find the first available slot, starting from shortest path</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ksp_ff</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the first available slot from the shortest available path</span>
<span class="sd">    Method: Go through action mask and find the first available slot, starting from shortest path</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_slots</span> <span class="o">=</span> <span class="n">first_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Chosen path is the first one with an available slot</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">first_slots</span> <span class="o">&lt;</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">first_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.ksp_ff_multiband" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ksp_ff_multiband</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the first available slot from all k-shortest paths in multiband scenario
Method: Go through action mask and find the first available slot, starting from shortest path</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="MultiBandRSAEnvState (xlron.environments.env_funcs.MultiBandRSAEnvState)" href="#xlron.environments.env_funcs.MultiBandRSAEnvState">MultiBandRSAEnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state specific to multiband operations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="MultiBandRSAEnvParams (xlron.environments.env_funcs.MultiBandRSAEnvParams)" href="#xlron.environments.env_funcs.MultiBandRSAEnvParams">MultiBandRSAEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters including multiband details</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    chex.Array: Action</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ksp_ff_multiband</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the first available slot from all k-shortest paths in multiband scenario</span>
<span class="sd">    Method: Go through action mask and find the first available slot, starting from shortest path</span>

<span class="sd">    Args:</span>
<span class="sd">        state (MultiBandRSAEnvState): Environment state specific to multiband operations</span>
<span class="sd">        params (MultiBandRSAEnvParams): Environment parameters including multiband details</span>
<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.ksp_lf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ksp_lf</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the last available slot on the shortest available path
Method: Go through action mask and find the last available slot, starting from shortest path</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ksp_lf</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the last available slot on the shortest available path</span>
<span class="sd">    Method: Go through action mask and find the last available slot, starting from shortest path</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_slots</span> <span class="o">=</span> <span class="n">last_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Chosen path is the first one with an available slot</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">last_slots</span> <span class="o">&lt;</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">last_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.ksp_mu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ksp_mu</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unique_lightpaths</span><span class="p">,</span> <span class="n">relative</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the most-used slot on the shortest available path.
Method: Go through action mask and find the utilisation of available slots on each path.
Find the shortest available path and choose the most utilised slot on that path.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_lightpaths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to consider unique lightpaths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relative</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return relative utilisation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">ksp_mu</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">unique_lightpaths</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">relative</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the most-used slot on the shortest available path.</span>
<span class="sd">    Method: Go through action mask and find the utilisation of available slots on each path.</span>
<span class="sd">    Find the shortest available path and choose the most utilised slot on that path.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">        unique_lightpaths (bool): Whether to consider unique lightpaths</span>
<span class="sd">        relative (bool): Whether to return relative utilisation</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="n">most_used_slots</span> <span class="o">=</span> <span class="n">most_used</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unique_lightpaths</span><span class="p">,</span> <span class="n">relative</span><span class="p">)</span>
    <span class="c1"># Get usage of available slots</span>
    <span class="n">most_used_mask</span> <span class="o">=</span> <span class="n">most_used_slots</span> <span class="o">*</span> <span class="n">mask</span>
    <span class="c1"># Get index of most-used available slot for each path</span>
    <span class="n">most_used_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">most_used_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="c1"># Chosen path is the first one with an available slot</span>
    <span class="n">available_paths</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">available_paths</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">most_used_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.last_fit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">last_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Last-Fit Spectrum Allocation. Returns the last fit slot for each path.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">last_fit</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Last-Fit Spectrum Allocation. Returns the last fit slot for each path.&quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Add a column of ones to the mask to make sure that occupied paths have non-zero index in &quot;last_slots&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mask</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="n">mask</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Get index of last available slots for each path</span>
    <span class="n">last_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">mask</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Convert to index from the left</span>
    <span class="n">last_slots</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">-</span> <span class="n">last_slots</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">last_slots</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.lf_ksp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lf_ksp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the last available slot from all paths
Method: Go through action mask and find the last available slot on all paths</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">lf_ksp</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the last available slot from all paths</span>
<span class="sd">    Method: Go through action mask and find the last available slot on all paths</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_slots</span> <span class="o">=</span> <span class="n">last_fit</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Chosen path is the one with the highest index of last available slot</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">last_slots</span><span class="p">)</span>
    <span class="n">slot_index</span> <span class="o">=</span> <span class="n">last_slots</span><span class="p">[</span><span class="n">path_index</span><span class="p">]</span> <span class="o">%</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span>
    <span class="c1"># Convert indices to action</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">path_index</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="n">slot_index</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.make_graph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_graph</span><span class="p">(</span><span class="n">topology_name</span><span class="o">=</span><span class="s1">&#39;conus&#39;</span><span class="p">,</span> <span class="n">topology_directory</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create graph from topology definition.
Topologies must be defined in JSON format in the topologies directory and
named as the topology name with .json extension.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>topology_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>topology name</p>
              </div>
            </td>
            <td>
                  <code>&#39;conus&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>topology_directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>topology directory</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>graph</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>graph</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_graph</span><span class="p">(</span><span class="n">topology_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;conus&quot;</span><span class="p">,</span> <span class="n">topology_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create graph from topology definition.</span>
<span class="sd">    Topologies must be defined in JSON format in the topologies directory and</span>
<span class="sd">    named as the topology name with .json extension.</span>

<span class="sd">    Args:</span>
<span class="sd">        topology_name: topology name</span>
<span class="sd">        topology_directory: topology directory</span>

<span class="sd">    Returns:</span>
<span class="sd">        graph: graph</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">topology_path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">topology_directory</span><span class="p">)</span> <span class="k">if</span> <span class="n">topology_directory</span> <span class="k">else</span> <span class="p">(</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;topologies&quot;</span><span class="p">)</span>
    <span class="c1"># Create topology</span>
    <span class="k">if</span> <span class="n">topology_name</span> <span class="o">==</span> <span class="s2">&quot;4node&quot;</span><span class="p">:</span>
        <span class="c1"># 4 node ring</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_numpy_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]))</span>
        <span class="c1"># Add edge weights to graph</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">topology_name</span> <span class="o">==</span> <span class="s2">&quot;7node&quot;</span><span class="p">:</span>
        <span class="c1"># 7 node ring</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_numpy_array</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                                               <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]))</span>
        <span class="c1"># Add edge weights to graph</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">set_edge_attributes</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="p">{(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span> <span class="mi">4</span><span class="p">},</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">topology_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topology_name</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">graph</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">node_link_graph</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">graph</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.mask_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_nodes</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns mask of valid actions for node selection. 1 for valid action, 0 for invalid action.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_nodes</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mask_nodes</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns mask of valid actions for node selection. 1 for valid action, 0 for invalid action.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        num_nodes: Number of nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_actions</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">remaining_actions</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_counter</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">full_request</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">virtual_topology</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">full_request</span><span class="p">,</span> <span class="p">(</span><span class="n">remaining_actions</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">node_request_s</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">node_request_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">prev_action</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="p">(</span><span class="n">remaining_actions</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">prev_dest</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">prev_action</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">node_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">)</span>
    <span class="c1"># Get requested indices from request array virtual topology</span>
    <span class="n">requested_indices</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">virtual_topology</span><span class="p">,</span> <span class="p">(</span><span class="n">remaining_actions</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">requested_index_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">requested_indices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Get index of previous selected node</span>
    <span class="n">prev_selected_node</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">virtual_topology</span> <span class="o">==</span> <span class="n">requested_index_d</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">virtual_topology</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># will be current index if node only occurs once in virtual topology or will be different index if occurs more than once</span>
    <span class="n">prev_selected_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">prev_selected_node</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="n">prev_selected_node_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice_in_dim</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="n">prev_selected_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># If first action, source and dest both to be assigned -&gt; just mask all nodes based on resources</span>
    <span class="c1"># Thereafter, source must be previous dest. Dest can be any node (except previous allocations).</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_s</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">remaining_actions</span><span class="p">,</span> <span class="n">total_actions</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">&gt;=</span> <span class="n">node_request_s</span><span class="p">,</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">node_indices</span> <span class="o">==</span> <span class="n">prev_dest</span><span class="p">,</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_d</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">&gt;=</span> <span class="n">node_request_d</span><span class="p">,</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># If not first move, set node_mask_d to zero wherever node_mask_s is 1</span>
    <span class="c1"># to avoid same node selection for s and d</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_d</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">remaining_actions</span><span class="p">,</span> <span class="n">total_actions</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">node_mask_s</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span>
                <span class="n">x</span>
            <span class="p">),</span>
            <span class="n">state</span><span class="o">.</span><span class="n">node_mask_d</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mask_previous_selections</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># Disallow previously allocated nodes</span>
        <span class="n">update_slice</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">j</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice_in_dim</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">]),</span> <span class="n">j</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">update_slice</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># i is node request index</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">update_slice</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>  <span class="c1"># i is slot request index (so add 1 to get next node)</span>
            <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="p">,</span> <span class="n">val</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_d</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="n">remaining_actions</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">action_history</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">mask_previous_selections</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">node_mask_d</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># If requested node index is new then disallow previously allocated nodes</span>
    <span class="c1"># If not new, then must match previously allocated node for that index</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_mask_d</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
            <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">prev_selected_node_d</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">node_indices</span> <span class="o">==</span> <span class="n">prev_selected_node_d</span><span class="p">,</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">),</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">),</span> <span class="n">state</span><span class="o">.</span><span class="n">node_mask_d</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.mask_slots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_slots</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns binary mask of valid actions. 1 for valid action, 0 for invalid action.</p>
<ol>
<li>Check request for source and destination nodes</li>
<li>For each path:<ul>
<li>Get current slots on path (with padding on end to avoid out of bounds)</li>
<li>Get mask for required slots on path</li>
<li>Multiply through current slots with required slots mask to check if slots available on path</li>
<li>Remove padding from mask</li>
<li>Return path mask</li>
</ul>
</li>
<li>Update total mask with path mask</li>
<li>If aggregate_slots &gt; 1, aggregate slot mask to reduce action space</li>
</ol>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array in format [source_node, data-rate, destination_node]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mask_slots</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns binary mask of valid actions. 1 for valid action, 0 for invalid action.</span>

<span class="sd">    1. Check request for source and destination nodes</span>
<span class="sd">    2. For each path:</span>
<span class="sd">        - Get current slots on path (with padding on end to avoid out of bounds)</span>
<span class="sd">        - Get mask for required slots on path</span>
<span class="sd">        - Multiply through current slots with required slots mask to check if slots available on path</span>
<span class="sd">        - Remove padding from mask</span>
<span class="sd">        - Return path mask</span>
<span class="sd">    3. Update total mask with path mask</span>
<span class="sd">    4. If aggregate_slots &gt; 1, aggregate slot mask to reduce action space</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        request: Request array in format [source_node, data-rate, destination_node]</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">init_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mask_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="c1"># Get slots for path</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1"># Add padding to slots at end</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">slots</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_slots</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)))</span>
        <span class="c1"># Convert bandwidth to slots for each path</span>
        <span class="n">spectral_efficiency</span> <span class="o">=</span> <span class="n">get_paths_se</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">consider_modulation_format</span> <span class="k">else</span> <span class="n">one</span>
        <span class="n">requested_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">spectral_efficiency</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)</span>
        <span class="c1"># Get mask used to check if request will fit slots</span>
        <span class="n">request_mask</span> <span class="o">=</span> <span class="n">get_request_mask</span><span class="p">(</span><span class="n">requested_slots</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">check_slots_available</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="c1"># Multiply through by request mask to check if slots available</span>
            <span class="n">request_slice</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_slots</span><span class="p">,))</span>
            <span class="n">slot_sum</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">request_mask</span> <span class="o">*</span> <span class="n">request_slice</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">zero</span>
            <span class="n">slot_sum</span> <span class="o">=</span> <span class="n">slot_sum</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">slot_sum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,))</span>

        <span class="c1"># Mask out slots that are not valid</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>  <span class="c1"># No need to check last requested_slots-1 slots</span>
            <span class="n">check_slots_available</span><span class="p">,</span>
            <span class="n">slots</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Cut off padding</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">path_mask</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="c1"># Update total mask with path mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">path_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="c1"># Loop over each path</span>
    <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">mask_path</span><span class="p">,</span> <span class="n">init_mask</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Full link slot mask is used in process_path_action to get the correct slot from the aggregated slot action</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
        <span class="n">link_slot_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">aggregate_slots</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.mask_slots_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_slots_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For use in RSAGNModelEnv.
1. For each path:
    1.1 Get path slots
    1.2 Get launch power</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvState (xlron.environments.dataclasses.RSAGNModelEnvState)" href="#xlron.environments.dataclasses.RSAGNModelEnvState">RSAGNModelEnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RSAGNModelEnvParams (xlron.environments.dataclasses.RSAGNModelEnvParams)" href="#xlron.environments.dataclasses.RSAGNModelEnvParams">RSAGNModelEnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array in format [source_node, data-rate, destination_node]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3306</span>
<span class="normal">3307</span>
<span class="normal">3308</span>
<span class="normal">3309</span>
<span class="normal">3310</span>
<span class="normal">3311</span>
<span class="normal">3312</span>
<span class="normal">3313</span>
<span class="normal">3314</span>
<span class="normal">3315</span>
<span class="normal">3316</span>
<span class="normal">3317</span>
<span class="normal">3318</span>
<span class="normal">3319</span>
<span class="normal">3320</span>
<span class="normal">3321</span>
<span class="normal">3322</span>
<span class="normal">3323</span>
<span class="normal">3324</span>
<span class="normal">3325</span>
<span class="normal">3326</span>
<span class="normal">3327</span>
<span class="normal">3328</span>
<span class="normal">3329</span>
<span class="normal">3330</span>
<span class="normal">3331</span>
<span class="normal">3332</span>
<span class="normal">3333</span>
<span class="normal">3334</span>
<span class="normal">3335</span>
<span class="normal">3336</span>
<span class="normal">3337</span>
<span class="normal">3338</span>
<span class="normal">3339</span>
<span class="normal">3340</span>
<span class="normal">3341</span>
<span class="normal">3342</span>
<span class="normal">3343</span>
<span class="normal">3344</span>
<span class="normal">3345</span>
<span class="normal">3346</span>
<span class="normal">3347</span>
<span class="normal">3348</span>
<span class="normal">3349</span>
<span class="normal">3350</span>
<span class="normal">3351</span>
<span class="normal">3352</span>
<span class="normal">3353</span>
<span class="normal">3354</span>
<span class="normal">3355</span>
<span class="normal">3356</span>
<span class="normal">3357</span>
<span class="normal">3358</span>
<span class="normal">3359</span>
<span class="normal">3360</span>
<span class="normal">3361</span>
<span class="normal">3362</span>
<span class="normal">3363</span>
<span class="normal">3364</span>
<span class="normal">3365</span>
<span class="normal">3366</span>
<span class="normal">3367</span>
<span class="normal">3368</span>
<span class="normal">3369</span>
<span class="normal">3370</span>
<span class="normal">3371</span>
<span class="normal">3372</span>
<span class="normal">3373</span>
<span class="normal">3374</span>
<span class="normal">3375</span>
<span class="normal">3376</span>
<span class="normal">3377</span>
<span class="normal">3378</span>
<span class="normal">3379</span>
<span class="normal">3380</span>
<span class="normal">3381</span>
<span class="normal">3382</span>
<span class="normal">3383</span>
<span class="normal">3384</span>
<span class="normal">3385</span>
<span class="normal">3386</span>
<span class="normal">3387</span>
<span class="normal">3388</span>
<span class="normal">3389</span>
<span class="normal">3390</span>
<span class="normal">3391</span>
<span class="normal">3392</span>
<span class="normal">3393</span>
<span class="normal">3394</span>
<span class="normal">3395</span>
<span class="normal">3396</span>
<span class="normal">3397</span>
<span class="normal">3398</span>
<span class="normal">3399</span>
<span class="normal">3400</span>
<span class="normal">3401</span>
<span class="normal">3402</span>
<span class="normal">3403</span>
<span class="normal">3404</span>
<span class="normal">3405</span>
<span class="normal">3406</span>
<span class="normal">3407</span>
<span class="normal">3408</span>
<span class="normal">3409</span>
<span class="normal">3410</span>
<span class="normal">3411</span>
<span class="normal">3412</span>
<span class="normal">3413</span>
<span class="normal">3414</span>
<span class="normal">3415</span>
<span class="normal">3416</span>
<span class="normal">3417</span>
<span class="normal">3418</span>
<span class="normal">3419</span>
<span class="normal">3420</span>
<span class="normal">3421</span>
<span class="normal">3422</span>
<span class="normal">3423</span>
<span class="normal">3424</span>
<span class="normal">3425</span>
<span class="normal">3426</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mask_slots_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For use in RSAGNModelEnv.</span>
<span class="sd">    1. For each path:</span>
<span class="sd">        1.1 Get path slots</span>
<span class="sd">        1.2 Get launch power</span>


<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        request: Request array in format [source_node, data-rate, destination_node]</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">init_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mask_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">get_paths</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># Get slots for path</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1"># Add padding to slots at end</span>
        <span class="c1"># 0 means slot is free, 1 is occupied</span>
        <span class="n">slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">slots</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_slots</span><span class="p">)))</span>
        <span class="n">launch_power</span> <span class="o">=</span> <span class="n">get_launch_power</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">launch_power_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">get_lightpath_index</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

        <span class="c1"># This function checks through each available modulation format, checks the first and last available slots,</span>
        <span class="c1"># calculates the SNR, checks it meets the requirements, and returns the resulting mask</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">check_modulation_format</span><span class="p">(</span><span class="n">mod_format_index</span><span class="p">,</span> <span class="n">init_path_mask</span><span class="p">):</span>
            <span class="n">se</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">mod_format_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">req_slots</span> <span class="o">=</span> <span class="n">required_slots</span><span class="p">(</span><span class="n">requested_datarate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">guardband</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">bandwidth_per_subchannel</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">slot_size</span>
            <span class="n">req_snr</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">mod_format_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">snr_margin</span>
            <span class="c1"># Get mask used to check if request will fit slots</span>
            <span class="n">request_mask</span> <span class="o">=</span> <span class="n">get_request_mask</span><span class="p">(</span><span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

            <span class="k">def</span><span class="w"> </span><span class="nf">check_slots_available</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
                <span class="c1"># Multiply through by request mask to check if slots available</span>
                <span class="n">slot_sum</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">request_mask</span> <span class="o">*</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_slots</span><span class="p">,)),</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
                <span class="n">slot_sum</span> <span class="o">=</span> <span class="n">slot_sum</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">slot_sum</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="p">,))</span>

            <span class="c1"># Mask out slots that are not valid</span>
            <span class="n">slot_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># No need to check last requested_slots-1 slots</span>
                <span class="n">check_slots_available</span><span class="p">,</span>
                <span class="n">slots</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># Cut off padding</span>
            <span class="n">slot_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">slot_mask</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
            <span class="c1"># Check first and last available slots for suitability</span>
            <span class="n">ff_path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">slot_mask</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">lf_path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,)),</span> <span class="n">slot_mask</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">first_available_slot_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">ff_path_mask</span><span class="p">)</span>
            <span class="n">last_available_slot_index</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lf_path_mask</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c1"># Assign &quot;req_slots&quot; subchannels (each with bandwidth = slot width) for the first and last possible slots</span>
            <span class="n">ff_temp_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">bandwidth_per_subchannel</span><span class="p">),</span>
                <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
                <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">),</span>
                <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">mod_format_index</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">lf_temp_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">bandwidth_per_subchannel</span><span class="p">),</span>
                <span class="n">channel_power_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">launch_power</span><span class="p">),</span>
                <span class="n">path_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">lightpath_index</span><span class="p">),</span>
                <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">mod_format_index</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">ff_temp_state</span> <span class="o">=</span> <span class="n">ff_temp_state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_snr_array</span><span class="o">=</span><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">ff_temp_state</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
            <span class="n">lf_temp_state</span> <span class="o">=</span> <span class="n">lf_temp_state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_snr_array</span><span class="o">=</span><span class="n">get_snr_link_array</span><span class="p">(</span><span class="n">lf_temp_state</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span>
            <span class="c1"># Take the minimum value of SNR from all the subchannels</span>
            <span class="n">ff_snr_value</span> <span class="o">=</span> <span class="n">get_minimum_snr_of_channels_on_path</span><span class="p">(</span>
                <span class="n">ff_temp_state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span>
            <span class="p">)</span>
            <span class="n">lf_snr_value</span> <span class="o">=</span> <span class="n">get_minimum_snr_of_channels_on_path</span><span class="p">(</span>
                <span class="n">lf_temp_state</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">req_slots</span><span class="p">,</span> <span class="n">params</span>
            <span class="p">)</span>
            <span class="c1"># Check that other paths SNR is still sufficient (True if failure)</span>
            <span class="n">ff_snr_check</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">check_action_rmsa_gn_model</span><span class="p">(</span><span class="n">ff_temp_state</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">lf_snr_check</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">check_action_rmsa_gn_model</span><span class="p">(</span><span class="n">lf_temp_state</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">ff_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">ff_snr_value</span> <span class="o">&gt;=</span> <span class="n">req_snr</span><span class="p">)</span> <span class="o">*</span> <span class="n">ff_snr_check</span>
            <span class="n">lf_check</span> <span class="o">=</span> <span class="p">(</span><span class="n">lf_snr_value</span> <span class="o">&gt;=</span> <span class="n">req_snr</span><span class="p">)</span> <span class="o">*</span> <span class="n">lf_snr_check</span>

            <span class="n">slot_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
            <span class="n">mod_format_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">slot_indices</span> <span class="o">==</span> <span class="n">first_available_slot_index</span><span class="p">,</span> <span class="n">ff_check</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">mod_format_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">slot_indices</span> <span class="o">==</span> <span class="n">last_available_slot_index</span><span class="p">,</span> <span class="n">lf_check</span><span class="p">,</span> <span class="n">mod_format_mask</span><span class="p">)</span>
            <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mod_format_mask</span><span class="p">,</span> <span class="n">mod_format_index</span><span class="p">,</span> <span class="n">init_path_mask</span><span class="p">)</span>
            <span class="c1"># jax.debug.print(&quot;ff_snr_check {}&quot;, ff_snr_check, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;lf_snr_check {}&quot;, lf_snr_check, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;ff_snr_value {}&quot;, ff_snr_value, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;lf_snr_value {}&quot;, lf_snr_value, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;first_available_slot_index {}&quot;, first_available_slot_index, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;last_available_slot_index {}&quot;, last_available_slot_index, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;req_snr {}&quot;, req_snr, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;mod_format_mask {}&quot;, mod_format_mask, ordered=True)</span>
            <span class="c1"># jax.debug.print(&quot;path_mask {}&quot;, path_mask, ordered=True)</span>
            <span class="k">return</span> <span class="n">path_mask</span>

        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">modulations_array</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">check_modulation_format</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,),</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">))</span>

        <span class="c1"># Update total mask with path mask</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">path_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="c1"># Loop over each path</span>
    <span class="n">mod_format_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">mask_path</span><span class="p">,</span> <span class="n">init_mask</span><span class="p">)</span>
    <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mod_format_mask</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Full link slot mask is used in process_path_action to get the correct slot from the aggregated slot action</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
        <span class="n">link_slot_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">aggregate_slots</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">,</span>
        <span class="n">mod_format_mask</span><span class="o">=</span><span class="n">mod_format_mask</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.mask_slots_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mask_slots_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>For use in RWALightpathReuseEnv.
Each lightpath has a maximum capacity defined in path_capacity_array. This is updated when a lightpath is assigned.
If remaining path capacity is less than current request, corresponding link-slots are masked out.
If link-slot is in use by another lightpath for a different source and destination node (even if not full) it is masked out.
Step 1:
- Mask out slots that are not valid based on path capacity (check link_capacity_array)
Step 2:
- Mask out slots that are not valid based on lightpath reuse (check path_index_array)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>request</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Request array in format [source_node, data-rate, destination_node]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>state</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mask_slots_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For use in RWALightpathReuseEnv.</span>
<span class="sd">    Each lightpath has a maximum capacity defined in path_capacity_array. This is updated when a lightpath is assigned.</span>
<span class="sd">    If remaining path capacity is less than current request, corresponding link-slots are masked out.</span>
<span class="sd">    If link-slot is in use by another lightpath for a different source and destination node (even if not full) it is masked out.</span>
<span class="sd">    Step 1:</span>
<span class="sd">    - Mask out slots that are not valid based on path capacity (check link_capacity_array)</span>
<span class="sd">    Step 2:</span>
<span class="sd">    - Mask out slots that are not valid based on lightpath reuse (check path_index_array)</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>
<span class="sd">        request: Request array in format [source_node, data-rate, destination_node]</span>

<span class="sd">    Returns:</span>
<span class="sd">        state: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="n">init_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">))</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">nodes_sd</span>
    <span class="n">path_start_index</span> <span class="o">=</span> <span class="n">get_path_indices</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">directed</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span><span class="p">)</span>
    <span class="c1">#jax.debug.print(&quot;path_start_index {}&quot;, path_start_index, ordered=True)</span>
    <span class="c1">#jax.debug.print(&quot;link_capacity_array {}&quot;, state.link_capacity_array, ordered=True)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">mask_path</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mask</span><span class="p">):</span>
        <span class="c1"># Step 1 - mask capacity</span>
        <span class="n">capacity_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;</span> <span class="n">requested_datarate</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="c1">#jax.debug.print(&quot;capacity_mask {}&quot;, capacity_mask, ordered=True)</span>
        <span class="n">capacity_slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">capacity_mask</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1">#jax.debug.print(&quot;capacity_slots {}&quot;, capacity_slots, ordered=True)</span>
        <span class="c1"># Step 2 - mask lightpath reuse</span>
        <span class="n">lightpath_index</span> <span class="o">=</span> <span class="n">path_start_index</span> <span class="o">+</span> <span class="n">i</span>
        <span class="c1">#jax.debug.print(&quot;lightpath_index {}&quot;, lightpath_index, ordered=True)</span>
        <span class="n">lightpath_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span> <span class="o">==</span> <span class="n">lightpath_index</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>  <span class="c1"># Allow current lightpath</span>
        <span class="c1">#jax.debug.print(&quot;lightpath_mask {}&quot;, lightpath_mask, ordered=True)</span>
        <span class="n">lightpath_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">lightpath_mask</span><span class="p">)</span>  <span class="c1"># Allow empty slots</span>
        <span class="c1">#jax.debug.print(&quot;lightpath_mask {}&quot;, lightpath_mask, ordered=True)</span>
        <span class="n">lightpath_slots</span> <span class="o">=</span> <span class="n">get_path_slots</span><span class="p">(</span><span class="n">lightpath_mask</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c1">#jax.debug.print(&quot;lightpath_slots {}&quot;, lightpath_slots, ordered=True)</span>
        <span class="c1"># Step 3 combine masks</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">capacity_slots</span><span class="p">,</span> <span class="n">lightpath_slots</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Swap zeros for ones</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">path_mask</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="c1">#jax.debug.print(&quot;path_mask {}&quot;, path_mask, ordered=True)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">path_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="c1"># Loop over each path</span>
    <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="n">mask_path</span><span class="p">,</span> <span class="n">init_mask</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Full link slot mask is used in process_path_action to get the correct slot from the aggregated slot action</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">full_link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
        <span class="n">link_slot_mask</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">aggregate_slots</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">k_paths</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">link_slot_mask</span> <span class="o">=</span> <span class="n">link_slot_mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">link_slot_mask</span><span class="o">=</span><span class="n">link_slot_mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.most_used" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">most_used</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unique_lightpaths</span><span class="p">,</span> <span class="n">relative</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Get the amount of utilised bandwidth on each lightpath.
If RWA-LR environment, the utilisation of a slot is defined by either the count of unique active lightpahts on the
slot (if unique_lightpaths is True) or the count of active lightpaths on the slot (if unique_lightpaths is False).
If RSA-type environment, utilisation is the count of active lightpaths on that slot.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_lightpaths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to consider unique lightpaths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relative</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return relative utilisation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Most used slots (array length = link_resources)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">most_used</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">unique_lightpaths</span><span class="p">,</span> <span class="n">relative</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the amount of utilised bandwidth on each lightpath.</span>
<span class="sd">    If RWA-LR environment, the utilisation of a slot is defined by either the count of unique active lightpahts on the</span>
<span class="sd">    slot (if unique_lightpaths is True) or the count of active lightpaths on the slot (if unique_lightpaths is False).</span>
<span class="sd">    If RSA-type environment, utilisation is the count of active lightpaths on that slot.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">        unique_lightpaths (bool): Whether to consider unique lightpaths</span>
<span class="sd">        relative (bool): Whether to return relative utilisation</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Most used slots (array length = link_resources)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;RWALightpathReuseEnvParams&quot;</span><span class="p">:</span>
        <span class="n">most_used_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;RWALightpathReuseEnvParams&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">unique_lightpaths</span><span class="p">:</span>
        <span class="c1"># Get initial path capacity</span>
        <span class="n">initial_path_capacity</span> <span class="o">=</span> <span class="n">init_path_capacity_array</span><span class="p">(</span>
            <span class="n">params</span><span class="o">.</span><span class="n">link_length_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">path_link_array</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="p">)</span>
        <span class="n">initial_path_capacity</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">initial_path_capacity</span><span class="p">[</span><span class="n">x</span><span class="p">])(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">))</span>
        <span class="n">utilisation</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">initial_path_capacity</span> <span class="o">-</span> <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                <span class="n">initial_path_capacity</span> <span class="o">-</span> <span class="n">state</span><span class="o">.</span><span class="n">link_capacity_array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
            <span class="n">utilisation</span> <span class="o">=</span> <span class="n">utilisation</span> <span class="o">/</span> <span class="n">initial_path_capacity</span>
        <span class="c1"># Get most used slots by summing the utilisation along the slots</span>
        <span class="n">most_used_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">utilisation</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">most_used_slots</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">most_used_slots</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.mu_ksp" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mu_ksp</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unique_lightpaths</span><span class="p">,</span> <span class="n">relative</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Use the most-used available slot on any path.
The most-used slot is that which has the most unique lightpaths (if unique_lightpaths=True) or active lightpaths.
Method: Go through action mask and find the usage of available slots, choose available slot that is most utilised.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.env_funcs.EnvState)" href="#xlron.environments.env_funcs.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.env_funcs.EnvParams)" href="#xlron.environments.env_funcs.EnvParams">EnvParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unique_lightpaths</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to consider unique lightpaths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>relative</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to return relative utilisation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.env_funcs.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>chex.Array: Action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/heuristics/heuristics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mu_ksp</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">unique_lightpaths</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">relative</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use the most-used available slot on any path.</span>
<span class="sd">    The most-used slot is that which has the most unique lightpaths (if unique_lightpaths=True) or active lightpaths.</span>
<span class="sd">    Method: Go through action mask and find the usage of available slots, choose available slot that is most utilised.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">        unique_lightpaths (bool): Whether to consider unique lightpaths</span>
<span class="sd">        relative (bool): Whether to return relative utilisation</span>

<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">get_action_mask</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
    <span class="c1"># Get most used slots by summing the link_slot_array along the links</span>
    <span class="n">most_used_slots</span> <span class="o">=</span> <span class="n">most_used</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">unique_lightpaths</span><span class="p">,</span> <span class="n">relative</span><span class="p">)</span>
    <span class="c1"># Get usage of available slots</span>
    <span class="n">most_used_mask</span> <span class="o">=</span> <span class="n">most_used_slots</span> <span class="o">*</span> <span class="n">mask</span>
    <span class="c1"># Chosen slot is the most used globally</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">most_used_mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.normalise_traffic_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalise_traffic_matrix</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Normalise traffic matrix to sum to 1</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalise_traffic_matrix</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalise traffic matrix to sum to 1&quot;&quot;&quot;</span>
    <span class="n">traffic_matrix</span> <span class="o">/=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">traffic_matrix</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">traffic_matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.pad_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pad_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Pad a ragged multidimensional array to rectangular shape.
Used for training on multiple topologies.
Source: https://codereview.stackexchange.com/questions/222623/pad-a-ragged-multidimensional-array-to-rectangular-shape</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array to pad</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>value to fill with</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>result</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>padded array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pad_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pad a ragged multidimensional array to rectangular shape.</span>
<span class="sd">    Used for training on multiple topologies.</span>
<span class="sd">    Source: https://codereview.stackexchange.com/questions/222623/pad-a-ragged-multidimensional-array-to-rectangular-shape</span>

<span class="sd">    Args:</span>
<span class="sd">        array: array to pad</span>
<span class="sd">        fill_value: value to fill with</span>

<span class="sd">    Returns:</span>
<span class="sd">        result: padded array</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_dimensions</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">level</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">array</span><span class="p">:</span>
                <span class="k">yield from</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1">#not an iterable</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_max_shape</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
            <span class="n">dimensions</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dimensions</span><span class="p">[</span><span class="n">level</span><span class="p">],</span> <span class="n">length</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">value</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dimensions</span><span class="o">.</span><span class="n">items</span><span class="p">())]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">iterate_nested_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">()):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">iterate_nested_array</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="p">,</span> <span class="n">idx</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="c1"># final level</span>
            <span class="k">yield</span> <span class="p">(</span><span class="o">*</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">))),</span> <span class="n">array</span>

    <span class="n">dimensions</span> <span class="o">=</span> <span class="n">get_max_shape</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="n">fill_value</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">iterate_nested_array</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="n">result</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.path_action_only" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">path_action_only</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">,</span> <span class="n">action_counter</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>This is to check if node has already been assigned, therefore just need to assign slots (n=0)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>topology_pattern</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Topology pattern</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_counter</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action counter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>remaining_actions</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Scalar">Scalar</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Remaining actions</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if only path action, False if node action</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">path_action_only</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">action_counter</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">remaining_actions</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Scalar</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is to check if node has already been assigned, therefore just need to assign slots (n=0)</span>

<span class="sd">    Args:</span>
<span class="sd">        topology_pattern: Topology pattern</span>
<span class="sd">        action_counter: Action counter</span>
<span class="sd">        remaining_actions: Remaining actions</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if only path action, False if node action</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get topology segment to be assigned e.g. [2,1,4]</span>
    <span class="n">topology_segment</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">topology_pattern</span><span class="p">,</span> <span class="p">((</span><span class="n">remaining_actions</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">))</span>
    <span class="n">topology_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">topology_pattern</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># Check if the latest node in the segment is found in &quot;prev_assigned_topology&quot;</span>
    <span class="n">new_node_to_be_assigned</span> <span class="o">=</span> <span class="n">topology_segment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">prev_assigned_topology</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">topology_indices</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">action_counter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">topology_pattern</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">nodes_already_assigned_check</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">prev_assigned_topology</span> <span class="o">==</span> <span class="n">new_node_to_be_assigned</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">nodes_already_assigned_check</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.poisson" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">poisson</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="o">.</span><span class="n">float_</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sample Exponential random values with given shape and float dtype.</p>
<p>The values are distributed according to the probability density function:</p>
<p>.. math::
 f(x) = \lambda e^{-\lambda x}</p>
<p>on the domain :math:<code>0 \le x &lt; \infty</code>.</p>
<p>Args:
key: a PRNG key used as the random key.
lam: a positive float32 or float64 <code>Tensor</code> indicating the rate parameter
shape: optional, a tuple of nonnegative integers representing the result
  shape. Default ().
dtype: optional, a float dtype for the returned values (default float64 if
  jax_enable_x64 is true, otherwise float32).</p>
<p>Returns:
A random array with the specified shape and dtype.</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">poisson</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">prng</span><span class="o">.</span><span class="n">PRNGKeyArray</span><span class="p">],</span>
            <span class="n">lam</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
            <span class="n">shape</span><span class="p">:</span> <span class="n">Shape</span> <span class="o">=</span> <span class="p">(),</span>
            <span class="n">dtype</span><span class="p">:</span> <span class="n">DTypeLike</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">float_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sample Exponential random values with given shape and float dtype.</span>

<span class="sd">    The values are distributed according to the probability density function:</span>

<span class="sd">    .. math::</span>
<span class="sd">     f(x) = \lambda e^{-\lambda x}</span>

<span class="sd">    on the domain :math:`0 \le x &lt; \infty`.</span>

<span class="sd">    Args:</span>
<span class="sd">    key: a PRNG key used as the random key.</span>
<span class="sd">    lam: a positive float32 or float64 `Tensor` indicating the rate parameter</span>
<span class="sd">    shape: optional, a tuple of nonnegative integers representing the result</span>
<span class="sd">      shape. Default ().</span>
<span class="sd">    dtype: optional, a float dtype for the returned values (default float64 if</span>
<span class="sd">      jax_enable_x64 is true, otherwise float32).</span>

<span class="sd">    Returns:</span>
<span class="sd">    A random array with the specified shape and dtype.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">_check_prng_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dtype argument to `exponential` must be a float &quot;</span>
                       <span class="sa">f</span><span class="s2">&quot;dtype, got </span><span class="si">{</span><span class="n">dtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">canonicalize_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">canonicalize_shape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_poisson</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.process_path_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">path_action</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Process path action to get path index and initial slot index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="State">State</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>current state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="Params">Params</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_action</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path action</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>(<span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path index</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code>(<span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>initial slot index</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_path_action</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">,</span> <span class="n">path_action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process path action to get path index and initial slot index.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (State): current state</span>
<span class="sd">        params (Params): environment parameters</span>
<span class="sd">        path_action (int): path action</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: path index</span>
<span class="sd">        int: initial slot index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_slot_actions</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="o">/</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">)</span>
    <span class="n">path_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">path_action</span> <span class="o">/</span> <span class="n">num_slot_actions</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">LARGE_INT_DTYPE</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">initial_aggregated_slot_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">path_action</span><span class="p">,</span> <span class="n">num_slot_actions</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">initial_aggregated_slot_index</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Get the path mask do a dynamic slice and get the index of first unoccupied slot in the slice</span>
        <span class="n">path_mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">full_link_slot_mask</span><span class="p">,</span> <span class="n">path_index</span><span class="o">*</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">,))</span>
        <span class="n">path_mask_slice</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">path_mask</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">aggregate_slots</span><span class="p">,))</span>
        <span class="c1"># Use argmax to get index of first 1 in slice of mask</span>
        <span class="n">initial_slot_index</span> <span class="o">=</span> <span class="n">initial_slot_index</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">path_mask_slice</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">initial_slot_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.read_rsa_request" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_rsa_request</span><span class="p">(</span><span class="n">request_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Read RSA request from request array. Return source-destination nodes and bandwidth request.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>request_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>request array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="xlron.environments.dataclasses.chex.Array">Array</span>, <span title="xlron.environments.dataclasses.chex.Array">Array</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[chex.Array, chex.Array]: source-destination nodes and bandwidth request</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_rsa_request</span><span class="p">(</span><span class="n">request_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read RSA request from request array. Return source-destination nodes and bandwidth request.</span>

<span class="sd">    Args:</span>
<span class="sd">        request_array: request array</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[chex.Array, chex.Array]: source-destination nodes and bandwidth request</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_s</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request_array</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">requested_datarate</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request_array</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">node_d</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span><span class="n">request_array</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
    <span class="n">nodes_sd</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">node_s</span><span class="p">,</span> <span class="n">node_d</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">nodes_sd</span><span class="p">,</span> <span class="n">requested_datarate</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.remove_expired_node_requests" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_node_requests</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check for values in node_departure_array that are less than the current time but greater than zero
(negative time indicates the request is not yet finalised).
If found, set to infinity in node_departure_array, set to zero in node_resource_array, and increase
node_capacity_array by expired resources on each node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_node_requests</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for values in node_departure_array that are less than the current time but greater than zero</span>
<span class="sd">    (negative time indicates the request is not yet finalised).</span>
<span class="sd">    If found, set to infinity in node_departure_array, set to zero in node_resource_array, and increase</span>
<span class="sd">    node_capacity_array by expired resources on each node.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">current_time</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;</span> <span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">expired_resources</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_capacity_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">+</span> <span class="n">expired_resources</span><span class="p">,</span>
        <span class="n">node_resource_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">),</span>
        <span class="n">node_departure_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.remove_expired_services_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_services_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_services_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set one where link_slot_departure_array is &gt;= zero and &lt;= current time</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">arrival_time</span>
    <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
        <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span><span class="p">:</span>
        <span class="n">mask_subtract</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_subtract</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                                                      <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">),</span>
                                                      <span class="n">updated_link_slot_departure_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">updated_link_slot_departure_array</span><span class="p">,</span>
        <span class="n">link_snr_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">),</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">),</span>
        <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array</span><span class="p">),</span>
        <span class="n">path_index_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array_prev</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array_prev</span><span class="p">),</span>
        <span class="n">channel_power_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array_prev</span><span class="p">),</span>
        <span class="n">modulation_format_index_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array_prev</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.remove_expired_services_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_services_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Check for values in link_slot_departure_array that are less than the current time but greater than zero
(negative time indicates the request is not yet finalised).
If found, set to zero in link_slot_array and link_slot_departure_array.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_services_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for values in link_slot_departure_array that are less than the current time but greater than zero</span>
<span class="sd">    (negative time indicates the request is not yet finalised).</span>
<span class="sd">    If found, set to zero in link_slot_array and link_slot_departure_array.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set one where link_slot_departure_array is &gt;= zero and &lt;= current time</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">arrival_time</span>
    <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
        <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="n">updated_link_slot_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">)</span>
    <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span><span class="p">:</span>
        <span class="n">mask_subtract</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_subtract</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                                                     <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">),</span>
                                                     <span class="n">updated_link_slot_departure_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">updated_link_slot_array</span><span class="p">,</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">updated_link_slot_departure_array</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.remove_expired_services_rsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_services_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_services_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set one where link_slot_departure_array is &gt;= zero and &lt;= current time</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">arrival_time</span>
    <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
        <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span><span class="p">:</span>
        <span class="n">mask_subtract</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_subtract</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                                                      <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">),</span>
                                                      <span class="n">updated_link_slot_departure_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">updated_link_slot_departure_array</span><span class="p">,</span>
        <span class="n">link_snr_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span><span class="p">),</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array</span><span class="p">),</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span><span class="p">),</span>
        <span class="n">path_index_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array_prev</span><span class="p">),</span>
        <span class="n">channel_centre_bw_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array_prev</span><span class="p">),</span>
        <span class="n">channel_power_array_prev</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">channel_power_array_prev</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span><span class="p">:</span>
        <span class="c1"># The active_lightpaths_array is set to -1 when the lightpath is not active</span>
        <span class="c1"># The active_lightpaths_array_departure is set to 0 when the lightpath is not active</span>
        <span class="c1"># (active_lightpaths_array is used to calculate the total throughput)</span>
        <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
            <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">active_lightpaths_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">),</span>
            <span class="n">active_lightpaths_array_departure</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.remove_expired_services_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_expired_services_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="EnvParams (xlron.environments.dataclasses.EnvParams)" href="#xlron.environments.dataclasses.EnvParams">EnvParams</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment parameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">remove_expired_services_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>
<span class="sd">        params: Environment parameters</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set one where link_slot_departure_array is &gt;= zero and &lt;= current time</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">arrival_time</span>
    <span class="n">mask_remove</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">zero</span> <span class="o">&lt;=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">)),</span>
        <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">relative_arrival_times</span><span class="p">:</span>
        <span class="n">mask_subtract</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">updated_link_slot_departure_array</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">)</span>
        <span class="n">updated_link_slot_departure_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_subtract</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                                                     <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">current_time</span><span class="p">),</span>
                                                     <span class="n">updated_link_slot_departure_array</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_remove</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">path_index_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">updated_link_slot_departure_array</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.required_slots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">required_slots</span><span class="p">(</span><span class="n">bitrate</span><span class="p">,</span> <span class="n">se</span><span class="p">,</span> <span class="n">channel_width</span><span class="p">,</span> <span class="n">guardband</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Calculate required slots for a given bitrate and spectral efficiency.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bit_rate</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Bit rate in Gbps</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>se</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Spectral efficiency in bps/Hz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>channel_width</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Channel width in GHz</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>guardband</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Guard band. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required slots</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">required_slots</span><span class="p">(</span><span class="n">bitrate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">se</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">channel_width</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">guardband</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate required slots for a given bitrate and spectral efficiency.</span>

<span class="sd">    Args:</span>
<span class="sd">        bit_rate (float): Bit rate in Gbps</span>
<span class="sd">        se (float): Spectral efficiency in bps/Hz</span>
<span class="sd">        channel_width (float): Channel width in GHz</span>
<span class="sd">        guardband (int, optional): Guard band. Defaults to 1.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Required slots</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If bitrate is zero, then required slots should be zero</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">jnp</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">bitrate</span><span class="o">/</span><span class="p">(</span><span class="n">se</span><span class="o">*</span><span class="n">channel_width</span><span class="p">))</span><span class="o">+</span><span class="n">guardband</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="p">(</span><span class="n">bitrate</span> <span class="o">==</span> <span class="n">zero</span><span class="p">)))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.set_band_gaps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_band_gaps</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Set band gaps in link slot array
Args:
    link_slot_array (chex.Array): Link slot array
    params (RSAGNModelEnvParams): Environment parameters
    val (int): Value to set
Returns:
    chex.Array: Link slot array with band gaps</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_band_gaps</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set band gaps in link slot array</span>
<span class="sd">    Args:</span>
<span class="sd">        link_slot_array (chex.Array): Link slot array</span>
<span class="sd">        params (RSAGNModelEnvParams): Environment parameters</span>
<span class="sd">        val (int): Value to set</span>
<span class="sd">    Returns:</span>
<span class="sd">        chex.Array: Link slot array with band gaps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create array that is size of link_slot array with values of column index</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">link_resources</span><span class="p">)</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_links</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_band_gap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
        <span class="n">gap_start</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">gap_starts</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">gap_end</span> <span class="o">=</span> <span class="n">gap_start</span> <span class="o">+</span> <span class="n">params</span><span class="o">.</span><span class="n">gap_widths</span><span class="o">.</span><span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">condition</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">arr</span> <span class="o">&gt;=</span> <span class="n">gap_start</span><span class="p">,</span> <span class="n">arr</span> <span class="o">&lt;</span> <span class="n">gap_end</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">arr</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">fori_loop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="o">.</span><span class="n">gap_widths</span><span class="o">.</span><span class="n">val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">set_band_gap</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="n">link_slot_array</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">link_slot_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">link_slot_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.undo_action_rmsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Undo action for RMSA GN model
Args:
    state (EnvState): Environment state
    action (chex.Array): Action array
    params (EnvParams): Environment parameters
Returns:
    EnvState: Updated environment state</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_action_rmsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Undo action for RMSA GN model</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        action (chex.Array): Action array</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        EnvState: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">undo_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>  <span class="c1"># Undo link_slot_array and link_slot_departure_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">set_band_gaps</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">),</span>  <span class="c1"># Set C+L band gap</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array_prev</span><span class="p">,</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array_prev</span><span class="p">,</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array_prev</span><span class="p">,</span>
        <span class="n">modulation_format_index_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">modulation_format_index_array_prev</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.undo_action_rsa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.
Partial resource allocation is indicated by negative time in link slot departure array.
Check for values in link_slot_departure_array that are less than zero.
If found, increase link_slot_array by +1 and link_slot_departure_array by current_time + holding_time of current request.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.</span>
<span class="sd">    Partial resource allocation is indicated by negative time in link slot departure array.</span>
<span class="sd">    Check for values in link_slot_departure_array that are less than zero.</span>
<span class="sd">    If found, increase link_slot_array by +1 and link_slot_departure_array by current_time + holding_time of current request.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If departure array is negative, then undo the action</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="c1"># If link slot array is &lt; -1, then undo the action</span>
    <span class="c1"># (departure might be positive because existing service had holding time after current)</span>
    <span class="c1"># e.g. (time_in_array = t1 - t2) where t2 &lt; t1 and t2 = current_time + holding_time</span>
    <span class="c1"># but link_slot_array = -2 due to double allocation, so undo the action</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">+</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span> <span class="o">+</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.undo_action_rsa_gn_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_action_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Undo action for RSA GN model
Args:
    state (EnvState): Environment state
    action (chex.Array): Action array
    params (EnvParams): Environment parameters
Returns:
    EnvState: Updated environment state</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_action_rsa_gn_model</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">RSAGNModelEnvParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Undo action for RSA GN model</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        action (chex.Array): Action array</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        EnvState: Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">undo_action_rsa</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>  <span class="c1"># Undo link_slot_array and link_slot_departure_array</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">set_band_gaps</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">),</span>  <span class="c1"># Set C+L band gap</span>
        <span class="n">channel_centre_bw_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">channel_centre_bw_array_prev</span><span class="p">,</span>
        <span class="n">path_index_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">path_index_array_prev</span><span class="p">,</span>
        <span class="n">channel_power_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array_prev</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">monitor_active_lightpaths</span><span class="p">:</span>
        <span class="c1"># If departure array is negative, then undo the action</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span>  <span class="n">zero</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="n">active_lightpaths_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">),</span>
            <span class="n">active_lightpaths_array_departure</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
                <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">,</span>
                <span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.undo_action_rwalr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.
Partial resource allocation is indicated by negative time in link slot departure array.
Check for values in link_slot_departure_array that are less than zero.
If found, increase link_slot_array by +1 and link_slot_departure_array by current_time + holding_time of current request.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_action_rwalr</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EnvParams</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.</span>
<span class="sd">    Partial resource allocation is indicated by negative time in link slot departure array.</span>
<span class="sd">    Check for values in link_slot_departure_array that are less than zero.</span>
<span class="sd">    If found, increase link_slot_array by +1 and link_slot_departure_array by current_time + holding_time of current request.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If departure array is negative, then undo the action</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">&lt;</span> <span class="n">zero</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">zero</span><span class="p">)</span>
    <span class="c1"># If link slot array is &lt; -1, then undo the action</span>
    <span class="c1"># (departure might be positive because existing service had holding time after current)</span>
    <span class="c1"># e.g. (time_in_array = t1 - t2) where t2 &lt; t1 and t2 = current_time + holding_time</span>
    <span class="c1"># but link_slot_array = -2 due to double allocation, so undo the action</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">one</span><span class="p">,</span> <span class="n">one</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">link_slot_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="o">+</span> <span class="n">one</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span><span class="p">),</span>
        <span class="n">link_slot_departure_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">mask</span> <span class="o">==</span> <span class="n">one</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">current_time</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">holding_time</span><span class="p">,</span>
            <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span><span class="p">),</span>
        <span class="n">total_bitrate</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">total_bitrate</span> <span class="o">+</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.undo_node_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">undo_node_action</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.
Partial resource allocation is indicated by negative time in node departure array.
Check for values in node_departure_array that are less than zero.
If found, set to infinity in node_departure_array, set to zero in node_resource_array, and increase
node_capacity_array by expired resources on each node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Environment state</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="EnvState (xlron.environments.dataclasses.EnvState)" href="#xlron.environments.dataclasses.EnvState">EnvState</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated environment state</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">donate_argnums</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
<span class="k">def</span><span class="w"> </span><span class="nf">undo_node_action</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EnvState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the request is unsuccessful i.e. checks fail, then remove the partial (unfinalised) resource allocation.</span>
<span class="sd">    Partial resource allocation is indicated by negative time in node departure array.</span>
<span class="sd">    Check for values in node_departure_array that are less than zero.</span>
<span class="sd">    If found, set to infinity in node_departure_array, set to zero in node_resource_array, and increase</span>
<span class="sd">    node_capacity_array by expired resources on each node.</span>

<span class="sd">    Args:</span>
<span class="sd">        state: Environment state</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated environment state</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO - Check that node resource clash doesn&#39;t happen (so time is always negative after implementation)</span>
    <span class="c1">#  and undoing always succeeds with negative time</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">resources</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">promote_integers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
        <span class="n">node_capacity_array</span><span class="o">=</span><span class="n">state</span><span class="o">.</span><span class="n">node_capacity_array</span> <span class="o">+</span> <span class="n">resources</span><span class="p">,</span>
        <span class="n">node_resource_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_resource_array</span><span class="p">),</span>
        <span class="n">node_departure_array</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">node_departure_array</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.update_action_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_action_history</span><span class="p">(</span><span class="n">action_history</span><span class="p">,</span> <span class="n">action_counter</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update action history by adding action to first available index starting from the end.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>action_history</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action_counter</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action counter</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Action to add to history</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated action_history</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_action_history</span><span class="p">(</span><span class="n">action_history</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">action_counter</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update action history by adding action to first available index starting from the end.</span>

<span class="sd">    Args:</span>
<span class="sd">        action_history: Action history</span>
<span class="sd">        action_counter: Action counter</span>
<span class="sd">        action: Action to add to history</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated action_history</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">action_history</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="p">((</span><span class="n">action_counter</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.update_active_lightpaths_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_active_lightpaths_array</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update active lightpaths array with new path index.
Find the first index of the array with value -1 and replace with path index.
Args:
    state (RSAGNModelEnvState): Environment state
    path_index (int): Path index to add to active lightpaths array
Returns:
    jnp.array: Updated active lightpaths array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_active_lightpaths_array</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">path_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update active lightpaths array with new path index.</span>
<span class="sd">    Find the first index of the array with value -1 and replace with path index.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (RSAGNModelEnvState): Environment state</span>
<span class="sd">        path_index (int): Path index to add to active lightpaths array</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Updated active lightpaths array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_empty_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Just look at the first column</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">path_index</span><span class="p">,</span> <span class="n">initial_slot_index</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]),</span> <span class="p">(</span><span class="n">first_empty_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.update_active_lightpaths_array_departure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">time</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update active lightpaths array with new path index.
Find the first index of the array with value -1 and replace with path index.
Args:
    state (RSAGNModelEnvState): Environment state
    time (float): Departure time
Returns:
    jnp.array: Updated active lightpaths array</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_active_lightpaths_array_departure</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">RSAGNModelEnvState</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update active lightpaths array with new path index.</span>
<span class="sd">    Find the first index of the array with value -1 and replace with path index.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (RSAGNModelEnvState): Environment state</span>
<span class="sd">        time (float): Departure time</span>
<span class="sd">    Returns:</span>
<span class="sd">        jnp.array: Updated active lightpaths array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_empty_index</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>  <span class="c1"># Just look at the first column</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">dynamic_update_slice</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">active_lightpaths_array_departure</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">time</span><span class="p">)),</span> <span class="p">(</span><span class="n">first_empty_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.update_graph_tuple" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update graph tuple for use with Jraph GNNs.
Edge and node features are updated from link_slot_array and node_capacity_array respectively.
Global features are updated as request_array.
Args:
    state (EnvState): Environment state
    params (EnvParams): Environment parameters
Returns:
    state (EnvState): Environment state with updated graph tuple</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_graph_tuple</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">EnvState</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">EnvParams</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update graph tuple for use with Jraph GNNs.</span>
<span class="sd">    Edge and node features are updated from link_slot_array and node_capacity_array respectively.</span>
<span class="sd">    Global features are updated as request_array.</span>
<span class="sd">    Args:</span>
<span class="sd">        state (EnvState): Environment state</span>
<span class="sd">        params (EnvParams): Environment parameters</span>
<span class="sd">    Returns:</span>
<span class="sd">        state (EnvState): Environment state with updated graph tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get source and dest from request array</span>
    <span class="n">source_dest</span><span class="p">,</span> <span class="n">datarate</span> <span class="o">=</span> <span class="n">read_rsa_request</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">request_array</span><span class="p">)</span>
    <span class="n">source</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">source_dest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">source_dest</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Global feature is normalised data rate of current request</span>
    <span class="nb">globals</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">datarate</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values_bw</span><span class="o">.</span><span class="n">val</span><span class="p">)],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="c1"># One-hot encode source and destination</span>
    <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>
    <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">source_dest_features</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">source</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">source_dest_features</span> <span class="o">=</span> <span class="n">source_dest_features</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">dest</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">),</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">spectral_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">holding_time_edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_departure_array</span> <span class="o">/</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;RSAGNModelEnvParams&quot;</span><span class="p">,</span> <span class="s2">&quot;RMSAGNModelEnvParams&quot;</span><span class="p">]:</span>
        <span class="c1"># Normalize by max parameters (converted to linear units)</span>
        <span class="n">max_power</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">from_dbm</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_power</span><span class="p">)</span>
        <span class="n">normalized_power</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">channel_power_array</span> <span class="o">/</span> <span class="n">max_power</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">max_snr</span> <span class="o">=</span> <span class="n">isrs_gn_model</span><span class="o">.</span><span class="n">from_db</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">max_snr</span><span class="p">)</span>
        <span class="n">normalized_snr</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">link_snr_array</span> <span class="o">/</span> <span class="n">max_snr</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">normalized_snr</span><span class="p">,</span> <span class="n">normalized_power</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">params</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;VONEEnvParams&quot;</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span> <span class="o">&gt;</span> <span class="mf">1e5</span> <span class="k">else</span> <span class="n">holding_time_edge_features</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;node_capacity_array&quot;</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">num_nodes</span><span class="p">))</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">node_features</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">node_features</span><span class="p">,</span> <span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">edge_features</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">link_slot_array</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">mean_service_holding_time</span> <span class="o">&gt;</span> <span class="mf">1e5</span> <span class="k">else</span> <span class="n">holding_time_edge_features</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">spectral_features</span><span class="p">,</span> <span class="n">source_dest_features</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">disable_node_features</span><span class="p">:</span>
        <span class="n">node_features</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">LARGE_FLOAT_DTYPE</span><span class="p">)</span>

    <span class="n">edge_features</span> <span class="o">=</span> <span class="n">edge_features</span> <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">directed_graph</span> <span class="k">else</span> <span class="n">jnp</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">edge_features</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">node_features</span><span class="p">,</span> <span class="n">edges</span><span class="o">=</span><span class="n">edge_features</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">state</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.update_node_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_node_array</span><span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Used to udated selected_nodes array with new requested resources on each node, for use in</p>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_node_array</span><span class="p">(</span><span class="n">node_indices</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used to udated selected_nodes array with new requested resources on each node, for use in &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">node_indices</span> <span class="o">==</span> <span class="n">node</span><span class="p">,</span> <span class="n">array</span><span class="o">-</span><span class="n">request</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.vmap_set_path_links" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vmap_set_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Set relevant slots along links in path to val.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path (row from path-link array that indicates links used by path)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_slot</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slots</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to set on link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated link slot array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vmap_set_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set relevant slots along links in path to val.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array: Link slot array</span>
<span class="sd">        path: Path (row from path-link array that indicates links used by path)</span>
<span class="sd">        initial_slot: Initial slot</span>
<span class="sd">        num_slots: Number of slots</span>
<span class="sd">        value: Value to set on link slot array</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated link slot array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">set_path</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.vmap_update_node_departure" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vmap_update_node_departure</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Called when implementing node action.
Sets request departure time ("value") in place of first "inf" i.e. unoccupied index on node departure array for selected nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_departure_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N x R) Node departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selected_nodes</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N x 1) Selected nodes (non-zero value on selected node indices)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to set on node departure array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated node departure array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vmap_update_node_departure</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Called when implementing node action.</span>
<span class="sd">    Sets request departure time (&quot;value&quot;) in place of first &quot;inf&quot; i.e. unoccupied index on node departure array for selected nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_departure_array: (N x R) Node departure array</span>
<span class="sd">        selected_nodes: (N x 1) Selected nodes (non-zero value on selected node indices)</span>
<span class="sd">        value: Value to set on node departure array</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated node departure array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_inf_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">MED_INT_DTYPE</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">update_selected_node_departure</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">node_departure_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">,</span> <span class="n">first_inf_indices</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.vmap_update_node_resources" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vmap_update_node_resources</span><span class="p">(</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Called when implementing node action.
Sets requested node resources on selected nodes in place of first "zero" i.e.
unoccupied index on node resource array for selected nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>node_resource_array</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N x R) Node resource array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>selected_nodes</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(N x 1) Requested resources on selected nodes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated node resource array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vmap_update_node_resources</span><span class="p">(</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Called when implementing node action.</span>
<span class="sd">    Sets requested node resources on selected nodes in place of first &quot;zero&quot; i.e.</span>
<span class="sd">    unoccupied index on node resource array for selected nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        node_resource_array: (N x R) Node resource array</span>
<span class="sd">        selected_nodes: (N x 1) Requested resources on selected nodes</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated node resource array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_zero_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">update_selected_node_resources</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))(</span><span class="n">node_resource_array</span><span class="p">,</span> <span class="n">selected_nodes</span><span class="p">,</span> <span class="n">first_zero_indices</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlron.heuristics.heuristics.vmap_update_path_links" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">vmap_update_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Update relevant slots along links in path to current_val - val.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>link_slot_array</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path (row from path-link array that indicates links used by path)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_slot</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial slot</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slots</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of slots</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to subtract from link slot array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="xlron.environments.dataclasses.chex.Array">Array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated link slot array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>xlron/environments/env_funcs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">vmap_update_path_links</span><span class="p">(</span><span class="n">link_slot_array</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">chex</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update relevant slots along links in path to current_val - val.</span>

<span class="sd">    Args:</span>
<span class="sd">        link_slot_array: Link slot array</span>
<span class="sd">        path: Path (row from path-link array that indicates links used by path)</span>
<span class="sd">        initial_slot: Initial slot</span>
<span class="sd">        num_slots: Number of slots</span>
<span class="sd">        value: Value to subtract from link slot array</span>

<span class="sd">    Returns:</span>
<span class="sd">        Updated link slot array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">update_path</span><span class="p">,</span> <span class="n">in_axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))(</span><span class="n">link_slot_array</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">initial_slot</span><span class="p">,</span> <span class="n">num_slots</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["content.tabs.link", "search.suggest"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>